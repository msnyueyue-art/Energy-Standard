# 删除确认对话框国际化修复说明

## 修复概述

将电价设置页面的删除确认对话框从浏览器原生 `confirm()` 对话框替换为自定义模态框,解决了英文环境下对话框标题仍显示中文"此网页显示"的问题。

## 问题描述

在英文环境下,点击删除按钮时,浏览器原生的 `confirm()` 对话框会显示:
- **标题:** `此网页显示` (浏览器默认,无法自定义)
- **内容:** `Are you sure you want to delete this template?` (已国际化)
- **按钮:** `确定` / `取消` (浏览器默认,无法自定义)

这导致即使内容已经国际化,但标题和按钮仍然是中文或浏览器默认语言。

## 根本原因

浏览器原生的 `window.confirm()` 对话框的标题、按钮文本完全由浏览器控制,无法通过 JavaScript 自定义,因此无法实现完整的国际化。

## 解决方案

### 1. 创建自定义确认对话框函数

在 `electricity-price-new.html` 文件的第 6642-6699 行,新增了自定义确认对话框相关函数:

#### a) `showConfirmDialog()` - 显示确认对话框
```javascript
function showConfirmDialog(title, message, confirmText, cancelText, onConfirm) {
    // 创建自定义模态框
    // 完全可控的标题、内容、按钮文本
}
```

**特点:**
- 完全自定义的 UI
- 支持国际化的标题和按钮
- 使用回调函数处理确认操作
- 支持点击背景关闭

#### b) `closeConfirmDialog()` - 关闭确认对话框
```javascript
function closeConfirmDialog() {
    // 移除对话框并清理回调
}
```

#### c) `confirmDialogAction()` - 执行确认操作
```javascript
function confirmDialogAction() {
    // 执行回调并关闭对话框
}
```

### 2. 修改 deleteTemplate 函数

**修改位置:** 第 6623-6640 行

**修改前:**
```javascript
function deleteTemplate(id) {
    const confirmText = getTranslation('elecPriceConfirmDeleteTemplate');
    const successText = getTranslation('elecPriceToastDeleteSuccess');

    if (confirm(confirmText)) {  // 使用浏览器原生对话框
        templates = templates.filter(t => t.id !== id);
        renderTemplates();
        showToast(successText, 'success');
    }
}
```

**修改后:**
```javascript
function deleteTemplate(id) {
    const confirmTitle = getTranslation('elecPriceConfirmDeleteTitle');
    const confirmText = getTranslation('elecPriceConfirmDeleteTemplate');
    const confirmBtn = getTranslation('elecPriceBtnConfirm');
    const cancelBtn = getTranslation('elecPriceBtnCancel');

    showConfirmDialog(confirmTitle, confirmText, confirmBtn, cancelBtn, () => {
        const successText = getTranslation('elecPriceToastDeleteSuccess');
        templates = templates.filter(t => t.id !== id);
        renderTemplates();
        showToast(successText, 'success');
    });
}
```

### 3. 添加国际化翻译键

在 `common.js` 文件中添加了新的翻译键:

**中文翻译** (第 3665 行):
```javascript
elecPriceConfirmDeleteTitle: '确认删除',
```

**英文翻译** (第 7393 行):
```javascript
elecPriceConfirmDeleteTitle: 'Confirm Delete',
```

**注:** `elecPriceBtnConfirm` 和 `elecPriceBtnCancel` 已存在,无需新增。

## 效果对比

### 修改前 (浏览器原生对话框)

**中文环境:**
- 标题: `此网页显示`
- 内容: `确定要删除此模版吗？`
- 按钮: `确定` / `取消`

**英文环境:**
- 标题: `此网页显示` ❌ (无法自定义)
- 内容: `Are you sure you want to delete this template?`
- 按钮: `确定` / `取消` ❌ (无法自定义)

### 修改后 (自定义模态框)

**中文环境:**
- 标题: `确认删除` ✅
- 内容: `确定要删除此模版吗？` ✅
- 按钮: `确认` / `取消` ✅

**英文环境:**
- 标题: `Confirm Delete` ✅
- 内容: `Are you sure you want to delete this template?` ✅
- 按钮: `Confirm` / `Cancel` ✅

## 技术特点

1. **完全可控:** 对话框的所有元素都可以自定义
2. **样式一致:** 使用现有的模态框样式,与页面整体风格统一
3. **交互友好:**
   - 点击背景可关闭
   - 支持关闭按钮
   - 键盘操作友好
4. **可扩展:** 函数可用于其他需要确认的操作
5. **回调机制:** 使用回调函数灵活处理确认逻辑

## 对话框 HTML 结构

```html
<div class="modal" id="customConfirmDialog">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h3 class="modal-title">确认删除 / Confirm Delete</h3>
            <button class="modal-close">×</button>
        </div>
        <div class="modal-body">
            <p>确定要删除此模版吗？ / Are you sure you want to delete this template?</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary">取消 / Cancel</button>
            <button class="btn btn-primary">确认 / Confirm</button>
        </div>
    </div>
</div>
```

## 可扩展性

这个自定义确认对话框可以用于其他需要确认的场景:

```javascript
// 示例:删除电站配置
showConfirmDialog(
    '确认删除',
    '确定要删除此电站配置吗?',
    '确认',
    '取消',
    () => {
        // 执行删除操作
        console.log('已确认删除');
    }
);
```

## 测试建议

1. **中文环境测试:**
   - 点击任一模板的删除按钮
   - 验证对话框标题显示"确认删除"
   - 验证按钮显示"确认"和"取消"
   - 点击"确认"验证删除成功
   - 点击"取消"验证对话框关闭

2. **英文环境测试:**
   - 切换到英文
   - 点击任一模板的 Delete 按钮
   - 验证对话框标题显示"Confirm Delete"
   - 验证按钮显示"Confirm"和"Cancel"
   - 测试各按钮功能

3. **交互测试:**
   - 点击对话框背景验证可关闭
   - 点击右上角关闭按钮验证可关闭
   - 测试键盘 ESC 键关闭(如已实现)

## 相关文件

- **主文件:** `electricity-price-new.html`
- **翻译文件:** `common.js`
- **修改函数:**
  - `deleteTemplate()`
  - `showConfirmDialog()`
  - `closeConfirmDialog()`
  - `confirmDialogAction()`

## 未来优化建议

1. 添加 ESC 键关闭支持
2. 添加自动聚焦到确认按钮
3. 添加过渡动画效果
4. 支持自定义按钮样式
5. 支持更多回调(如取消回调)

## 日期

修复日期: 2026-01-14
