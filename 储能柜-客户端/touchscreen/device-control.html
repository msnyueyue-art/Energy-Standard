<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚¨èƒ½æŸœç®¡ç†ç³»ç»Ÿ - è®¾å¤‡æ§åˆ¶</title>
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="tech-ui-enhancement.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            overflow: hidden;
        }

        /* å¤´éƒ¨å¯¼èˆª */
        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #0a1628 100%);
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
        }
        
        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 600;
        }

        .cabinet-info {
            margin-left: 40px;
            color: white;
        }

        .cabinet-name {
            font-size: 18px;
            font-weight: 500;
        }

        .cabinet-status {
            font-size: 14px;
            color: #4ade80;
            margin-top: 5px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-time {
            color: white;
            font-size: 16px;
            font-family: 'Helvetica Neue', monospace;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-container {
            display: flex;
            height: calc(100vh - 80px);
        }

        /* ä¾§è¾¹å¯¼èˆª */
        .sidebar {
            width: 240px;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            padding: 30px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 30px;
            color: #666;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            font-size: 16px;
        }

        .nav-item:hover {
            background: #f0f2f5;
            color: #1e90ff;
        }

        .nav-item.active {
            background: linear-gradient(90deg, #e3f2fd 0%, transparent 100%);
            color: #1e90ff;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #1e90ff;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            width: 36px;
            height: 36px;
            background: #e3f2fd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1e90ff;
            font-size: 20px;
        }

        /* è¿è¡Œæ¨¡å¼é€‰æ‹© */
        .mode-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-option {
            flex: 1;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mode-option:hover {
            border-color: #1e90ff;
            background: #f0f8ff;
        }

        .mode-option.active {
            border-color: #1e90ff;
            background: #e3f2fd;
        }

        .mode-icon {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .mode-name {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 5px;
        }

        .mode-desc {
            font-size: 14px;
            color: #666;
        }

        /* æ§åˆ¶æŒ‰é’®ç»„ */
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .control-btn {
            padding: 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: #f3f4f6;
            color: #374151;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .control-btn.charge {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
        }

        .control-btn.discharge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .control-btn.stop {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .control-btn.standby {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }

        .control-btn-icon {
            font-size: 32px;
        }

        /* å‚æ•°è®¾ç½® */
        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .param-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .param-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .param-input {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f9fafb;
        }

        .param-input:focus {
            outline: none;
            border-color: #1e90ff;
            background: white;
            box-shadow: 0 0 0 3px rgba(30, 144, 255, 0.1);
        }

        .param-unit {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            pointer-events: none;
        }

        .input-wrapper {
            position: relative;
        }

        /* å³°è°·å¥—åˆ©æ—¶é—´è½´ */
        .timeline-container {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .timeline-header {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            color: #1a1a1a;
        }

        .timeline {
            position: relative;
            height: 80px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

        .time-labels {
            display: flex;
            height: 25px;
            border-bottom: 1px solid #e5e7eb;
        }

        .time-label {
            flex: 1;
            text-align: center;
            font-size: 12px;
            color: #666;
            padding-top: 5px;
            border-right: 1px solid #e5e7eb;
        }

        .time-label:last-child {
            border-right: none;
        }

        .time-blocks {
            display: flex;
            height: 55px;
        }

        .time-block {
            flex: 1;
            border-right: 1px solid #e5e7eb;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .time-block:last-child {
            border-right: none;
        }

        .time-block:hover {
            opacity: 0.8;
        }

        .time-block.peak {
            background: #fee2e2;
        }

        .time-block.valley {
            background: #dbeafe;
        }

        .time-block.normal {
            background: #f3f4f6;
        }

        /* å›¾ä¾‹ */
        .timeline-legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            font-size: 14px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
        }

        /* æ“ä½œæŒ‰é’® */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e5e7eb;
        }

        .action-btn {
            padding: 12px 32px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.primary {
            background: #1e90ff;
            color: white;
        }

        .action-btn.primary:hover {
            background: #1873cc;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(30, 144, 255, 0.3);
        }

        .action-btn.secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #e5e7eb;
        }

        .action-btn.secondary:hover {
            background: #e5e7eb;
        }

        /* çŠ¶æ€æç¤º */
        .status-banner {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 12px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #166534;
        }

        .status-banner.warning {
            background: #fef3c7;
            border-color: #fde68a;
            color: #92400e;
        }

        .status-banner.error {
            background: #fee2e2;
            border-color: #fecaca;
            color: #991b1b;
        }

        /* å“åº”å¼è®¾è®¡ - 10.1å¯¸å±å¹• */
        @media (max-width: 1280px) and (max-height: 800px) {
            .header {
                height: 60px;
                padding: 0 20px;
            }
            
            .logo-text {
                font-size: 20px;
            }
            
            .sidebar {
                width: 200px;
            }
            
            .nav-item {
                padding: 15px 20px;
                font-size: 14px;
            }
            
            .content {
                padding: 20px;
            }
            
            .control-btn {
                padding: 16px;
                font-size: 14px;
            }
            
            .control-btn-icon {
                font-size: 28px;
            }
        }

        /* å“åº”å¼è®¾è®¡ - 13.3å¯¸å±å¹• */
        @media (min-width: 1920px) and (min-height: 1080px) {
            .header {
                height: 100px;
                padding: 0 50px;
            }
            
            .logo-text {
                font-size: 28px;
            }
            
            .sidebar {
                width: 280px;
            }
            
            .nav-item {
                padding: 22px 40px;
                font-size: 18px;
            }
            
            .content {
                padding: 40px;
            }
            
            .control-btn {
                padding: 24px;
                font-size: 18px;
            }
            
            .control-btn-icon {
                font-size: 40px;
            }
        }

        /* ç¡®è®¤å¯¹è¯æ¡† */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .confirm-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .confirm-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1a1a1a;
        }

        .confirm-message {
            font-size: 16px;
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .confirm-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .confirm-btn.confirm {
            background: #1e90ff;
            color: white;
        }

        .confirm-btn.confirm:hover {
            background: #1873cc;
        }

        .confirm-btn.cancel {
            background: #f3f4f6;
            color: #374151;
        }

        .confirm-btn.cancel:hover {
            background: #e5e7eb;
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <div class="logo-icon">
                    <img src="logo.png" alt="Logo">
                </div>
                <div class="logo-text" data-lang="systemName">å‚¨èƒ½æŸœç®¡ç†ç³»ç»Ÿ</div>
            </div>
            <div class="cabinet-info">
                <div class="cabinet-name">å‚¨èƒ½æŸœ #001</div>
                <div class="cabinet-status">
                    <span data-lang="status">è¿è¡Œæ­£å¸¸</span>
                    <span class="status-dot status-normal" style="margin-left: 5px; width: 8px; height: 8px; background: #4ade80; border-radius: 50%; display: inline-block;"></span>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="header-time" id="currentTime">2024-01-31 14:30:00</div>
            <div class="header-buttons">
                <button class="header-btn" onclick="switchTheme()">ğŸ¨ <span data-lang="theme">ä¸»é¢˜</span></button>
                <button class="header-btn" onclick="switchLanguage()">ğŸŒ <span data-lang="language">è¯­è¨€</span></button>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-container">
        <!-- ä¾§è¾¹å¯¼èˆª -->
        <nav class="sidebar">
            <a href="home.html" class="nav-item">
                <span class="nav-icon">ğŸ </span>
                <span data-lang="navHome">é¦–é¡µ</span>
            </a>
            <a href="device-params.html" class="nav-item">
                <span class="nav-icon">ğŸ“Š</span>
                <span data-lang="navParams">è®¾å¤‡å‚æ•°</span>
            </a>
            <a href="device-control.html" class="nav-item active">
                <span class="nav-icon">ğŸ›ï¸</span>
                <span data-lang="navControl">è®¾å¤‡æ§åˆ¶</span>
            </a>
            <a href="alarms.html" class="nav-item">
                <span class="nav-icon">âš ï¸</span>
                <span data-lang="navAlarms">å‘Šè­¦</span>
            </a>
            <a href="settings.html" class="nav-item">
                <span class="nav-icon">âš™ï¸</span>
                <span data-lang="navSettings">è®¾ç½®</span>
            </a>
        </nav>

        <!-- å†…å®¹åŒºåŸŸ -->
        <main class="content">
            <!-- å½“å‰çŠ¶æ€æç¤º -->
            <div class="status-banner" id="statusBanner">
                <span>â„¹ï¸</span>
                <span data-lang="autoModeRunning">ç³»ç»Ÿæ­£åœ¨è‡ªåŠ¨æ¨¡å¼ä¸‹è¿è¡Œï¼Œæ ¹æ®å³°è°·å¥—åˆ©ç­–ç•¥è‡ªåŠ¨æ§åˆ¶å……æ”¾ç”µ</span>
            </div>

            <!-- è¿è¡Œæ¨¡å¼ -->
            <div class="control-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">ğŸ”„</div>
                        <span data-lang="runMode">è¿è¡Œæ¨¡å¼</span>
                    </h2>
                </div>
                
                <div class="mode-selector">
                    <div class="mode-option active" onclick="selectMode('auto')">
                        <div class="mode-icon">ğŸ¤–</div>
                        <div class="mode-name" data-lang="autoMode">è‡ªåŠ¨æ¨¡å¼</div>
                        <div class="mode-desc" data-lang="autoModeDesc">ç³»ç»Ÿæ ¹æ®ç­–ç•¥è‡ªåŠ¨æ§åˆ¶</div>
                    </div>
                    <div class="mode-option" onclick="selectMode('manual')">
                        <div class="mode-icon">ğŸ‘†</div>
                        <div class="mode-name" data-lang="manualMode">æ‰‹åŠ¨æ¨¡å¼</div>
                        <div class="mode-desc" data-lang="manualModeDesc">æ‰‹åŠ¨æ§åˆ¶å……æ”¾ç”µæ“ä½œ</div>
                    </div>
                </div>
            </div>

            <!-- æ‰‹åŠ¨æ§åˆ¶ -->
            <div class="control-section" id="manualControl" style="display: none;">
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">ğŸ›ï¸</div>
                        <span data-lang="manualControl">æ‰‹åŠ¨æ§åˆ¶</span>
                    </h2>
                </div>
                
                <div class="control-buttons">
                    <button class="control-btn charge" onclick="executeControl('charge')">
                        <span class="control-btn-icon">ğŸ”‹</span>
                        <span data-lang="charge">å……ç”µ</span>
                    </button>
                    <button class="control-btn discharge" onclick="executeControl('discharge')">
                        <span class="control-btn-icon">âš¡</span>
                        <span data-lang="discharge">æ”¾ç”µ</span>
                    </button>
                    <button class="control-btn stop" onclick="executeControl('stop')">
                        <span class="control-btn-icon">â¹ï¸</span>
                        <span data-lang="stop">åœæ­¢</span>
                    </button>
                    <button class="control-btn standby" onclick="executeControl('standby')">
                        <span class="control-btn-icon">â¸ï¸</span>
                        <span data-lang="standby">å¾…æœº</span>
                    </button>
                </div>
            </div>

            <!-- å³°è°·å¥—åˆ©è®¾ç½® -->
            <div class="control-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">ğŸ“ˆ</div>
                        <span data-lang="peakValley">å³°è°·å¥—åˆ©è®¾ç½®</span>
                    </h2>
                </div>
                
                <div class="timeline-container">
                    <div class="timeline-header" data-lang="timeSettings">æ—¶é—´æ®µè®¾ç½®ï¼ˆç‚¹å‡»æ—¶é—´å—åˆ‡æ¢å³°è°·å¹³çŠ¶æ€ï¼‰</div>
                    <div class="timeline">
                        <div class="time-labels">
                            <div class="time-label">0-2</div>
                            <div class="time-label">2-4</div>
                            <div class="time-label">4-6</div>
                            <div class="time-label">6-8</div>
                            <div class="time-label">8-10</div>
                            <div class="time-label">10-12</div>
                            <div class="time-label">12-14</div>
                            <div class="time-label">14-16</div>
                            <div class="time-label">16-18</div>
                            <div class="time-label">18-20</div>
                            <div class="time-label">20-22</div>
                            <div class="time-label">22-24</div>
                        </div>
                        <div class="time-blocks" id="timeBlocks">
                            <!-- æ—¶é—´å—å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="timeline-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #fee2e2;"></div>
                            <span data-lang="peak">å³°å€¼æ—¶æ®µ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #dbeafe;"></div>
                            <span data-lang="valley">è°·å€¼æ—¶æ®µ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f3f4f6;"></div>
                            <span data-lang="normal">å¹³ä»·æ—¶æ®µ</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç”µæ± å‚æ•°è®¾ç½® -->
            <div class="control-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">ğŸ”‹</div>
                        <span data-lang="batteryParams">ç”µæ± å‚æ•°è®¾ç½®</span>
                    </h2>
                </div>
                
                <div class="param-grid">
                    <div class="param-item">
                        <label class="param-label" data-lang="chargeStopSOC">å……ç”µåœæ­¢SOC</label>
                        <div class="input-wrapper">
                            <input type="number" class="param-input" id="chargeStopSOC" value="95" min="0" max="100">
                            <span class="param-unit">%</span>
                        </div>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="chargePower">å……ç”µåŠŸç‡</label>
                        <div class="input-wrapper">
                            <input type="number" class="param-input" id="chargePower" value="250" min="0" max="500">
                            <span class="param-unit">kW</span>
                        </div>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="dischargeStopSOC">æ”¾ç”µåœæ­¢SOC</label>
                        <div class="input-wrapper">
                            <input type="number" class="param-input" id="dischargeStopSOC" value="10" min="0" max="100">
                            <span class="param-unit">%</span>
                        </div>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="dischargePower">æ”¾ç”µåŠŸç‡</label>
                        <div class="input-wrapper">
                            <input type="number" class="param-input" id="dischargePower" value="250" min="0" max="500">
                            <span class="param-unit">kW</span>
                        </div>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="balanceControl">å‡è¡¡æ§åˆ¶</label>
                        <select class="param-input" id="balanceControl">
                            <option value="active" data-lang="activeBalance">ä¸»åŠ¨å‡è¡¡</option>
                            <option value="passive" data-lang="passiveBalance">è¢«åŠ¨å‡è¡¡</option>
                        </select>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="fanControl">é£æ‰‡æ§åˆ¶</label>
                        <select class="param-input" id="fanControl">
                            <option value="auto" data-lang="auto">è‡ªåŠ¨</option>
                            <option value="on" data-lang="on">å¼€å¯</option>
                            <option value="off" data-lang="off">å…³é—­</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- æ¶ˆé˜²æ§åˆ¶ -->
            <div class="control-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <div class="section-icon">ğŸš¨</div>
                        <span data-lang="fireControl">æ¶ˆé˜²æ§åˆ¶</span>
                    </h2>
                </div>
                
                <div class="param-grid">
                    <div class="param-item">
                        <label class="param-label" data-lang="fireStartMode">ç­ç«å¯åŠ¨</label>
                        <select class="param-input" id="fireStartMode">
                            <option value="auto" data-lang="autoStart">è‡ªåŠ¨å¯åŠ¨</option>
                            <option value="manual" data-lang="manualStart">æ‰‹åŠ¨å¯åŠ¨</option>
                        </select>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="fireAgent">ç­ç«å‰‚ç±»å‹</label>
                        <select class="param-input" id="fireAgent">
                            <option value="perfluorohexanone" data-lang="perfluorohexanone">å…¨æ°Ÿå·±é…®</option>
                            <option value="heptafluoropropane" data-lang="heptafluoropropane">ä¸ƒæ°Ÿä¸™çƒ·</option>
                        </select>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="alarmSound">å£°å…‰æŠ¥è­¦</label>
                        <select class="param-input" id="alarmSound">
                            <option value="enable" data-lang="enable">å¯ç”¨</option>
                            <option value="disable" data-lang="disable">ç¦ç”¨</option>
                        </select>
                    </div>
                    <div class="param-item">
                        <label class="param-label" data-lang="emergencyPower">ç´§æ€¥æ–­ç”µ</label>
                        <select class="param-input" id="emergencyPower">
                            <option value="auto" data-lang="auto">è‡ªåŠ¨</option>
                            <option value="manual" data-lang="manual">æ‰‹åŠ¨</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="action-buttons">
                <button class="action-btn secondary" onclick="resetSettings()">
                    <span data-lang="reset">é‡ç½®é»˜è®¤</span>
                </button>
                <button class="action-btn primary" onclick="saveSettings()">
                    <span data-lang="save">ä¿å­˜è®¾ç½®</span>
                </button>
            </div>
        </main>
    </div>

    <!-- ç¡®è®¤å¯¹è¯æ¡† -->
    <div class="confirm-dialog" id="confirmDialog">
        <div class="confirm-content">
            <h3 class="confirm-title" id="confirmTitle">ç¡®è®¤æ“ä½œ</h3>
            <p class="confirm-message" id="confirmMessage">ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
            <div class="confirm-buttons">
                <button class="confirm-btn cancel" onclick="closeConfirm()">
                    <span data-lang="cancel">å–æ¶ˆ</span>
                </button>
                <button class="confirm-btn confirm" onclick="confirmAction()">
                    <span data-lang="confirm">ç¡®è®¤</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // è¯­è¨€é…ç½®
        const translations = {
            zh: {
                systemName: 'å‚¨èƒ½æŸœç®¡ç†ç³»ç»Ÿ',
                status: 'è¿è¡Œæ­£å¸¸',
                theme: 'ä¸»é¢˜',
                language: 'è¯­è¨€',
                navHome: 'é¦–é¡µ',
                navParams: 'è®¾å¤‡å‚æ•°',
                navControl: 'è®¾å¤‡æ§åˆ¶',
                navAlarms: 'å‘Šè­¦',
                navSettings: 'è®¾ç½®',
                autoModeRunning: 'ç³»ç»Ÿæ­£åœ¨è‡ªåŠ¨æ¨¡å¼ä¸‹è¿è¡Œï¼Œæ ¹æ®å³°è°·å¥—åˆ©ç­–ç•¥è‡ªåŠ¨æ§åˆ¶å……æ”¾ç”µ',
                runMode: 'è¿è¡Œæ¨¡å¼',
                autoMode: 'è‡ªåŠ¨æ¨¡å¼',
                autoModeDesc: 'ç³»ç»Ÿæ ¹æ®ç­–ç•¥è‡ªåŠ¨æ§åˆ¶',
                manualMode: 'æ‰‹åŠ¨æ¨¡å¼',
                manualModeDesc: 'æ‰‹åŠ¨æ§åˆ¶å……æ”¾ç”µæ“ä½œ',
                manualControl: 'æ‰‹åŠ¨æ§åˆ¶',
                charge: 'å……ç”µ',
                discharge: 'æ”¾ç”µ',
                stop: 'åœæ­¢',
                standby: 'å¾…æœº',
                peakValley: 'å³°è°·å¥—åˆ©è®¾ç½®',
                timeSettings: 'æ—¶é—´æ®µè®¾ç½®ï¼ˆç‚¹å‡»æ—¶é—´å—åˆ‡æ¢å³°è°·å¹³çŠ¶æ€ï¼‰',
                peak: 'å³°å€¼æ—¶æ®µ',
                valley: 'è°·å€¼æ—¶æ®µ',
                normal: 'å¹³ä»·æ—¶æ®µ',
                batteryParams: 'ç”µæ± å‚æ•°è®¾ç½®',
                chargeStopSOC: 'å……ç”µåœæ­¢SOC',
                chargePower: 'å……ç”µåŠŸç‡',
                dischargeStopSOC: 'æ”¾ç”µåœæ­¢SOC',
                dischargePower: 'æ”¾ç”µåŠŸç‡',
                balanceControl: 'å‡è¡¡æ§åˆ¶',
                activeBalance: 'ä¸»åŠ¨å‡è¡¡',
                passiveBalance: 'è¢«åŠ¨å‡è¡¡',
                fanControl: 'é£æ‰‡æ§åˆ¶',
                auto: 'è‡ªåŠ¨',
                on: 'å¼€å¯',
                off: 'å…³é—­',
                fireControl: 'æ¶ˆé˜²æ§åˆ¶',
                fireStartMode: 'ç­ç«å¯åŠ¨',
                autoStart: 'è‡ªåŠ¨å¯åŠ¨',
                manualStart: 'æ‰‹åŠ¨å¯åŠ¨',
                fireAgent: 'ç­ç«å‰‚ç±»å‹',
                perfluorohexanone: 'å…¨æ°Ÿå·±é…®',
                heptafluoropropane: 'ä¸ƒæ°Ÿä¸™çƒ·',
                alarmSound: 'å£°å…‰æŠ¥è­¦',
                enable: 'å¯ç”¨',
                disable: 'ç¦ç”¨',
                emergencyPower: 'ç´§æ€¥æ–­ç”µ',
                manual: 'æ‰‹åŠ¨',
                reset: 'é‡ç½®é»˜è®¤',
                save: 'ä¿å­˜è®¾ç½®',
                cancel: 'å–æ¶ˆ',
                confirm: 'ç¡®è®¤',
                confirmSave: 'ç¡®è®¤ä¿å­˜',
                confirmSaveMsg: 'ç¡®å®šè¦ä¿å­˜å½“å‰è®¾ç½®å—ï¼Ÿ',
                confirmReset: 'ç¡®è®¤é‡ç½®',
                confirmResetMsg: 'ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤è®¾ç½®å—ï¼Ÿæ‰€æœ‰ä¿®æ”¹å°†ä¸¢å¤±ã€‚',
                confirmCharge: 'ç¡®è®¤å……ç”µ',
                confirmChargeMsg: 'ç¡®å®šè¦å¼€å§‹å……ç”µå—ï¼Ÿ',
                confirmDischarge: 'ç¡®è®¤æ”¾ç”µ',
                confirmDischargeMsg: 'ç¡®å®šè¦å¼€å§‹æ”¾ç”µå—ï¼Ÿ',
                confirmStop: 'ç¡®è®¤åœæ­¢',
                confirmStopMsg: 'ç¡®å®šè¦åœæ­¢å½“å‰æ“ä½œå—ï¼Ÿ',
                confirmStandby: 'ç¡®è®¤å¾…æœº',
                confirmStandbyMsg: 'ç¡®å®šè¦è¿›å…¥å¾…æœºæ¨¡å¼å—ï¼Ÿ',
                saveSuccess: 'è®¾ç½®å·²ä¿å­˜',
                resetSuccess: 'å·²é‡ç½®ä¸ºé»˜è®¤è®¾ç½®',
                controlSuccess: 'æ§åˆ¶æŒ‡ä»¤å·²å‘é€'
            },
            en: {
                systemName: 'Energy Storage System',
                status: 'Running Normal',
                theme: 'Theme',
                language: 'Language',
                navHome: 'Home',
                navParams: 'Parameters',
                navControl: 'Control',
                navAlarms: 'Alarms',
                navSettings: 'Settings',
                autoModeRunning: 'System is running in automatic mode, controlling charge/discharge based on peak-valley arbitrage strategy',
                runMode: 'Run Mode',
                autoMode: 'Auto Mode',
                autoModeDesc: 'System controls automatically',
                manualMode: 'Manual Mode',
                manualModeDesc: 'Manual charge/discharge control',
                manualControl: 'Manual Control',
                charge: 'Charge',
                discharge: 'Discharge',
                stop: 'Stop',
                standby: 'Standby',
                peakValley: 'Peak-Valley Arbitrage Settings',
                timeSettings: 'Time Period Settings (Click blocks to switch peak/valley/normal)',
                peak: 'Peak Period',
                valley: 'Valley Period',
                normal: 'Normal Period',
                batteryParams: 'Battery Parameters',
                chargeStopSOC: 'Charge Stop SOC',
                chargePower: 'Charge Power',
                dischargeStopSOC: 'Discharge Stop SOC',
                dischargePower: 'Discharge Power',
                balanceControl: 'Balance Control',
                activeBalance: 'Active Balance',
                passiveBalance: 'Passive Balance',
                fanControl: 'Fan Control',
                auto: 'Auto',
                on: 'On',
                off: 'Off',
                fireControl: 'Fire Control',
                fireStartMode: 'Fire Start Mode',
                autoStart: 'Auto Start',
                manualStart: 'Manual Start',
                fireAgent: 'Fire Agent Type',
                perfluorohexanone: 'Perfluorohexanone',
                heptafluoropropane: 'Heptafluoropropane',
                alarmSound: 'Sound & Light Alarm',
                enable: 'Enable',
                disable: 'Disable',
                emergencyPower: 'Emergency Power Off',
                manual: 'Manual',
                reset: 'Reset Default',
                save: 'Save Settings',
                cancel: 'Cancel',
                confirm: 'Confirm',
                confirmSave: 'Confirm Save',
                confirmSaveMsg: 'Are you sure you want to save current settings?',
                confirmReset: 'Confirm Reset',
                confirmResetMsg: 'Are you sure you want to reset to default settings? All changes will be lost.',
                confirmCharge: 'Confirm Charge',
                confirmChargeMsg: 'Are you sure you want to start charging?',
                confirmDischarge: 'Confirm Discharge',
                confirmDischargeMsg: 'Are you sure you want to start discharging?',
                confirmStop: 'Confirm Stop',
                confirmStopMsg: 'Are you sure you want to stop current operation?',
                confirmStandby: 'Confirm Standby',
                confirmStandbyMsg: 'Are you sure you want to enter standby mode?',
                saveSuccess: 'Settings saved',
                resetSuccess: 'Reset to default settings',
                controlSuccess: 'Control command sent'
            }
        };

        let currentLang = localStorage.getItem('touchscreen_lang') || 'zh';
        let currentTheme = localStorage.getItem('touchscreen_theme') || 'light';
        let currentMode = 'auto';
        let pendingAction = null;

        // æ—¶é—´æ®µé…ç½® (0-23å°æ—¶ï¼Œæ¯ä¸ªå°æ—¶çš„çŠ¶æ€)
        let timeBlockStates = [
            'valley', 'valley', 'valley', 'valley', 'valley', 'valley', // 0-5
            'normal', 'normal', 'peak', 'peak', 'peak', 'normal',       // 6-11
            'normal', 'normal', 'normal', 'normal', 'normal', 'normal', // 12-17
            'peak', 'peak', 'peak', 'normal', 'valley', 'valley'        // 18-23
        ];

        // æ›´æ–°æ—¶é—´
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeStr;
        }

        // åˆ‡æ¢è¯­è¨€
        function switchLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            localStorage.setItem('touchscreen_lang', currentLang);
            applyLanguage();
        }

        // åº”ç”¨è¯­è¨€
        function applyLanguage() {
            document.querySelectorAll('[data-lang]').forEach(elem => {
                const key = elem.getAttribute('data-lang');
                if (translations[currentLang][key]) {
                    elem.textContent = translations[currentLang][key];
                }
            });
        }

        // åˆ‡æ¢ä¸»é¢˜
        function switchTheme() {
            // æ˜¾ç¤ºä¸»é¢˜é€‰æ‹©å™¨
            if (window.ThemeManager) {
                ThemeManager.showThemePicker();
            }
        }

        // åº”ç”¨ä¸»é¢˜
        function applyTheme() {
            // ä½¿ç”¨ ThemeManager å¤„ç†ä¸»é¢˜
            const theme = localStorage.getItem('touchscreen_theme') || 'light';
            if (window.ThemeManager) {
                ThemeManager.applyTheme(theme);
            }
        }


        // é€‰æ‹©è¿è¡Œæ¨¡å¼
        function selectMode(mode) {
            currentMode = mode;
            
            // æ›´æ–°æ¨¡å¼é€‰é¡¹çŠ¶æ€
            document.querySelectorAll('.mode-option').forEach(option => {
                option.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // æ˜¾ç¤º/éšè—æ‰‹åŠ¨æ§åˆ¶åŒºåŸŸ
            const manualControl = document.getElementById('manualControl');
            const statusBanner = document.getElementById('statusBanner');
            
            if (mode === 'manual') {
                manualControl.style.display = 'block';
                statusBanner.innerHTML = '<span>âš ï¸</span><span>' + 
                    (currentLang === 'zh' ? 'ç³»ç»Ÿå·²åˆ‡æ¢åˆ°æ‰‹åŠ¨æ¨¡å¼ï¼Œè¯·è°¨æ…æ“ä½œ' : 'System switched to manual mode, please operate carefully') + 
                    '</span>';
                statusBanner.className = 'status-banner warning';
            } else {
                manualControl.style.display = 'none';
                statusBanner.innerHTML = '<span>â„¹ï¸</span><span>' + 
                    translations[currentLang].autoModeRunning + 
                    '</span>';
                statusBanner.className = 'status-banner';
            }
        }

        // æ‰§è¡Œæ§åˆ¶å‘½ä»¤
        function executeControl(action) {
            let title, message;
            
            switch(action) {
                case 'charge':
                    title = translations[currentLang].confirmCharge;
                    message = translations[currentLang].confirmChargeMsg;
                    break;
                case 'discharge':
                    title = translations[currentLang].confirmDischarge;
                    message = translations[currentLang].confirmDischargeMsg;
                    break;
                case 'stop':
                    title = translations[currentLang].confirmStop;
                    message = translations[currentLang].confirmStopMsg;
                    break;
                case 'standby':
                    title = translations[currentLang].confirmStandby;
                    message = translations[currentLang].confirmStandbyMsg;
                    break;
            }
            
            pendingAction = () => {
                // æ¨¡æ‹Ÿå‘é€æ§åˆ¶å‘½ä»¤
                console.log('Executing control:', action);
                showNotification(translations[currentLang].controlSuccess, 'success');
                
                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                updateControlStatus(action);
            };
            
            showConfirm(title, message);
        }

        // æ›´æ–°æ§åˆ¶çŠ¶æ€
        function updateControlStatus(action) {
            const statusBanner = document.getElementById('statusBanner');
            let statusText = '';
            
            switch(action) {
                case 'charge':
                    statusText = currentLang === 'zh' ? 'è®¾å¤‡æ­£åœ¨å……ç”µä¸­...' : 'Device is charging...';
                    break;
                case 'discharge':
                    statusText = currentLang === 'zh' ? 'è®¾å¤‡æ­£åœ¨æ”¾ç”µä¸­...' : 'Device is discharging...';
                    break;
                case 'stop':
                    statusText = currentLang === 'zh' ? 'è®¾å¤‡å·²åœæ­¢è¿è¡Œ' : 'Device has stopped';
                    break;
                case 'standby':
                    statusText = currentLang === 'zh' ? 'è®¾å¤‡å¤„äºå¾…æœºçŠ¶æ€' : 'Device is in standby mode';
                    break;
            }
            
            statusBanner.innerHTML = '<span>â„¹ï¸</span><span>' + statusText + '</span>';
            statusBanner.className = 'status-banner';
        }

        // åˆå§‹åŒ–æ—¶é—´å—
        function initTimeBlocks() {
            const timeBlocksContainer = document.getElementById('timeBlocks');
            timeBlocksContainer.innerHTML = '';
            
            // åˆ›å»º12ä¸ª2å°æ—¶çš„æ—¶é—´å—
            for (let i = 0; i < 12; i++) {
                const block = document.createElement('div');
                block.className = 'time-block';
                block.dataset.index = i;
                
                // æ ¹æ®ä¸¤ä¸ªå°æ—¶çš„çŠ¶æ€å†³å®šæ—¶é—´å—é¢œè‰²
                const hour1State = timeBlockStates[i * 2];
                const hour2State = timeBlockStates[i * 2 + 1];
                
                // å¦‚æœä¸¤ä¸ªå°æ—¶çŠ¶æ€ç›¸åŒï¼Œä½¿ç”¨è¯¥çŠ¶æ€ï¼›å¦åˆ™é»˜è®¤ä¸ºnormal
                if (hour1State === hour2State) {
                    block.classList.add(hour1State);
                } else {
                    block.classList.add('normal');
                }
                
                block.onclick = () => toggleTimeBlock(i);
                timeBlocksContainer.appendChild(block);
            }
        }

        // åˆ‡æ¢æ—¶é—´å—çŠ¶æ€
        function toggleTimeBlock(index) {
            const block = document.querySelector(`.time-block[data-index="${index}"]`);
            const states = ['valley', 'normal', 'peak'];
            
            // è·å–å½“å‰çŠ¶æ€
            let currentState = 'normal';
            states.forEach(state => {
                if (block.classList.contains(state)) {
                    currentState = state;
                }
            });
            
            // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€
            const currentIndex = states.indexOf(currentState);
            const nextIndex = (currentIndex + 1) % states.length;
            const nextState = states[nextIndex];
            
            // æ›´æ–°æ ·å¼
            states.forEach(state => block.classList.remove(state));
            block.classList.add(nextState);
            
            // æ›´æ–°çŠ¶æ€æ•°ç»„
            timeBlockStates[index * 2] = nextState;
            timeBlockStates[index * 2 + 1] = nextState;
        }

        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            pendingAction = () => {
                // æ”¶é›†æ‰€æœ‰è®¾ç½®
                const settings = {
                    chargeStopSOC: document.getElementById('chargeStopSOC').value,
                    chargePower: document.getElementById('chargePower').value,
                    dischargeStopSOC: document.getElementById('dischargeStopSOC').value,
                    dischargePower: document.getElementById('dischargePower').value,
                    balanceControl: document.getElementById('balanceControl').value,
                    fanControl: document.getElementById('fanControl').value,
                    fireStartMode: document.getElementById('fireStartMode').value,
                    fireAgent: document.getElementById('fireAgent').value,
                    alarmSound: document.getElementById('alarmSound').value,
                    emergencyPower: document.getElementById('emergencyPower').value,
                    timeBlockStates: timeBlockStates
                };
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('touchscreen_control_settings', JSON.stringify(settings));
                
                showNotification(translations[currentLang].saveSuccess, 'success');
            };
            
            showConfirm(
                translations[currentLang].confirmSave,
                translations[currentLang].confirmSaveMsg
            );
        }

        // é‡ç½®è®¾ç½®
        function resetSettings() {
            pendingAction = () => {
                // é‡ç½®è¡¨å•å€¼
                document.getElementById('chargeStopSOC').value = '95';
                document.getElementById('chargePower').value = '250';
                document.getElementById('dischargeStopSOC').value = '10';
                document.getElementById('dischargePower').value = '250';
                document.getElementById('balanceControl').value = 'active';
                document.getElementById('fanControl').value = 'auto';
                document.getElementById('fireStartMode').value = 'auto';
                document.getElementById('fireAgent').value = 'perfluorohexanone';
                document.getElementById('alarmSound').value = 'enable';
                document.getElementById('emergencyPower').value = 'auto';
                
                // é‡ç½®æ—¶é—´å—
                timeBlockStates = [
                    'valley', 'valley', 'valley', 'valley', 'valley', 'valley',
                    'normal', 'normal', 'peak', 'peak', 'peak', 'normal',
                    'normal', 'normal', 'normal', 'normal', 'normal', 'normal',
                    'peak', 'peak', 'peak', 'normal', 'valley', 'valley'
                ];
                initTimeBlocks();
                
                showNotification(translations[currentLang].resetSuccess, 'success');
            };
            
            showConfirm(
                translations[currentLang].confirmReset,
                translations[currentLang].confirmResetMsg
            );
        }

        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        function showConfirm(title, message) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmDialog').style.display = 'flex';
        }

        // å…³é—­ç¡®è®¤å¯¹è¯æ¡†
        function closeConfirm() {
            document.getElementById('confirmDialog').style.display = 'none';
            pendingAction = null;
        }

        // ç¡®è®¤æ“ä½œ
        function confirmAction() {
            if (pendingAction) {
                pendingAction();
            }
            closeConfirm();
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            // ç®€å•çš„é€šçŸ¥å®ç°ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å¢å¼º
            const statusBanner = document.getElementById('statusBanner');
            const originalContent = statusBanner.innerHTML;
            const originalClass = statusBanner.className;
            
            statusBanner.innerHTML = '<span>âœ“</span><span>' + message + '</span>';
            statusBanner.className = 'status-banner ' + (type === 'success' ? '' : type);
            
            // 3ç§’åæ¢å¤åŸçŠ¶
            setTimeout(() => {
                statusBanner.innerHTML = originalContent;
                statusBanner.className = originalClass;
            }, 3000);
        }

        // åŠ è½½ä¿å­˜çš„è®¾ç½®
        function loadSettings() {
            const savedSettings = localStorage.getItem('touchscreen_control_settings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                // æ¢å¤è¡¨å•å€¼
                if (settings.chargeStopSOC) document.getElementById('chargeStopSOC').value = settings.chargeStopSOC;
                if (settings.chargePower) document.getElementById('chargePower').value = settings.chargePower;
                if (settings.dischargeStopSOC) document.getElementById('dischargeStopSOC').value = settings.dischargeStopSOC;
                if (settings.dischargePower) document.getElementById('dischargePower').value = settings.dischargePower;
                if (settings.balanceControl) document.getElementById('balanceControl').value = settings.balanceControl;
                if (settings.fanControl) document.getElementById('fanControl').value = settings.fanControl;
                if (settings.fireStartMode) document.getElementById('fireStartMode').value = settings.fireStartMode;
                if (settings.fireAgent) document.getElementById('fireAgent').value = settings.fireAgent;
                if (settings.alarmSound) document.getElementById('alarmSound').value = settings.alarmSound;
                if (settings.emergencyPower) document.getElementById('emergencyPower').value = settings.emergencyPower;
                
                // æ¢å¤æ—¶é—´å—çŠ¶æ€
                if (settings.timeBlockStates) {
                    timeBlockStates = settings.timeBlockStates;
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            const user = localStorage.getItem('touchscreen_user') || sessionStorage.getItem('touchscreen_user');
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            // åº”ç”¨ä¿å­˜çš„è®¾ç½®
            applyLanguage();
            applyTheme();
            
            // åŠ è½½ä¿å­˜çš„è®¾ç½®
            loadSettings();
            
            // åˆå§‹åŒ–æ—¶é—´å—
            initTimeBlocks();

            // æ›´æ–°æ—¶é—´
            updateTime();
            setInterval(updateTime, 1000);
        };
    </script>
    <script src="theme-manager.js"></script>
    <script src="tech-ui-enhancement.js"></script>
</body>
</html>