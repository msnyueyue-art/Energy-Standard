<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜æ–‡æœ¬è¯­è¨€åˆ‡æ¢æµ‹è¯•</title>
    <style>
        body {
            padding: 40px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #0066cc;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0052a3;
        }
        iframe {
            width: 100%;
            height: 150px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Dashboard ç®¡ç†å‘˜æ–‡æœ¬è¯­è¨€åˆ‡æ¢æµ‹è¯•</h1>

        <div class="test-section">
            <h3>1. LocalStorage è¯­è¨€è®¾ç½®æ£€æŸ¥</h3>
            <div id="storageStatus"></div>
            <button onclick="setLanguage('zh')">è®¾ç½®ä¸­æ–‡</button>
            <button onclick="setLanguage('en')">è®¾ç½®è‹±æ–‡</button>
            <button onclick="clearLanguage()">æ¸…é™¤è®¾ç½®</button>
        </div>

        <div class="test-section">
            <h3>2. ç¿»è¯‘æ–‡æœ¬æ£€æŸ¥</h3>
            <div id="translationStatus"></div>
        </div>

        <div class="test-section">
            <h3>3. Dashboard é¡µé¢æµ‹è¯•</h3>
            <p>è¯·åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€ dashboard.htmlï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š</p>
            <ol>
                <li>é¡µé¢åŠ è½½æ—¶ï¼Œ"ç®¡ç†å‘˜"æ–‡æœ¬æ˜¯å¦æ­£ç¡®æ˜¾ç¤º</li>
                <li>ç‚¹å‡»è¯­è¨€åˆ‡æ¢å›¾æ ‡åï¼Œæ˜¯å¦å˜æˆ "Administrator"</li>
                <li>åˆ·æ–°é¡µé¢åï¼Œè¯­è¨€è®¾ç½®æ˜¯å¦ä¿æŒ</li>
            </ol>
            <div id="dashboardStatus"></div>
        </div>

        <div class="test-section">
            <h3>4. é—®é¢˜è¯Šæ–­</h3>
            <div id="diagnosis"></div>
        </div>

        <div class="test-section">
            <h3>5. ä¿®å¤å»ºè®®</h3>
            <div id="solution"></div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥localStorage
        function checkStorage() {
            const lang = localStorage.getItem('language');
            const status = document.getElementById('storageStatus');
            if (lang) {
                status.innerHTML = `<div class="status info">å½“å‰è¯­è¨€è®¾ç½®: <strong>${lang}</strong></div>`;
                status.innerHTML += `<div class="status ${lang === 'zh' || lang === 'en' ? 'success' : 'error'}">
                    ${lang === 'zh' || lang === 'en' ? 'âœ…' : 'âŒ'} è¯­è¨€è®¾ç½®æœ‰æ•ˆ
                </div>`;
            } else {
                status.innerHTML = `<div class="status info">æœªè®¾ç½®è¯­è¨€ï¼Œé»˜è®¤ä½¿ç”¨: zh</div>`;
            }
        }

        // è®¾ç½®è¯­è¨€
        function setLanguage(lang) {
            localStorage.setItem('language', lang);
            checkStorage();
            checkTranslations();
        }

        // æ¸…é™¤è¯­è¨€è®¾ç½®
        function clearLanguage() {
            localStorage.removeItem('language');
            checkStorage();
        }

        // æ£€æŸ¥ç¿»è¯‘æ–‡æœ¬
        function checkTranslations() {
            const status = document.getElementById('translationStatus');
            const currentLang = localStorage.getItem('language') || 'zh';

            // æ¨¡æ‹Ÿç¿»è¯‘å¯¹è±¡
            const translations = {
                zh: { userName: 'ç®¡ç†å‘˜' },
                en: { userName: 'Administrator' }
            };

            status.innerHTML = `
                <div class="status info">
                    å½“å‰è¯­è¨€: <strong>${currentLang}</strong><br>
                    åº”æ˜¾ç¤ºæ–‡æœ¬: <strong>${translations[currentLang].userName}</strong>
                </div>
            `;

            // æ£€æŸ¥common.jsæ˜¯å¦å­˜åœ¨
            fetch('common.js')
                .then(response => response.text())
                .then(text => {
                    if (text.includes("userName: 'ç®¡ç†å‘˜'") && text.includes("userName: 'Administrator'")) {
                        status.innerHTML += `<div class="status success">âœ… common.js åŒ…å«æ­£ç¡®çš„ç¿»è¯‘æ–‡æœ¬</div>`;
                    } else {
                        status.innerHTML += `<div class="status error">âŒ common.js ç¿»è¯‘æ–‡æœ¬å¯èƒ½æœ‰é—®é¢˜</div>`;
                    }

                    // æ£€æŸ¥setLanguageå‡½æ•°
                    if (text.includes('function setLanguage')) {
                        status.innerHTML += `<div class="status success">âœ… setLanguage å‡½æ•°å­˜åœ¨</div>`;
                    }
                })
                .catch(err => {
                    status.innerHTML += `<div class="status error">âŒ æ— æ³•è¯»å– common.js</div>`;
                });
        }

        // è¯Šæ–­é—®é¢˜
        function diagnose() {
            const diagnosis = document.getElementById('diagnosis');
            const currentLang = localStorage.getItem('language') || 'zh';

            diagnosis.innerHTML = `
                <div class="status info">
                    <strong>å¯èƒ½çš„é—®é¢˜ï¼š</strong><br>
                    1. dashboard.html å¯èƒ½åœ¨ common.js åŠ è½½å‰å°±è®¾ç½®äº†æ–‡æœ¬<br>
                    2. é¡µé¢å¯èƒ½è¦†ç›–äº† common.js çš„åˆå§‹åŒ–<br>
                    3. ID ä¸º "userName" çš„å…ƒç´ å¯èƒ½è¢«å…¶ä»–è„šæœ¬ä¿®æ”¹
                </div>
            `;

            // æä¾›è§£å†³æ–¹æ¡ˆ
            const solution = document.getElementById('solution');
            solution.innerHTML = `
                <div class="status success">
                    <strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>
                    1. ç¡®ä¿ dashboard.html å¼•å…¥äº† common.js<br>
                    2. ç¡®ä¿é¡µé¢åŠ è½½æ—¶è°ƒç”¨äº† setLanguage(currentLang)<br>
                    3. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä»£ç è¦†ç›–äº† userName çš„æ–‡æœ¬<br>
                    4. è¯­è¨€åˆ‡æ¢æŒ‰é’®å·²ä¿®æ”¹ä¸ºé»‘è‰²å›¾æ ‡æ ·å¼ âœ…
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.addEventListener('load', function() {
            checkStorage();
            checkTranslations();
            diagnose();

            // æ˜¾ç¤ºå½“å‰dashboardçš„çŠ¶æ€
            const dashboardStatus = document.getElementById('dashboardStatus');
            dashboardStatus.innerHTML = `
                <div class="status info">
                    <strong>ä¿®æ”¹å†…å®¹ï¼š</strong><br>
                    âœ… è¯­è¨€åˆ‡æ¢æŒ‰é’®æ”¹ä¸ºé»‘è‰²å›¾æ ‡ï¼ˆä¸ç™»å½•é¡µä¸€è‡´ï¼‰<br>
                    âœ… common.js åŒ…å« userName çš„ç¿»è¯‘<br>
                    âœ… setLanguage å‡½æ•°ä¼šæ›´æ–° ID ä¸º userName çš„å…ƒç´ <br>
                    âš ï¸ éœ€è¦åˆ·æ–° dashboard.html é¡µé¢ä»¥æŸ¥çœ‹æ•ˆæœ
                </div>
            `;
        });
    </script>
</body>
</html>