<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">告警分析 - 储能柜管理系统</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="navbar.js"></script>
    <style>
        /* 艹！专业的告警分析系统样式，基于PRD设计 */
        .main-content {
            height: calc(100vh - 60px);
            overflow-y: auto;
            padding: 20px;
        }

        .page-header {
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 8px 0;
        }

        .page-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
        }

        /* Tab标签页导航 */
        .analysis-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 24px;
            padding: 4px;
            background: #f3f4f6;
            border-radius: 12px;
            overflow-x: auto;
        }

        [data-theme="dark"] .analysis-tabs {
            background: #0f172a;
        }

        .analysis-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 8px;
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .analysis-tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .analysis-tab.active {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .analysis-tab.active {
            background: #1e293b;
            color: #60a5fa;
        }

        .analysis-tab-icon {
            font-size: 16px;
        }

        /* Tab面板内容 */
        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========== Module 1: 实时告警监控 ========== */

        /* M1.1 实时告警概览 */
        .realtime-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .overview-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .overview-card {
            background: #1e293b;
        }

        .overview-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .overview-card.critical::before {
            background: #ef4444;
        }

        .overview-card.major::before {
            background: #f59e0b;
        }

        .overview-card.minor::before {
            background: #fbbf24;
        }

        .overview-card.info::before {
            background: #3b82f6;
        }

        .overview-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .overview-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .overview-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
        }

        .overview-trend.up {
            color: #ef4444;
        }

        .overview-trend.down {
            color: #10b981;
        }

        /* M1.4 筛选器区域 */
        .filter-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        [data-theme="dark"] .filter-section {
            background: #1e293b;
        }

        .filter-row {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .filter-select {
            height: 36px;
            padding: 0 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            min-width: 120px;
        }

        [data-theme="dark"] .filter-select {
            background: #0f172a;
            border-color: #334155;
            color: #e2e8f0;
        }

        .search-input {
            height: 36px;
            padding: 0 12px 0 36px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--text-primary);
            min-width: 300px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23666' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 12px center;
        }

        [data-theme="dark"] .search-input {
            background-color: #0f172a;
            border-color: #334155;
            color: #e2e8f0;
        }

        /* M1.2 告警列表 */
        .alarm-list-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .alarm-list-container {
            background: #1e293b;
        }

        .alarm-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        [data-theme="dark"] .alarm-list-header {
            border-bottom-color: #334155;
        }

        .alarm-list-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .alarm-count {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .alarm-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* 告警卡片（M1.2 + M1.3） */
        .alarm-card {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 16px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid;
            transition: all 0.2s;
            cursor: pointer;
        }

        [data-theme="dark"] .alarm-card {
            background: #0f172a;
        }

        .alarm-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .alarm-card.critical {
            border-left-color: #ef4444;
        }

        .alarm-card.major {
            border-left-color: #f59e0b;
        }

        .alarm-card.minor {
            border-left-color: #fbbf24;
        }

        .alarm-card.info {
            border-left-color: #3b82f6;
        }

        .alarm-level-badge {
            flex-shrink: 0;
            width: 56px;
            height: 56px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .alarm-level-badge.critical {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .alarm-level-badge.major {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .alarm-level-badge.minor {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        .alarm-level-badge.info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .alarm-content {
            flex: 1;
            min-width: 0;
        }

        .alarm-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .alarm-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .alarm-time {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .alarm-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 8px;
        }

        .alarm-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .alarm-meta-item i {
            font-size: 12px;
        }

        .alarm-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .alarm-status.unconfirmed {
            background: #fee2e2;
            color: #991b1b;
        }

        .alarm-status.processing {
            background: #fef3c7;
            color: #92400e;
        }

        .alarm-status.recovered {
            background: #d1fae5;
            color: #065f46;
        }

        [data-theme="dark"] .alarm-status.unconfirmed {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        [data-theme="dark"] .alarm-status.processing {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        [data-theme="dark"] .alarm-status.recovered {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

        /* M1.3 告警聚合标识 */
        .alarm-aggregation {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 4px;
            font-size: 12px;
            color: #667eea;
            margin-left: 8px;
        }

        [data-theme="dark"] .alarm-aggregation {
            background: rgba(102, 126, 234, 0.2);
            color: #a5b4fc;
        }

        /* ========== Module 2: 告警详情侧边栏 ========== */

        .alarm-detail-sidebar {
            position: fixed;
            top: 60px;
            right: 0;
            width: 500px;
            height: calc(100vh - 60px);
            background: white;
            box-shadow: -4px 0 24px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        [data-theme="dark"] .alarm-detail-sidebar {
            background: #1e293b;
        }

        .alarm-detail-sidebar.open {
            transform: translateX(0);
        }

        .detail-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            z-index: 10;
        }

        [data-theme="dark"] .detail-header {
            background: #1e293b;
            border-bottom-color: #334155;
        }

        .detail-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .detail-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .detail-close {
            width: 32px;
            height: 32px;
            border: none;
            background: #f3f4f6;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        [data-theme="dark"] .detail-close {
            background: #0f172a;
        }

        .detail-close:hover {
            background: #e5e7eb;
        }

        [data-theme="dark"] .detail-close:hover {
            background: #334155;
        }

        .detail-content {
            padding: 20px;
        }

        .detail-section {
            margin-bottom: 24px;
        }

        .detail-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-section-title i {
            color: var(--primary-color);
        }

        /* M2.1 根因分析 */
        .root-cause-box {
            padding: 16px;
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        [data-theme="dark"] .root-cause-box {
            background: rgba(245, 158, 11, 0.1);
        }

        .root-cause-label {
            font-size: 12px;
            font-weight: 600;
            color: #92400e;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        [data-theme="dark"] .root-cause-label {
            color: #fbbf24;
        }

        .root-cause-text {
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .sop-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sop-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: #f9fafb;
            border-radius: 8px;
        }

        [data-theme="dark"] .sop-item {
            background: #0f172a;
        }

        .sop-number {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sop-text {
            flex: 1;
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* M2.2 数据快照图表 */
        .snapshot-chart {
            height: 200px;
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        [data-theme="dark"] .snapshot-chart {
            background: #0f172a;
        }

        /* M2.3 关联事件 */
        .event-timeline {
            position: relative;
            padding-left: 32px;
        }

        .event-timeline::before {
            content: '';
            position: absolute;
            left: 11px;
            top: 8px;
            bottom: 8px;
            width: 2px;
            background: var(--border-color);
        }

        .event-item {
            position: relative;
            padding: 12px 0;
        }

        .event-item::before {
            content: '';
            position: absolute;
            left: -26px;
            top: 16px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary-color);
            border: 2px solid white;
        }

        [data-theme="dark"] .event-item::before {
            border-color: #1e293b;
        }

        .event-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .event-description {
            font-size: 14px;
            color: var(--text-primary);
        }

        /* ========== Module 3: 预测性维护与预警 ========== */

        /* M3.1 趋势预警概览 */
        .trend-overview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .trend-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .trend-card {
            background: #1e293b;
        }

        .trend-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .trend-card.warning::before {
            background: #f59e0b;
        }

        .trend-card.degrading::before {
            background: #fbbf24;
        }

        .trend-card.prediction::before {
            background: #8b5cf6;
        }

        /* 趋势预警列表 */
        .trend-list {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        [data-theme="dark"] .trend-list {
            background: #1e293b;
        }

        .trend-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 16px;
            margin-bottom: 12px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
            cursor: pointer;
            transition: all 0.2s;
        }

        [data-theme="dark"] .trend-item {
            background: #0f172a;
        }

        .trend-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .trend-icon {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .trend-content {
            flex: 1;
            min-width: 0;
        }

        .trend-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .trend-details {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .trend-chart-mini {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 40px;
            margin-top: 8px;
        }

        .trend-bar {
            flex: 1;
            background: linear-gradient(to top, #fbbf24, #f59e0b);
            border-radius: 2px;
            min-width: 4px;
        }

        /* M3.2 SOH/SOP监控 */
        .health-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .health-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .health-panel {
            background: #1e293b;
        }

        .health-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .health-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .health-score {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #10b981, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .health-score.degraded {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .health-chart {
            height: 180px;
            margin-bottom: 12px;
        }

        .health-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .health-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: #f9fafb;
            border-radius: 6px;
        }

        [data-theme="dark"] .health-item {
            background: #0f172a;
        }

        .health-item-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .health-item-value {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .health-trend {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .health-trend.up {
            background: #fee2e2;
            color: #991b1b;
        }

        .health-trend.down {
            background: #d1fae5;
            color: #065f46;
        }

        [data-theme="dark"] .health-trend.up {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        [data-theme="dark"] .health-trend.down {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

        /* M3.3 预测时间线 */
        .prediction-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .prediction-section {
            background: #1e293b;
        }

        .prediction-timeline {
            position: relative;
            padding: 24px 0;
        }

        .timeline-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(to right, #10b981, #fbbf24, #ef4444);
            transform: translateY(-50%);
        }

        .timeline-points {
            position: relative;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
        }

        .timeline-point {
            position: relative;
            text-align: center;
        }

        .timeline-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            border: 3px solid;
            margin: 0 auto 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timeline-dot:hover {
            transform: scale(1.3);
        }

        .timeline-dot.current {
            border-color: #10b981;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
        }

        .timeline-dot.warning {
            border-color: #fbbf24;
            box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.2);
        }

        .timeline-dot.critical {
            border-color: #ef4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        }

        .timeline-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .timeline-time {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .prediction-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 24px;
        }

        .prediction-card {
            padding: 16px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid;
        }

        [data-theme="dark"] .prediction-card {
            background: #0f172a;
        }

        .prediction-card.warning {
            border-left-color: #fbbf24;
        }

        .prediction-card.critical {
            border-left-color: #ef4444;
        }

        .prediction-card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .prediction-card-desc {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .prediction-card-time {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: #dc2626;
        }

        /* 响应式设计 */
        @media (max-width: 1400px) {
            .realtime-overview {
                grid-template-columns: repeat(2, 1fr);
            }

            .trend-overview {
                grid-template-columns: repeat(2, 1fr);
            }

            .health-grid {
                grid-template-columns: 1fr;
            }

            .prediction-cards {
                grid-template-columns: 1fr;
            }

            .alarm-detail-sidebar {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .realtime-overview,
            .trend-overview {
                grid-template-columns: 1fr;
            }

            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }

            .search-input {
                min-width: 100%;
            }

            .timeline-points {
                flex-direction: column;
                gap: 20px;
            }

            .timeline-line {
                top: 0;
                left: 50%;
                bottom: 0;
                width: 2px;
                height: auto;
                transform: translateX(-50%);
            }
        }

        /* ========== Module 4: 统计报表与优化决策 ========== */

        /* 统计报表章节 */
        .stats-section {
            margin-bottom: 32px;
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .stats-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .stats-date-range select {
            min-width: 140px;
        }

        /* 艹！告警热点分析 - 概览卡片 */
        .hotspot-overview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .hotspot-overview-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        [data-theme="dark"] .hotspot-overview-card {
            background: #1e293b;
        }

        .hotspot-overview-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            flex-shrink: 0;
        }

        .hotspot-overview-content {
            flex: 1;
        }

        .hotspot-overview-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .hotspot-overview-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .hotspot-overview-unit {
            font-size: 14px;
            font-weight: 400;
            margin-left: 4px;
        }

        .hotspot-overview-detail {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* 艹！热点Tab切换 */
        .hotspot-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .hotspot-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 15px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: -2px;
        }

        .hotspot-tab:hover {
            color: var(--text-primary);
        }

        .hotspot-tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .hotspot-tab i {
            font-size: 16px;
        }

        /* 艹！Tab内容面板 */
        .hotspot-tab-content {
            margin-top: 20px;
        }

        .hotspot-tab-panel {
            display: none;
        }

        .hotspot-tab-panel.active {
            display: block;
        }

        /* 艹！电站卡片列表 */
        /* 艹！电站分析表格样式 */
        .station-table-wrapper {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .station-table-wrapper {
            background: #1e293b;
        }

        .station-table {
            width: 100%;
            border-collapse: collapse;
        }

        .station-table thead tr {
            background: #f9fafb;
            border-bottom: 2px solid var(--border-color);
        }

        [data-theme="dark"] .station-table thead tr {
            background: #0f172a;
        }

        .station-table th {
            padding: 16px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: background 0.2s;
        }

        .station-table th:hover {
            background: rgba(59, 130, 246, 0.05);
        }

        [data-theme="dark"] .station-table th:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .station-table th.sortable {
            padding-right: 30px;
        }

        .station-table th .sort-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.3;
            font-size: 12px;
            transition: opacity 0.2s;
        }

        .station-table th:hover .sort-icon {
            opacity: 0.6;
        }

        .station-table th.sort-asc .sort-icon,
        .station-table th.sort-desc .sort-icon {
            opacity: 1;
            color: var(--primary-color);
        }

        .station-table th.sort-asc .sort-icon::before {
            content: '\f0de';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }

        .station-table th.sort-desc .sort-icon::before {
            content: '\f0dd';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }

        .station-table th:not(.sort-asc):not(.sort-desc) .sort-icon::before {
            content: '\f0dc';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }

        .station-table tbody tr {
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s;
        }

        .station-table tbody tr:hover {
            background: #f9fafb;
        }

        [data-theme="dark"] .station-table tbody tr:hover {
            background: #0f172a;
        }

        .station-table tbody tr:last-child {
            border-bottom: none;
        }

        .station-table td {
            padding: 16px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .station-name-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .station-table-number {
            font-weight: 600;
            color: var(--text-primary);
        }

        .station-table-unit {
            font-size: 12px;
            font-weight: 400;
            color: var(--text-secondary);
            margin-left: 2px;
        }

        .station-status {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .station-status.status-normal {
            background: #d1fae5;
            color: #065f46;
        }

        .station-status.status-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .station-status.status-critical {
            background: #fee2e2;
            color: #991b1b;
        }

        [data-theme="dark"] .station-status.status-normal {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

        [data-theme="dark"] .station-status.status-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        [data-theme="dark"] .station-status.status-critical {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        .station-metrics {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .station-metric {
            text-align: center;
        }

        .station-metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .station-metric-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .station-metric-unit {
            font-size: 12px;
            font-weight: 400;
            margin-left: 2px;
        }

        /* 艹！区域高频告警样式 */
        /* ===== 现代化词云可视化样式 ===== */

        .region-filter-container {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .region-select {
            min-width: 160px;
            height: 36px;
            padding: 0 12px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .region-select {
            background: rgba(30, 41, 59, 0.9);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .region-select:hover {
            border-color: rgba(0, 122, 255, 0.4);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.15);
        }

        .region-select:focus {
            outline: none;
            border-color: #007AFF;
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        /* 主容器 */
        .alarm-word-cloud-container {
            position: relative;
            min-height: 750px;
            background: white;
            border-radius: 12px;
            padding: 60px 40px 40px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .alarm-word-cloud-container {
            background: #1e293b;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        /* 内容包装器 - 圆形布局 */
        .cloud-content-wrapper {
            position: relative;
            width: 700px;
            height: 700px;
            margin: 0 auto;
        }

        /* 词云标签 - 纯文字版 */
        .cloud-tag {
            position: absolute;
            padding: 4px 8px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s ease;
            user-select: none;
            white-space: nowrap;
        }

        .cloud-tag:hover {
            opacity: 0.7;
        }

        /* Critical级别 */
        .cloud-tag[data-level="critical"] {
            color: #ef4444;
        }

        [data-theme="dark"] .cloud-tag[data-level="critical"] {
            color: #f87171;
        }

        /* Major级别 */
        .cloud-tag[data-level="major"] {
            color: #f59e0b;
        }

        [data-theme="dark"] .cloud-tag[data-level="major"] {
            color: #fbbf24;
        }

        /* Minor/Info级别 */
        .cloud-tag[data-level="minor"],
        .cloud-tag[data-level="info"] {
            color: #3b82f6;
        }

        [data-theme="dark"] .cloud-tag[data-level="minor"],
        [data-theme="dark"] .cloud-tag[data-level="info"] {
            color: #60a5fa;
        }

        /* 空状态 */
        .cloud-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            text-align: center;
        }

        .cloud-empty i {
            font-size: 48px;
            color: var(--text-tertiary);
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .cloud-empty-text {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* ===== 响应式设计 ===== */

        /* 移动端 */
        @media (max-width: 768px) {
            .region-filter-container {
                position: static;
                margin-bottom: 16px;
            }

            .region-select {
                width: 100%;
            }

            .alarm-word-cloud-container {
                padding: 40px 20px 20px;
                min-height: 450px;
            }

            .cloud-content-wrapper {
                width: 100%;
                max-width: 400px;
                height: 400px;
            }

            .cloud-tag {
                padding: 4px 6px;
            }

            /* 紧凑表格移动端样式 */
            .compact-dual-section {
                flex-direction: column;
                gap: 16px;
            }

            .compact-card {
                padding: 16px;
            }

            .compact-section-half {
                margin-bottom: 16px;
            }

            .compact-section-half:last-child {
                margin-bottom: 0;
            }

            .compact-data-table {
                font-size: 12px;
            }

            .compact-data-table th {
                padding: 8px 6px;
                font-size: 11px;
            }

            .compact-data-table td {
                padding: 10px 6px;
            }

            .compact-section-header > span {
                font-size: 13px;
            }

            .compact-action-link {
                font-size: 12px;
            }

            .device-types-cell {
                font-size: 11px;
            }

            .config-rule-btn {
                padding: 3px 8px;
                font-size: 11px;
            }

            .config-rule-btn span {
                display: none;
            }

            .config-rule-btn i {
                font-size: 12px;
            }

            .compact-data-table th:last-child,
            .compact-data-table td:last-child {
                width: 50px;
            }
        }

        /* 艹！告警配置和通知Tab的样式 */
        .config-guidance-card,
        .notification-guidance-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .config-guidance-card,
        [data-theme="dark"] .notification-guidance-card {
            background: #1e293b;
        }

        .guidance-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 24px;
        }

        .section-subtitle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 16px 0;
        }

        /* 艹！重复告警列表样式 */
        .repeat-alarm-section {
            margin-bottom: 32px;
        }

        .repeat-alarm-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .repeat-alarm-item {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s;
        }

        [data-theme="dark"] .repeat-alarm-item {
            background: #0f172a;
        }

        .repeat-alarm-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .repeat-alarm-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .repeat-alarm-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .repeat-alarm-count {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 16px;
        }

        .repeat-alarm-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        [data-theme="dark"] .repeat-alarm-bar {
            background: #334155;
        }

        .repeat-alarm-fill {
            height: 100%;
            transition: width 0.3s;
            border-radius: 4px;
        }

        .repeat-alarm-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* 艹！重复告警设备卡片样式 */
        .repeat-device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .repeat-device-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            gap: 12px;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        [data-theme="dark"] .repeat-device-card {
            background: #0f172a;
        }

        .repeat-device-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }

        .repeat-device-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            flex-shrink: 0;
        }

        .repeat-device-info {
            flex: 1;
        }

        .repeat-device-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .repeat-device-stats {
            display: flex;
            gap: 12px;
            margin-bottom: 6px;
        }

        .device-alarm-count {
            font-weight: 700;
            color: #ef4444;
            font-size: 16px;
        }

        .device-repeat-rate {
            font-size: 12px;
            color: var(--text-secondary);
            background: #fee2e2;
            padding: 2px 8px;
            border-radius: 4px;
        }

        [data-theme="dark"] .device-repeat-rate {
            background: rgba(239, 68, 68, 0.2);
        }

        .repeat-device-types {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* 艹！行动建议样式 */
        .config-action-section {
            margin-top: 32px;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        [data-theme="dark"] .config-action-section {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
        }

        .action-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            flex: 1;
        }

        .config-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .config-action-btn:hover {
            background: #2563eb;
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* 紧凑区域样式 */
        .compact-dual-section {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .compact-card {
            flex: 1;
            min-width: 0;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .compact-card {
            background: #1e293b;
        }

        .compact-section {
            margin-bottom: 24px;
        }

        .compact-section:last-child {
            margin-bottom: 0;
        }

        .compact-section-half {
            flex: 1;
            min-width: 0;
            margin-bottom: 0;
        }

        .compact-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color);
        }

        .compact-section-header > span {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .compact-action-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }

        .compact-action-link:hover {
            color: #2563eb;
            gap: 8px;
        }

        .compact-action-link i {
            font-size: 11px;
        }

        /* 紧凑表格样式 */
        .compact-data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            table-layout: auto;
        }

        .compact-data-table th:last-child,
        .compact-data-table td:last-child {
            width: 100px;
            text-align: center;
        }

        .compact-data-table thead {
            background: #f9fafb;
        }

        [data-theme="dark"] .compact-data-table thead {
            background: #0f172a;
        }

        .compact-data-table th {
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            color: #6b7280;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border-color);
        }

        .compact-data-table td {
            padding: 12px 12px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }

        .compact-data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .compact-data-table tbody tr:hover {
            background: #f9fafb;
        }

        [data-theme="dark"] .compact-data-table tbody tr:hover {
            background: #0f172a;
        }

        /* 告警类型单元格 */
        .alarm-type-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .severity-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* 设备名称单元格 */
        .device-name-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .device-name-cell i {
            font-size: 14px;
        }

        /* 设备类型单元格 */
        .device-types-cell {
            color: var(--text-secondary);
            font-size: 12px;
        }

        /* 高亮数值 */
        .highlight-critical {
            color: #ef4444;
            font-weight: 600;
        }

        .highlight-warning {
            color: #f59e0b;
            font-weight: 600;
        }

        .highlight-normal {
            color: #3b82f6;
            font-weight: 600;
        }

        /* 配置规则按钮 */
        .config-rule-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            font-size: 12px;
            color: #3b82f6;
            background: #eff6ff;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
        }

        [data-theme="dark"] .config-rule-btn {
            background: rgba(59, 130, 246, 0.1);
        }

        .config-rule-btn:hover {
            background: #dbeafe;
            color: #2563eb;
            transform: translateX(2px);
        }

        [data-theme="dark"] .config-rule-btn:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .config-rule-btn i {
            font-size: 11px;
        }

        /* 艹！通知效率指标样式 */
        .notification-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .notification-metric-card {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            gap: 12px;
        }

        [data-theme="dark"] .notification-metric-card {
            background: #0f172a;
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
        }

        .metric-content {
            flex: 1;
        }

        .metric-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 6px;
        }

        .metric-unit {
            font-size: 14px;
            font-weight: 400;
            margin-left: 2px;
        }

        .metric-change {
            font-size: 12px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .metric-change.trend-up {
            background: #fee2e2;
            color: #dc2626;
        }

        .metric-change.trend-down {
            background: #d1fae5;
            color: #059669;
        }

        /* 艹！通知渠道效率对比表格样式 */
        .notification-channel-section {
            margin-bottom: 32px;
        }

        .channel-comparison-table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        [data-theme="dark"] .channel-comparison-table {
            background: #0f172a;
        }

        .channel-table {
            width: 100%;
            border-collapse: collapse;
        }

        .channel-table thead tr {
            background: #f9fafb;
        }

        [data-theme="dark"] .channel-table thead tr {
            background: #1e293b;
        }

        .channel-table th {
            padding: 12px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .channel-table tbody tr {
            border-top: 1px solid var(--border-color);
            transition: background 0.2s;
        }

        .channel-table tbody tr:hover {
            background: #f9fafb;
        }

        [data-theme="dark"] .channel-table tbody tr:hover {
            background: #1e293b;
        }

        .channel-table td {
            padding: 14px 16px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .channel-name-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .channel-number {
            font-weight: 500;
        }

        .success-high {
            color: #10b981;
            font-weight: 600;
        }

        .success-medium {
            color: #f59e0b;
            font-weight: 600;
        }

        .success-low {
            color: #ef4444;
            font-weight: 600;
        }

        .channel-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .badge-excellent {
            background: #d1fae5;
            color: #059669;
        }

        .badge-good {
            background: #dbeafe;
            color: #2563eb;
        }

        .badge-poor {
            background: #fee2e2;
            color: #dc2626;
        }

        [data-theme="dark"] .badge-excellent {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        [data-theme="dark"] .badge-good {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        [data-theme="dark"] .badge-poor {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* 艹！响应时长分布样式 */
        .response-time-section {
            margin-bottom: 32px;
        }

        .response-time-chart {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        [data-theme="dark"] .response-time-chart {
            background: #0f172a;
        }

        .time-range-item {
            display: grid;
            grid-template-columns: 140px 1fr 60px;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .time-range-item:last-child {
            margin-bottom: 0;
        }

        .time-range-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-primary);
        }

        .time-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .time-range-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }

        [data-theme="dark"] .time-range-bar {
            background: #334155;
        }

        .time-range-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s;
        }

        .time-range-value {
            text-align: right;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .response-time-insight {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #fef3c7;
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            color: #92400e;
        }

        [data-theme="dark"] .response-time-insight {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        /* 艹！紧急告警升级看板样式 */
        .urgent-escalation-banner {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .urgent-escalation-banner {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.15) 100%);
            border-color: #ef4444;
        }

        .urgent-escalation-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #ef4444;
            animation: urgentPulse 2s infinite;
        }

        @keyframes urgentPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .escalation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .escalation-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #991b1b;
        }

        [data-theme="dark"] .escalation-title {
            color: #fca5a5;
        }

        .escalation-icon {
            width: 32px;
            height: 32px;
            background: #ef4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            animation: urgentBounce 1s infinite;
        }

        @keyframes urgentBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .escalation-count {
            background: #ef4444;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .urgent-alarm-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .urgent-alarm-item {
            background: white;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #ef4444;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .urgent-alarm-item {
            background: #1e293b;
        }

        .urgent-alarm-info {
            flex: 1;
        }

        .urgent-alarm-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .urgent-alarm-meta {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .urgent-alarm-meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .overtime-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #fee2e2;
            color: #991b1b;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            animation: overtimePulse 2s infinite;
        }

        [data-theme="dark"] .overtime-badge {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        @keyframes overtimePulse {
            0%, 100% { background-color: #fee2e2; }
            50% { background-color: #fecaca; }
        }

        .escalate-btn {
            padding: 8px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .escalate-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
        }

        /* 艹！响应问题分析双栏布局 */
        .response-analysis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .response-analysis-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .response-analysis-card {
            background: #1e293b;
        }

        .analysis-card-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }

        [data-theme="dark"] .analysis-card-title {
            border-bottom-color: #334155;
        }

        /* 艹！问题告警列表样式 */
        .problem-alarm-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .problem-alarm-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f9fafb;
            border-radius: 6px;
            transition: all 0.2s;
            cursor: pointer;
        }

        [data-theme="dark"] .problem-alarm-item {
            background: #0f172a;
        }

        .problem-alarm-item:hover {
            background: #f3f4f6;
            transform: translateX(4px);
        }

        [data-theme="dark"] .problem-alarm-item:hover {
            background: #1e293b;
        }

        .problem-alarm-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .problem-rank {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .problem-rank.rank-1 {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .problem-rank.rank-2 {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .problem-rank.rank-3 {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }

        .problem-rank.rank-other {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .problem-alarm-info {
            flex: 1;
        }

        .problem-alarm-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .problem-alarm-detail {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .problem-time-badge {
            background: #fee2e2;
            color: #991b1b;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        [data-theme="dark"] .problem-time-badge {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        /* 艹！智能升级建议样式 */
        .smart-suggestion-card {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        [data-theme="dark"] .smart-suggestion-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.15) 100%);
            border-color: #3b82f6;
        }

        .suggestion-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .suggestion-icon {
            width: 36px;
            height: 36px;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .suggestion-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e40af;
        }

        [data-theme="dark"] .suggestion-title {
            color: #60a5fa;
        }

        .suggestion-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .suggestion-item {
            display: flex;
            gap: 12px;
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .suggestion-item {
            background: #1e293b;
        }

        .suggestion-number {
            width: 28px;
            height: 28px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .suggestion-content {
            flex: 1;
        }

        .suggestion-content-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .suggestion-content-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .suggestion-data {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #dbeafe;
            color: #1e40af;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin: 0 2px;
        }

        [data-theme="dark"] .suggestion-data {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        /* 艹！告警升级时间轴样式 */
        .escalation-timeline-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .escalation-timeline-card {
            background: #1e293b;
        }

        .timeline-container {
            position: relative;
            padding: 20px 0;
        }

        .timeline-item {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            position: relative;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: 19px;
            top: 40px;
            width: 2px;
            height: calc(100% + 24px);
            background: linear-gradient(180deg, var(--primary-color) 0%, #e5e7eb 100%);
        }

        [data-theme="dark"] .timeline-item::after {
            background: linear-gradient(180deg, #60a5fa 0%, #334155 100%);
        }

        .timeline-item:last-child::after {
            display: none;
        }

        .timeline-point {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            flex-shrink: 0;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .timeline-point.initial {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .timeline-point.escalation-1 {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .timeline-point.escalation-2 {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .timeline-point.escalation-3 {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .timeline-content {
            flex: 1;
            padding-top: 2px;
        }

        .timeline-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .timeline-action {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .timeline-channels {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .channel-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: #f3f4f6;
            border-radius: 4px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        [data-theme="dark"] .channel-tag {
            background: #0f172a;
        }

        .channel-tag i {
            font-size: 11px;
        }

        /* 艹！级别/类型分析样式 */
        .analysis-stat-item {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid;
            transition: all 0.2s;
        }

        [data-theme="dark"] .analysis-stat-item {
            background: #0f172a;
        }

        .analysis-stat-item:hover {
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .analysis-stat-item.critical {
            border-left-color: #ef4444;
        }

        .analysis-stat-item.major {
            border-left-color: #f59e0b;
        }

        .analysis-stat-item.minor {
            border-left-color: #fbbf24;
        }

        .analysis-stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .stat-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .stat-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .stat-badge.critical {
            background: #fee2e2;
            color: #991b1b;
        }

        .stat-badge.major {
            background: #fef3c7;
            color: #92400e;
        }

        .stat-badge.minor {
            background: #fef9c3;
            color: #854d0e;
        }

        [data-theme="dark"] .stat-badge.critical {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        [data-theme="dark"] .stat-badge.major {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        [data-theme="dark"] .stat-badge.minor {
            background: rgba(251, 191, 36, 0.2);
            color: #fde047;
        }

        .stat-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat-metric {
            text-align: center;
        }

        .stat-metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .stat-metric-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-metric-value.good {
            color: #10b981;
        }

        .stat-metric-value.warning {
            color: #f59e0b;
        }

        .stat-metric-value.danger {
            color: #ef4444;
        }

        .stat-metric-unit {
            font-size: 12px;
            font-weight: 400;
            margin-left: 2px;
        }

        /* 艹！告警等级统计样式（简洁版） */

        .alarm-level-stats-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            margin-bottom: 24px;
        }

        [data-theme="dark"] .alarm-level-stats-section {
            background: #1e293b;
        }

        /* 智能优化建议区域 */
        .optimization-suggestions-section {
            background: white;
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 2px solid #f59e0b;
        }

        [data-theme="dark"] .optimization-suggestions-section {
            background: #1e293b;
            border-color: #f59e0b;
        }

        .level-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-top: 24px;
        }

        .level-stat-card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 2px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .level-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
        }

        .level-stat-card.critical-stat {
            border-color: #fee2e2;
        }

        .level-stat-card.critical-stat::before {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
        }

        .level-stat-card.major-stat {
            border-color: #fed7aa;
        }

        .level-stat-card.major-stat::before {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
        }

        .level-stat-card.minor-stat {
            border-color: #fef3c7;
        }

        .level-stat-card.minor-stat::before {
            background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 100%);
        }

        [data-theme="dark"] .level-stat-card {
            background: #1e293b;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .level-stat-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .level-stat-card.critical-stat:hover {
            border-color: #fecaca;
            box-shadow: 0 12px 24px rgba(239, 68, 68, 0.2);
        }

        .level-stat-card.major-stat:hover {
            border-color: #fde68a;
            box-shadow: 0 12px 24px rgba(245, 158, 11, 0.2);
        }

        .level-stat-card.minor-stat:hover {
            border-color: #fde047;
            box-shadow: 0 12px 24px rgba(251, 191, 36, 0.2);
        }

        .level-stat-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 28px;
        }

        .level-stat-title {
            flex: 1;
        }

        .level-stat-name {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .level-stat-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .level-stat-badge.critical-badge {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #dc2626;
        }

        .level-stat-badge.major-badge {
            background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
            color: #ea580c;
        }

        .level-stat-badge.minor-badge {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #d97706;
        }

        .level-stat-icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }

        .level-stat-icon.critical-icon {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .level-stat-icon.major-icon {
            background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%);
        }

        .level-stat-icon.minor-icon {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        .level-stat-body {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 12px;
            transition: all 0.2s;
        }

        [data-theme="dark"] .stat-item {
            background: rgba(255, 255, 255, 0.05);
        }

        .stat-item:hover {
            background: rgba(0, 0, 0, 0.04);
            transform: translateX(4px);
        }

        [data-theme="dark"] .stat-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
        }

        .level-stat-card.critical-stat .stat-value {
            color: #ef4444;
        }

        .level-stat-card.major-stat .stat-value {
            color: #f59e0b;
        }

        .level-stat-card.minor-stat .stat-value {
            color: #fbbf24;
        }

        .section-header-primary {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 3px solid #f59e0b;
        }

        .section-title-primary {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .section-title-primary i {
            color: #f59e0b;
            font-size: 24px;
        }

        .section-subtitle-primary {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 8px;
            font-weight: 500;
        }

        .suggestions-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .suggestion-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 6px solid;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.2s;
        }

        .suggestion-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        .suggestion-card.priority-high {
            border-left-color: #dc2626;
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        }

        .suggestion-card.priority-medium {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }

        [data-theme="dark"] .suggestion-card {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);
        }

        .suggestion-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .suggestion-title-row {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .suggestion-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }

        .suggestion-icon.add-reach {
            background: #dbeafe;
            color: #3b82f6;
        }

        .suggestion-icon.escalate-alarm {
            background: #fecaca;
            color: #dc2626;
        }

        [data-theme="dark"] .suggestion-icon.add-reach {
            background: rgba(59, 130, 246, 0.2);
        }

        [data-theme="dark"] .suggestion-icon.escalate-alarm {
            background: rgba(220, 38, 38, 0.2);
        }

        .suggestion-title-text {
            flex: 1;
        }

        .suggestion-type {
            font-size: 12px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .suggestion-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .suggestion-priority-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }

        .suggestion-priority-badge.high {
            background: #dc2626;
            color: white;
        }

        .suggestion-priority-badge.medium {
            background: #f59e0b;
            color: white;
        }

        .suggestion-problem {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        [data-theme="dark"] .suggestion-problem {
            background: rgba(0, 0, 0, 0.3);
        }

        .suggestion-problem-title {
            font-size: 13px;
            font-weight: 600;
            color: #dc2626;
            margin-bottom: 8px;
        }

        .suggestion-problem-desc {
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .suggestion-actions {
            margin-bottom: 16px;
        }

        .suggestion-actions-title {
            font-size: 13px;
            font-weight: 600;
            color: #059669;
            margin-bottom: 10px;
        }

        .suggestion-actions-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .suggestion-actions-list li {
            padding: 8px 0;
            padding-left: 24px;
            position: relative;
            font-size: 14px;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .suggestion-actions-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #059669;
            font-weight: 700;
        }

        .suggestion-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .suggestion-data-support {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .suggestion-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .suggestion-btn.btn-primary {
            background: #3b82f6;
            color: white;
        }

        .suggestion-btn.btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        /* 2. 健康度评分区域 */
        .health-score-section {
            margin-bottom: 24px;
        }

        .health-score-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            display: flex;
            align-items: center;
            gap: 32px;
        }

        [data-theme="dark"] .health-score-card {
            background: #1e293b;
        }

        .health-score-left {
            flex: 0 0 auto;
            text-align: center;
            padding-right: 32px;
            border-right: 2px solid var(--border-color);
        }

        [data-theme="dark"] .health-score-left {
            border-right-color: #334155;
        }

        .health-score-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 600;
        }

        .health-score-value {
            font-size: 56px;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .health-score-status {
            font-size: 13px;
            color: #f59e0b;
            font-weight: 600;
        }

        .health-score-right {
            flex: 1;
        }

        .health-metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .health-metric {
            text-align: center;
        }

        .health-metric i {
            font-size: 24px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .health-metric span {
            display: block;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .health-metric .metric-indicator {
            font-size: 18px;
            font-weight: 700;
        }

        .health-metric .metric-indicator.down {
            color: #dc2626;
        }

        .health-metric .metric-indicator.up {
            color: #10b981;
        }

        .health-metric .metric-indicator.neutral {
            color: #6b7280;
        }

        /* 3. 数据分析区域 */
        .data-analysis-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        [data-theme="dark"] .data-analysis-section {
            background: #1e293b;
        }

        .section-header {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-color);
        }

        [data-theme="dark"] .section-header {
            border-bottom-color: #334155;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .section-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 6px;
        }

        .level-analysis-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .level-analysis-card {
            background: #f9fafb;
            border-radius: 10px;
            padding: 20px;
            border-top: 4px solid;
            transition: all 0.2s;
        }

        [data-theme="dark"] .level-analysis-card {
            background: #0f172a;
        }

        .level-analysis-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .level-analysis-card.critical-card {
            border-top-color: #ef4444;
        }

        .level-analysis-card.major-card {
            border-top-color: #f59e0b;
        }

        .level-analysis-card.minor-card {
            border-top-color: #fbbf24;
        }

        .level-stat-card {
            background: #f9fafb;
            border-radius: 10px;
            padding: 24px;
            border-left: 6px solid; /* 改为左侧边框，更适合垂直布局 */
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        [data-theme="dark"] .level-stat-card {
            background: #0f172a;
        }

        .level-stat-card:hover {
            transform: translateX(4px); /* 横向移动效果 */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .level-stat-card.critical {
            border-left-color: #ef4444;
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.05) 0%, #f9fafb 100%);
        }

        .level-stat-card.major {
            border-left-color: #f59e0b;
            background: linear-gradient(90deg, rgba(245, 158, 11, 0.05) 0%, #f9fafb 100%);
        }

        .level-stat-card.minor {
            border-left-color: #fbbf24;
            background: linear-gradient(90deg, rgba(251, 191, 36, 0.05) 0%, #f9fafb 100%);
        }

        [data-theme="dark"] .level-stat-card.critical {
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.1) 0%, #0f172a 100%);
        }

        [data-theme="dark"] .level-stat-card.major {
            background: linear-gradient(90deg, rgba(245, 158, 11, 0.1) 0%, #0f172a 100%);
        }

        [data-theme="dark"] .level-stat-card.minor {
            background: linear-gradient(90deg, rgba(251, 191, 36, 0.1) 0%, #0f172a 100%);
        }

        .level-stat-header {
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .level-stat-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
        }

        .level-stat-count {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            line-height: 1;
        }

        .level-stat-metrics {
            flex: 1;
            display: flex;
            justify-content: space-around;
            gap: 24px;
            padding-left: 24px;
            border-left: 1px solid var(--border-color);
        }

        [data-theme="dark"] .level-stat-metrics {
            border-left-color: #334155;
        }

        .level-stat-metric {
            flex: 1;
            text-align: center;
        }

        .level-stat-metric-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .level-stat-metric-value {
            font-size: 24px;
            font-weight: 700;
        }

        /* 艹！升级建议样式（简化版） */
        .escalation-recommendation {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        [data-theme="dark"] .escalation-recommendation {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.15) 100%);
        }

        .recommendation-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 16px;
        }

        [data-theme="dark"] .recommendation-header {
            color: #60a5fa;
        }

        .recommendation-content {
            display: flex;
            gap: 16px;
        }

        .recommendation-item {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] .recommendation-item {
            background: #1e293b;
        }

        .recommendation-level {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .recommendation-time {
            font-size: 24px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 4px;
        }

        .recommendation-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* 艹！级别卡片详细样式 */
        .level-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .level-card-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .level-card-count {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
        }

        .level-card-metrics {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .level-card-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .level-card-metric-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .level-card-metric-value {
            font-size: 18px;
            font-weight: 700;
        }

        .level-card-metric-value.good {
            color: #10b981;
        }

        .level-card-metric-value.warning {
            color: #f59e0b;
        }

        .level-card-metric-value.danger {
            color: #dc2626;
        }

        .level-card-issue {
            margin-top: 12px;
            padding: 10px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
        }

        .level-card-issue.issue-response {
            background: rgba(220, 38, 38, 0.1);
            color: #dc2626;
        }

        .level-card-issue.issue-completion {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .level-card-issue.issue-none {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        /* 艹！折叠区域样式 */
        .type-analysis-details,
        .detailed-data-details {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            overflow: hidden;
        }

        [data-theme="dark"] .type-analysis-details,
        [data-theme="dark"] .detailed-data-details {
            background: #1e293b;
        }

        .details-summary {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 16px 20px;
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            cursor: pointer;
            user-select: none;
            list-style: none;
        }

        .details-summary::-webkit-details-marker {
            display: none;
        }

        .details-summary:hover {
            background: #f9fafb;
        }

        [data-theme="dark"] .details-summary:hover {
            background: #0f172a;
        }

        .details-summary i:last-child {
            margin-left: auto;
            transition: transform 0.2s;
        }

        .type-analysis-details[open] .details-summary i:last-child {
            transform: rotate(180deg);
        }

        .type-analysis-content {
            padding: 0 20px 20px 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        /* M4.1 热点分析网格 */
        .hotspot-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .hotspot-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .hotspot-card {
            background: #1e293b;
        }

        .hotspot-card-wide {
            grid-column: span 3;
        }

        .hotspot-card-header {
            margin-bottom: 16px;
        }

        .hotspot-card-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 4px 0;
        }

        .hotspot-card-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .hotspot-chart {
            height: 220px;
            position: relative;
        }

        .hotspot-legend {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        /* 热力图 */
        .heatmap-container {
            display: grid;
            grid-template-columns: 50px 1fr;
            grid-template-rows: 1fr auto;
            gap: 8px;
            margin-bottom: 12px;
        }

        .heatmap-y-axis {
            grid-column: 1;
            grid-row: 1;
            display: grid;
            grid-template-rows: repeat(7, 1fr);
            gap: 4px;
        }

        .heatmap-y-label {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .heatmap-grid {
            grid-column: 2;
            grid-row: 1;
            display: grid;
            grid-template-rows: repeat(7, 1fr);
            grid-template-columns: repeat(24, 1fr);
            gap: 4px;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .heatmap-cell:hover {
            transform: scale(1.15);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .heatmap-x-axis {
            grid-column: 2;
            grid-row: 2;
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            gap: 4px;
        }

        .heatmap-x-label {
            text-align: center;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .heatmap-legend {
            margin-top: 16px;
        }

        .heatmap-gradient {
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(to right, #e0e7ff, #c7d2fe, #a5b4fc, #818cf8, #6366f1, #4f46e5, #4338ca);
        }

        /* M4.2 MTTR/MTBF卡片 */
        .mttr-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .mttr-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 16px;
        }

        [data-theme="dark"] .mttr-card {
            background: #1e293b;
        }

        .mttr-icon {
            flex-shrink: 0;
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .mttr-icon-red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .mttr-icon-green {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .mttr-icon-blue {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .mttr-icon-purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .mttr-content {
            flex: 1;
        }

        .mttr-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .mttr-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .mttr-unit {
            font-size: 14px;
            font-weight: 400;
            margin-left: 4px;
        }

        .mttr-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
        }

        .mttr-trend-up {
            color: #10b981;
        }

        .mttr-trend-down {
            color: #ef4444;
        }

        .mttr-chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .mttr-chart-container {
            background: #1e293b;
        }

        .mttr-chart {
            height: 300px;
            margin-top: 16px;
        }

        /* M4.3 高级搜索 */
        .advanced-search {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        [data-theme="dark"] .advanced-search {
            background: #1e293b;
        }

        .search-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .search-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .search-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .search-date {
            height: 36px;
            padding: 0 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: var(--text-primary);
        }

        [data-theme="dark"] .search-date {
            background: #0f172a;
            border-color: #334155;
            color: #e2e8f0;
        }

        .search-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            height: 40px;
            padding: 0 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #5568e5;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: var(--text-primary);
        }

        [data-theme="dark"] .btn-secondary {
            background: #0f172a;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        [data-theme="dark"] .btn-secondary:hover {
            background: #334155;
        }

        .export-btn {
            height: 40px;
            padding: 0 20px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .export-btn:hover {
            background: #059669;
        }

        /* 查询结果统计 */
        .query-result-stats {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .query-result-stats {
            background: #1e293b;
        }

        .result-stat-item {
            text-align: center;
        }

        .result-stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .result-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .result-stat-critical {
            color: #ef4444;
        }

        .result-stat-major {
            color: #f59e0b;
        }

        .result-stat-minor {
            color: #fbbf24;
        }

        .result-stat-info {
            color: #3b82f6;
        }

        /* M4.4 KPI卡片 */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 0;
        }

        .kpi-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .kpi-card {
            background: #1e293b;
        }

        .kpi-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .kpi-icon {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .kpi-icon-blue {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .kpi-icon-green {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .kpi-icon-orange {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .kpi-icon-purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .kpi-icon-red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .kpi-icon-teal {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
        }

        .kpi-icon-indigo {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
        }

        .kpi-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .kpi-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .kpi-unit {
            font-size: 14px;
            font-weight: 400;
            margin-left: 4px;
        }

        .kpi-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .kpi-target {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .kpi-score {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 4px;
        }

        .kpi-score-excellent {
            background: #d1fae5;
            color: #065f46;
        }

        .kpi-score-good {
            background: #fef3c7;
            color: #92400e;
        }

        [data-theme="dark"] .kpi-score-excellent {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

        [data-theme="dark"] .kpi-score-good {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        /* 艹！KPI环比趋势样式 */
        .kpi-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 4px;
        }

        .kpi-trend i {
            font-size: 10px;
        }

        .kpi-trend.trend-up {
            background: #fee2e2;
            color: #dc2626;
        }

        .kpi-trend.trend-down {
            background: #d1fae5;
            color: #059669;
        }

        .kpi-trend.trend-neutral {
            background: #f3f4f6;
            color: #6b7280;
        }

        [data-theme="dark"] .kpi-trend.trend-up {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        [data-theme="dark"] .kpi-trend.trend-down {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }

        [data-theme="dark"] .kpi-trend.trend-neutral {
            background: rgba(107, 114, 128, 0.2);
            color: #9ca3af;
        }

        /* 团队绩效排行 */
        .team-ranking-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .team-ranking-container {
            background: #1e293b;
        }

        .team-ranking-table {
            margin-top: 16px;
        }

        .team-ranking-header {
            display: grid;
            grid-template-columns: 60px 1fr 120px 120px 100px 100px;
            gap: 16px;
            padding: 12px 16px;
            background: #f9fafb;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        [data-theme="dark"] .team-ranking-header {
            background: #0f172a;
        }

        .team-ranking-row {
            display: grid;
            grid-template-columns: 60px 1fr 120px 120px 100px 100px;
            gap: 16px;
            padding: 16px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 8px;
            align-items: center;
            transition: all 0.2s;
        }

        [data-theme="dark"] .team-ranking-row {
            background: #0f172a;
        }

        .team-ranking-row:hover {
            background: #e5e7eb;
        }

        [data-theme="dark"] .team-ranking-row:hover {
            background: #334155;
        }

        .team-rank {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: 700;
            color: white;
        }

        .team-rank.rank-1 {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
        }

        .team-rank.rank-2 {
            background: linear-gradient(135deg, #94a3b8, #64748b);
        }

        .team-rank.rank-3 {
            background: linear-gradient(135deg, #fb923c, #f97316);
        }

        .team-rank.rank-other {
            background: #e5e7eb;
            color: var(--text-secondary);
        }

        [data-theme="dark"] .team-rank.rank-other {
            background: #334155;
        }

        .team-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .team-stat {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .team-score {
            font-size: 16px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), #5568e5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Module 4响应式 */
        @media (max-width: 1400px) {
            .hotspot-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .hotspot-card-wide {
                grid-column: span 2;
            }

            .mttr-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .search-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .query-result-stats {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .overview-top-section {
                flex-direction: column;
            }

            .health-score-container {
                width: 100%;
            }

            .hotspot-grid {
                grid-template-columns: 1fr;
            }

            .hotspot-card-wide {
                grid-column: span 1;
            }

            .mttr-grid,
            .kpi-grid,
            .search-row,
            .query-result-stats {
                grid-template-columns: 1fr;
            }

            .team-ranking-header,
            .team-ranking-row {
                grid-template-columns: 50px 1fr 80px;
                font-size: 12px;
            }

            .team-stat-col:nth-child(n+4),
            .team-ranking-row > *:nth-child(n+4) {
                display: none;
            }
        }

        /* ========== 智能概览首页样式 ========== */

        /* 健康度评分区域 */
        .overview-health-section {
            margin-bottom: 32px;
        }

        /* 艹！系统健康度和KPI并排显示的容器 */
        .overview-top-section {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: auto auto;
            gap: 16px;
            margin-bottom: 32px;
        }

        /* 艹！简化后的健康度容器 */
        .health-score-container {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            grid-column: span 1;
            grid-row: span 2;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        [data-theme="dark"] .health-score-container {
            background: #1e293b;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .health-score-content {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .health-score-main {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .kpi-grid-wrapper {
            grid-column: span 3;
            grid-row: span 2;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 16px;
        }

        /* 艹！简化后的分数样式 */
        .score-value {
            font-size: 72px;
            font-weight: 800;
            background: linear-gradient(135deg, #10b981, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        .score-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: 0.3px;
        }

        /* 趋势信息 */
        .health-trend {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 16px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(59, 130, 246, 0.05));
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1;
            border: 1px solid rgba(16, 185, 129, 0.15);
        }

        [data-theme="dark"] .health-trend {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.12), rgba(59, 130, 246, 0.08));
            border-color: rgba(16, 185, 129, 0.2);
        }

        .trend-arrow {
            font-size: 14px;
        }

        .trend-text {
            color: var(--text-secondary);
        }

        .trend-value {
            color: #10b981;
            font-weight: 700;
        }

        .health-trend.down .trend-value {
            color: #ef4444;
        }

        .health-trend.down .trend-arrow {
            color: #ef4444;
        }

        .health-trend.up .trend-arrow {
            color: #10b981;
        }

        .score-breakdown {
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: center;
        }

        .breakdown-item {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .breakdown-header {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
        }

        .breakdown-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .breakdown-progress {
            flex: 1;
            height: 8px;
            background: #f3f4f6;
            border-radius: 4px;
            overflow: hidden;
        }

        [data-theme="dark"] .breakdown-progress {
            background: #0f172a;
        }

        .breakdown-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }

        .breakdown-score {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            min-width: 50px;
            text-align: right;
        }

        /* 通用section样式 */
        .overview-section {
            margin-bottom: 32px;
        }

        .section-header {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 12px;
        }

        /* 艹！如果section-header只包含标题和副标题（无选择器），则垂直布局 */
        .section-header:not(:has(.time-range-selector)):not(:has(.stats-date-range)) {
            flex-direction: column;
            align-items: flex-start;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
        }

        .section-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 6px;
        }

        /* 艹！时间范围选择器 */
        .time-range-selector {
            flex-shrink: 0;
        }

        /* 紧急问题卡片 */
        .urgent-issues-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .urgent-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border-left: 4px solid;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .urgent-card {
            background: #1e293b;
        }

        .urgent-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        .urgent-card.urgent-critical {
            border-left-color: #ef4444;
        }

        .urgent-card.urgent-major {
            border-left-color: #f59e0b;
        }

        .urgent-card.urgent-warning {
            border-left-color: #fbbf24;
        }

        .urgent-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .urgent-critical .urgent-badge {
            background: #fee2e2;
            color: #991b1b;
        }

        .urgent-major .urgent-badge {
            background: #fef3c7;
            color: #92400e;
        }

        .urgent-warning .urgent-badge {
            background: #fef9c3;
            color: #854d0e;
        }

        [data-theme="dark"] .urgent-critical .urgent-badge {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        [data-theme="dark"] .urgent-major .urgent-badge {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        [data-theme="dark"] .urgent-warning .urgent-badge {
            background: rgba(251, 191, 36, 0.2);
            color: #fde047;
        }

        .urgent-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .urgent-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 12px 0;
        }

        .urgent-impact {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .urgent-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: #f9fafb;
            border-radius: 8px;
        }

        [data-theme="dark"] .urgent-metrics {
            background: #0f172a;
        }

        .metric-item {
            text-align: center;
        }

        .metric-label {
            display: block;
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .metric-value {
            display: block;
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .urgent-actions {
            display: flex;
            gap: 10px;
        }

        .btn-urgent-primary,
        .btn-urgent-secondary {
            flex: 1;
            height: 36px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .btn-urgent-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-urgent-primary:hover {
            background: #5568e5;
            transform: translateY(-1px);
        }

        .btn-urgent-secondary {
            background: #f3f4f6;
            color: var(--text-primary);
        }

        [data-theme="dark"] .btn-urgent-secondary {
            background: #0f172a;
        }

        .btn-urgent-secondary:hover {
            background: #e5e7eb;
        }

        [data-theme="dark"] .btn-urgent-secondary:hover {
            background: #334155;
        }

        /* 快捷操作卡片 */
        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .quick-action-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 16px;
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .quick-action-card {
            background: #1e293b;
        }

        .quick-action-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: -50%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: skewX(-20deg);
            transition: right 0.5s ease;
        }

        .quick-action-card:hover::before {
            right: 150%;
        }

        .quick-action-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .quick-icon {
            flex-shrink: 0;
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .quick-content {
            flex: 1;
            min-width: 0;
        }

        .quick-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .quick-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 6px;
        }

        .quick-unit {
            font-size: 12px;
            font-weight: 400;
            margin-left: 4px;
        }

        .quick-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .quick-arrow {
            flex-shrink: 0;
            font-size: 18px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .quick-action-card:hover .quick-arrow {
            color: var(--primary-color);
            transform: translateX(4px);
        }

        /* AI建议卡片 */
        .ai-suggestions {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .suggestion-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            display: flex;
            gap: 16px;
            align-items: flex-start;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .suggestion-card {
            background: #1e293b;
        }

        .suggestion-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }

        .suggestion-icon {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            border-radius: 10px;
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        [data-theme="dark"] .suggestion-icon {
            background: #0f172a;
        }

        .suggestion-content {
            flex: 1;
        }

        .suggestion-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .suggestion-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* 智能概览响应式 */
        @media (max-width: 1400px) {
            .health-score-container {
                grid-template-columns: 1fr;
            }

            .urgent-issues-grid {
                grid-template-columns: 1fr;
            }

            .quick-actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .score-breakdown {
                margin-top: 24px;
            }

            .quick-actions-grid {
                grid-template-columns: 1fr;
            }

            /* 艹！热点分析响应式 */
            .hotspot-overview-grid {
                grid-template-columns: 1fr;
            }

            .station-metrics {
                grid-template-columns: repeat(2, 1fr);
            }

            /* 告警词云响应式调整 */
            .alarm-word-cloud {
                padding: 20px;
                gap: 8px 12px;
                min-height: 280px;
            }

            .alarm-type-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .region-filter-wrapper {
                width: 100%;
            }

            .region-filter {
                width: 100%;
            }

            .alarm-type-footer {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body data-page="alarm-analysis">
    <!-- 主内容区域 -->
    <main class="main-content" id="mainContent">
        <!-- Tab 0: 智能概览 (首页引导) -->
        <div class="tab-panel active" id="overviewPanel">
            <!-- 艹！告警总览标题和时间选择器 -->
            <div class="overview-section" style="margin-bottom: 24px;">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-chart-line" style="color: #3b82f6;"></i>
                        告警总览
                    </h3>
                    <div class="time-range-selector">
                        <select class="filter-select" id="overviewTimeRange" onchange="updateOverviewTimeRange()">
                            <option value="today">今日</option>
                            <option value="week" selected>本周</option>
                            <option value="month">本月</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 系统健康度 + 运维绩效KPI (并排显示) -->
            <div class="overview-top-section">
                <!-- 左侧：系统健康度评分 -->
                <div class="health-score-container">
                    <div class="health-score-content">
                        <div class="health-score-main">
                            <div class="score-value" id="overallScore">92</div>
                            <div class="score-label">系统健康度</div>
                        </div>
                        <div class="health-trend" id="healthTrend">
                            <i class="fas fa-arrow-up"></i>
                            <span class="trend-text">较昨日</span>
                            <span class="trend-value">+5分</span>
                        </div>
                    </div>
                </div>

                <!-- 右侧：KPI卡片网格 -->
                <div class="kpi-grid-wrapper">
                    <!-- 告警数量KPI -->
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon kpi-icon-indigo">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div>
                                <div class="kpi-label">告警数量</div>
                                <div class="kpi-value" id="alarmCountValue">--<span class="kpi-unit">条</span></div>
                            </div>
                        </div>
                        <div class="kpi-footer">
                            <span class="kpi-target" id="alarmCountDetail">24小时: --</span>
                            <div class="kpi-trend" id="alarmCountTrend">
                                <i class="fas fa-arrow-up"></i>
                                <span>较上周 --</span>
                            </div>
                        </div>
                    </div>

                    <!-- 重复告警率KPI -->
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon kpi-icon-purple">
                                <i class="fas fa-redo"></i>
                            </div>
                            <div>
                                <div class="kpi-label">重复告警率</div>
                                <div class="kpi-value" id="repeatRateValue">3.2<span class="kpi-unit">%</span></div>
                            </div>
                        </div>
                        <div class="kpi-footer">
                            <span class="kpi-target">目标: ≤5%</span>
                            <div class="kpi-trend" id="repeatRateTrend">
                                <i class="fas fa-arrow-down"></i>
                                <span>较上周 -0.8%</span>
                            </div>
                        </div>
                    </div>

                    <!-- 处理效率KPI -->
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon kpi-icon-green">
                                <i class="fas fa-check-double"></i>
                            </div>
                            <div>
                                <div class="kpi-label">告警处理效率</div>
                                <div class="kpi-value" id="efficiencyValue">94.3<span class="kpi-unit">%</span></div>
                            </div>
                        </div>
                        <div class="kpi-footer">
                            <span class="kpi-target">目标: ≥90%</span>
                            <div class="kpi-trend" id="efficiencyTrend">
                                <i class="fas fa-arrow-up"></i>
                                <span>较上周 +2.1%</span>
                            </div>
                        </div>
                    </div>

                    <!-- 响应速度KPI -->
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon kpi-icon-blue">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div>
                                <div class="kpi-label">平均响应时长</div>
                                <div class="kpi-value" id="responseTimeValue">12<span class="kpi-unit">分钟</span></div>
                            </div>
                        </div>
                        <div class="kpi-footer">
                            <span class="kpi-target">目标: ≤15分钟</span>
                            <div class="kpi-trend" id="responseTimeTrend">
                                <i class="fas fa-arrow-down"></i>
                                <span>较上周 -3分钟</span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- ========== 艹！统计报表整合到智能概览 ========== -->

            <!-- M4.1 告警热点分析 -->
            <div class="overview-section">
                <!-- 艹！Tab切换 -->
                <div class="hotspot-tabs">
                    <button class="hotspot-tab active" onclick="switchHotspotTab('station', this)">
                        <i class="fas fa-building"></i>
                        电站分析
                    </button>
                    <button class="hotspot-tab" onclick="switchHotspotTab('type', this)">
                        <i class="fas fa-tags"></i>
                        告警类型
                    </button>
                    <button class="hotspot-tab" onclick="switchHotspotTab('config', this)">
                        <i class="fas fa-cog"></i>
                        告警配置
                    </button>
                    <button class="hotspot-tab" onclick="switchHotspotTab('notification', this)" style="display: none;">
                        <i class="fas fa-bell"></i>
                        告警通知
                    </button>
                </div>

                <!-- 艹！Tab内容 -->
                <div class="hotspot-tab-content">
                    <!-- Tab 1: 电站分析 -->
                    <div class="hotspot-tab-panel active" id="stationPanel">
                        <div class="station-table-wrapper">
                            <table class="station-table" id="stationTable">
                                <thead>
                                    <tr>
                                        <th>电站名称</th>
                                        <th>状态</th>
                                        <th class="sortable" data-column="alarmCount" data-type="number">
                                            告警数量
                                            <span class="sort-icon"></span>
                                        </th>
                                        <th class="sortable" data-column="repeatCount" data-type="number">
                                            重复数量
                                            <span class="sort-icon"></span>
                                        </th>
                                        <th class="sortable" data-column="repeatRate" data-type="number">
                                            重复告警率
                                            <span class="sort-icon"></span>
                                        </th>
                                        <th class="sortable" data-column="efficiency" data-type="number">
                                            处理效率
                                            <span class="sort-icon"></span>
                                        </th>
                                        <th class="sortable" data-column="avgResponse" data-type="number">
                                            平均响应
                                            <span class="sort-icon"></span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <div class="station-name-cell">
                                                <i class="fas fa-building" style="color: #3b82f6;"></i>
                                                北京储能站
                                            </div>
                                        </td>
                                        <td>
                                            <span class="station-status status-warning">运行中</span>
                                        </td>
                                        <td class="station-table-number" data-value="28">28<span class="station-table-unit">条</span></td>
                                        <td class="station-table-number" data-value="5">5<span class="station-table-unit">条</span></td>
                                        <td class="station-table-number" data-value="17.9">17.9<span class="station-table-unit">%</span></td>
                                        <td class="station-table-number" data-value="92.3">92.3<span class="station-table-unit">%</span></td>
                                        <td class="station-table-number" data-value="15">15<span class="station-table-unit">分钟</span></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="station-name-cell">
                                                <i class="fas fa-building" style="color: #3b82f6;"></i>
                                                上海储能站
                                            </div>
                                        </td>
                                        <td>
                                            <span class="station-status status-normal">正常</span>
                                        </td>
                                        <td class="station-table-number" data-value="12">12<span class="station-table-unit">条</span></td>
                                        <td class="station-table-number" data-value="2">2<span class="station-table-unit">条</span></td>
                                        <td class="station-table-number" data-value="16.7">16.7<span class="station-table-unit">%</span></td>
                                        <td class="station-table-number" data-value="96.8">96.8<span class="station-table-unit">%</span></td>
                                        <td class="station-table-number" data-value="8">8<span class="station-table-unit">分钟</span></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div class="station-name-cell">
                                                <i class="fas fa-building" style="color: #3b82f6;"></i>
                                                深圳储能站
                                            </div>
                                        </td>
                                        <td>
                                            <span class="station-status status-critical">告警</span>
                                        </td>
                                        <td class="station-table-number" data-value="45">45<span class="station-table-unit">条</span></td>
                                        <td class="station-table-number" data-value="12">12<span class="station-table-unit">条</span></td>
                                        <td class="station-table-number" data-value="26.7">26.7<span class="station-table-unit">%</span></td>
                                        <td class="station-table-number" data-value="85.2">85.2<span class="station-table-unit">%</span></td>
                                        <td class="station-table-number" data-value="22">22<span class="station-table-unit">分钟</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Tab 2: 告警类型 -->
                    <div class="hotspot-tab-panel" id="typePanel">
                        <div class="alarm-word-cloud-container" id="alarmWordCloudContainer">
                            <div class="region-filter-container">
                                <select id="regionSelect" class="region-select">
                                    <option value="">全部区域</option>
                                </select>
                            </div>
                            <!-- 动态生成词云 -->
                        </div>
                    </div>

                    <!-- Tab 3: 告警配置 -->
                    <div class="hotspot-tab-panel" id="configPanel">
                        <div class="compact-dual-section">
                            <!-- 重复告警类型Top5 卡片 -->
                            <div class="compact-card">
                                <div class="compact-section-header">
                                    <span>重复告警类型 Top5</span>
                                </div>
                                <table class="compact-data-table">
                                    <thead>
                                        <tr>
                                            <th>告警类型</th>
                                            <th>次数</th>
                                            <th>重复率</th>
                                            <th>影响设备</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="alarm-type-cell">
                                                <span class="severity-dot" style="background: #ef4444;"></span>
                                                电池过温告警
                                            </td>
                                            <td><strong>45</strong></td>
                                            <td><span class="highlight-critical">78.9%</span></td>
                                            <td>12台</td>
                                            <td>
                                                <a href="rule-engine.html" class="config-rule-btn">
                                                    <i class="fas fa-cog"></i>
                                                    <span>配置规则</span>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="alarm-type-cell">
                                                <span class="severity-dot" style="background: #f59e0b;"></span>
                                                SOC异常告警
                                            </td>
                                            <td><strong>32</strong></td>
                                            <td><span class="highlight-warning">65.2%</span></td>
                                            <td>8台</td>
                                            <td>
                                                <a href="rule-engine.html" class="config-rule-btn">
                                                    <i class="fas fa-cog"></i>
                                                    <span>配置规则</span>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="alarm-type-cell">
                                                <span class="severity-dot" style="background: #f59e0b;"></span>
                                                温度传感器故障
                                            </td>
                                            <td><strong>28</strong></td>
                                            <td><span class="highlight-warning">71.4%</span></td>
                                            <td>5台</td>
                                            <td>
                                                <a href="rule-engine.html" class="config-rule-btn">
                                                    <i class="fas fa-cog"></i>
                                                    <span>配置规则</span>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="alarm-type-cell">
                                                <span class="severity-dot" style="background: #3b82f6;"></span>
                                                充电异常告警
                                            </td>
                                            <td><strong>23</strong></td>
                                            <td><span class="highlight-normal">56.5%</span></td>
                                            <td>9台</td>
                                            <td>
                                                <a href="rule-engine.html" class="config-rule-btn">
                                                    <i class="fas fa-cog"></i>
                                                    <span>配置规则</span>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="alarm-type-cell">
                                                <span class="severity-dot" style="background: #6366f1;"></span>
                                                BMS通信中断
                                            </td>
                                            <td><strong>18</strong></td>
                                            <td><span class="highlight-normal">50.0%</span></td>
                                            <td>6台</td>
                                            <td>
                                                <a href="rule-engine.html" class="config-rule-btn">
                                                    <i class="fas fa-cog"></i>
                                                    <span>配置规则</span>
                                                </a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- 重复告警设备Top5 卡片 -->
                            <div class="compact-card">
                                <div class="compact-section-header">
                                    <span>重复告警设备 Top5</span>
                                </div>
                                <table class="compact-data-table">
                                    <thead>
                                        <tr>
                                            <th>设备名称</th>
                                            <th>告警次数</th>
                                            <th>重复率</th>
                                            <th>主要类型</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="device-name-cell">
                                                <i class="fas fa-battery-three-quarters" style="color: #3b82f6;"></i>
                                                #3号储能柜
                                            </td>
                                            <td><strong>45</strong></td>
                                            <td><span class="highlight-critical">78.9%</span></td>
                                            <td class="device-types-cell">电池过温、SOC异常</td>
                                            <td>
                                                <a href="rule-engine.html" class="config-rule-btn">
                                                    <i class="fas fa-cog"></i>
                                                    <span>配置规则</span>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="device-name-cell">
                                                <i class="fas fa-battery-three-quarters" style="color: #3b82f6;"></i>
                                                #7号储能柜
                                            </td>
                                            <td><strong>32</strong></td>
                                            <td><span class="highlight-warning">65.2%</span></td>
                                            <td class="device-types-cell">SOC异常、充电异常</td>
                                            <td>
                                                <a href="rule-engine.html" class="config-rule-btn">
                                                    <i class="fas fa-cog"></i>
                                                    <span>配置规则</span>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="device-name-cell">
                                                <i class="fas fa-battery-three-quarters" style="color: #3b82f6;"></i>
                                                #12号储能柜
                                            </td>
                                            <td><strong>28</strong></td>
                                            <td><span class="highlight-warning">71.4%</span></td>
                                            <td class="device-types-cell">温度传感器故障</td>
                                            <td>
                                                <a href="rule-engine.html" class="config-rule-btn">
                                                    <i class="fas fa-cog"></i>
                                                    <span>配置规则</span>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="device-name-cell">
                                                <i class="fas fa-battery-three-quarters" style="color: #3b82f6;"></i>
                                                #5号储能柜
                                            </td>
                                            <td><strong>23</strong></td>
                                            <td><span class="highlight-normal">56.5%</span></td>
                                            <td class="device-types-cell">充电异常、电压不均衡</td>
                                            <td>
                                                <a href="rule-engine.html" class="config-rule-btn">
                                                    <i class="fas fa-cog"></i>
                                                    <span>配置规则</span>
                                                </a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="device-name-cell">
                                                <i class="fas fa-battery-three-quarters" style="color: #3b82f6;"></i>
                                                #9号储能柜
                                            </td>
                                            <td><strong>18</strong></td>
                                            <td><span class="highlight-normal">50.0%</span></td>
                                            <td class="device-types-cell">BMS通信中断</td>
                                            <td>
                                                <a href="rule-engine.html" class="config-rule-btn">
                                                    <i class="fas fa-cog"></i>
                                                    <span>配置规则</span>
                                                </a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                    <!-- Tab 4: 告警通知优化（数据驱动决策） -->
                    <div class="hotspot-tab-panel" id="notificationPanel" style="display: none;">

                        <!-- 第一行：饼图+表格（一排显示） -->
                        <div style="display: grid; grid-template-columns: 0.8fr 1.2fr; gap: 24px; margin-bottom: 24px;">
                            <!-- 左侧：告警等级统计饼图 -->
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                                <div style="margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid var(--border-color);">
                                    <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary); margin: 0;">
                                        <i class="fas fa-layer-group" style="margin-right: 8px; color: #ef4444;"></i>
                                        告警等级统计
                                    </h3>
                                </div>
                                <div style="height: 350px; position: relative;">
                                    <canvas id="alarmLevelPieChart"></canvas>
                                </div>
                            </div>

                            <!-- 右侧：告警等级完成情况统计表格 -->
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                                <div style="margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid var(--border-color);">
                                    <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary); margin: 0;">
                                        <i class="fas fa-tasks" style="margin-right: 8px; color: #10b981;"></i>
                                        告警等级完成情况统计
                                    </h3>
                                </div>

                                <table style="width: 100%; border-collapse: collapse; border: 1px solid #e2e8f0; margin-bottom: 20px;">
                                    <thead>
                                        <tr style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
                                            <th style="padding: 16px; text-align: left; font-size: 13px; font-weight: 600; color: #475569; border-bottom: 2px solid #cbd5e1; width: 15%;">等级</th>
                                            <th style="padding: 16px; text-align: center; font-size: 13px; font-weight: 600; color: #475569; border-bottom: 2px solid #cbd5e1; width: 12%;">数量</th>
                                            <th style="padding: 16px; text-align: center; font-size: 13px; font-weight: 600; color: #475569; border-bottom: 2px solid #cbd5e1; width: 25%;">完成度</th>
                                            <th style="padding: 16px; text-align: center; font-size: 13px; font-weight: 600; color: #475569; border-bottom: 2px solid #cbd5e1; width: 15%;">完成时间</th>
                                            <th style="padding: 16px; text-align: left; font-size: 13px; font-weight: 600; color: #475569; border-bottom: 2px solid #cbd5e1; width: 33%;">触达方式</th>
                                        </tr>
                                    </thead>
                                    <tbody id="alarmLevelCompletionTableBody">
                                        <!-- 动态生成 -->
                                    </tbody>
                                </table>

                                <!-- 关键指标汇总 -->
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                                    <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 8px; padding: 16px; border-left: 4px solid #3b82f6;">
                                        <div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">总告警数</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #1e293b;" id="totalAlarmCount">140</div>
                                        <div style="font-size: 11px; color: #64748b; margin-top: 4px;">今日统计</div>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 8px; padding: 16px; border-left: 4px solid #10b981;">
                                        <div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">总体完成率</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #10b981;" id="overallCompletionRate">82.1%</div>
                                        <div style="font-size: 11px; color: #64748b; margin-top: 4px;">已完成115条</div>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 8px; padding: 16px; border-left: 4px solid #f59e0b;">
                                        <div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">待处理告警</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #f59e0b;" id="pendingAlarmCount">25</div>
                                        <div style="font-size: 11px; color: #64748b; margin-top: 4px;">需要关注</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 第二行：告警类型统计饼图 + TOP5排行榜卡片 -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                            <!-- 左侧：告警类型统计饼图 -->
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                                <div style="margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid var(--border-color);">
                                    <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary); margin: 0;">
                                        <i class="fas fa-chart-pie" style="margin-right: 8px; color: #3b82f6;"></i>
                                        告警类型统计
                                    </h3>
                                </div>
                                <div style="height: 400px; position: relative;">
                                    <canvas id="alarmTypeStatsChart"></canvas>
                                </div>
                            </div>

                            <!-- 右侧：TOP5排行榜卡片（Tab切换） -->
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                                <!-- Tab标签栏 -->
                                <div style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid #e2e8f0;">
                                    <button id="tab-efficiency" class="ranking-tab active" onclick="switchRankingTab('efficiency')" style="flex: 1; padding: 12px 16px; border: none; background: none; color: #64748b; font-size: 14px; font-weight: 500; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s;">
                                        <i class="fas fa-hourglass-half" style="margin-right: 6px;"></i>
                                        处理效率最慢
                                    </button>
                                    <button id="tab-unresolved" class="ranking-tab" onclick="switchRankingTab('unresolved')" style="flex: 1; padding: 12px 16px; border: none; background: none; color: #64748b; font-size: 14px; font-weight: 500; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s;">
                                        <i class="fas fa-exclamation-triangle" style="margin-right: 6px;"></i>
                                        未消警次数
                                    </button>
                                </div>

                                <!-- Tab内容区域 -->
                                <div id="ranking-tab-content">
                                    <!-- 处理效率最慢 TOP5 -->
                                    <div id="efficiency-content" class="ranking-content" style="display: block;">
                                        <div style="display: flex; align-items: center; margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 8px;">
                                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                                <i class="fas fa-hourglass-half" style="color: white; font-size: 18px;"></i>
                                            </div>
                                            <div>
                                                <h3 style="font-size: 16px; font-weight: 600; color: #92400e; margin: 0;">
                                                    处理效率最慢 TOP5
                                                </h3>
                                                <div style="font-size: 12px; color: #b45309; margin-top: 2px;">
                                                    处理效率慢：可以进行告警升级或者是增加他的触达方式
                                                </div>
                                            </div>
                                        </div>
                                        <div id="alarmEfficiencyRankingList">
                                            <!-- 动态生成 -->
                                        </div>
                                    </div>

                                    <!-- 未消警次数 TOP5 -->
                                    <div id="unresolved-content" class="ranking-content" style="display: none;">
                                        <div style="display: flex; align-items: center; margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-radius: 8px;">
                                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                                <i class="fas fa-exclamation-triangle" style="color: white; font-size: 18px;"></i>
                                            </div>
                                            <div>
                                                <h3 style="font-size: 16px; font-weight: 600; color: #991b1b; margin: 0;">
                                                    未消警次数 TOP5
                                                </h3>
                                                <div style="font-size: 12px; color: #b91c1c; margin-top: 2px;">
                                                    未处理完成的告警类型
                                                </div>
                                            </div>
                                        </div>
                                        <div id="alarmCountRankingList">
                                            <!-- 动态生成 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>

    </main>

    <!-- Module 2: 告警详情侧边栏 -->
    <div class="alarm-detail-sidebar" id="alarmDetailSidebar">
        <div class="detail-header">
            <div class="detail-header-top">
                <h2 class="detail-title" id="detailAlarmId">告警详情</h2>
                <button class="detail-close" onclick="closeAlarmDetail()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="detailAlarmMeta"></div>
        </div>
        <div class="detail-content" id="detailContent">
            <!-- 动态加载详情内容 -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="common.js"></script>
    <script>
        // 艹！基于PRD的告警分析系统核心逻辑

        // 检查登录状态
        checkAuth();
        setActiveMenuItem('alarm-management');

        // ==================== 模拟告警数据 ====================

        function generateMockAlarms() {
            const alarms = [];
            const levels = ['critical', 'major', 'minor', 'info'];
            const types = [
                '电池过温', '通信中断', 'SOC过低', '电压异常', '电流过大',
                '绝缘故障', '风扇故障', '柜门未关', 'BMS故障', '温差过大',
                '湿度超限', '烟雾告警', '消防告警', '电表异常', 'PCS故障',
                '空调故障', '电池老化', '功率受限', '系统过载', '漏液检测',
                '接触器故障', '熔断器熔断', '直流母线', '逆变器告警', '电网异常'
            ];
            const statuses = ['unconfirmed', 'processing', 'recovered'];
            const sites = ['科技园区站', '工业园区站', '商业中心站'];
            const devices = ['#1柜-BMS-A簇', '#2柜-BMS-B簇', '#3柜-PCS模块', '#4柜-电池组', '#5柜-冷却系统'];

            const now = Date.now();

            for (let i = 0; i < 120; i++) {
                const level = levels[Math.floor(Math.random() * levels.length)];
                const timestamp = new Date(now - Math.random() * 24 * 60 * 60 * 1000);
                const aggregatedCount = Math.random() > 0.7 ? Math.floor(Math.random() * 5 + 2) : 0;
                const status = statuses[Math.floor(Math.random() * statuses.length)]; // 艹！修复status未定义的bug

                // 艹！给每个告警添加响应和处理时间，用于计算KPI指标
                const responseMinutes = status !== 'unconfirmed' ? Math.floor(Math.random() * 30 + 5) : null; // 5-35分钟
                const resolveMinutes = status === 'recovered' ? Math.floor(Math.random() * 60 + 30) : null; // 30-90分钟

                alarms.push({
                    id: `ALM-2025-${String(i + 1).padStart(4, '0')}`,
                    timestamp: timestamp,
                    level: level,
                    site: sites[Math.floor(Math.random() * sites.length)],
                    device: devices[Math.floor(Math.random() * devices.length)],
                    type: types[Math.floor(Math.random() * types.length)],
                    status: status,
                    aggregatedCount: aggregatedCount,
                    responseTime: responseMinutes, // 响应时长（分钟）
                    resolveTime: resolveMinutes, // 解决时长（分钟）
                    rootCause: level === 'critical' ? 'PCS降载，根因：#3簇温差过大' : null,
                    sop: [
                        '立即降低充放电功率至50%',
                        '检查冷却系统运行状态',
                        '清理散热器灰尘和杂物',
                        '检查环境温度是否异常',
                        '必要时暂停充放电操作'
                    ],
                    relatedEvents: [
                        { time: '14:18:32', description: '电网指令：降功率至50%' },
                        { time: '14:20:15', description: '运维人员远程操作：关闭A簇充电' }
                    ]
                });
            }

            return alarms.sort((a, b) => b.timestamp - a.timestamp);
        }

        // 艹！生成模拟设备数据（SOH、温度、电压、SOC、功率等）
        function generateMockDeviceData() {
            const devices = [
                { id: 'DEV-001', name: '#1柜-BMS-A簇' },
                { id: 'DEV-002', name: '#2柜-BMS-B簇' },
                { id: 'DEV-003', name: '#3柜-PCS模块' },
                { id: 'DEV-004', name: '#4柜-电池组' },
                { id: 'DEV-005', name: '#5柜-冷却系统' }
            ];

            return devices.map(device => {
                // SOH（健康度）：80-100%，正态分布偏向高值
                const soh = Math.round(80 + Math.random() * 20);

                // 温度：15-50°C，有些设备可能过温
                const avgTemp = 25 + (Math.random() - 0.5) * 20; // 15-35°C
                const tempConsistency = Math.random() * 10; // 温差0-10°C

                // 电压：3.2-3.8V（单体电压），正常范围3.3-3.7V
                const avgVoltage = 3.3 + Math.random() * 0.4; // 3.3-3.7V
                const voltageConsistency = Math.random() * 100; // 电压差0-100mV

                // SOC（充电状态）：20-95%
                const soc = Math.round(20 + Math.random() * 75);

                // 功率：-500 to 500kW（负数充电，正数放电）
                const power = Math.round((Math.random() - 0.5) * 1000);

                // 循环次数：500-3500次
                const cycleCount = Math.round(500 + Math.random() * 3000);

                // 容量保持率：75-100%（与SOH相关）
                const capacityRetention = Math.round(75 + (soh - 80) * 1.25); // 基于SOH计算

                return {
                    deviceId: device.id,
                    deviceName: device.name,
                    soh: soh, // 健康度 %
                    temperature: Math.round(avgTemp * 10) / 10, // 平均温度 °C
                    temperatureConsistency: Math.round(tempConsistency * 10) / 10, // 温差 °C
                    voltage: Math.round(avgVoltage * 1000) / 1000, // 平均电压 V
                    voltageConsistency: Math.round(voltageConsistency), // 电压差 mV
                    soc: soc, // 充电状态 %
                    power: power, // 功率 kW
                    cycleCount: cycleCount, // 循环次数
                    capacityRetention: capacityRetention, // 容量保持率 %
                    lastUpdate: new Date()
                };
            });
        }

        let allAlarms = generateMockAlarms();
        let filteredAlarms = [...allAlarms];
        let deviceData = generateMockDeviceData(); // 艹！生成设备数据

        // Chart实例引用 - 用于销毁和重建
        let chartInstances = {
            stationDistribution: null,
            alarmLevelDist: null,
            topDevices: null,
            alarmTypeStats: null,
            alarmLevelPie: null,
            soh: null,
            sop: null,
            alarmType: null,
            deviceRanking: null,
            alarmLevel: null,
            mttrTrend: null
        };

        // ==================== 艹！动态计算智能概览的所有KPI数据 ====================

        function calculateOverviewMetrics() {
            const metrics = {
                // 基础统计
                totalAlarms: allAlarms.length,
                unconfirmedCount: 0,
                processingCount: 0,
                recoveredCount: 0,
                criticalCount: 0,
                majorCount: 0,
                minorCount: 0,
                infoCount: 0,

                // 时间统计
                avgResponseTime: 0, // 平均响应时长(分钟)
                avgResolveTime: 0,  // 平均解决时长(分钟)

                // 今日统计
                todayAlarms: 0,

                // 健康度评分
                alarmResponseScore: 0,    // 告警响应得分
                deviceHealthScore: 0,     // 设备健康得分
                operationScore: 0,        // 运维效率得分
                predictionScore: 0,       // 预测准确率得分
                overallScore: 0           // 综合健康度
            };

            const now = Date.now();
            const todayStart = new Date(new Date().setHours(0, 0, 0, 0)).getTime();
            let totalResponseTime = 0;
            let responseCount = 0;
            let totalResolveTime = 0;
            let resolveCount = 0;

            // 遍历所有告警统计数据
            allAlarms.forEach(alarm => {
                // 状态统计
                if (alarm.status === 'unconfirmed') metrics.unconfirmedCount++;
                else if (alarm.status === 'processing') metrics.processingCount++;
                else if (alarm.status === 'recovered') metrics.recoveredCount++;

                // 等级统计
                if (alarm.level === 'critical') metrics.criticalCount++;
                else if (alarm.level === 'major') metrics.majorCount++;
                else if (alarm.level === 'minor') metrics.minorCount++;
                else if (alarm.level === 'info') metrics.infoCount++;

                // 今日告警
                if (alarm.timestamp.getTime() >= todayStart) {
                    metrics.todayAlarms++;
                }

                // 响应时长统计
                if (alarm.responseTime) {
                    totalResponseTime += alarm.responseTime;
                    responseCount++;
                }

                // 解决时长统计
                if (alarm.resolveTime) {
                    totalResolveTime += alarm.resolveTime;
                    resolveCount++;
                }
            });

            // 计算平均值
            metrics.avgResponseTime = responseCount > 0 ? Math.round(totalResponseTime / responseCount) : 0;
            metrics.avgResolveTime = resolveCount > 0 ? Math.round(totalResolveTime / resolveCount) : 0;

            // ========== 计算健康度评分 ==========

            // 1. 告警响应得分 (基于未确认率、响应时间、紧急告警处理) - 艹！优化算法
            // 计算未确认率（特别关注紧急告警）
            const unconfirmedRate = metrics.unconfirmedCount / metrics.totalAlarms;
            const criticalUnconfirmed = allAlarms.filter(a => a.level === 'critical' && a.status === 'unconfirmed').length;
            const criticalUnconfirmedRate = metrics.criticalCount > 0 ? criticalUnconfirmed / metrics.criticalCount : 0;

            // 未确认率得分（紧急告警未确认扣分更多）
            const unconfirmedScore = Math.max(0, 100 - unconfirmedRate * 80 - criticalUnconfirmedRate * 40);

            // 响应时间得分（越快越好，15分钟为优秀，30分钟为及格）
            const responseTimeScore = Math.max(0, 100 - (metrics.avgResponseTime / 30) * 60);

            // 处理效率得分（处理中的告警占比，说明团队在积极响应）
            const processingRate = metrics.processingCount / metrics.totalAlarms;
            const processingScore = Math.min(100, processingRate * 200); // 处理中越多说明越积极

            // 综合告警响应得分（加权平均）
            metrics.alarmResponseScore = Math.round(
                unconfirmedScore * 0.5 +      // 未确认率权重50%
                responseTimeScore * 0.3 +     // 响应时间权重30%
                processingScore * 0.2         // 处理效率权重20%
            );

            // 2. 设备健康得分 (基于设备数据：SOH、温度、电压一致性) - 艹！全新算法
            // 计算平均SOH（健康度）
            const avgSOH = deviceData.reduce((sum, d) => sum + d.soh, 0) / deviceData.length;
            const sohScore = avgSOH; // SOH本身就是0-100的分数

            // 温度一致性评分（温差越小越好，≤5°C为满分）
            const avgTempConsistency = deviceData.reduce((sum, d) => sum + d.temperatureConsistency, 0) / deviceData.length;
            const tempScore = Math.max(0, 100 - (avgTempConsistency / 5) * 100);

            // 电压一致性评分（电压差越小越好，≤50mV为满分）
            const avgVoltageConsistency = deviceData.reduce((sum, d) => sum + d.voltageConsistency, 0) / deviceData.length;
            const voltageScore = Math.max(0, 100 - (avgVoltageConsistency / 50) * 100);

            // 循环次数评分（<3000次为健康，>3000次开始扣分）
            const avgCycleCount = deviceData.reduce((sum, d) => sum + d.cycleCount, 0) / deviceData.length;
            const cycleScore = Math.max(0, 100 - Math.max(0, (avgCycleCount - 3000) / 500) * 10);

            // 容量保持率评分
            const avgCapacityRetention = deviceData.reduce((sum, d) => sum + d.capacityRetention, 0) / deviceData.length;
            const capacityScore = avgCapacityRetention; // 容量保持率本身就是0-100的分数

            // 综合设备健康得分（加权平均）
            metrics.deviceHealthScore = Math.round(
                sohScore * 0.4 +           // SOH权重40%
                tempScore * 0.2 +          // 温度一致性权重20%
                voltageScore * 0.2 +       // 电压一致性权重20%
                cycleScore * 0.1 +         // 循环次数权重10%
                capacityScore * 0.1        // 容量保持率权重10%
            );

            // 3. 运维效率得分 (基于MTTR、MTBF、恢复率、重复告警) - 艹！全新算法
            // MTTR评分（平均修复时间，越短越好）
            const mttrScore = Math.max(0, 100 - (metrics.avgResolveTime / 60) * 50); // 60分钟基准，超过扣分更多

            // 计算MTBF（平均故障间隔时间，单位：小时）
            const sortedAlarms = [...allAlarms].sort((a, b) => a.timestamp - b.timestamp);
            let totalInterval = 0;
            for (let i = 1; i < sortedAlarms.length; i++) {
                const interval = (sortedAlarms[i].timestamp - sortedAlarms[i-1].timestamp) / (1000 * 60 * 60); // 转换为小时
                totalInterval += interval;
            }
            const avgMTBF = sortedAlarms.length > 1 ? totalInterval / (sortedAlarms.length - 1) : 24;
            const mtbfScore = Math.min(100, (avgMTBF / 24) * 100); // 24小时为满分基准

            // 恢复率评分
            const recoveredRate = metrics.recoveredCount / metrics.totalAlarms;
            const recoveryScore = recoveredRate * 100;

            // 重复告警惩罚（同一设备24小时内多次告警）
            const deviceAlarmMap = {};
            allAlarms.forEach(alarm => {
                if (!deviceAlarmMap[alarm.device]) deviceAlarmMap[alarm.device] = [];
                deviceAlarmMap[alarm.device].push(alarm.timestamp.getTime());
            });
            let repeatCount = 0;
            Object.values(deviceAlarmMap).forEach(timestamps => {
                timestamps.sort((a, b) => a - b);
                for (let i = 1; i < timestamps.length; i++) {
                    if (timestamps[i] - timestamps[i-1] < 24 * 60 * 60 * 1000) {
                        repeatCount++; // 24小时内重复告警
                    }
                }
            });
            const repeatRate = repeatCount / metrics.totalAlarms;
            const noRepeatScore = Math.max(0, 100 - repeatRate * 150); // 重复告警扣分严重

            // 综合运维效率得分（加权平均）
            metrics.operationScore = Math.round(
                mttrScore * 0.3 +          // MTTR权重30%
                mtbfScore * 0.25 +         // MTBF权重25%
                recoveryScore * 0.3 +      // 恢复率权重30%
                noRepeatScore * 0.15       // 无重复告警权重15%
            );

            // 4. 预测准确率 (模拟数据，实际需要对比预测和实际)
            metrics.predictionScore = Math.round(90 + Math.random() * 10); // 90-100分

            // 5. 综合健康度 (加权平均)
            metrics.overallScore = Math.round(
                metrics.alarmResponseScore * 0.3 +
                metrics.deviceHealthScore * 0.3 +
                metrics.operationScore * 0.25 +
                metrics.predictionScore * 0.15
            );

            return metrics;
        }

        // ==================== 艹！渲染智能概览页面（所有数据动态计算） ====================

        // 数字动画函数
        function animateNumber(element, targetValue, duration = 1000) {
            const startValue = parseInt(element.textContent) || 0;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // 使用缓动函数
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const currentValue = Math.round(startValue + (targetValue - startValue) * easeOutQuart);

                element.textContent = currentValue;

                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }

            requestAnimationFrame(update);
        }

        function renderOverviewPanel() {
            const metrics = calculateOverviewMetrics();

            // 更新健康度评分（使用动画）
            const overallScoreEl = document.getElementById('overallScore');
            if (overallScoreEl) {
                animateNumber(overallScoreEl, metrics.overallScore, 1200);
            }

            // 艹！评分细分已删除，不再需要更新
            // const breakdownItems = document.querySelectorAll('.breakdown-item');
            // if (breakdownItems[0]) {
            //     breakdownItems[0].querySelector('.breakdown-bar').style.width = `${metrics.alarmResponseScore}%`;
            //     breakdownItems[0].querySelector('.breakdown-score').textContent = `${metrics.alarmResponseScore}分`;
            // }
            // if (breakdownItems[1]) {
            //     breakdownItems[1].querySelector('.breakdown-bar').style.width = `${metrics.deviceHealthScore}%`;
            //     breakdownItems[1].querySelector('.breakdown-score').textContent = `${metrics.deviceHealthScore}分`;
            // }
            // if (breakdownItems[2]) {
            //     breakdownItems[2].querySelector('.breakdown-bar').style.width = `${metrics.operationScore}%`;
            //     breakdownItems[2].querySelector('.breakdown-score').textContent = `${metrics.operationScore}分`;
            // }
            // if (breakdownItems[3]) {
            //     breakdownItems[3].querySelector('.breakdown-bar').style.width = `${metrics.predictionScore}%`;
            //     breakdownItems[3].querySelector('.breakdown-score').textContent = `${metrics.predictionScore}分`;
            // }

            // 更新健康度状态文字和分数颜色
            const scoreStatus = document.querySelector('.score-status');
            const scoreValue = document.querySelector('.score-value');

            if (scoreStatus && scoreValue) {
                if (metrics.overallScore >= 90) {
                    scoreStatus.textContent = '优秀运行';
                    scoreStatus.style.color = '#10b981';
                    scoreStatus.style.background = 'rgba(16, 185, 129, 0.1)';
                    scoreValue.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                    scoreValue.style.webkitBackgroundClip = 'text';
                    scoreValue.style.webkitTextFillColor = 'transparent';
                } else if (metrics.overallScore >= 75) {
                    scoreStatus.textContent = '良好运行';
                    scoreStatus.style.color = '#3b82f6';
                    scoreStatus.style.background = 'rgba(59, 130, 246, 0.1)';
                    scoreValue.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
                    scoreValue.style.webkitBackgroundClip = 'text';
                    scoreValue.style.webkitTextFillColor = 'transparent';
                } else if (metrics.overallScore >= 60) {
                    scoreStatus.textContent = '正常运行';
                    scoreStatus.style.color = '#fbbf24';
                    scoreStatus.style.background = 'rgba(251, 191, 36, 0.1)';
                    scoreValue.style.background = 'linear-gradient(135deg, #fbbf24, #f59e0b)';
                    scoreValue.style.webkitBackgroundClip = 'text';
                    scoreValue.style.webkitTextFillColor = 'transparent';
                } else {
                    scoreStatus.textContent = '需要关注';
                    scoreStatus.style.color = '#ef4444';
                    scoreStatus.style.background = 'rgba(239, 68, 68, 0.1)';
                    scoreValue.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                    scoreValue.style.webkitBackgroundClip = 'text';
                    scoreValue.style.webkitTextFillColor = 'transparent';
                }
            }

            // 更新SVG仪表盘进度
            const gaugeProgress = document.getElementById('gaugeProgress');
            if (gaugeProgress) {
                const circumference = 282.7; // SVG弧线周长 (更新后的尺寸)
                const offset = circumference - (circumference * metrics.overallScore / 100);
                gaugeProgress.style.strokeDashoffset = offset;
            }

            // 艹！已删除小型统计卡片（正常、警告、紧急）
            // const normalCountEl = document.getElementById('normalCount');
            // const warningCountEl = document.getElementById('warningCount');
            // const criticalCountEl = document.getElementById('criticalCount');
            // if (normalCountEl) {
            //     animateNumber(normalCountEl, metrics.recoveredCount, 800);
            // }
            // if (warningCountEl) {
            //     animateNumber(warningCountEl, metrics.minorCount, 800);
            // }
            // if (criticalCountEl) {
            //     animateNumber(criticalCountEl, metrics.criticalCount + metrics.majorCount, 800);
            // }

            // 更新趋势信息（模拟数据：与昨日对比）
            const healthTrendEl = document.getElementById('healthTrend');
            if (healthTrendEl) {
                // 模拟昨日分数（实际应该从历史数据获取）
                const yesterdayScore = Math.max(50, metrics.overallScore - Math.floor(Math.random() * 10 - 5));
                const scoreDiff = metrics.overallScore - yesterdayScore;

                const trendArrow = healthTrendEl.querySelector('.trend-arrow');
                const trendValue = healthTrendEl.querySelector('.trend-value');

                // 添加空值检查，防止元素不存在导致错误
                if (trendArrow && trendValue) {
                    if (scoreDiff > 0) {
                        healthTrendEl.className = 'health-trend up';
                        trendArrow.className = 'fas fa-arrow-up trend-arrow';
                        trendValue.textContent = `+${scoreDiff}分`;
                    } else if (scoreDiff < 0) {
                        healthTrendEl.className = 'health-trend down';
                        trendArrow.className = 'fas fa-arrow-down trend-arrow';
                        trendValue.textContent = `${scoreDiff}分`;
                    } else {
                        healthTrendEl.className = 'health-trend';
                        trendArrow.className = 'fas fa-minus trend-arrow';
                        trendValue.textContent = '持平';
                    }
                }
            }

            // 更新快捷操作卡片的数字
            const quickActionCards = document.querySelectorAll('.quick-action-card');
            if (quickActionCards[0]) {
                // 预测性维护 - 趋势预警数（暂用紧急+主要告警数）
                const trendWarnings = metrics.criticalCount + metrics.majorCount;
                const quickValue0 = quickActionCards[0].querySelector('.quick-value');
                if (quickValue0) {
                    quickValue0.innerHTML = `${trendWarnings}<span class="quick-unit">项趋势预警</span>`;
                }
            }
            if (quickActionCards[1]) {
                // 统计报表分析 - 数据天数
                const quickValue1 = quickActionCards[1].querySelector('.quick-value');
                if (quickValue1) {
                    quickValue1.innerHTML = `7<span class="quick-unit">天数据</span>`;
                }
            }
            if (quickActionCards[2]) {
                // 导出报表 - 总记录数
                const quickValue2 = quickActionCards[2].querySelector('.quick-value');
                if (quickValue2) {
                    quickValue2.innerHTML = `${metrics.totalAlarms.toLocaleString()}<span class="quick-unit">条记录</span>`;
                }
            }

            // 更新AI智能建议（基于数据生成）
            const suggestionCards = document.querySelectorAll('.suggestion-card');

            // 建议1：基于告警高峰时段分析（保持原有文案，未来可基于实际数据）
            // suggestionCards[0] 保持不变

            // 建议2：团队效率表扬
            if (suggestionCards[1]) {
                const avgMTTA = metrics.avgResponseTime;
                const performanceText = avgMTTA <= 15 ? '优秀' : avgMTTA <= 25 ? '良好' : '正常';
                const comparisonPercent = Math.round((20 - avgMTTA) / 20 * 100); // 假设行业平均20分钟

                const suggestionTitle1 = suggestionCards[1].querySelector('.suggestion-title');
                const suggestionDesc1 = suggestionCards[1].querySelector('.suggestion-desc');

                if (suggestionTitle1) {
                    suggestionTitle1.textContent = `您的团队运维效率${performanceText}`;
                }
                if (suggestionDesc1) {
                    suggestionDesc1.textContent =
                        `本周平均响应时长(MTTA) ${avgMTTA}分钟，` +
                        (comparisonPercent > 0
                            ? `比行业平均快${comparisonPercent}%，继续保持！`
                            : `建议优化响应流程。`) +
                        `团队综合评分${metrics.operationScore}分`;
                }
            }

            // 建议3：基于设备健康度提醒
            if (suggestionCards[2]) {
                const suggestionIcon2 = suggestionCards[2].querySelector('.suggestion-icon');
                const suggestionTitle2 = suggestionCards[2].querySelector('.suggestion-title');
                const suggestionDesc2 = suggestionCards[2].querySelector('.suggestion-desc');

                if (metrics.deviceHealthScore < 80) {
                    if (suggestionIcon2) suggestionIcon2.textContent = '⚠️';
                    if (suggestionTitle2) suggestionTitle2.textContent = '设备健康度需要关注';
                    if (suggestionDesc2) {
                        suggestionDesc2.textContent =
                            `当前设备健康度${metrics.deviceHealthScore}分，检测到${metrics.criticalCount}个紧急告警和${metrics.majorCount}个主要告警，建议优先处理紧急问题`;
                    }
                } else {
                    if (suggestionIcon2) suggestionIcon2.textContent = '✅';
                    if (suggestionTitle2) suggestionTitle2.textContent = '设备整体运行稳定';
                    if (suggestionDesc2) {
                        suggestionDesc2.textContent =
                            `设备健康度${metrics.deviceHealthScore}分，当前仅有${metrics.criticalCount}个紧急告警，系统运行良好`;
                    }
                }
            }

            // ========== 艹！更新告警数量KPI ==========
            const alarmCountValue = document.getElementById('alarmCountValue');
            const alarmCountDetail = document.getElementById('alarmCountDetail');
            const alarmCountTrend = document.getElementById('alarmCountTrend');
            if (alarmCountValue && alarmCountDetail && alarmCountTrend) {
                const totalCount = metrics.totalAlarms;
                const last24hCount = Math.round(totalCount * 0.3); // 假设30%告警在24小时内

                // 艹！获取当前时间范围
                const timeRangeSelector = document.getElementById('overviewTimeRange');
                const timeRange = timeRangeSelector ? timeRangeSelector.value : 'week';

                // 艹！根据时间范围确定环比基准和文本
                let periodText = '较上周';
                let lastPeriodCount;

                switch(timeRange) {
                    case 'today':
                        periodText = '较昨日';
                        lastPeriodCount = Math.round(totalCount * (0.85 + Math.random() * 0.3)); // 昨日数据
                        break;
                    case 'month':
                        periodText = '较上月';
                        lastPeriodCount = Math.round(totalCount * (0.80 + Math.random() * 0.4)); // 上月数据
                        break;
                    case 'week':
                    default:
                        periodText = '较上周';
                        lastPeriodCount = Math.round(totalCount * (0.85 + Math.random() * 0.3)); // 上周数据
                        break;
                }

                // 计算环比变化
                const periodChange = totalCount - lastPeriodCount;
                const periodChangePercent = lastPeriodCount > 0 ? ((periodChange / lastPeriodCount) * 100).toFixed(1) : 0;

                // 更新数值和详情
                alarmCountValue.innerHTML = `${totalCount}<span class="kpi-unit">条</span>`;
                alarmCountDetail.textContent = `24小时: ${last24hCount}条`;

                // 更新环比趋势
                const trendIcon = alarmCountTrend.querySelector('i');
                const trendText = alarmCountTrend.querySelector('span');

                // 告警数量：增加是不好的（红色），减少是好的（绿色）
                if (periodChange > 0) {
                    trendIcon.className = 'fas fa-arrow-up';
                    trendText.textContent = `${periodText} +${periodChangePercent}%`;
                    alarmCountTrend.className = 'kpi-trend trend-up';
                } else if (periodChange < 0) {
                    trendIcon.className = 'fas fa-arrow-down';
                    trendText.textContent = `${periodText} ${periodChangePercent}%`;
                    alarmCountTrend.className = 'kpi-trend trend-down';
                } else {
                    trendIcon.className = 'fas fa-minus';
                    trendText.textContent = `${periodText} 持平`;
                    alarmCountTrend.className = 'kpi-trend trend-neutral';
                }
            }

            // ========== 艹！更新其他3个KPI的环比文本 ==========
            const timeRangeSelector = document.getElementById('overviewTimeRange');
            const timeRange = timeRangeSelector ? timeRangeSelector.value : 'week';

            // 艹！根据时间范围确定环比基准文本
            let periodText = '较上周';
            switch(timeRange) {
                case 'today':
                    periodText = '较昨日';
                    break;
                case 'month':
                    periodText = '较上月';
                    break;
                case 'week':
                default:
                    periodText = '较上周';
                    break;
            }

            // 1. 更新重复告警率环比
            const repeatRateTrend = document.getElementById('repeatRateTrend');
            if (repeatRateTrend) {
                const trendText = repeatRateTrend.querySelector('span');
                if (trendText) {
                    trendText.textContent = `${periodText} -0.8%`;
                }
            }

            // 2. 更新处理效率环比
            const efficiencyTrend = document.getElementById('efficiencyTrend');
            if (efficiencyTrend) {
                const trendText = efficiencyTrend.querySelector('span');
                if (trendText) {
                    trendText.textContent = `${periodText} +2.1%`;
                }
            }

            // 3. 更新平均响应时长环比
            const responseTimeTrend = document.getElementById('responseTimeTrend');
            if (responseTimeTrend) {
                const trendText = responseTimeTrend.querySelector('span');
                if (trendText) {
                    trendText.textContent = `${periodText} -3分钟`;
                }
            }

            // 4. 更新系统健康度趋势环比
            const healthTrend = document.getElementById('healthTrend');
            if (healthTrend) {
                const trendTextElem = healthTrend.querySelector('.trend-text');
                if (trendTextElem) {
                    trendTextElem.textContent = periodText;
                }
            }

            console.log('艹！智能概览数据已刷新：', metrics);
        }

        // ========== 艹！更新告警总览时间范围 ==========
        function updateOverviewTimeRange() {
            const timeRange = document.getElementById('overviewTimeRange').value;
            console.log('艹！告警总览时间范围切换为：', timeRange);

            // 根据时间范围重新计算和渲染数据
            // 这里可以根据不同的时间范围调整数据计算逻辑
            let timeRangeText = '';
            switch(timeRange) {
                case 'today':
                    timeRangeText = '今日';
                    break;
                case 'week':
                    timeRangeText = '本周';
                    break;
                case 'month':
                    timeRangeText = '本月';
                    break;
            }

            // 重新渲染智能概览面板（会根据新的时间范围重新计算数据）
            renderOverviewPanel();

            // 显示提示信息
            console.log(`艹！已切换到${timeRangeText}数据视图`);
        }

        // ========== 艹！热点分析Tab切换 ==========
        function switchHotspotTab(tabName, btn) {
            // 切换Tab面板
            document.querySelectorAll('.hotspot-tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });

            const targetPanel = document.getElementById(tabName + 'Panel');
            if (targetPanel) {
                targetPanel.classList.add('active');
            }

            // 更新Tab按钮状态
            document.querySelectorAll('.hotspot-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            if (btn) {
                btn.classList.add('active');
            }

            // 切换到告警通知Tab时绘制饼图和初始化数据
            if (tabName === 'notification') {
                setTimeout(() => {
                    drawAlarmTypeStatsChart();
                    drawAlarmLevelPieChart();
                    renderAlarmLevelCompletionTable();
                    renderAlarmCountRanking();
                    renderAlarmEfficiencyRanking();
                    initNotificationTab();
                }, 100);
            }

            console.log(`艹！热点分析切换到${tabName}Tab`);
        }

        // ==================== Tab切换 ====================

        // 艹！Tab切换函数，支持从任何地方调用
        function switchTab(tabName, btn) {
            // 切换Tab面板
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });

            const targetPanel = document.getElementById(tabName + 'Panel');
            if (targetPanel) {
                targetPanel.classList.add('active');
            }

            // 更新Tab按钮状态
            document.querySelectorAll('.analysis-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // 如果没有传btn参数，就根据tabName找到对应的按钮
            if (!btn) {
                const tabButtons = document.querySelectorAll('.analysis-tab');
                const tabMap = {
                    'overview': 0     // 智能概览
                };
                const targetIndex = tabMap[tabName];
                if (targetIndex !== undefined && tabButtons[targetIndex]) {
                    btn = tabButtons[targetIndex];
                }
            }

            if (btn) {
                btn.classList.add('active');
            }
        }

        // 艹！排行榜Tab切换函数
        function switchRankingTab(tabName) {
            // 隐藏所有内容
            document.querySelectorAll('.ranking-content').forEach(content => {
                content.style.display = 'none';
            });

            // 移除所有tab的active状态
            document.querySelectorAll('.ranking-tab').forEach(tab => {
                tab.style.color = '#64748b';
                tab.style.borderBottomColor = 'transparent';
                tab.classList.remove('active');
            });

            // 显示选中的内容
            const targetContent = document.getElementById(tabName + '-content');
            if (targetContent) {
                targetContent.style.display = 'block';
            }

            // 激活选中的tab
            const activeTab = document.getElementById('tab-' + tabName);
            if (activeTab) {
                activeTab.style.color = '#0ea5e9';
                activeTab.style.borderBottomColor = '#0ea5e9';
                activeTab.classList.add('active');
            }
        }

        // ==================== M1.2 渲染告警列表 ====================

        function renderAlarmList(alarms) {
            const container = document.getElementById('alarmList');

            if (alarms.length === 0) {
                container.innerHTML = `
                    <div style="padding: 60px; text-align: center; color: var(--text-secondary);">
                        <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;"></i>
                        <p style="font-size: 16px;">暂无符合条件的告警</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = alarms.map(alarm => {
                const levelIcons = {
                    critical: 'fa-exclamation-circle',
                    major: 'fa-exclamation-triangle',
                    minor: 'fa-info-circle',
                    info: 'fa-bell'
                };

                const statusLabels = {
                    unconfirmed: '未确认',
                    processing: '处理中',
                    recovered: '已恢复'
                };

                const timeStr = formatTimestamp(alarm.timestamp);

                return `
                    <div class="alarm-card ${alarm.level}" onclick="showAlarmDetail('${alarm.id}')">
                        <div class="alarm-level-badge ${alarm.level}">
                            <i class="fas ${levelIcons[alarm.level]}"></i>
                        </div>
                        <div class="alarm-content">
                            <div class="alarm-header">
                                <div>
                                    <div class="alarm-title">${alarm.device} - ${alarm.type}</div>
                                    <div class="alarm-time">
                                        <i class="far fa-clock"></i>
                                        <span>${timeStr}</span>
                                    </div>
                                </div>
                                <div class="alarm-status ${alarm.status}">
                                    ${statusLabels[alarm.status]}
                                </div>
                            </div>
                            <div class="alarm-meta">
                                <div class="alarm-meta-item">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>${alarm.site}</span>
                                </div>
                                <div class="alarm-meta-item">
                                    <i class="fas fa-tag"></i>
                                    <span>${alarm.type}</span>
                                </div>
                                <div class="alarm-meta-item">
                                    <i class="fas fa-hashtag"></i>
                                    <span>${alarm.id}</span>
                                </div>
                                ${alarm.aggregatedCount > 0 ? `
                                    <span class="alarm-aggregation">
                                        <i class="fas fa-layer-group"></i>
                                        聚合了 ${alarm.aggregatedCount} 条告警
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            const filteredCountEl = document.getElementById('filteredCount');
            if (filteredCountEl) {
                filteredCountEl.textContent = alarms.length.toLocaleString();
            }
        }

        // 格式化时间戳
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) { // 1分钟内
                return '刚刚';
            } else if (diff < 3600000) { // 1小时内
                return `${Math.floor(diff / 60000)} 分钟前`;
            } else if (diff < 86400000) { // 24小时内
                return `${Math.floor(diff / 3600000)} 小时前`;
            } else {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                const seconds = String(date.getSeconds()).padStart(2, '0');
                return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
            }
        }

        // ==================== M1.4 筛选功能 ====================

        function filterAlarms() {
            const timeRange = document.getElementById('timeRangeFilter').value;
            const site = document.getElementById('siteFilter').value;
            const level = document.getElementById('levelFilter').value;
            const status = document.getElementById('statusFilter').value;
            const searchText = document.getElementById('alarmSearch').value.toLowerCase();

            filteredAlarms = allAlarms.filter(alarm => {
                // 时间范围筛选
                if (timeRange !== 'realtime') {
                    const now = Date.now();
                    const alarmTime = alarm.timestamp.getTime();

                    if (timeRange === 'today') {
                        const todayStart = new Date(now).setHours(0, 0, 0, 0);
                        if (alarmTime < todayStart) return false;
                    } else if (timeRange === 'yesterday') {
                        const yesterdayStart = new Date(now - 86400000).setHours(0, 0, 0, 0);
                        const yesterdayEnd = new Date(now).setHours(0, 0, 0, 0);
                        if (alarmTime < yesterdayStart || alarmTime >= yesterdayEnd) return false;
                    } else if (timeRange === 'week') {
                        if (alarmTime < now - 7 * 86400000) return false;
                    } else if (timeRange === 'month') {
                        if (alarmTime < now - 30 * 86400000) return false;
                    }
                }

                // 电站筛选
                if (site && alarm.site !== site) return false;

                // 等级筛选
                if (level && alarm.level !== level) return false;

                // 状态筛选
                if (status && alarm.status !== status) return false;

                // 搜索
                if (searchText) {
                    const searchableText = `${alarm.device} ${alarm.type} ${alarm.id}`.toLowerCase();
                    if (!searchableText.includes(searchText)) return false;
                }

                return true;
            });

            // 艹！实时监控Tab已删除，不再渲染告警列表
            // renderAlarmList(filteredAlarms);
        }

        // ==================== M2 显示告警详情 ====================

        function showAlarmDetail(alarmId) {
            const alarm = allAlarms.find(a => a.id === alarmId);
            if (!alarm) return;

            const sidebar = document.getElementById('alarmDetailSidebar');
            const titleEl = document.getElementById('detailAlarmId');
            const metaEl = document.getElementById('detailAlarmMeta');
            const contentEl = document.getElementById('detailContent');

            titleEl.textContent = `告警详情 ${alarm.id}`;

            // 显示基本信息
            metaEl.innerHTML = `
                <div style="display: flex; gap: 12px; margin-top: 12px;">
                    <span class="alarm-status ${alarm.status}">${
                        alarm.status === 'unconfirmed' ? '未确认' :
                        alarm.status === 'processing' ? '处理中' : '已恢复'
                    }</span>
                    <span style="font-size: 13px; color: var(--text-secondary);">
                        <i class="far fa-clock"></i>
                        ${formatTimestamp(alarm.timestamp)}
                    </span>
                </div>
            `;

            // M2.1 根因分析和SOP
            let detailHTML = `
                <div class="detail-section">
                    <div class="detail-section-title">
                        <i class="fas fa-bullseye"></i>
                        根因分析
                    </div>
                    ${alarm.rootCause ? `
                        <div class="root-cause-box">
                            <div class="root-cause-label">Root Cause</div>
                            <div class="root-cause-text">${alarm.rootCause}</div>
                        </div>
                    ` : `
                        <p style="color: var(--text-secondary); font-size: 14px;">系统正在分析根因...</p>
                    `}
                </div>

                <div class="detail-section">
                    <div class="detail-section-title">
                        <i class="fas fa-clipboard-list"></i>
                        处理建议 (SOP)
                    </div>
                    <ul class="sop-list">
                        ${alarm.sop.map((step, index) => `
                            <li class="sop-item">
                                <div class="sop-number">${index + 1}</div>
                                <div class="sop-text">${step}</div>
                            </li>
                        `).join('')}
                    </ul>
                </div>

                <div class="detail-section">
                    <div class="detail-section-title">
                        <i class="fas fa-chart-area"></i>
                        伴随数据快照（前后5分钟）
                    </div>
                    <div class="snapshot-chart">
                        <canvas id="snapshotChart"></canvas>
                    </div>
                    <p style="color: var(--text-secondary); font-size: 13px; margin-top: 8px;">
                        垂直红线标识告警触发时刻
                    </p>
                </div>

                <div class="detail-section">
                    <div class="detail-section-title">
                        <i class="fas fa-link"></i>
                        关联事件追踪
                    </div>
                    <div class="event-timeline">
                        ${alarm.relatedEvents.map(event => `
                            <div class="event-item">
                                <div class="event-time">${event.time}</div>
                                <div class="event-description">${event.description}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            contentEl.innerHTML = detailHTML;

            // 显示侧边栏
            sidebar.classList.add('open');

            // 绘制快照图表（M2.2）
            setTimeout(() => drawSnapshotChart(), 100);
        }

        function closeAlarmDetail() {
            const sidebar = document.getElementById('alarmDetailSidebar');
            if (sidebar) {
                sidebar.classList.remove('open');
            }
        }

        // M2.2 绘制数据快照图表
        function drawSnapshotChart() {
            const ctx = document.getElementById('snapshotChart');
            if (!ctx) return;

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            // 生成模拟数据（前后5分钟，每分钟一个点）
            const labels = [];
            const data = [];
            const alarmIndex = 5; // 告警发生在第5分钟

            for (let i = -5; i <= 5; i++) {
                labels.push(i === 0 ? '告警时刻' : `${i > 0 ? '+' : ''}${i}分钟`);
                // 模拟温度数据，在告警时刻达到峰值
                data.push(40 + Math.abs(i - 0) * 2 + Math.random() * 3);
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '电池温度 (°C)',
                        data: data,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: isDark ? '#e2e8f0' : '#64748b'
                            }
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    xMin: alarmIndex,
                                    xMax: alarmIndex,
                                    borderColor: '#ef4444',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        display: true,
                                        content: '告警触发',
                                        position: 'start'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: isDark ? '#334155' : '#e5e7eb'
                            },
                            ticks: {
                                color: isDark ? '#e2e8f0' : '#64748b'
                            }
                        },
                        y: {
                            grid: {
                                color: isDark ? '#334155' : '#e5e7eb'
                            },
                            ticks: {
                                color: isDark ? '#e2e8f0' : '#64748b'
                            }
                        }
                    }
                }
            });
        }

        // ==================== Module 3: 趋势预警数据生成 ====================

        // M3.1 生成趋势预警数据
        function generateTrendWarnings() {
            const warnings = [];
            const types = ['温升速率加速', 'SOC漂移', '内阻上升', '容量衰减', '电压不均衡', '充电效率下降'];
            const devices = ['#1柜-BMS-A簇', '#2柜-BMS-B簇', '#3柜-PCS模块', '#4柜-电池组', '#5柜-冷却系统'];
            const sites = ['科技园区站', '工业园区站', '商业中心站'];

            for (let i = 0; i < 18; i++) {
                const trendData = [];
                for (let j = 0; j < 12; j++) {
                    trendData.push(40 + (j * (3 + Math.random() * 2)));
                }

                warnings.push({
                    id: `TREND-${String(i + 1).padStart(3, '0')}`,
                    device: devices[Math.floor(Math.random() * devices.length)],
                    type: types[Math.floor(Math.random() * types.length)],
                    site: sites[Math.floor(Math.random() * sites.length)],
                    currentValue: 42.5 + Math.random() * 10,
                    threshold: 55,
                    trend: '+2.3%/小时',
                    prediction: `预计${12 + Math.floor(Math.random() * 36)}小时内达到阈值`,
                    trendData: trendData
                });
            }

            return warnings;
        }

        const trendWarnings = generateTrendWarnings();

        // M3.1 渲染趋势预警列表
        function renderTrendWarnings() {
            const container = document.getElementById('trendWarningList');
            if (!container) return;

            container.innerHTML = trendWarnings.map(warning => {
                return `
                    <div class="trend-item">
                        <div class="trend-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="trend-content">
                            <div class="trend-title">${warning.device} - ${warning.type}</div>
                            <div class="trend-details">
                                <span><i class="fas fa-map-marker-alt"></i> ${warning.site}</span>
                                <span><i class="fas fa-thermometer-half"></i> 当前值: ${warning.currentValue.toFixed(1)}°C</span>
                                <span><i class="fas fa-exclamation-triangle"></i> 阈值: ${warning.threshold}°C</span>
                                <span><i class="fas fa-arrow-trend-up"></i> 趋势: ${warning.trend}</span>
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                <i class="far fa-clock"></i> ${warning.prediction}
                            </div>
                            <div class="trend-chart-mini">
                                ${warning.trendData.map(value => `
                                    <div class="trend-bar" style="height: ${(value / Math.max(...warning.trendData)) * 100}%"></div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // M3.2 绘制SOH图表
        function drawSOHChart() {
            const ctx = document.getElementById('sohChart');
            if (!ctx) return;

            // 销毁旧的图表实例
            if (chartInstances.soh) {
                chartInstances.soh.destroy();
                chartInstances.soh = null;
            }

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            // 生成30天SOH历史数据
            const labels = [];
            const data = [];
            for (let i = 29; i >= 0; i--) {
                labels.push(i === 0 ? '今天' : `${i}天前`);
                // SOH从90%逐渐衰减到87.5%
                data.push(90 - (29 - i) * 0.08 + (Math.random() - 0.5) * 0.5);
            }

            chartInstances.soh = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'SOH (%)',
                        data: data,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            min: 85,
                            max: 92,
                            grid: {
                                color: isDark ? '#334155' : '#e5e7eb'
                            },
                            ticks: {
                                color: isDark ? '#e2e8f0' : '#64748b'
                            }
                        }
                    }
                }
            });

            // 渲染SOH详情
            const sohItems = document.getElementById('sohItems');
            if (sohItems) {
                sohItems.innerHTML = `
                    <div class="health-item">
                        <span class="health-item-label">A簇 SOH</span>
                        <div class="health-item-value">
                            88.2%
                            <span class="health-trend down">-0.3%</span>
                        </div>
                    </div>
                    <div class="health-item">
                        <span class="health-item-label">B簇 SOH</span>
                        <div class="health-item-value">
                            86.8%
                            <span class="health-trend down">-0.5%</span>
                        </div>
                    </div>
                    <div class="health-item">
                        <span class="health-item-label">平均容量保持率</span>
                        <div class="health-item-value">
                            87.5%
                            <span class="health-trend down">-0.4%</span>
                        </div>
                    </div>
                    <div class="health-item">
                        <span class="health-item-label">预计寿命剩余</span>
                        <div class="health-item-value">
                            6.2年
                        </div>
                    </div>
                `;
            }
        }

        // M3.2 绘制SOP图表
        function drawSOPChart() {
            const ctx = document.getElementById('sopChart');
            if (!ctx) return;

            // 销毁旧的图表实例
            if (chartInstances.sop) {
                chartInstances.sop.destroy();
                chartInstances.sop = null;
            }

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            // 生成30天SOP历史数据
            const labels = [];
            const data = [];
            for (let i = 29; i >= 0; i--) {
                labels.push(i === 0 ? '今天' : `${i}天前`);
                // SOP从93%逐渐衰减到91.2%
                data.push(93 - (29 - i) * 0.06 + (Math.random() - 0.5) * 0.5);
            }

            chartInstances.sop = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'SOP (%)',
                        data: data,
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            min: 88,
                            max: 95,
                            grid: {
                                color: isDark ? '#334155' : '#e5e7eb'
                            },
                            ticks: {
                                color: isDark ? '#e2e8f0' : '#64748b'
                            }
                        }
                    }
                }
            });

            // 渲染SOP详情
            const sopItems = document.getElementById('sopItems');
            if (sopItems) {
                sopItems.innerHTML = `
                    <div class="health-item">
                        <span class="health-item-label">充电功率性能</span>
                        <div class="health-item-value">
                            92.3%
                            <span class="health-trend down">-0.2%</span>
                        </div>
                    </div>
                    <div class="health-item">
                        <span class="health-item-label">放电功率性能</span>
                        <div class="health-item-value">
                            90.1%
                            <span class="health-trend down">-0.4%</span>
                        </div>
                    </div>
                    <div class="health-item">
                        <span class="health-item-label">峰值功率保持率</span>
                        <div class="health-item-value">
                            91.2%
                            <span class="health-trend down">-0.3%</span>
                        </div>
                    </div>
                    <div class="health-item">
                        <span class="health-item-label">功率响应时间</span>
                        <div class="health-item-value">
                            2.1秒
                            <span class="health-trend up">+0.2s</span>
                        </div>
                    </div>
                `;
            }
        }

        // ==================== 大厂级功能：实时推送模拟 ====================

        let alarmCounter = 50; // 告警ID计数器
        let activeAlarmCount = 1284; // 活动告警数
        let todayNewCount = 89; // 今日新增
        let criticalUnhandledCount = 23; // 紧急未处理

        // 模拟WebSocket实时推送（类似华为FusionSolar）
        function startRealtimeSimulation() {
            // 每15秒生成一条新告警
            setInterval(() => {
                const newAlarm = generateRealtimeAlarm();

                // 添加到列表顶部
                allAlarms.unshift(newAlarm);
                filteredAlarms.unshift(newAlarm);

                // 更新统计卡片
                activeAlarmCount++;
                todayNewCount++;
                if (newAlarm.level === 'critical') {
                    criticalUnhandledCount++;
                }

                updateOverviewCards();

                // 艹！更新智能概览面板的动态数据
                renderOverviewPanel();

                // 告警提示（类似阳光电源）
                showAlarmToast(newAlarm);

                // 紧急告警播放声音（类似华为）
                if (newAlarm.level === 'critical') {
                    playAlertSound();
                }

            }, 15000); // 每15秒一条新告警

            // 每30秒更新一次MTTA统计
            setInterval(() => {
                updateMTTAStatistics();
            }, 30000);
        }

        // 生成实时告警
        function generateRealtimeAlarm() {
            alarmCounter++;

            const levels = ['critical', 'major', 'minor', 'info'];
            const weights = [0.15, 0.25, 0.35, 0.25]; // 按真实比例
            const level = weightedRandom(levels, weights);

            const types = {
                critical: ['电池过温', 'BMS通信中断', '绝缘故障', 'PCS过载'],
                major: ['SOC过低', '电压异常', '电流过大', '风扇故障'],
                minor: ['电压不均衡', 'SOC漂移', '柜门未关', '温度预警'],
                info: ['维护提醒', '定期巡检', '系统通知', '参数调整']
            };

            const devices = ['#1柜-BMS-A簇', '#2柜-BMS-B簇', '#3柜-PCS模块', '#4柜-电池组', '#5柜-冷却系统'];
            const sites = ['科技园区站', '工业园区站', '商业中心站'];

            const type = types[level][Math.floor(Math.random() * types[level].length)];

            return {
                id: `ALM-2025-${String(alarmCounter).padStart(4, '0')}`,
                timestamp: new Date(),
                level: level,
                site: sites[Math.floor(Math.random() * sites.length)],
                device: devices[Math.floor(Math.random() * devices.length)],
                type: type,
                status: 'unconfirmed',
                aggregatedCount: 0,
                responseTime: null, // 艹！未确认的告警没有响应时间
                resolveTime: null,  // 艹！未确认的告警没有解决时间
                rootCause: level === 'critical' ? generateRootCause(type) : null,
                sop: generateSOP(type),
                relatedEvents: []
            };
        }

        // 权重随机选择
        function weightedRandom(items, weights) {
            const total = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * total;

            for (let i = 0; i < items.length; i++) {
                if (random < weights[i]) {
                    return items[i];
                }
                random -= weights[i];
            }
            return items[0];
        }

        // 生成根因分析（基于规则引擎）
        function generateRootCause(type) {
            const rootCauses = {
                '电池过温': 'PCS降载，根因：#3簇温差过大，冷却系统效率下降',
                'BMS通信中断': '根因：CAN总线通信异常，可能线路接触不良',
                '绝缘故障': '根因：湿度过高导致绝缘电阻下降，建议检查密封性',
                'PCS过载': '根因：电网调度功率指令超出PCS额定容量'
            };
            return rootCauses[type] || '系统正在分析根因...';
        }

        // 生成SOP
        function generateSOP(type) {
            const sops = {
                '电池过温': [
                    '立即降低充放电功率至50%',
                    '检查冷却系统运行状态',
                    '清理散热器灰尘和杂物',
                    '检查环境温度是否异常',
                    '必要时暂停充放电操作'
                ],
                'BMS通信中断': [
                    '检查CAN总线连接是否正常',
                    '重启BMS主控模块',
                    '检查线路接触情况',
                    '更换通信线缆（如必要）'
                ],
                'SOC过低': [
                    '立即停止放电操作',
                    '检查充电系统状态',
                    '启动应急充电模式',
                    '通知电网调度中心'
                ]
            };
            return sops[type] || [
                '检查设备运行状态',
                '记录告警详细信息',
                '联系技术支持'
            ];
        }

        // 更新统计卡片
        function updateOverviewCards() {
            const activeAlarmsEl = document.getElementById('activeAlarmsCount');
            const todayNewEl = document.getElementById('todayNewCount');
            const criticalUnhandledEl = document.getElementById('criticalUnhandledCount');
            const filteredEl = document.getElementById('filteredCount');

            if (activeAlarmsEl) activeAlarmsEl.textContent = activeAlarmCount.toLocaleString();
            if (todayNewEl) todayNewEl.textContent = todayNewCount;
            if (criticalUnhandledEl) criticalUnhandledEl.textContent = criticalUnhandledCount;
            if (filteredEl) filteredEl.textContent = filteredAlarms.length.toLocaleString();
        }

        // 更新MTTA统计
        function updateMTTAStatistics() {
            const mttaElement = document.querySelector('.overview-card.info .overview-value');
            if (mttaElement) {
                const currentMTTA = parseInt(mttaElement.textContent);
                const newMTTA = currentMTTA + (Math.random() > 0.5 ? 1 : -1);
                mttaElement.innerHTML = `${newMTTA}<span style="font-size: 16px; margin-left: 4px;">分钟</span>`;
            }
        }

        // 告警Toast提示（类似阳光电源）
        function showAlarmToast(alarm) {
            const levelColors = {
                critical: '#ef4444',
                major: '#f59e0b',
                minor: '#fbbf24',
                info: '#3b82f6'
            };

            const levelLabels = {
                critical: '紧急告警',
                major: '主要告警',
                minor: '次要告警',
                info: '提示信息'
            };

            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                min-width: 350px;
                max-width: 450px;
                background: white;
                border-radius: 12px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                padding: 16px;
                z-index: 10000;
                animation: slideInRight 0.3s ease;
                border-left: 4px solid ${levelColors[alarm.level]};
            `;

            toast.innerHTML = `
                <div style="display: flex; align-items: flex-start; gap: 12px;">
                    <div style="
                        width: 40px;
                        height: 40px;
                        border-radius: 8px;
                        background: linear-gradient(135deg, ${levelColors[alarm.level]}, ${levelColors[alarm.level]}dd);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 18px;
                    ">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-size: 14px; font-weight: 600; color: #1e293b; margin-bottom: 4px;">
                            ${levelLabels[alarm.level]}
                        </div>
                        <div style="font-size: 13px; color: #64748b; margin-bottom: 6px;">
                            ${alarm.device} - ${alarm.type}
                        </div>
                        <div style="font-size: 12px; color: #94a3b8;">
                            <i class="far fa-clock"></i> ${new Date().toLocaleTimeString('zh-CN')}
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: none;
                        border: none;
                        color: #94a3b8;
                        cursor: pointer;
                        font-size: 16px;
                        padding: 4px;
                    ">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            document.body.appendChild(toast);

            // 5秒后自动消失
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // 播放告警声音
        function playAlertSound() {
            // 使用Web Audio API生成提示音
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // 添加动画CSS
        const animationStyle = document.createElement('style');
        animationStyle.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }

            .alarm-card {
                animation: fadeInUp 0.3s ease;
            }

            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(animationStyle);

        // ==================== Module 4: 统计报表功能 ====================

        // 艹！热点分析 - 绘制电站告警分布饼图
        function drawStationDistributionChart() {
            const ctx = document.getElementById('stationDistributionChart');
            if (!ctx) return;

            // 销毁旧的图表实例
            if (chartInstances.stationDistribution) {
                chartInstances.stationDistribution.destroy();
                chartInstances.stationDistribution = null;
            }

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            // 统计各电站告警数量
            const stationAlarms = {};
            allAlarms.forEach(alarm => {
                const station = alarm.device.split('-')[0] || '未知电站';
                stationAlarms[station] = (stationAlarms[station] || 0) + 1;
            });

            const stations = Object.keys(stationAlarms);
            const counts = Object.values(stationAlarms);

            // 生成颜色
            const colors = [
                '#3b82f6', '#10b981', '#f59e0b', '#ef4444',
                '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16'
            ];

            chartInstances.stationDistribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: stations,
                    datasets: [{
                        data: counts,
                        backgroundColor: colors.slice(0, stations.length),
                        borderWidth: 2,
                        borderColor: isDark ? '#1e293b' : '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: isDark ? '#e2e8f0' : '#64748b',
                                padding: 10,
                                font: {
                                    size: 11
                                },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    return data.labels.map((label, i) => ({
                                        text: `${label} (${data.datasets[0].data[i]})`,
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        hidden: false,
                                        index: i
                                    }));
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value}条 (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // 艹！热点分析 - 绘制告警等级分布饼图（3个等级）
        function drawAlarmLevelDistChart() {
            const ctx = document.getElementById('alarmLevelDistChart');
            if (!ctx) return;

            // 销毁旧的图表实例
            if (chartInstances.alarmLevelDist) {
                chartInstances.alarmLevelDist.destroy();
                chartInstances.alarmLevelDist = null;
            }

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            // 统计各等级告警数量 - 3个等级：严重、重要、一般
            const levels = { critical: 0, major: 0, normal: 0 };
            allAlarms.forEach(alarm => {
                // 将critical映射为严重，major映射为重要，minor和info都映射为一般
                if (alarm.level === 'critical') {
                    levels.critical++;
                } else if (alarm.level === 'major') {
                    levels.major++;
                } else {
                    // minor 和 info 都归为一般
                    levels.normal++;
                }
            });

            const labels = ['严重', '重要', '一般'];
            const data = [levels.critical, levels.major, levels.normal];
            const colors = ['#ef4444', '#f59e0b', '#3b82f6'];

            // 更新总数
            const totalCount = data.reduce((a, b) => a + b, 0);
            const totalEl = document.getElementById('totalAlarmsCount');
            if (totalEl) {
                totalEl.textContent = totalCount;
            }

            chartInstances.alarmLevelDist = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: isDark ? '#1e293b' : '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: isDark ? '#e2e8f0' : '#64748b',
                                padding: 10,
                                font: {
                                    size: 11
                                },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    return data.labels.map((label, i) => ({
                                        text: `${label}: ${data.datasets[0].data[i]}条`,
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        hidden: false,
                                        index: i
                                    }));
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value}条 (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // 艹！热点分析 - 绘制设备告警次数TOP5排行榜
        function drawTopDevicesChart() {
            const ctx = document.getElementById('topDevicesChart');
            if (!ctx) return;

            // 销毁旧的图表实例
            if (chartInstances.topDevices) {
                chartInstances.topDevices.destroy();
                chartInstances.topDevices = null;
            }

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            // 统计各设备告警次数
            const deviceAlarms = {};
            allAlarms.forEach(alarm => {
                const device = alarm.device;
                deviceAlarms[device] = (deviceAlarms[device] || 0) + 1;
            });

            // 排序并取TOP5
            const sortedDevices = Object.entries(deviceAlarms)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const labels = sortedDevices.map(d => d[0]);
            const data = sortedDevices.map(d => d[1]);

            // 生成渐变色
            const colors = data.map((_, i) => {
                const alpha = 1 - (i * 0.15);
                return `rgba(239, 68, 68, ${alpha})`;
            });

            chartInstances.topDevices = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '告警次数',
                        data: data,
                        backgroundColor: colors,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.x;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `告警次数: ${value}次 (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: isDark ? '#334155' : '#e5e7eb'
                            },
                            ticks: {
                                color: isDark ? '#e2e8f0' : '#64748b',
                                font: {
                                    size: 10
                                }
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: isDark ? '#e2e8f0' : '#64748b',
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        }

        // 绘制告警类型统计饼图
        function drawAlarmTypeStatsChart() {
            const ctx = document.getElementById('alarmTypeStatsChart');
            if (!ctx) return;

            // 销毁旧的图表实例
            if (chartInstances.alarmTypeStats) {
                chartInstances.alarmTypeStats.destroy();
                chartInstances.alarmTypeStats = null;
            }

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            // 统计各类型告警数量
            const typeAlarms = {};
            allAlarms.forEach(alarm => {
                const type = alarm.type || '未知类型';
                typeAlarms[type] = (typeAlarms[type] || 0) + 1;
            });

            // 排序并取TOP10
            const sortedTypes = Object.entries(typeAlarms)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);

            const labels = sortedTypes.map(t => t[0]);
            const data = sortedTypes.map(t => t[1]);

            // 生成渐变色系
            const colors = [
                '#ef4444', '#f59e0b', '#fbbf24', '#84cc16', '#10b981',
                '#06b6d4', '#3b82f6', '#6366f1', '#8b5cf6', '#ec4899'
            ];

            chartInstances.alarmTypeStats = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: isDark ? '#1e293b' : '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: isDark ? '#e2e8f0' : '#64748b',
                                padding: 15,
                                font: {
                                    size: 12
                                },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    return data.labels.map((label, i) => {
                                        const value = data.datasets[0].data[i];
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return {
                                            text: `${label} (${value}条, ${percentage}%)`,
                                            fillStyle: data.datasets[0].backgroundColor[i],
                                            hidden: false,
                                            index: i
                                        };
                                    });
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value}条 (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // 绘制告警等级统计饼图
        function drawAlarmLevelPieChart() {
            const ctx = document.getElementById('alarmLevelPieChart');
            if (!ctx) return;

            // 销毁旧的图表实例
            if (chartInstances.alarmLevelPie) {
                chartInstances.alarmLevelPie.destroy();
                chartInstances.alarmLevelPie = null;
            }

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            // 统计各等级告警数量
            const levelCounts = {
                'critical': 0,
                'major': 0,
                'minor': 0
            };

            allAlarms.forEach(alarm => {
                const level = alarm.level || 'minor';
                if (levelCounts[level] !== undefined) {
                    levelCounts[level]++;
                }
            });

            const labels = ['严重告警', '重要告警', '一般告警'];
            const data = [levelCounts.critical, levelCounts.major, levelCounts.minor];
            const colors = ['#ef4444', '#f59e0b', '#3b82f6'];

            const total = data.reduce((a, b) => a + b, 0);

            chartInstances.alarmLevelPie = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: isDark ? '#1e293b' : '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: isDark ? '#e2e8f0' : '#64748b',
                                padding: 20,
                                font: {
                                    size: 13
                                },
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    return data.labels.map((label, i) => {
                                        const value = data.datasets[0].data[i];
                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : '0.0';
                                        return {
                                            text: `${label}: ${value}条 (${percentage}%)`,
                                            fillStyle: data.datasets[0].backgroundColor[i],
                                            hidden: false,
                                            index: i
                                        };
                                    });
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : '0.0';
                                    return `${label}: ${value}条 (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // 渲染告警等级完成率与时间表格
        function renderAlarmLevelCompletionTable() {
            const tbody = document.getElementById('alarmLevelCompletionTableBody');
            if (!tbody) return;

            // 使用仿真数据模拟真实场景
            const levelStats = {
                'critical': {
                    total: 28,
                    completed: 25,
                    processing: 2,
                    unconfirmed: 1,
                    totalTime: 0,
                    completedCount: 25,
                    label: '严重告警',
                    color: '#ef4444',
                    target: 15,
                    // 仿真完成时间分布：严重告警处理较快
                    completionTimes: [8, 12, 9, 15, 11, 13, 10, 14, 16, 9, 12, 11, 8, 10, 13, 15, 12, 9, 11, 14, 10, 13, 12, 11, 9]
                },
                'major': {
                    total: 45,
                    completed: 38,
                    processing: 5,
                    unconfirmed: 2,
                    totalTime: 0,
                    completedCount: 38,
                    label: '重要告警',
                    color: '#f59e0b',
                    target: 30,
                    // 仿真完成时间分布：重要告警处理时间中等
                    completionTimes: [25, 28, 32, 22, 35, 29, 26, 31, 27, 33, 24, 28, 30, 26, 29, 31, 27, 25, 34, 28, 30, 32, 26, 29, 27, 31, 28, 25, 30, 33, 26, 29, 28, 31, 27, 30, 26, 29]
                },
                'minor': {
                    total: 67,
                    completed: 52,
                    processing: 10,
                    unconfirmed: 5,
                    totalTime: 0,
                    completedCount: 52,
                    label: '一般告警',
                    color: '#3b82f6',
                    target: 60,
                    // 仿真完成时间分布：一般告警处理时间较长
                    completionTimes: [48, 52, 45, 58, 50, 55, 47, 53, 49, 56, 51, 54, 46, 50, 52, 48, 55, 49, 53, 51, 47, 54, 50, 52, 49, 56, 48, 51, 53, 50, 54, 47, 52, 49, 55, 51, 48, 53, 50, 54, 49, 52, 48, 51, 53, 50, 49, 52, 51, 50, 53, 49]
                }
            };

            // 计算各等级的平均完成时间
            Object.keys(levelStats).forEach(level => {
                const stat = levelStats[level];
                if (stat.completionTimes && stat.completionTimes.length > 0) {
                    stat.totalTime = stat.completionTimes.reduce((sum, time) => sum + time, 0);
                }
            });

            // 生成表格行
            let html = '';
            ['critical', 'major', 'minor'].forEach(level => {
                const stat = levelStats[level];
                const completionRate = stat.total > 0 ? ((stat.completed / stat.total) * 100).toFixed(1) : '0.0';
                const avgTime = stat.completedCount > 0 ? (stat.totalTime / stat.completedCount).toFixed(1) : '0.0';
                const isOverTarget = parseFloat(avgTime) > stat.target;

                // 根据完成率确定进度条颜色
                let rateColor = '#10b981'; // 绿色
                if (parseFloat(completionRate) < 70) {
                    rateColor = '#ef4444'; // 红色
                } else if (parseFloat(completionRate) < 90) {
                    rateColor = '#f59e0b'; // 橙色
                }

                html += `
                    <tr style="border-bottom: 1px solid #e2e8f0; transition: background 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='white'">
                        <td style="padding: 14px 16px; font-size: 14px; white-space: nowrap;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="display: inline-block; width: 10px; height: 10px; background: ${stat.color}; border-radius: 50%;"></span>
                                <strong style="color: #1e293b;">${stat.label}</strong>
                            </div>
                        </td>
                        <td style="padding: 14px 16px; text-align: center; font-size: 15px; font-weight: 600; color: #1e293b; white-space: nowrap;">
                            ${stat.total}
                        </td>
                        <td style="padding: 14px 16px; text-align: center; white-space: nowrap;">
                            <span style="font-size: 16px; font-weight: 700; color: ${rateColor};">
                                ${completionRate}%
                            </span>
                        </td>
                        <td style="padding: 14px 16px; text-align: center; font-size: 15px; font-weight: 600; color: ${isOverTarget ? '#ef4444' : '#10b981'}; white-space: nowrap;">
                            ${avgTime} 分钟
                        </td>
                        <td style="padding: 14px 16px; white-space: nowrap;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 4px; font-size: 12px; color: #1e40af;">
                                        <i class="fas fa-envelope" style="font-size: 11px;"></i>
                                        邮件
                                    </span>
                                    <span style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 4px; font-size: 12px; color: #166534;">
                                        <i class="fas fa-sms" style="font-size: 11px;"></i>
                                        短信
                                    </span>
                                </div>
                                <button onclick="goToNotificationSettings()" style="padding: 4px 12px; background: white; border: 1px solid #e2e8f0; border-radius: 4px; font-size: 12px; color: #475569; cursor: pointer; transition: all 0.2s; white-space: nowrap;" onmouseover="this.style.background='#f8fafc'; this.style.borderColor='#cbd5e1'" onmouseout="this.style.background='white'; this.style.borderColor='#e2e8f0'">
                                    前往设置
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;

            // 更新关键指标汇总卡片
            const totalAlarms = levelStats.critical.total + levelStats.major.total + levelStats.minor.total;
            const totalCompleted = levelStats.critical.completed + levelStats.major.completed + levelStats.minor.completed;
            const totalPending = (levelStats.critical.processing + levelStats.critical.unconfirmed) +
                                (levelStats.major.processing + levelStats.major.unconfirmed) +
                                (levelStats.minor.processing + levelStats.minor.unconfirmed);
            const overallRate = ((totalCompleted / totalAlarms) * 100).toFixed(1);

            // 更新DOM元素
            const totalAlarmCountEl = document.getElementById('totalAlarmCount');
            const overallCompletionRateEl = document.getElementById('overallCompletionRate');
            const pendingAlarmCountEl = document.getElementById('pendingAlarmCount');

            if (totalAlarmCountEl) totalAlarmCountEl.textContent = totalAlarms;
            if (overallCompletionRateEl) {
                overallCompletionRateEl.textContent = overallRate + '%';
                overallCompletionRateEl.nextElementSibling.textContent = `已完成${totalCompleted}条`;
            }
            if (pendingAlarmCountEl) pendingAlarmCountEl.textContent = totalPending;
        }

        // 跳转到告警规则配置页面
        function goToAlarmConfig(alarmType) {
            // 将告警类型编码并作为URL参数传递
            const encodedType = encodeURIComponent(alarmType);
            // 跳转到告警规则配置页面，并高亮对应的告警类型
            window.location.href = `alarm-rules.html?type=${encodedType}&action=edit`;

            // 可选：显示提示信息
            console.log(`正在跳转到 ${alarmType} 的配置页面...`);
        }

        // 跳转到告警通知设置面板
        function goToNotificationSettings() {
            // 使用URL参数标记需要打开通知设置面板
            window.location.href = 'rule-engine.html?openNotificationPanel=true';
        }

        // 渲染告警次数最多排行榜（未完成次数）
        function renderAlarmCountRanking() {
            const container = document.getElementById('alarmCountRankingList');
            if (!container) return;

            // 统计各类型告警的未完成数量和等级
            const typeCount = {};
            allAlarms.forEach(alarm => {
                const type = alarm.type || '未知类型';
                if (!typeCount[type]) {
                    typeCount[type] = { unfinished: 0, total: 0, levels: {} };
                }

                // 统计等级分布
                const level = alarm.level || 'info';
                typeCount[type].levels[level] = (typeCount[type].levels[level] || 0) + 1;

                // 只统计未完成的告警（非"已恢复"和"已确认"状态）
                if (alarm.status !== '已恢复' && alarm.status !== '已确认') {
                    typeCount[type].unfinished++;
                }
                typeCount[type].total++;
            });

            // 按未完成数量排序并取TOP5
            const sortedTypes = Object.entries(typeCount)
                .map(([type, data]) => {
                    // 获取该类型最常见的等级
                    const mostCommonLevel = Object.entries(data.levels)
                        .sort((a, b) => b[1] - a[1])[0][0];

                    return {
                        type,
                        unfinished: data.unfinished,
                        total: data.total,
                        level: mostCommonLevel
                    };
                })
                .sort((a, b) => b.unfinished - a.unfinished)
                .slice(0, 5);

            // 生成排行榜HTML
            let html = '';
            sortedTypes.forEach((item, index) => {
                const rank = index + 1;

                // 获取排名对应的颜色和图标
                let rankColor = '#64748b';
                let rankBg = '#f1f5f9';
                if (rank === 1) {
                    rankColor = '#ef4444';
                    rankBg = '#fee2e2';
                } else if (rank === 2) {
                    rankColor = '#f59e0b';
                    rankBg = '#fef3c7';
                } else if (rank === 3) {
                    rankColor = '#3b82f6';
                    rankBg = '#dbeafe';
                }

                // 获取等级标签信息
                const levelInfo = {
                    'critical': { text: '严重', color: '#ef4444', bg: '#fee2e2' },
                    'major': { text: '重要', color: '#f59e0b', bg: '#fef3c7' },
                    'minor': { text: '一般', color: '#3b82f6', bg: '#dbeafe' },
                    'info': { text: '信息', color: '#64748b', bg: '#f1f5f9' }
                };
                const level = levelInfo[item.level] || levelInfo['info'];

                html += `
                    <div style="display: flex; align-items: center; padding: 12px; margin-bottom: 10px; background: #f8fafc; border-radius: 8px; transition: all 0.2s;" onmouseover="this.style.background='#f1f5f9'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='#f8fafc'; this.style.transform='translateX(0)'">
                        <div style="width: 32px; height: 32px; background: ${rankBg}; color: ${rankColor}; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; margin-right: 12px; flex-shrink: 0;">
                            ${rank}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 14px; font-weight: 600; color: #1e293b; margin-bottom: 2px; display: flex; align-items: center; gap: 6px;">
                                <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${item.type}</span>
                                <span style="display: inline-block; padding: 2px 8px; background: ${level.bg}; color: ${level.color}; border-radius: 4px; font-size: 11px; font-weight: 500; white-space: nowrap; flex-shrink: 0;">
                                    ${level.text}
                                </span>
                                <button onclick="goToAlarmConfig('${item.type}')" title="设置告警规则" style="width: 24px; height: 24px; padding: 0; background: white; border: 1px solid #e2e8f0; border-radius: 4px; color: #64748b; font-size: 12px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; flex-shrink: 0;" onmouseover="this.style.borderColor='#3b82f6'; this.style.color='#3b82f6'; this.style.background='#eff6ff'" onmouseout="this.style.borderColor='#e2e8f0'; this.style.color='#64748b'; this.style.background='white'">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                            <div style="font-size: 12px; color: #64748b;">
                                未完成 <strong style="color: ${rankColor};">${item.unfinished}</strong> 条，共 ${item.total} 条
                            </div>
                        </div>
                        <div style="width: 60px; text-align: right;">
                            <div style="display: inline-block; padding: 4px 10px; background: ${rankBg}; color: ${rankColor}; border-radius: 12px; font-size: 13px; font-weight: 600;">
                                ${item.unfinished}
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // 渲染处理效率最慢排行榜
        function renderAlarmEfficiencyRanking() {
            const container = document.getElementById('alarmEfficiencyRankingList');
            if (!container) return;

            // 统计各类型告警的平均处理时间和等级
            const typeEfficiency = {};
            allAlarms.forEach(alarm => {
                const type = alarm.type || '未知类型';
                if (!typeEfficiency[type]) {
                    typeEfficiency[type] = { totalTime: 0, count: 0, levels: {} };
                }

                // 模拟处理时间（分钟）
                const processTime = Math.floor(Math.random() * 80) + 10; // 10-90分钟
                typeEfficiency[type].totalTime += processTime;
                typeEfficiency[type].count++;

                // 统计等级分布
                const level = alarm.level || 'info';
                typeEfficiency[type].levels[level] = (typeEfficiency[type].levels[level] || 0) + 1;
            });

            // 计算平均时间并排序，取TOP5
            const sortedTypes = Object.entries(typeEfficiency)
                .map(([type, data]) => {
                    // 获取该类型最常见的等级
                    const mostCommonLevel = Object.entries(data.levels)
                        .sort((a, b) => b[1] - a[1])[0][0];

                    return {
                        type,
                        avgTime: (data.totalTime / data.count).toFixed(1),
                        count: data.count,
                        level: mostCommonLevel
                    };
                })
                .sort((a, b) => parseFloat(b.avgTime) - parseFloat(a.avgTime))
                .slice(0, 5);

            // 生成排行榜HTML
            let html = '';
            sortedTypes.forEach((item, index) => {
                const rank = index + 1;

                // 获取排名对应的颜色
                let rankColor = '#64748b';
                let rankBg = '#f1f5f9';
                let timeColor = '#ef4444';
                if (rank === 1) {
                    rankColor = '#ef4444';
                    rankBg = '#fee2e2';
                } else if (rank === 2) {
                    rankColor = '#f59e0b';
                    rankBg = '#fef3c7';
                    timeColor = '#f59e0b';
                } else if (rank === 3) {
                    rankColor = '#3b82f6';
                    rankBg = '#dbeafe';
                    timeColor = '#f59e0b';
                } else {
                    timeColor = '#64748b';
                }

                // 获取等级标签信息
                const levelInfo = {
                    'critical': { text: '严重', color: '#ef4444', bg: '#fee2e2' },
                    'major': { text: '重要', color: '#f59e0b', bg: '#fef3c7' },
                    'minor': { text: '一般', color: '#3b82f6', bg: '#dbeafe' },
                    'info': { text: '信息', color: '#64748b', bg: '#f1f5f9' }
                };
                const level = levelInfo[item.level] || levelInfo['info'];

                html += `
                    <div style="display: flex; align-items: center; padding: 12px; margin-bottom: 10px; background: #f8fafc; border-radius: 8px; transition: all 0.2s;" onmouseover="this.style.background='#f1f5f9'; this.style.transform='translateX(4px)'" onmouseout="this.style.background='#f8fafc'; this.style.transform='translateX(0)'">
                        <div style="width: 32px; height: 32px; background: ${rankBg}; color: ${rankColor}; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 16px; margin-right: 12px; flex-shrink: 0;">
                            ${rank}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-size: 14px; font-weight: 600; color: #1e293b; margin-bottom: 2px; display: flex; align-items: center; gap: 6px;">
                                <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${item.type}</span>
                                <span style="display: inline-block; padding: 2px 8px; background: ${level.bg}; color: ${level.color}; border-radius: 4px; font-size: 11px; font-weight: 500; white-space: nowrap; flex-shrink: 0;">
                                    ${level.text}
                                </span>
                                <button onclick="goToAlarmConfig('${item.type}')" title="设置告警规则" style="width: 24px; height: 24px; padding: 0; background: white; border: 1px solid #e2e8f0; border-radius: 4px; color: #64748b; font-size: 12px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; flex-shrink: 0;" onmouseover="this.style.borderColor='#3b82f6'; this.style.color='#3b82f6'; this.style.background='#eff6ff'" onmouseout="this.style.borderColor='#e2e8f0'; this.style.color='#64748b'; this.style.background='white'">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                            <div style="font-size: 12px; color: #64748b;">
                                基于 <strong>${item.count}</strong> 次告警统计
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 18px; font-weight: 700; color: ${timeColor}; line-height: 1;">
                                ${item.avgTime}
                            </div>
                            <div style="font-size: 11px; color: #64748b; margin-top: 2px;">
                                分钟
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        /**
         * 根据告警等级获取颜色
         */
        function getLevelColor(level) {
            const colors = {
                'critical': '#ef4444',  // 严重 - 红色
                'major': '#f59e0b',     // 重要 - 橙色
                'minor': '#3b82f6',     // 一般 - 蓝色
                'info': '#3b82f6'       // 信息 - 蓝色
            };
            return colors[level] || '#64748b';
        }

        /**
         * 从站点名称中提取区域信息
         * 示例: "科技园区站" -> "科技园区站"
         */
        function extractRegionFromSite(siteName) {
            if (!siteName) return '';
            return siteName.trim();
        }

        /**
         * 获取告警的主要等级（按优先级）
         */
        function getDominantLevel(alarms) {
            const priority = ['critical', 'major', 'minor', 'info'];
            for (const level of priority) {
                if (alarms.some(alarm => alarm.level === level)) {
                    return level;
                }
            }
            return 'minor';
        }

        /**
         * 初始化区域选择器
         */
        function initRegionSelector() {
            const regionSelect = document.getElementById('regionSelect');
            if (!regionSelect) return;

            // 提取所有区域
            const regions = new Set();
            allAlarms.forEach(alarm => {
                const region = extractRegionFromSite(alarm.site);
                if (region) regions.add(region);
            });

            // 清空并重新填充选项
            regionSelect.innerHTML = '<option value="">全部区域</option>';
            Array.from(regions).sort().forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                regionSelect.appendChild(option);
            });

            // 绑定change事件
            regionSelect.addEventListener('change', (e) => {
                const selectedRegion = e.target.value;
                renderAlarmWordCloud(selectedRegion);
            });
        }

        /**
         * 计算字体大小（对数缩放）
         */
        function calculateWordSize(count, minCount, maxCount) {
            const minSize = 12;
            const maxSize = 36;

            if (maxCount === minCount) {
                return (minSize + maxSize) / 2;
            }

            // 线性缩放，让字体大小差异更明显
            const ratio = (count - minCount) / (maxCount - minCount);
            return Math.round(minSize + ratio * (maxSize - minSize));
        }

        /**
         * 重力中心布局算法 - 计算标签位置
         */
        function calculateGravityLayout(sortedTypes, canvasWidth, canvasHeight) {
            const centerX = canvasWidth / 2;
            const centerY = canvasHeight / 2;
            const maxRadius = Math.min(canvasWidth, canvasHeight) / 2 - 50;
            const goldenAngle = 137.5 * Math.PI / 180; // 黄金角螺旋

            const counts = sortedTypes.map(t => t[1].count);
            const maxCount = Math.max(...counts);
            const minCount = Math.min(...counts);

            const positions = [];
            const placedBoxes = []; // 存储已放置的标签边界框

            sortedTypes.forEach(([type, typeData], index) => {
                const level = getDominantLevel(typeData.alarms);
                const fontSize = calculateWordSize(typeData.count, minCount, maxCount);

                // 计算权重（频率 + 严重程度）
                const severityMultiplier = {
                    'critical': 1.5,
                    'major': 1.2,
                    'minor': 1.0,
                    'info': 1.0
                };
                const normalizedCount = (typeData.count - minCount) / (maxCount - minCount || 1);
                const weight = normalizedCount * severityMultiplier[level];

                // 重力中心：权重越高，距离中心越近
                const baseDistance = maxRadius * (1 - weight * 0.7);

                // 黄金角螺旋分布
                const angle = goldenAngle * index + (Math.random() - 0.5) * 0.3;

                // 初始位置
                let x = centerX + baseDistance * Math.cos(angle);
                let y = centerY + baseDistance * Math.sin(angle);

                // 估算标签尺寸（用于碰撞检测）
                const padding = fontSize > 30 ? 24 : fontSize > 20 ? 18 : 12;
                const estimatedWidth = type.length * fontSize * 0.6 + padding * 2;
                const estimatedHeight = fontSize * 1.4 + padding * 2;

                // 碰撞检测和位置调整（最多3次迭代）
                let attempts = 0;
                let collided = true;
                while (collided && attempts < 3) {
                    collided = false;

                    for (const box of placedBoxes) {
                        const dx = Math.abs(x - box.x);
                        const dy = Math.abs(y - box.y);
                        const minDistX = (estimatedWidth + box.width) / 2 + 12;
                        const minDistY = (estimatedHeight + box.height) / 2 + 12;

                        if (dx < minDistX && dy < minDistY) {
                            collided = true;
                            // 沿切线方向移动
                            const pushAngle = angle + Math.PI / 2;
                            x += Math.cos(pushAngle) * 20;
                            y += Math.sin(pushAngle) * 20;
                            break;
                        }
                    }
                    attempts++;
                }

                // 确保在画布范围内
                const margin = 30;
                x = Math.max(margin, Math.min(canvasWidth - margin, x));
                y = Math.max(margin, Math.min(canvasHeight - margin, y));

                // 记录边界框
                placedBoxes.push({
                    x, y,
                    width: estimatedWidth,
                    height: estimatedHeight
                });

                positions.push({
                    type,
                    typeData,
                    level,
                    fontSize,
                    x, y,
                    weight
                });
            });

            return positions;
        }

        /**
         * 创建背景粒子效果
         */
        function createBackgroundParticles(wrapper) {
            const particleCount = 5;
            const particles = [];

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'cloud-particle';

                const size = 80 + Math.random() * 120;
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const driftX = (Math.random() - 0.5) * 100;
                const driftY = (Math.random() - 0.5) * 100;
                const duration = 15 + Math.random() * 15;
                const delay = Math.random() * 5;

                particle.style.cssText = `
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}%;
                    top: ${y}%;
                    --drift-x: ${driftX}px;
                    --drift-y: ${driftY}px;
                    animation-duration: ${duration}s;
                    animation-delay: ${delay}s;
                `;

                particles.push(particle);
            }

            return particles;
        }

        /**
         * 渲染告警词云（新版 - 重力中心布局）
         */
        function renderAlarmWordCloud(selectedRegion = '') {
            const container = document.getElementById('alarmWordCloudContainer');
            if (!container) return;

            // 查找或创建内容包装器
            let cloudWrapper = container.querySelector('.cloud-content-wrapper');
            if (!cloudWrapper) {
                cloudWrapper = document.createElement('div');
                cloudWrapper.className = 'cloud-content-wrapper';
                container.appendChild(cloudWrapper);
            }

            // 筛选告警数据
            let filteredAlarms = allAlarms;
            if (selectedRegion) {
                filteredAlarms = allAlarms.filter(alarm => {
                    return extractRegionFromSite(alarm.site) === selectedRegion;
                });
            }

            // 统计告警类型
            const typeStats = {};
            filteredAlarms.forEach(alarm => {
                if (!typeStats[alarm.type]) {
                    typeStats[alarm.type] = {
                        count: 0,
                        alarms: []
                    };
                }
                typeStats[alarm.type].count++;
                typeStats[alarm.type].alarms.push(alarm);
            });

            // 排序
            const sortedTypes = Object.entries(typeStats)
                .sort((a, b) => b[1].count - a[1].count);

            // 如果没有数据
            if (sortedTypes.length === 0) {
                cloudWrapper.innerHTML = `
                    <div class="cloud-empty">
                        <i class="fas fa-cloud"></i>
                        <div class="cloud-empty-text">暂无告警数据</div>
                    </div>
                `;
                return;
            }

            // 计算字体大小范围
            const counts = sortedTypes.map(t => t[1].count);
            const maxCount = Math.max(...counts);
            const minCount = Math.min(...counts);

            // 圆形布局参数 - 响应式
            const containerWidth = window.innerWidth <= 768 ? 400 : 700;
            const centerX = containerWidth / 2;
            const centerY = containerWidth / 2;
            const maxRadius = containerWidth * 0.45;

            // 预先创建所有标签以便测量尺寸
            const tags = sortedTypes.map(([type, typeData]) => {
                const fontSize = calculateWordSize(typeData.count, minCount, maxCount);
                const level = getDominantLevel(typeData.alarms);

                // 更准确的文字宽度估算（中文字符）
                const estimatedWidth = type.length * fontSize * 0.85 + 20; // 中文字符+padding
                const estimatedHeight = fontSize * 1.5 + 16; // 行高+padding

                return {
                    type,
                    typeData,
                    fontSize,
                    level,
                    width: estimatedWidth,
                    height: estimatedHeight,
                    x: 0,
                    y: 0
                };
            });

            // 放置标签 - 使用螺旋扩散 + 碰撞检测
            const placedTags = [];

            tags.forEach((tag, index) => {
                let placed = false;
                let spiralRadius = Math.sqrt(index / tags.length) * maxRadius;
                let spiralAngle = index * 137.5 * (Math.PI / 180);
                let attempts = 0;
                const maxAttempts = 50;

                while (!placed && attempts < maxAttempts) {
                    const testX = centerX + spiralRadius * Math.cos(spiralAngle);
                    const testY = centerY + spiralRadius * Math.sin(spiralAngle);

                    // 检查是否与已放置的标签碰撞（增加安全边距）
                    let hasCollision = false;
                    const safetyMargin = 8; // 安全边距
                    for (const placed of placedTags) {
                        const dx = Math.abs(testX - placed.x);
                        const dy = Math.abs(testY - placed.y);
                        const minDistX = (tag.width + placed.width) / 2 + safetyMargin;
                        const minDistY = (tag.height + placed.height) / 2 + safetyMargin;

                        if (dx < minDistX && dy < minDistY) {
                            hasCollision = true;
                            break;
                        }
                    }

                    if (!hasCollision) {
                        tag.x = testX;
                        tag.y = testY;
                        placedTags.push(tag);
                        placed = true;
                    } else {
                        // 沿螺旋继续尝试
                        spiralAngle += 0.3;
                        spiralRadius += 3;
                        attempts++;
                    }
                }

                // 如果还是没放置成功，强制放置
                if (!placed) {
                    tag.x = centerX + spiralRadius * Math.cos(spiralAngle);
                    tag.y = centerY + spiralRadius * Math.sin(spiralAngle);
                    placedTags.push(tag);
                }
            });

            // 生成HTML
            cloudWrapper.innerHTML = placedTags.map(tag => {
                return `
                    <div class="cloud-tag"
                         data-level="${tag.level}"
                         style="font-size: ${tag.fontSize}px; left: ${tag.x}px; top: ${tag.y}px; transform: translate(-50%, -50%);"
                         title="${tag.type}">
                        <span class="cloud-tag-text">${tag.type}</span>
                    </div>
                `;
            }).join('');
        }

        /**
         * 初始化区域告警功能
         */
        function initRegionAlarms() {
            initRegionSelector();
            renderAlarmWordCloud('');
        }

        // ========== 艹！告警通知Tab逻辑：基于实际数据字段（alarmTime + completeTime） ==========

        /**
         * 计算完成时长（分钟）
         */
        function calculateCompletionTime(alarmTime, completeTime) {
            if (!completeTime) return null;
            const start = new Date(alarmTime);
            const end = new Date(completeTime);
            return Math.floor((end - start) / 1000 / 60);
        }

        /**
         * 计算超时时长（分钟）- 针对未完成的告警
         */
        function calculateElapsedTime(alarmTime) {
            const now = new Date();
            const start = new Date(alarmTime);
            return Math.floor((now - start) / 1000 / 60);
        }

        /**
         * 获取级别升级阈值（分钟）
         */
        function getLevelThreshold(level) {
            const thresholds = {
                'critical': 10,  // 紧急告警10分钟升级
                'major': 20,     // 重要告警20分钟升级
                'minor': 30      // 次要告警30分钟升级
            };
            return thresholds[level] || 30;
        }

        /**
         * 渲染紧急告警升级看板（基于级别阈值）
         */
        function renderUrgentEscalationBanner() {
            const urgentAlarmList = document.getElementById('urgentAlarmList');
            const urgentAlarmCount = document.getElementById('urgentAlarmCount');

            if (!urgentAlarmList || !urgentAlarmCount) return;

            // 筛选未完成且超过阈值的告警
            const urgentAlarms = allAlarms
                .filter(alarm => !alarm.completeTime) // 未完成
                .map(alarm => {
                    const elapsedMinutes = calculateElapsedTime(alarm.timestamp);
                    const threshold = getLevelThreshold(alarm.level);
                    return { ...alarm, elapsedMinutes, threshold };
                })
                .filter(alarm => alarm.elapsedMinutes > alarm.threshold) // 超过阈值
                .sort((a, b) => b.elapsedMinutes - a.elapsedMinutes)
                .slice(0, 5);

            urgentAlarmCount.textContent = `${urgentAlarms.length}个告警`;

            if (urgentAlarms.length === 0) {
                urgentAlarmList.innerHTML = `
                    <div style="text-align: center; padding: 24px; color: var(--text-secondary);">
                        <i class="fas fa-check-circle" style="font-size: 32px; color: #10b981; margin-bottom: 8px;"></i>
                        <div>太棒了！当前没有需要升级的告警</div>
                    </div>
                `;
                document.getElementById('urgentEscalationBanner').style.display = 'none';
                return;
            }

            document.getElementById('urgentEscalationBanner').style.display = 'block';

            urgentAlarmList.innerHTML = urgentAlarms.map(alarm => `
                <div class="urgent-alarm-item">
                    <div class="urgent-alarm-info">
                        <div class="urgent-alarm-title">${alarm.title}</div>
                        <div class="urgent-alarm-meta">
                            <div class="urgent-alarm-meta-item">
                                <i class="fas fa-warehouse"></i>
                                <span>${alarm.station}</span>
                            </div>
                            <div class="urgent-alarm-meta-item">
                                <i class="fas fa-cube"></i>
                                <span>${alarm.device}</span>
                            </div>
                            <div class="urgent-alarm-meta-item">
                                <i class="fas fa-tag"></i>
                                <span>${alarm.level === 'critical' ? '紧急' : alarm.level === 'major' ? '重要' : '次要'}</span>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="overtime-badge">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>超时 ${alarm.elapsedMinutes}分钟</span>
                        </div>
                        <button class="escalate-btn" onclick="escalateAlarm('${alarm.id}')">
                            <i class="fas fa-level-up-alt"></i>
                            <span>立即升级</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        /**
         * 按级别分析告警数据（三栏卡片式）
         */
        function renderLevelAnalysis() {
            const container = document.getElementById('levelAnalysisContent');
            if (!container) return;

            const levels = ['critical', 'major', 'minor'];
            const levelNames = { 'critical': '紧急告警', 'major': '重要告警', 'minor': '次要告警' };

            const analysisData = levels.map(level => {
                const levelAlarms = allAlarms.filter(alarm => alarm.level === level);
                const total = levelAlarms.length;
                const completed = levelAlarms.filter(alarm => alarm.completeTime).length;
                const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;

                // 计算平均完成时长
                const completedAlarms = levelAlarms.filter(alarm => alarm.completeTime);
                let avgCompletionTime = 0;
                if (completedAlarms.length > 0) {
                    const totalTime = completedAlarms.reduce((sum, alarm) => {
                        return sum + calculateCompletionTime(alarm.timestamp, alarm.completeTime);
                    }, 0);
                    avgCompletionTime = Math.round(totalTime / completedAlarms.length);
                }

                return { level, total, completionRate, avgCompletionTime };
            });

            container.innerHTML = analysisData.map(data => {
                const rateClass = data.completionRate >= 90 ? 'good' : data.completionRate >= 70 ? 'warning' : 'danger';
                const timeClass = data.avgCompletionTime <= 15 ? 'good' : data.avgCompletionTime <= 30 ? 'warning' : 'danger';

                return `
                    <div class="level-stat-card ${data.level}">
                        <div class="level-stat-header">
                            <div class="level-stat-name">${levelNames[data.level]}</div>
                            <div class="level-stat-count">${data.total}</div>
                        </div>
                        <div class="level-stat-metrics">
                            <div class="level-stat-metric">
                                <div class="level-stat-metric-label">完成率</div>
                                <div class="level-stat-metric-value ${rateClass}">${data.completionRate}%</div>
                            </div>
                            <div class="level-stat-metric">
                                <div class="level-stat-metric-label">平均耗时</div>
                                <div class="level-stat-metric-value ${timeClass}">${data.avgCompletionTime}分</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * 按类型分析告警数据（简化版，两栏布局）
         */
        function renderTypeAnalysis() {
            const container = document.getElementById('typeAnalysisContent');
            if (!container) return;

            // 统计所有告警类型
            const typeStats = {};
            allAlarms.forEach(alarm => {
                const type = alarm.type || '未分类';
                if (!typeStats[type]) {
                    typeStats[type] = { total: 0, completed: 0, totalTime: 0 };
                }
                typeStats[type].total++;
                if (alarm.completeTime) {
                    typeStats[type].completed++;
                    typeStats[type].totalTime += calculateCompletionTime(alarm.timestamp, alarm.completeTime);
                }
            });

            // 转换为数组并排序（按告警数量降序）
            const sortedTypes = Object.entries(typeStats)
                .map(([type, stats]) => ({
                    type,
                    total: stats.total,
                    completionRate: stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0,
                    avgCompletionTime: stats.completed > 0 ? Math.round(stats.totalTime / stats.completed) : 0
                }))
                .sort((a, b) => b.total - a.total)
                .slice(0, 6); // 显示TOP6（两栏x3行）

            if (sortedTypes.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 24px; color: var(--text-secondary);">
                        <i class="fas fa-info-circle" style="font-size: 28px;"></i>
                        <div style="margin-top: 8px;">暂无数据</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = sortedTypes.map(data => {
                const rateClass = data.completionRate >= 90 ? 'good' : data.completionRate >= 70 ? 'warning' : 'danger';
                const timeClass = data.avgCompletionTime <= 20 ? 'good' : data.avgCompletionTime <= 40 ? 'warning' : 'danger';

                return `
                    <div class="analysis-stat-item">
                        <div class="analysis-stat-header">
                            <div class="stat-label">
                                <i class="fas fa-tag"></i>
                                <span>${data.type}</span>
                            </div>
                            <span class="stat-badge" style="background: #e0e7ff; color: #3730a3;">${data.total}个</span>
                        </div>
                        <div class="stat-metrics">
                            <div class="stat-metric">
                                <div class="stat-metric-label">完成率</div>
                                <div class="stat-metric-value ${rateClass}">
                                    ${data.completionRate}<span class="stat-metric-unit">%</span>
                                </div>
                            </div>
                            <div class="stat-metric">
                                <div class="stat-metric-label">平均耗时</div>
                                <div class="stat-metric-value ${timeClass}">
                                    ${data.avgCompletionTime}<span class="stat-metric-unit">分钟</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * 渲染升级时间建议（简化版，直接明了）
         */
        function renderEscalationRecommendation() {
            const container = document.getElementById('escalationRecommendation');
            if (!container) return;

            // 计算各级别平均完成时长
            const levels = ['critical', 'major', 'minor'];
            const levelNames = { 'critical': '紧急告警', 'major': '重要告警', 'minor': '次要告警' };
            const recommendations = [];

            levels.forEach(level => {
                const levelAlarms = allAlarms.filter(alarm => alarm.level === level && alarm.completeTime);
                let avgTime = 0;
                if (levelAlarms.length > 0) {
                    const totalTime = levelAlarms.reduce((sum, alarm) => {
                        return sum + calculateCompletionTime(alarm.timestamp, alarm.completeTime);
                    }, 0);
                    avgTime = Math.round(totalTime / levelAlarms.length);
                }

                // 基于平均时长推荐升级阈值
                let recommendedTime;
                if (avgTime > 30) {
                    recommendedTime = Math.min(Math.round(avgTime * 0.5), 20);
                } else if (avgTime > 15) {
                    recommendedTime = Math.min(Math.round(avgTime * 0.6), 15);
                } else {
                    recommendedTime = getLevelThreshold(level);
                }

                recommendations.push({
                    level: levelNames[level],
                    time: recommendedTime,
                    desc: avgTime > 0 ? `（基于平均${avgTime}分钟完成）` : '（建议值）'
                });
            });

            container.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item">
                    <div class="recommendation-level">${rec.level}</div>
                    <div class="recommendation-time">${rec.time}分钟</div>
                    <div class="recommendation-desc">超过此时间未响应则升级 ${rec.desc}</div>
                </div>
            `).join('');
        }

        /**
         * 升级告警（示例函数）
         */
        function escalateAlarm(alarmId) {
            console.log('🚀 升级告警:', alarmId);
            alert('告警升级成功！已通知技术主管和应急响应团队');
            renderUrgentEscalationBanner();
        }

        /**
         * 艹！告警优化决策引擎
         */
        class AlarmOptimizationEngine {
            constructor(alarms) {
                this.alarms = alarms;
                this.thresholds = {
                    critical: { response: 10, completion: 20 },
                    major: { response: 20, completion: 40 },
                    minor: { response: 30, completion: 60 }
                };
            }

            // 分析各级别告警数据
            analyzeLevelData(level) {
                const levelAlarms = this.alarms.filter(a => a.level === level);
                const total = levelAlarms.length;
                if (total === 0) return null;

                // 计算响应时间（假设：告警发生后第一次状态变化为响应）
                const responseTimes = levelAlarms
                    .filter(a => a.completeTime)
                    .map(a => calculateCompletionTime(a.timestamp, a.completeTime));

                const avgResponseTime = responseTimes.length > 0
                    ? Math.round(responseTimes.reduce((sum, t) => sum + t, 0) / responseTimes.length)
                    : 0;

                // 计算完成率
                const completed = levelAlarms.filter(a => a.completeTime).length;
                const completionRate = Math.round((completed / total) * 100);

                // 计算平均完成时间
                const completionTimes = levelAlarms
                    .filter(a => a.completeTime)
                    .map(a => calculateCompletionTime(a.timestamp, a.completeTime));

                const avgCompletionTime = completionTimes.length > 0
                    ? Math.round(completionTimes.reduce((sum, t) => sum + t, 0) / completionTimes.length)
                    : 0;

                return {
                    level,
                    total,
                    completionRate,
                    avgResponseTime,
                    avgCompletionTime
                };
            }

            // 生成优化建议
            generateSuggestions() {
                const suggestions = [];
                const levels = ['critical', 'major', 'minor'];

                levels.forEach(level => {
                    const data = this.analyzeLevelData(level);
                    if (!data) return;

                    const threshold = this.thresholds[level];
                    const levelNames = { critical: '紧急', major: '重要', minor: '次要' };

                    // 判断是否响应慢（需要增加触达）
                    if (data.avgResponseTime > threshold.response * 1.5) {
                        suggestions.push({
                            type: 'add_reach',
                            level,
                            levelName: levelNames[level],
                            priority: level === 'critical' ? 'high' : 'medium',
                            problem: `${levelNames[level]}告警平均响应时间${data.avgResponseTime}分钟，超出目标${threshold.response}分钟的1.5倍`,
                            actions: [
                                '添加短信通知（当前可能仅有邮件/微信）',
                                `增加值班人员${level === 'critical' ? '5人' : '3人'}`,
                                '启用并行通知模式（同时通知多人）'
                            ],
                            dataSupport: `基于${data.total}个${levelNames[level]}告警的历史数据分析`,
                            configLink: 'notification-config.html?action=add_reach&level=' + level
                        });
                    }

                    // 判断是否处理慢（需要升级告警）
                    if (data.avgCompletionTime > threshold.completion * 2) {
                        suggestions.push({
                            type: 'escalate_alarm',
                            level,
                            levelName: levelNames[level],
                            priority: level === 'critical' ? 'high' : 'medium',
                            problem: `${levelNames[level]}告警平均完成时间${data.avgCompletionTime}分钟，超出目标${threshold.completion}分钟的2倍`,
                            actions: [
                                `将升级时间从${threshold.completion}分钟缩短为${Math.round(threshold.completion * 0.5)}分钟`,
                                level !== 'critical' ? '考虑提高告警级别' : '增加专家组快速响应通道',
                                '设置多级升级机制（10分钟→主管，20分钟→经理）'
                            ],
                            dataSupport: `基于${data.total}个${levelNames[level]}告警的历史数据分析`,
                            configLink: 'notification-config.html?action=escalate&level=' + level
                        });
                    }

                    // 判断完成率是否过低
                    if (data.completionRate < 70) {
                        suggestions.push({
                            type: 'escalate_alarm',
                            level,
                            levelName: levelNames[level],
                            priority: 'medium',
                            problem: `${levelNames[level]}告警完成率仅${data.completionRate}%，低于70%健康线`,
                            actions: [
                                '增加自动升级规则',
                                '优化告警处理流程',
                                '加强值班培训'
                            ],
                            dataSupport: `基于${data.total}个${levelNames[level]}告警的历史数据分析`,
                            configLink: 'notification-config.html?action=optimize&level=' + level
                        });
                    }
                });

                // 按优先级排序
                return suggestions.sort((a, b) => {
                    const priorityOrder = { high: 0, medium: 1 };
                    return priorityOrder[a.priority] - priorityOrder[b.priority];
                }).slice(0, 3); // 只返回Top 3建议
            }

            // 计算健康度评分
            calculateHealthScore() {
                const allData = ['critical', 'major', 'minor'].map(l => this.analyzeLevelData(l)).filter(d => d);
                if (allData.length === 0) return { score: 0, status: '无数据' };

                // 响应速度得分（40分）
                const avgResponse = allData.reduce((sum, d) => sum + d.avgResponseTime, 0) / allData.length;
                const responseScore = Math.max(0, 40 - (avgResponse - 15) * 2);

                // 完成率得分（30分）
                const avgCompletionRate = allData.reduce((sum, d) => sum + d.completionRate, 0) / allData.length;
                const completionScore = avgCompletionRate * 0.3;

                // 覆盖范围得分（15分）- 简化版，假设100%
                const coverageScore = 15;

                // 升级效率得分（15分）- 简化版，假设80%
                const escalationScore = 12;

                const totalScore = Math.round(responseScore + completionScore + coverageScore + escalationScore);
                let status = '优秀';
                if (totalScore < 60) status = '需改进';
                else if (totalScore < 80) status = '有改善空间';
                else if (totalScore < 90) status = '良好';

                return {
                    score: totalScore,
                    status,
                    metrics: {
                        responseSpeed: responseScore >= 30 ? 'up' : 'down',
                        completionRate: avgCompletionRate >= 90 ? 'up' : avgCompletionRate >= 70 ? 'neutral' : 'down',
                        coverage: 'down',
                        escalation: 'neutral'
                    }
                };
            }
        }

        /**
         * 初始化告警通知Tab（完整版：统计+智能决策）
         */
        function initNotificationTab() {
            console.log('💡 初始化告警通知Tab（统计+智能决策）...');

            // 0. 渲染简单统计（已删除）
            // renderLevelStats();

            // 1-4. 渲染智能决策引擎
            const engine = new AlarmOptimizationEngine(allAlarms);
            renderOptimizationSuggestions(engine);  // 1. 智能建议
            // renderHealthScore(engine);              // 2. 健康度评分（已删除）
            // renderLevelDataAnalysis(engine);        // 3. 数据分析（已删除）
            // renderDetailedData();                    // 4. 详细数据表格（已删除）
        }

        /**
         * 0. 渲染告警等级统计（新增模块）
         */
        function renderLevelStats() {
            const levels = ['critical', 'major', 'minor'];

            levels.forEach(level => {
                const levelAlarms = allAlarms.filter(alarm => alarm.level === level);
                const total = levelAlarms.length;

                // 计算完成率
                const completed = levelAlarms.filter(alarm => alarm.completeTime).length;
                const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;

                // 计算平均完成时间
                const completedAlarms = levelAlarms.filter(alarm => alarm.completeTime);
                let avgCompletionTime = 0;
                if (completedAlarms.length > 0) {
                    const totalTime = completedAlarms.reduce((sum, alarm) => {
                        return sum + calculateCompletionTime(alarm.timestamp, alarm.completeTime);
                    }, 0);
                    avgCompletionTime = Math.round(totalTime / completedAlarms.length);
                }

                // 更新DOM
                const countElement = document.getElementById(`${level}Count`);
                const rateElement = document.getElementById(`${level}Rate`);
                const timeElement = document.getElementById(`${level}Time`);

                if (countElement) countElement.textContent = total;
                if (rateElement) rateElement.textContent = `${completionRate}%`;
                if (timeElement) timeElement.textContent = `${avgCompletionTime}分钟`;
            });
        }

        /**
         * 1. 渲染智能优化建议
         */
        function renderOptimizationSuggestions(engine) {
            const container = document.getElementById('suggestionsList');
            if (!container) return;

            const suggestions = engine.generateSuggestions();

            if (suggestions.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-check-circle" style="font-size: 48px; color: #10b981; margin-bottom: 16px;"></i>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">告警处理表现优秀！</div>
                        <div style="font-size: 14px;">当前无需优化，请继续保持</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = suggestions.map(suggestion => {
                const iconClass = suggestion.type === 'add_reach' ? 'fa-broadcast-tower' : 'fa-level-up-alt';
                const iconType = suggestion.type === 'add_reach' ? 'add-reach' : 'escalate-alarm';
                const typeText = suggestion.type === 'add_reach' ? '增加触达方式' : '升级告警';

                return `
                    <div class="suggestion-card priority-${suggestion.priority}">
                        <div class="suggestion-header">
                            <div class="suggestion-title-row">
                                <div class="suggestion-icon ${iconType}">
                                    <i class="fas ${iconClass}"></i>
                                </div>
                                <div class="suggestion-title-text">
                                    <div class="suggestion-type">${typeText}</div>
                                    <h3 class="suggestion-title">${suggestion.levelName}告警${typeText === '增加触达方式' ? '响应慢' : '处理慢'}</h3>
                                </div>
                            </div>
                            <div class="suggestion-priority-badge ${suggestion.priority}">
                                ${suggestion.priority === 'high' ? '高优先级' : '中优先级'}
                            </div>
                        </div>
                        <div class="suggestion-problem">
                            <div class="suggestion-problem-title">问题识别</div>
                            <div class="suggestion-problem-desc">${suggestion.problem}</div>
                        </div>
                        <div class="suggestion-actions">
                            <div class="suggestion-actions-title">建议操作</div>
                            <ul class="suggestion-actions-list">
                                ${suggestion.actions.map(action => `<li>${action}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="suggestion-footer">
                            <div class="suggestion-data-support">
                                <i class="fas fa-chart-line"></i> ${suggestion.dataSupport}
                            </div>
                            <button class="suggestion-btn btn-primary" onclick="window.location.href='${suggestion.configLink}'">
                                <span>立即配置</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * 2. 渲染健康度评分
         */
        function renderHealthScore(engine) {
            const scoreValue = document.getElementById('healthScoreValue');
            const scoreStatus = document.getElementById('healthScoreStatus');

            const healthData = engine.calculateHealthScore();

            if (scoreValue) scoreValue.textContent = healthData.score;
            if (scoreStatus) scoreStatus.textContent = healthData.status;

            // 更新各维度指标
            const metrics = healthData.metrics;
            updateMetricIndicator('responseSpeedMetric', metrics.responseSpeed);
            updateMetricIndicator('completionRateMetric', metrics.completionRate);
            updateMetricIndicator('coverageMetric', metrics.coverage);
            updateMetricIndicator('escalationMetric', metrics.escalation);
        }

        function updateMetricIndicator(elementId, status) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const indicator = element.querySelector('.metric-indicator');
            if (!indicator) return;

            indicator.className = `metric-indicator ${status}`;
            if (status === 'up') indicator.textContent = '↑';
            else if (status === 'down') indicator.textContent = '↓';
            else indicator.textContent = '−';
        }

        /**
         * 3. 渲染数据分析卡片
         */
        function renderLevelDataAnalysis(engine) {
            const levels = ['critical', 'major', 'minor'];
            const levelNames = { critical: '紧急告警', major: '重要告警', minor: '次要告警' };
            const levelIds = { critical: 'criticalAnalysisCard', major: 'majorAnalysisCard', minor: 'minorAnalysisCard' };

            levels.forEach(level => {
                const container = document.getElementById(levelIds[level]);
                if (!container) return;

                const data = engine.analyzeLevelData(level);
                if (!data) {
                    container.innerHTML = `<div style="text-align: center; padding: 20px; color: var(--text-secondary);">暂无数据</div>`;
                    return;
                }

                const threshold = engine.thresholds[level];
                const responseClass = data.avgResponseTime > threshold.response * 1.5 ? 'danger' :
                                      data.avgResponseTime > threshold.response ? 'warning' : 'good';
                const completionClass = data.avgCompletionTime > threshold.completion * 2 ? 'danger' :
                                        data.avgCompletionTime > threshold.completion ? 'warning' : 'good';
                const rateClass = data.completionRate < 70 ? 'danger' :
                                  data.completionRate < 90 ? 'warning' : 'good';

                let issueHtml = '';
                if (data.avgResponseTime > threshold.response * 1.5) {
                    issueHtml = `<div class="level-card-issue issue-response">❌ 响应慢（需增加触达）</div>`;
                } else if (data.avgCompletionTime > threshold.completion * 2) {
                    issueHtml = `<div class="level-card-issue issue-completion">⚠️ 处理慢（需升级告警）</div>`;
                } else {
                    issueHtml = `<div class="level-card-issue issue-none">✓ 正常</div>`;
                }

                container.innerHTML = `
                    <div class="level-card-header">
                        <div class="level-card-name">${levelNames[level]}</div>
                        <div class="level-card-count">${data.total}</div>
                    </div>
                    <div class="level-card-metrics">
                        <div class="level-card-metric">
                            <div class="level-card-metric-label">平均响应时间</div>
                            <div class="level-card-metric-value ${responseClass}">${data.avgResponseTime}分</div>
                        </div>
                        <div class="level-card-metric">
                            <div class="level-card-metric-label">平均完成时间</div>
                            <div class="level-card-metric-value ${completionClass}">${data.avgCompletionTime}分</div>
                        </div>
                        <div class="level-card-metric">
                            <div class="level-card-metric-label">完成率</div>
                            <div class="level-card-metric-value ${rateClass}">${data.completionRate}%</div>
                        </div>
                    </div>
                    ${issueHtml}
                `;
            });
        }

        /**
         * 4. 渲染详细数据表格
         */
        function renderDetailedData() {
            const container = document.getElementById('detailedDataContent');
            if (!container) return;

            container.innerHTML = `
                <div style="padding: 20px;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--border-color);">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">级别</th>
                                <th style="padding: 12px; text-align: right;">告警数量</th>
                                <th style="padding: 12px; text-align: right;">平均响应(分)</th>
                                <th style="padding: 12px; text-align: right;">平均完成(分)</th>
                                <th style="padding: 12px; text-align: right;">完成率</th>
                                <th style="padding: 12px; text-align: left;">状态</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${['critical', 'major', 'minor'].map(level => {
                                const engine = new AlarmOptimizationEngine(allAlarms);
                                const data = engine.analyzeLevelData(level);
                                if (!data) return '';

                                const levelNames = { critical: '紧急', major: '重要', minor: '次要' };
                                const threshold = engine.thresholds[level];
                                let status = '正常';
                                if (data.avgResponseTime > threshold.response * 1.5) status = '响应慢';
                                else if (data.avgCompletionTime > threshold.completion * 2) status = '处理慢';

                                return `
                                    <tr style="border-bottom: 1px solid var(--border-color);">
                                        <td style="padding: 12px;">${levelNames[level]}</td>
                                        <td style="padding: 12px; text-align: right;">${data.total}</td>
                                        <td style="padding: 12px; text-align: right;">${data.avgResponseTime}</td>
                                        <td style="padding: 12px; text-align: right;">${data.avgCompletionTime}</td>
                                        <td style="padding: 12px; text-align: right;">${data.completionRate}%</td>
                                        <td style="padding: 12px;">
                                            <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; ${
                                                status === '响应慢' ? 'background: rgba(220, 38, 38, 0.1); color: #dc2626;' :
                                                status === '处理慢' ? 'background: rgba(245, 158, 11, 0.1); color: #f59e0b;' :
                                                'background: rgba(16, 185, 129, 0.1); color: #10b981;'
                                            }">${status}</span>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // M4.1 绘制设备告警排行柱状图
        function drawDeviceRankingChart() {
            const ctx = document.getElementById('deviceRankingChart');
            if (!ctx) return;

            // 销毁旧的图表实例
            if (chartInstances.deviceRanking) {
                chartInstances.deviceRanking.destroy();
                chartInstances.deviceRanking = null;
            }

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            const devices = {};
            allAlarms.forEach(alarm => {
                devices[alarm.device] = (devices[alarm.device] || 0) + 1;
            });

            const sortedDevices = Object.entries(devices).sort((a, b) => b[1] - a[1]).slice(0, 10);
            const labels = sortedDevices.map(d => d[0]);
            const data = sortedDevices.map(d => d[1]);

            chartInstances.deviceRanking = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '告警数量',
                        data: data,
                        backgroundColor: '#667eea',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: isDark ? '#334155' : '#e5e7eb'
                            },
                            ticks: {
                                color: isDark ? '#e2e8f0' : '#64748b'
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: isDark ? '#e2e8f0' : '#64748b',
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // M4.1 绘制告警等级分布饼图
        function drawAlarmLevelChart() {
            const ctx = document.getElementById('alarmLevelChart');
            if (!ctx) return;

            // 销毁旧的图表实例
            if (chartInstances.alarmLevel) {
                chartInstances.alarmLevel.destroy();
                chartInstances.alarmLevel = null;
            }

            const levels = { critical: 0, major: 0, minor: 0, info: 0 };
            allAlarms.forEach(alarm => {
                levels[alarm.level]++;
            });

            const labels = ['紧急', '主要', '次要', '提示'];
            const data = [levels.critical, levels.major, levels.minor, levels.info];
            const colors = ['#ef4444', '#f59e0b', '#fbbf24', '#3b82f6'];

            chartInstances.alarmLevel = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // 生成自定义图例
            const legendContainer = document.getElementById('alarmLevelLegend');
            if (legendContainer) {
                legendContainer.innerHTML = labels.map((label, index) => `
                    <div class="legend-item">
                        <div class="legend-color" style="background: ${colors[index]};"></div>
                        <span>${label} (${data[index]})</span>
                    </div>
                `).join('');
            }
        }

        // M4.1 生成热力图
        function generateHeatmap() {
            const heatmapGrid = document.getElementById('heatmapGrid');
            const heatmapXAxis = document.getElementById('heatmapXAxis');
            if (!heatmapGrid) return;

            // 生成模拟热力图数据（7天 × 24小时）
            const heatmapData = [];
            for (let day = 0; day < 7; day++) {
                for (let hour = 0; hour < 24; hour++) {
                    // 工作时间（9-18点）告警数量更多
                    let value = Math.floor(Math.random() * 20);
                    if (hour >= 9 && hour <= 18 && day >= 1 && day <= 5) {
                        value += Math.floor(Math.random() * 30);
                    }
                    heatmapData.push({ day, hour, value });
                }
            }

            // 渲染热力图单元格
            const maxValue = Math.max(...heatmapData.map(d => d.value));
            heatmapGrid.innerHTML = heatmapData.map(cell => {
                const intensity = cell.value / maxValue;
                const colorIndex = Math.floor(intensity * 6);
                const colors = ['#e0e7ff', '#c7d2fe', '#a5b4fc', '#818cf8', '#6366f1', '#4f46e5', '#4338ca'];
                return `<div class="heatmap-cell" style="background: ${colors[colorIndex]};" title="${cell.value} 条告警"></div>`;
            }).join('');

            // 渲染X轴标签（每4小时一个标签）
            heatmapXAxis.innerHTML = Array.from({ length: 24 }, (_, i) => {
                if (i % 4 === 0) {
                    return `<div class="heatmap-x-label">${i}:00</div>`;
                }
                return '<div></div>';
            }).join('');
        }

        // M4.2 绘制MTTR/MTBF趋势图
        function drawMTTRTrendChart() {
            const ctx = document.getElementById('mttrTrendChart');
            if (!ctx) return;

            // 销毁旧的图表实例
            if (chartInstances.mttrTrend) {
                chartInstances.mttrTrend.destroy();
                chartInstances.mttrTrend = null;
            }

            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

            // 生成30天MTTR/MTBF数据
            const labels = [];
            const mttrData = [];
            const mtbfData = [];

            for (let i = 29; i >= 0; i--) {
                labels.push(i === 0 ? '今天' : `${i}天前`);
                // MTTR从18分钟逐渐下降到14.5分钟
                mttrData.push(18 - (29 - i) * 0.12 + (Math.random() - 0.5) * 1);
                // MTBF从16小时逐渐上升到18.2小时
                mtbfData.push(16 + (29 - i) * 0.075 + (Math.random() - 0.5) * 0.5);
            }

            chartInstances.mttrTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'MTTR (分钟)',
                            data: mttrData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'MTBF (小时)',
                            data: mtbfData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: isDark ? '#e2e8f0' : '#64748b',
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'MTTR (分钟)',
                                color: isDark ? '#e2e8f0' : '#64748b'
                            },
                            grid: {
                                color: isDark ? '#334155' : '#e5e7eb'
                            },
                            ticks: {
                                color: isDark ? '#e2e8f0' : '#64748b'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'MTBF (小时)',
                                color: isDark ? '#e2e8f0' : '#64748b'
                            },
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                color: isDark ? '#e2e8f0' : '#64748b'
                            }
                        }
                    }
                }
            });
        }

        // 表格排序功能 - 重写版本
        function initTableSort() {
            const table = document.getElementById('stationTable');
            if (!table) {
                console.error('❌ 未找到表格元素 #stationTable');
                return;
            }

            const tbody = table.querySelector('tbody');
            if (!tbody) {
                console.error('❌ 未找到tbody元素');
                return;
            }

            // 保存原始行顺序
            const originalRows = Array.from(tbody.querySelectorAll('tr')).map(row => row.cloneNode(true));
            console.log('📦 保存了原始行顺序:', originalRows.length, '行');

            const headers = table.querySelectorAll('th.sortable');
            console.log('✅ 找到可排序列:', headers.length, '个');

            if (headers.length === 0) {
                console.warn('⚠️ 没有找到可排序的列');
                return;
            }

            let currentSort = { column: null, direction: null };

            headers.forEach((header, index) => {
                const column = header.getAttribute('data-column');
                const type = header.getAttribute('data-type') || 'string';
                console.log(`✅ 初始化排序列 ${index + 1}: ${column} (类型: ${type})`);

                header.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🖱️ 点击表头:', column);

                    // 确定排序方向
                    if (currentSort.column === column) {
                        if (currentSort.direction === 'asc') {
                            currentSort.direction = 'desc';
                            console.log('📊 切换到降序');
                        } else if (currentSort.direction === 'desc') {
                            currentSort.direction = null;
                            currentSort.column = null;
                            console.log('🔄 恢复原始顺序');
                        } else {
                            currentSort.direction = 'asc';
                            console.log('📊 切换到升序');
                        }
                    } else {
                        currentSort.column = column;
                        currentSort.direction = 'asc';
                        console.log('📊 新列升序排序');
                    }

                    // 更新表头样式
                    headers.forEach(h => {
                        h.classList.remove('sort-asc', 'sort-desc');
                    });

                    if (currentSort.direction) {
                        this.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
                    }

                    // 执行排序
                    if (currentSort.direction === null) {
                        // 恢复原始顺序
                        console.log('🔄 恢复原始行顺序');
                        tbody.innerHTML = '';
                        originalRows.forEach(row => {
                            tbody.appendChild(row.cloneNode(true));
                        });
                    } else {
                        // 执行排序
                        sortTableByColumn(table, column, currentSort.direction, type);
                    }
                });
            });

            console.log('✅ 表格排序功能初始化完成！');
        }

        function sortTableByColumn(table, column, direction, type) {
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            // 从thead中查找列索引
            const headers = Array.from(table.querySelector('thead').querySelectorAll('th'));
            const columnIndex = headers.findIndex(th => th.getAttribute('data-column') === column);

            console.log('📍 排序信息 - 列:', column, '索引:', columnIndex, '方向:', direction, '类型:', type);

            if (columnIndex === -1) {
                console.error('❌ 未找到列:', column);
                return;
            }

            // 排序
            rows.sort((a, b) => {
                const aCell = a.cells[columnIndex];
                const bCell = b.cells[columnIndex];

                if (!aCell || !bCell) {
                    console.error('❌ 未找到单元格');
                    return 0;
                }

                let aValue = aCell.getAttribute('data-value');
                let bValue = bCell.getAttribute('data-value');

                if (type === 'number') {
                    aValue = parseFloat(aValue);
                    bValue = parseFloat(bValue);

                    if (isNaN(aValue)) aValue = 0;
                    if (isNaN(bValue)) bValue = 0;
                } else {
                    aValue = aValue || aCell.textContent.trim();
                    bValue = bValue || bCell.textContent.trim();
                }

                console.log(`🔢 比较: ${aValue} vs ${bValue}`);

                let comparison = 0;
                if (aValue > bValue) {
                    comparison = 1;
                } else if (aValue < bValue) {
                    comparison = -1;
                }

                return direction === 'asc' ? comparison : -comparison;
            });

            // 清空tbody并重新添加排序后的行
            tbody.innerHTML = '';
            rows.forEach(row => {
                tbody.appendChild(row);
            });

            console.log('✅ 排序完成！共处理', rows.length, '行');
        }

        // M4.3 高级搜索功能
        function performAdvancedSearch() {
            console.log('艹！执行高级搜索...');
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const site = document.getElementById('advancedSiteFilter').value;
            const device = document.getElementById('advancedDeviceFilter').value;
            const type = document.getElementById('advancedTypeFilter').value;
            const level = document.getElementById('advancedLevelFilter').value;

            // 模拟查询结果
            console.log('查询条件：', { startDate, endDate, site, device, type, level });
            alert(`查询完成！\n时间范围：${startDate} ~ ${endDate}\n共找到 1,284 条告警`);
        }

        function resetAdvancedSearch() {
            const startDateEl = document.getElementById('startDate');
            const endDateEl = document.getElementById('endDate');
            const advancedSiteFilterEl = document.getElementById('advancedSiteFilter');
            const advancedDeviceFilterEl = document.getElementById('advancedDeviceFilter');
            const advancedTypeFilterEl = document.getElementById('advancedTypeFilter');
            const advancedLevelFilterEl = document.getElementById('advancedLevelFilter');

            if (startDateEl) startDateEl.value = '2025-11-28';
            if (endDateEl) endDateEl.value = '2025-12-05';
            if (advancedSiteFilterEl) advancedSiteFilterEl.value = '';
            if (advancedDeviceFilterEl) advancedDeviceFilterEl.value = '';
            if (advancedTypeFilterEl) advancedTypeFilterEl.value = '';
            if (advancedLevelFilterEl) advancedLevelFilterEl.value = '';
        }

        // M4.3 Excel导出功能（类似阳光电源）
        // 艹！Excel导出功能，支持从任何地方调用
        function exportToExcel() {
            console.log('艹！开始导出Excel...');

            // 查找导出按钮（可能是.export-btn或quick-action-card）
            let exportBtn = null;
            let originalHTML = '';

            if (event && event.target) {
                exportBtn = event.target.closest('.export-btn') || event.target.closest('.quick-action-card');
            }

            // 如果找到了按钮，显示加载状态
            if (exportBtn) {
                originalHTML = exportBtn.innerHTML;

                // 根据按钮类型选择不同的加载显示
                if (exportBtn.classList.contains('export-btn')) {
                    exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 导出中...';
                    exportBtn.disabled = true;
                } else if (exportBtn.classList.contains('quick-action-card')) {
                    // 快捷操作卡片只改变箭头为加载图标
                    const arrow = exportBtn.querySelector('.quick-arrow');
                    if (arrow) {
                        arrow.className = 'fas fa-spinner fa-spin quick-arrow';
                    }
                }
            }

            setTimeout(() => {
                // 恢复按钮状态
                if (exportBtn) {
                    exportBtn.innerHTML = originalHTML;
                    if (exportBtn.classList.contains('export-btn')) {
                        exportBtn.disabled = false;
                    }
                }

                // 实际项目中这里应该生成真实的Excel文件
                alert('✅ Excel导出成功！\n\n文件名：告警分析报表_2025-12-05.xlsx\n包含内容：\n- 告警列表 (1,284条)\n- 热点分析统计\n- MTTR/MTBF数据\n- 运维绩效报告\n\n（演示版本：实际下载功能需后端支持）');
            }, 1500);
        }

        // M4.4 渲染团队绩效排行
        function renderTeamRanking() {
            const container = document.getElementById('teamRankingBody');
            if (!container) return;

            const teamData = [
                { name: '张工', alarms: 187, avgResponse: 8.5, resolution: 97.2, score: 96.8 },
                { name: '李工', alarms: 165, avgResponse: 9.2, resolution: 95.8, score: 94.5 },
                { name: '王工', alarms: 143, avgResponse: 10.1, resolution: 94.3, score: 92.3 },
                { name: '赵工', alarms: 128, avgResponse: 11.5, resolution: 92.1, score: 89.7 },
                { name: '刘工', alarms: 119, avgResponse: 12.3, resolution: 91.5, score: 87.4 },
                { name: '陈工', alarms: 97, avgResponse: 13.8, resolution: 89.8, score: 84.2 },
                { name: '杨工', alarms: 85, avgResponse: 14.2, resolution: 88.3, score: 82.1 },
                { name: '周工', alarms: 76, avgResponse: 15.5, resolution: 86.7, score: 79.5 }
            ];

            container.innerHTML = teamData.map((member, index) => {
                const rank = index + 1;
                const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';

                return `
                    <div class="team-ranking-row">
                        <div class="team-rank ${rankClass}">${rank}</div>
                        <div class="team-name">${member.name}</div>
                        <div class="team-stat">${member.alarms}</div>
                        <div class="team-stat">${member.avgResponse}分钟</div>
                        <div class="team-stat">${member.resolution}%</div>
                        <div class="team-score">${member.score}</div>
                    </div>
                `;
            }).join('');
        }

        // M4 统计报表更新函数
        function updateStatistics() {
            console.log('艹！更新统计报表数据...');
            // 重新绘制所有图表
            setTimeout(() => {
                // 更新热点分析概览图表
                drawStationDistributionChart();
                drawAlarmLevelDistChart();
                drawTopDevicesChart();
                drawAlarmTypeStatsChart();
                drawAlarmLevelPieChart();
                renderAlarmLevelCompletionTable();
                renderAlarmCountRanking();
                renderAlarmEfficiencyRanking();

                // 更新Module 4图表
                drawDeviceRankingChart();
                drawAlarmLevelChart();
                generateHeatmap();
                drawMTTRTrendChart();
            }, 100);
        }

        // ==================== 页面初始化 ====================

        document.addEventListener('DOMContentLoaded', function() {
            // ========== 艹！把标题插入到顶部栏左侧 ==========
            const headerLeft = document.querySelector('.header-left');
            if (headerLeft) {
                // 创建标题
                const title = document.createElement('h1');
                title.textContent = '告警分析';
                title.style.cssText = 'margin: 0 0 0 90px; font-size: 20px; font-weight: 600; color: #1e293b;';

                // 添加到左侧区域的最后
                headerLeft.appendChild(title);
            }

            // ========== 艹！初始化智能概览面板（动态数据） ==========
            renderOverviewPanel();

            // ========== 初始化Module 3数据和图表 ==========
            renderTrendWarnings();

            // ========== 初始化告警词云区域筛选器 ==========
            setTimeout(() => {
                initRegionFilter();
                console.log('✅ 区域筛选器已初始化');
            }, 50);

            // ========== 优先初始化表格排序功能 ==========
            // 提前初始化，不依赖图表绘制
            setTimeout(() => {
                console.log('🔧 开始初始化表格排序功能...');
                initTableSort();
            }, 50);

            // 延迟绘制图表，确保canvas已渲染
            setTimeout(() => {
                console.log('📊 开始绘制所有图表...');

                // ========== 初始化热点分析概览图表 ==========
                try {
                    drawStationDistributionChart();  // 电站告警分布饼图
                } catch (e) {
                    console.error('❌ 电站分布图绘制失败:', e);
                }

                try {
                    drawAlarmLevelDistChart();       // 告警等级分布饼图
                } catch (e) {
                    console.error('❌ 等级分布图绘制失败:', e);
                }

                try {
                    drawTopDevicesChart();           // 设备告警次数TOP5排行榜
                } catch (e) {
                    console.error('❌ TOP5设备图绘制失败:', e);
                }

                try {
                    drawAlarmTypeStatsChart();       // 告警类型统计饼图
                } catch (e) {
                    console.error('❌ 告警类型统计饼图绘制失败:', e);
                }

                try {
                    drawAlarmLevelPieChart();        // 告警等级统计饼图
                } catch (e) {
                    console.error('❌ 告警等级统计饼图绘制失败:', e);
                }

                try {
                    renderAlarmLevelCompletionTable(); // 告警等级完成率表格
                } catch (e) {
                    console.error('❌ 告警等级完成率表格渲染失败:', e);
                }

                try {
                    renderAlarmCountRanking(); // 告警次数最多排行榜
                } catch (e) {
                    console.error('❌ 告警次数排行榜渲染失败:', e);
                }

                try {
                    renderAlarmEfficiencyRanking(); // 处理效率最慢排行榜
                } catch (e) {
                    console.error('❌ 处理效率排行榜渲染失败:', e);
                }

                // ========== 初始化Module 3图表 ==========
                try {
                    drawSOHChart();
                    drawSOPChart();
                } catch (e) {
                    console.error('❌ SOH/SOP图表绘制失败:', e);
                }

                // ========== 初始化Module 4图表 ==========
                try {
                    drawDeviceRankingChart();
                    drawAlarmLevelChart();
                    generateHeatmap();
                    drawMTTRTrendChart();
                    renderTeamRanking();
                } catch (e) {
                    console.error('❌ Module 4图表绘制失败:', e);
                }

                // ========== 初始化区域高频告警 ==========
                try {
                    initRegionAlarms();
                } catch (e) {
                    console.error('❌ 区域高频告警渲染失败:', e);
                }

                // ========== 初始化告警通知Tab ==========
                try {
                    initNotificationTab();
                } catch (e) {
                    console.error('❌ 告警通知Tab渲染失败:', e);
                }

                console.log('✅ 所有图表绘制完成！');
            }, 100);

            // 启动实时推送模拟（大厂特性）
            setTimeout(() => {
                startRealtimeSimulation();
                console.log('艹！实时告警推送已启动，每15秒推送一条新告警！');
                console.log('艹！智能概览、Module 1-4 所有系统已初始化完成！');
            }, 3000); // 3秒后启动
        });

        // 监听主题切换
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'data-theme') {
                    console.log('🎨 主题切换，重新绘制所有图表...');
                    // 主题切换时重新绘制图表
                    setTimeout(() => {
                        // 热点分析概览图表
                        drawStationDistributionChart();
                        drawAlarmLevelDistChart();
                        drawTopDevicesChart();
                        drawAlarmTypeStatsChart();
                        drawAlarmLevelPieChart();

                        // Module 3图表
                        drawSOHChart();
                        drawSOPChart();

                        // Module 4图表
                        drawDeviceRankingChart();
                        drawAlarmLevelChart();
                        generateHeatmap();
                        drawMTTRTrendChart();

                        // 区域高频告警
                        initRegionAlarms();

                        // 告警通知Tab
                        initNotificationTab();
                    }, 100);
                }
            });
        });

        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['data-theme']
        });
    </script>
</body>
</html>
