# 仪表盘地图功能使用说明

## 📍 功能概述

仪表盘页面现已支持**地图视图模式**，您可以在数据视图和地图视图之间自由切换，通过地图直观查看各个电站的地理位置和实时状态。

---

## 🚀 快速开始

### 1. 配置高德地图API密钥

在使用地图功能前，您需要申请高德地图API密钥：

1. 访问 [高德开放平台](https://lbs.amap.com/)
2. 注册并登录账号
3. 进入控制台创建应用
4. 选择"Web端(JS API)" 服务
5. 获取 API Key

**配置方式：**

打开 `dashboard.html` 文件，找到第11行：

```html
<script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=YOUR_AMAP_KEY"></script>
```

将 `YOUR_AMAP_KEY` 替换为您的实际API密钥：

```html
<script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=你的密钥"></script>
```

---

## 🎯 功能特性

### ✅ 视图切换
- **数据视图**: 传统的数据卡片和图表展示
- **地图视图**: 基于地图的电站位置展示

### ✅ 电站标记
- 5个电站在地图上以蓝色充电桩图标显示
- 鼠标悬停时图标会放大
- 点击图标显示电站详细信息

### ✅ 信息窗口
显示电站的实时信息：
- 电站名称
- 在线状态
- 总容量
- 储能柜数量
- 今日充电量
- 今日放电量
- 今日收益

### ✅ 地图控件
- **缩放控制**: 放大/缩小地图
- **工具栏**: 地图操作工具
- **比例尺**: 显示地图比例

### ✅ 3D视图
- 支持3D地图视角
- 45度倾斜角度
- 更直观的空间展示

### ✅ 平滑动画
- 视图切换时有淡入淡出动画
- 标记悬停时有缩放动画
- 流畅的用户体验

### ✅ 多语言支持
- 中文/英文界面自动切换
- 所有标签和信息都支持国际化

---

## 📖 使用方法

### 切换到地图视图

1. 打开仪表盘页面
2. 页面顶部有两个切换按钮
3. 点击 **"地图视图"** 按钮
4. 页面平滑切换到地图模式

### 查看电站信息

1. 在地图视图中找到蓝色充电桩图标
2. 点击图标
3. 弹出信息窗口显示电站详细数据
4. 再次点击地图其他位置关闭窗口

### 地图操作

- **缩放**: 鼠标滚轮或右侧缩放按钮
- **拖动**: 按住鼠标左键拖动地图
- **旋转**: 按住鼠标右键拖动（3D模式）
- **倾斜**: Ctrl + 鼠标拖动（3D模式）

---

## 🗺️ 电站位置说明

当前配置了5个示例电站（北京地区坐标）：

| 电站名称 | 位置坐标 | 容量 | 储能柜数 |
|---------|---------|------|---------|
| 科技园区站 | 116.397428, 39.90923 | 2000kWh | 8个 |
| 工业园区站 | 116.320580, 39.98408 | 2500kWh | 10个 |
| 商业中心站 | 116.476053, 39.91736 | 1800kWh | 7个 |
| 物流园区站 | 116.360703, 39.86633 | 1500kWh | 6个 |
| 产业园区站 | 116.453485, 40.01094 | 1200kWh | 5个 |

**修改电站位置：**

打开 `dashboard.html`，找到第2078行的 `stationsData` 数组，修改 `position` 字段：

```javascript
{
    id: 'station1',
    name: '科技园区站',
    position: [经度, 纬度], // 修改这里
    capacity: '2000kWh',
    // ...其他字段
}
```

---

## 🎨 自定义样式

### 修改标记颜色

在 `dashboard.html` 第2173行，修改标记的渐变色：

```javascript
background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
```

### 修改信息窗口样式

在 `dashboard.html` 第404-450行，修改 `.station-info-window` 相关CSS样式。

### 修改地图主题

在 `initMap()` 函数中添加地图样式：

```javascript
map = new AMap.Map('amap-container', {
    zoom: 11,
    center: [116.397428, 39.90923],
    viewMode: '3D',
    pitch: 45,
    skyColor: '#e6f7ff',
    mapStyle: 'amap://styles/blue' // 添加地图样式
});
```

可选样式：
- `amap://styles/normal` - 默认样式
- `amap://styles/dark` - 深色主题
- `amap://styles/blue` - 蓝色主题
- `amap://styles/fresh` - 清新主题

---

## 🔧 技术实现

### 核心技术栈
- **高德地图 API 2.0**: 地图渲染和交互
- **原生 JavaScript**: 视图切换逻辑
- **CSS3 动画**: 平滑过渡效果
- **Font Awesome**: 图标库

### 关键函数

1. **initMap()**: 初始化地图实例
2. **addStationMarkers()**: 添加电站标记
3. **createInfoWindowContent()**: 创建信息窗口内容
4. **switchView()**: 切换视图模式

### 性能优化

- 懒加载：地图仅在首次切换到地图视图时初始化
- 事件节流：标记悬停事件使用防抖处理
- 动画优化：使用 CSS transform 而非 position 改变

---

## 🐛 常见问题

### Q1: 地图无法加载？

**A**: 检查以下几点：
1. 确认已正确配置高德地图API密钥
2. 检查网络连接是否正常
3. 查看浏览器控制台是否有错误信息
4. 确认API密钥的服务权限包含"Web端(JS API)"

### Q2: 电站位置不准确？

**A**: 您需要在 `stationsData` 数组中修改实际的经纬度坐标。可以使用高德地图坐标拾取工具：
https://lbs.amap.com/tools/picker

### Q3: 信息窗口显示乱码？

**A**: 确保文件编码为 UTF-8。如果使用文本编辑器，保存时选择 UTF-8 编码。

### Q4: 移动端地图操作不流畅？

**A**: 高德地图自动适配移动端，建议：
1. 减少地图上的标记数量
2. 关闭不必要的地图特效
3. 优化网络环境

### Q5: 如何添加更多电站？

**A**: 在 `stationsData` 数组中添加新的电站对象：

```javascript
{
    id: 'station6',
    name: '新电站名称',
    nameKey: 'dashboardStation6', // 需要在common.js中添加翻译
    position: [经度, 纬度],
    capacity: '容量',
    cabinets: 数量,
    status: 'online',
    dailyCharge: '充电量',
    dailyDischarge: '放电量',
    revenue: '收益'
}
```

---

## 📝 更新日志

### v1.0.0 (2024-11-21)
- ✅ 实现地图视图基础功能
- ✅ 添加5个电站标记
- ✅ 实现信息窗口展示
- ✅ 添加视图切换动画
- ✅ 支持中英文双语

---

## 💡 未来计划

- [ ] 支持聚合标记（当电站数量较多时）
- [ ] 添加路径规划功能
- [ ] 实现电站状态实时更新
- [ ] 添加热力图展示收益分布
- [ ] 支持历史轨迹回放
- [ ] 添加地图标注和测距工具

---

## 📞 技术支持

如有问题或建议，请联系开发团队。

---

**祝您使用愉快！** 🎉
