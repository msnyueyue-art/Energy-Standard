# 触摸屏历史数据日历国际化修复说明

## 问题描述
在触摸屏数据页面 (touchscreen/data.html) 的历史数据时间选择器中,日历的月份名称(如"一月"、"二月")、星期标题(如"日"、"一"、"二")以及按钮文字("今天"、"取消")是硬编码的中文,在英文环境下没有切换为英文。

## 问题位置
- 文件: `touchscreen/data.html`
- 行号: 7979-8014
- 问题代码:
  - 月份选项: 第7980-7991行 ("一月"、"二月"等)
  - 星期标题: 第8000-8006行 ("日"、"一"、"二"等)
  - 底部按钮: 第8012-8013行 ("今天"、"取消")

## 修复方案

### 1. 添加国际化翻译键

在 `touchscreen/touchscreen-i18n.js` 中添加日历相关的翻译配置:

**中文翻译 (第548-569行):**
```javascript
// ========== 日历相关 ==========
calendarMonthJan: '一月',
calendarMonthFeb: '二月',
calendarMonthMar: '三月',
calendarMonthApr: '四月',
calendarMonthMay: '五月',
calendarMonthJun: '六月',
calendarMonthJul: '七月',
calendarMonthAug: '八月',
calendarMonthSep: '九月',
calendarMonthOct: '十月',
calendarMonthNov: '十一月',
calendarMonthDec: '十二月',
calendarWeekdaySun: '日',
calendarWeekdayMon: '一',
calendarWeekdayTue: '二',
calendarWeekdayWed: '三',
calendarWeekdayThu: '四',
calendarWeekdayFri: '五',
calendarWeekdaySat: '六',
calendarToday: '今天',
calendarCancel: '取消',
```

**英文翻译 (第1161-1182行):**
```javascript
// ========== Calendar ==========
calendarMonthJan: 'January',
calendarMonthFeb: 'February',
calendarMonthMar: 'March',
calendarMonthApr: 'April',
calendarMonthMay: 'May',
calendarMonthJun: 'June',
calendarMonthJul: 'July',
calendarMonthAug: 'August',
calendarMonthSep: 'September',
calendarMonthOct: 'October',
calendarMonthNov: 'November',
calendarMonthDec: 'December',
calendarWeekdaySun: 'Sun',
calendarWeekdayMon: 'Mon',
calendarWeekdayTue: 'Tue',
calendarWeekdayWed: 'Wed',
calendarWeekdayThu: 'Thu',
calendarWeekdayFri: 'Fri',
calendarWeekdaySat: 'Sat',
calendarToday: 'Today',
calendarCancel: 'Cancel',
```

### 2. 修改日历HTML

**修改 1: 月份选项 (第7979-7992行)**

修改前:
```html
<select id="calendarMonth" onchange="updateCalendar()">
    <option value="0">一月</option>
    <option value="1">二月</option>
    <!-- ... 其他月份 ... -->
</select>
```

修改后:
```html
<select id="calendarMonth" onchange="updateCalendar()">
    <option value="0" data-i18n="calendarMonthJan">January</option>
    <option value="1" data-i18n="calendarMonthFeb">February</option>
    <option value="2" data-i18n="calendarMonthMar">March</option>
    <option value="3" data-i18n="calendarMonthApr">April</option>
    <option value="4" data-i18n="calendarMonthMay">May</option>
    <option value="5" data-i18n="calendarMonthJun">June</option>
    <option value="6" data-i18n="calendarMonthJul">July</option>
    <option value="7" data-i18n="calendarMonthAug">August</option>
    <option value="8" data-i18n="calendarMonthSep">September</option>
    <option value="9" data-i18n="calendarMonthOct">October</option>
    <option value="10" data-i18n="calendarMonthNov">November</option>
    <option value="11" data-i18n="calendarMonthDec">December</option>
</select>
```

**修改 2: 星期标题 (第7999-8007行)**

修改前:
```html
<div class="calendar-weekdays">
    <div class="calendar-weekday">日</div>
    <div class="calendar-weekday">一</div>
    <!-- ... 其他星期 ... -->
</div>
```

修改后:
```html
<div class="calendar-weekdays">
    <div class="calendar-weekday" data-i18n="calendarWeekdaySun">Sun</div>
    <div class="calendar-weekday" data-i18n="calendarWeekdayMon">Mon</div>
    <div class="calendar-weekday" data-i18n="calendarWeekdayTue">Tue</div>
    <div class="calendar-weekday" data-i18n="calendarWeekdayWed">Wed</div>
    <div class="calendar-weekday" data-i18n="calendarWeekdayThu">Thu</div>
    <div class="calendar-weekday" data-i18n="calendarWeekdayFri">Fri</div>
    <div class="calendar-weekday" data-i18n="calendarWeekdaySat">Sat</div>
</div>
```

**修改 3: 底部按钮 (第8011-8014行)**

修改前:
```html
<div class="calendar-footer">
    <button class="calendar-btn secondary" onclick="setToday()" ontouchend="setToday()">今天</button>
    <button class="calendar-btn secondary" onclick="closeCustomCalendar()" ontouchend="closeCustomCalendar()">取消</button>
</div>
```

修改后:
```html
<div class="calendar-footer">
    <button class="calendar-btn secondary" onclick="setToday()" ontouchend="setToday()" data-i18n="calendarToday">Today</button>
    <button class="calendar-btn secondary" onclick="closeCustomCalendar()" ontouchend="closeCustomCalendar()" data-i18n="calendarCancel">Cancel</button>
</div>
```

## 修复效果

### 英文环境下
- ✅ **月份名称**: January, February, March, April, May, June, July, August, September, October, November, December
- ✅ **星期标题**: Sun, Mon, Tue, Wed, Thu, Fri, Sat
- ✅ **今天按钮**: Today
- ✅ **取消按钮**: Cancel

### 中文环境下
- ✅ **月份名称**: 一月、二月、三月、四月、五月、六月、七月、八月、九月、十月、十一月、十二月
- ✅ **星期标题**: 日、一、二、三、四、五、六
- ✅ **今天按钮**: 今天
- ✅ **取消按钮**: 取消

### 语言切换
- ✅ 切换语言时,日历文本会实时更新
- ✅ 不影响日历的任何功能和布局

## 测试方法

### 英文环境测试
1. 打开触摸屏数据页面: `touchscreen/data.html`
2. 确保当前语言为英文
3. 点击左侧设备列表中的"Overall"(整机)
4. 点击顶部的"Historical Data"标签
5. 点击日期输入框,打开日历选择器
6. 验证以下内容:
   - 月份下拉框显示: "January", "February", "March"等
   - 星期标题显示: "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"
   - 底部按钮显示: "Today"和"Cancel"

### 中文环境测试
1. 切换到中文环境
2. 重复上述步骤
3. 验证以下内容:
   - 月份下拉框显示: "一月"、"二月"、"三月"等
   - 星期标题显示: "日"、"一"、"二"、"三"、"四"、"五"、"六"
   - 底部按钮显示: "今天"和"取消"

### 语言切换测试
1. 打开日历选择器(保持打开状态)
2. 点击右上角的语言切换按钮
3. 观察日历文本是否立即更新为对应语言

## 技术说明

### HTML 默认文本设置
触摸屏系统的设计策略:
- HTML 中的默认文本使用**英文**
- 页面加载后,如果检测到中文环境,才会执行翻译转换
- 这种策略避免了英文环境下的内容闪烁

### data-i18n 属性
触摸屏系统使用 `data-i18n` 属性标记需要国际化的元素:
```html
<div data-i18n="translationKey">Default Text</div>
```

`applyTouchscreenTranslations()` 函数会:
1. 查找所有带有 `data-i18n` 属性的元素
2. 获取属性值作为翻译键
3. 从翻译对象中获取对应语言的文本
4. 更新元素的 `textContent`

### 自动应用
- 页面加载时自动检测语言并应用翻译
- 语言切换时重新应用翻译
- 无需手动调用翻译函数

## 相关文件
- `touchscreen/data.html` - 数据页面(包含日历组件)
- `touchscreen/touchscreen-i18n.js` - 触摸屏国际化翻译配置文件

## 注意事项
- 日历的 HTML 默认文本必须使用英文(符合触摸屏系统的设计规范)
- 使用 `data-i18n` 属性,而不是 `data-translate`
- 翻译键名遵循驼峰命名规范,便于维护
- 不影响日历的任何交互功能和事件绑定

## 修复日期
2026-01-14
