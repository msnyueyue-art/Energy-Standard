<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†å² - å‚¨èƒ½æŸœç®¡ç†ç³»ç»Ÿ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="common-header-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0a0e1a;
            height: 100vh;
            overflow: hidden;
            color: #fff;
            display: flex;
            flex-direction: column;
        }

        /* ç§‘æŠ€é£èƒŒæ™¯ç½‘æ ¼ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 150, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 150, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        /* åŠ¨æ€å…‰æ•ˆèƒŒæ™¯ */
        .bg-effects {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            z-index: 0;
        }

        .bg-effects::after {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 150, 255, 0.15) 0%, transparent 50%);
            animation: rotate 20s linear infinite;
            top: -50%;
            left: -50%;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* å¤´éƒ¨å¯¼èˆª */
        .header {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 30px;
            border-bottom: 1px solid rgba(0, 150, 255, 0.3);
            position: relative;
            z-index: 100;
            gap: 40px;
            flex-wrap: nowrap;
            min-width: 0;
        }

        /* LogoåŒºåŸŸ */
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: none;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 600;
            background: linear-gradient(90deg, #0096ff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* å¯¼èˆªèœå• */
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            justify-content: center;
            flex-wrap: nowrap;
            min-width: 0;
        }

        .nav-item {
            padding: 12px 28px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 17px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 8px;
            white-space: nowrap;
            display: inline-block;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00d4ff, transparent);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-item:hover {
            color: #00d4ff;
            background: rgba(0, 150, 255, 0.1);
        }

        .nav-item:hover::before {
            width: 80%;
        }

        .nav-item.active {
            color: #00d4ff;
            background: rgba(0, 150, 255, 0.15);
        }

        .nav-item.active::before {
            width: 80%;
            background: #00d4ff;
            box-shadow: 0 0 10px #00d4ff;
        }

        /* å¤´éƒ¨å³ä¾§ */
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* æ—¶é—´æ˜¾ç¤º */
        .header-time {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            font-family: 'SF Mono', monospace;
            letter-spacing: 1px;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0 20px 20px 20px;
            position: relative;
            z-index: 10;
            /* ç¡®ä¿æ»šåŠ¨å¹³æ»‘ */
            scroll-behavior: smooth;
            /* å…è®¸è§¦æ‘¸æ»šåŠ¨ */
            -webkit-overflow-scrolling: touch;
            /* ç¡®ä¿æœ‰å›ºå®šé«˜åº¦ */
            height: calc(100vh - 60px);
            max-height: calc(100vh - 60px);
        }
        
        .main-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: rgba(0, 150, 255, 0.3);
            border-radius: 4px;
        }
        
        .main-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 150, 255, 0.5);
        }

        .page-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 30px;
            background: linear-gradient(to right, #00d4ff, #0096ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        .content-card {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.8));
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .placeholder-icon {
            font-size: 80px;
            color: rgba(0, 150, 255, 0.5);
            margin-bottom: 20px;
        }

        .placeholder-text {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            line-height: 1.5;
        }

        .placeholder-subtext {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 10px;
            text-align: center;
        }

        /* å›¾è¡¨å®¹å™¨ */
        .charts-container {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(0, 150, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: 600px;
            width: 100%;
            margin: 10px 0;
        }
        
        .chart-container:first-child {
            margin-top: 20px;
        }
        
        .chart-container:last-child {
            margin-bottom: 20px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .chart-title {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
        }

        .chart-wrapper {
            flex: 1;
            position: relative;
            min-height: 500px;
        }

        .form-input {
            background: rgba(15, 25, 42, 0.8);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            font-size: 13px;
            outline: none;
            transition: all 0.3s;
        }

        .form-input:focus {
            border-color: #00d4ff;
            background: rgba(15, 25, 42, 0.95);
        }
        /* éšè—åŸç”Ÿæ—¥æœŸé€‰æ‹©å™¨ */
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="month"]::-webkit-calendar-picker-indicator {
            display: none;
        }
        
        /* è‡ªå®šä¹‰æ—¥æœŸè¾“å…¥æ¡†æ ·å¼ */
        .custom-date-input {
            position: relative;
            display: inline-block;
        }
        
        .custom-date-input input {
            background: rgba(15, 25, 42, 0.8);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.9);
            padding: 12px 45px 12px 16px;
            font-size: 24px;
            font-weight: 600;
            width: 220px;
            height: 55px;
            cursor: pointer;
        }
        
        .custom-date-input .calendar-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 24px;
        }
        
        .custom-date-input .calendar-icon:hover {
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å¼¹çª— */
        .custom-calendar-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 25, 42, 0.98);
            border: 2px solid rgba(0, 150, 255, 0.4);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.8);
            z-index: 10000;
            min-width: 450px;
            backdrop-filter: blur(10px);
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        .custom-calendar-popup.show {
            display: block;
        }
        
        /* é®ç½©å±‚ */
        .calendar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        .calendar-overlay.show {
            display: block;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 150, 255, 0.2);
        }
        
        .calendar-nav-btn {
            width: 50px;
            height: 50px;
            background: rgba(0, 150, 255, 0.2);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .calendar-nav-btn:hover {
            background: rgba(0, 150, 255, 0.3);
            border-color: rgba(0, 150, 255, 0.5);
        }
        
        .calendar-month-year {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .calendar-month-year select {
            background: rgba(15, 25, 42, 0.8);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            font-size: 16px;
            height: 45px;
            cursor: pointer;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .calendar-weekday {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
            font-weight: 600;
            padding: 10px 0;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day {
            width: 55px;
            height: 55px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 150, 255, 0.2);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 20px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            touch-action: manipulation;
            pointer-events: auto;
            position: relative;
            z-index: 1;
        }
        
        .calendar-day:hover {
            background: rgba(0, 150, 255, 0.2);
            border-color: rgba(0, 150, 255, 0.4);
            color: white;
        }
        
        .calendar-day.other-month {
            color: rgba(255, 255, 255, 0.3);
        }
        
        .calendar-day.selected {
            background: linear-gradient(135deg, #0096ff, #00d4ff);
            border-color: #00d4ff;
            color: white;
            font-weight: 600;
        }
        
        .calendar-day.today {
            border-color: #00d4ff;
            position: relative;
        }
        
        .calendar-day.today::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 4px;
            height: 4px;
            background: #00d4ff;
            border-radius: 50%;
        }
        
        .calendar-footer {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 150, 255, 0.2);
        }
        
        .calendar-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            min-width: 100px;
        }
        
        .calendar-btn.primary {
            background: linear-gradient(135deg, #0096ff, #00d4ff);
            color: white;
        }
        
        .calendar-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 150, 255, 0.4);
        }
        
        .calendar-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .calendar-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* æ‚¬æµ®æ»šåŠ¨æŒ‰é’® */
        .floating-scroll-buttons {
            position: fixed;
            right: 15px;
            bottom: 50%;
            transform: translateY(50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .scroll-btn {
            width: 60px;
            height: 60px;
            background: rgba(0, 150, 255, 0.9);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 150, 255, 0.4);
            transition: all 0.3s ease;
        }

        .scroll-btn:hover {
            background: rgba(0, 150, 255, 1);
            transform: scale(1.1);
            box-shadow: 0 6px 24px rgba(0, 150, 255, 0.6);
        }

        .scroll-btn:active {
            transform: scale(0.95);
        }

        .scroll-btn.up {
            background: linear-gradient(135deg, #00d4ff 0%, #0096ff 100%);
        }

        .scroll-btn.down {
            background: linear-gradient(135deg, #0096ff 0%, #00d4ff 100%);
        }

        .scroll-btn i {
            pointer-events: none;
        }


        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { 
                transform: scale(0.8);
                opacity: 0;
            }
            to { 
                transform: scale(1);
                opacity: 1;
            }
        }





</style>
</head>
<body>
    <!-- èƒŒæ™¯æ•ˆæœ -->
    <div class="bg-effects"></div>

    <!-- æ‚¬æµ®æ»šåŠ¨æŒ‰é’® -->
    <div class="floating-scroll-buttons">
        <button class="scroll-btn up" onclick="scrollPage('up')" title="å‘ä¸Šæ»šåŠ¨">
            <i class="fas fa-chevron-up"></i>
        </button>
        <button class="scroll-btn down" onclick="scrollPage('down')" title="å‘ä¸‹æ»šåŠ¨">
            <i class="fas fa-chevron-down"></i>
        </button>
    </div>

    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <div class="logo-icon">
                    <img src="logo.png" alt="Logo">
                </div>
                <div class="logo-text">å‚¨èƒ½æŸœç®¡ç†ç³»ç»Ÿ</div>
            </div>
        </div>
        
        <!-- å¯¼èˆªèœå• -->
        <nav class="nav-menu">
            <div class="nav-item" onclick="switchPage('home')">é¦–é¡µ</div>
            <a href="#data" class="nav-item" onclick="switchPage('data')">æ•°æ®</a>
            <a href="#" class="nav-item active" onclick="switchPage('history')">å†å²</a>
            <a href="#control" class="nav-item" onclick="switchPage('control')">æ§åˆ¶</a>
            <a href="#alarm" class="nav-item" onclick="switchPage('alarm')">å‘Šè­¦</a>
            <a href="#log" class="nav-item" onclick="switchPage('log')">æ—¥å¿—</a>
            <a href="#settings" class="nav-item" onclick="switchPage('settings')">è®¾ç½®</a>
        </nav>
        
        <div class="header-right">
            <div class="header-time" id="headerTime">2025-08-06 10:30:00</div>
            
            <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
            <div class="lang-switcher">
                <button class="lang-btn" onclick="toggleLanguageDropdown(event)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                </button>
                <div class="lang-dropdown" id="langDropdown">
                    <div class="lang-option" onclick="changeLanguage('zh', event)">
                        <span class="flag">ğŸ‡¨ğŸ‡³</span>
                        <span>ä¸­æ–‡</span>
                    </div>
                    <div class="lang-option" onclick="changeLanguage('en', event)">
                        <span class="flag">ğŸ‡ºğŸ‡¸</span>
                        <span>English</span>
                    </div>
                </div>
            </div>
            
            <!-- é€€å‡ºæŒ‰é’® -->
            <button class="logout-btn" onclick="logout()" title="é€€å‡ºç™»å½•">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
        <div class="charts-container">
            <!-- åŠŸç‡ä¸SOCç»¼åˆåˆ†æ -->
            <div class="chart-container">
                <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="chart-title" style="font-size: 14px; font-weight: 600; color: rgba(255, 255, 255, 0.9); display: flex; align-items: center; gap: 6px;">
                        <span style="width: 3px; height: 14px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                        åŠŸç‡è¶‹åŠ¿åˆ†æ
                    </div>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <label style="font-size: 16px; color: rgba(255, 255, 255, 0.7); font-weight: 500;">é€‰æ‹©æ—¥æœŸ:</label>
                        <div class="custom-date-input">
                            <input type="text" id="historyEndDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('historyEndDatePicker')">
                            <span class="calendar-icon" onclick="showCustomCalendar('historyEndDatePicker')" style="font-size: 24px;">ğŸ“…</span>
                        </div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="powerSocChart"></canvas>
                </div>
            </div>

            <!-- æ”¶ç›Šåˆ†æ -->
            <div class="chart-container">
                <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="chart-title" style="font-size: 14px; font-weight: 600; color: rgba(255, 255, 255, 0.9); display: flex; align-items: center; gap: 6px;">
                        <span style="width: 3px; height: 14px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                        æ”¶ç›Šåˆ†æ
                    </div>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <select id="revenueTimeType" class="form-input" style="width: 120px; height: 32px; padding: 4px 8px; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 6px; color: rgba(255, 255, 255, 0.9);" onchange="updateRevenueAnalysisChart()">
                            <option value="day" selected>æ—¥</option>
                            <option value="month">æœˆ</option>
                            <option value="year">å¹´</option>
                            <option value="total">åˆè®¡</option>
                        </select>
                        <div class="custom-date-input" id="revenueDatePickerWrapper" style="display: inline-block;">
                            <input type="text" id="revenueDatePicker" readonly style="width: 140px; height: 32px; padding: 4px 32px 4px 8px; font-size: 13px; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 6px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('revenueDatePicker')">
                            <span class="calendar-icon" onclick="showCustomCalendar('revenueDatePicker')">ğŸ“…</span>
                        </div>
                        <input type="month" id="revenueMonthPicker" class="form-input" style="width: 140px; height: 32px; padding: 4px 8px; display: none; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 6px; color: rgba(255, 255, 255, 0.9);" onchange="updateRevenueAnalysisChart()">
                        <select id="revenueYearPicker" class="form-input" style="width: 140px; height: 32px; padding: 4px 8px; display: none; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 6px; color: rgba(255, 255, 255, 0.9);" onchange="updateRevenueAnalysisChart()">
                            <option value="2023">2023å¹´</option>
                            <option value="2024">2024å¹´</option>
                            <option value="2025" selected>2025å¹´</option>
                        </select>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="revenueAnalysisChart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <script>
        // æ»šåŠ¨é¡µé¢åŠŸèƒ½ - å‚è€ƒæ•°æ®é¡µé¢çš„å®ç°
        function scrollPage(direction) {
            const scrollAmount = 300; // æ¯æ¬¡æ»šåŠ¨300åƒç´ 
            
            // ä¼˜å…ˆæŸ¥æ‰¾ä¸»å†…å®¹åŒºåŸŸ
            const mainContent = document.querySelector('.main-content');
            
            if (mainContent && mainContent.scrollHeight > mainContent.clientHeight) {
                // å¦‚æœä¸»å†…å®¹åŒºåŸŸå¯ä»¥æ»šåŠ¨ï¼Œæ»šåŠ¨å®ƒ
                if (direction === 'up') {
                    mainContent.scrollBy({
                        top: -scrollAmount,
                        behavior: 'smooth'
                    });
                } else if (direction === 'down') {
                    mainContent.scrollBy({
                        top: scrollAmount,
                        behavior: 'smooth'
                    });
                }
            } else {
                // å¦‚æœä¸»å†…å®¹ä¸èƒ½æ»šåŠ¨ï¼Œå°è¯•æ»šåŠ¨æ•´ä¸ªçª—å£
                if (direction === 'up') {
                    window.scrollBy({
                        top: -scrollAmount,
                        behavior: 'smooth'
                    });
                } else if (direction === 'down') {
                    window.scrollBy({
                        top: scrollAmount,
                        behavior: 'smooth'
                    });
                }
            }
        }
        
        // ç¡®ä¿å‡½æ•°åœ¨å…¨å±€ä½œç”¨åŸŸå¯ç”¨
        window.scrollPage = scrollPage;
        
        // æ·»åŠ é¼ æ ‡æ»šè½®æ”¯æŒ
        function enableMouseWheelScroll() {
            // ç¡®ä¿ä¸»å†…å®¹åŒºåŸŸæ”¯æŒæ»šåŠ¨
            const mainContent = document.querySelector('.main-content');
            if (mainContent) {
                // ç¡®ä¿overflowè®¾ç½®æ­£ç¡®
                mainContent.style.overflowY = 'auto';
                // æµè§ˆå™¨ä¼šè‡ªåŠ¨å¤„ç†é¼ æ ‡æ»šè½®å’Œè§¦æ‘¸æ»‘åŠ¨
            }
        }

        // åˆ‡æ¢è¯­è¨€ä¸‹æ‹‰èœå•
        function toggleLanguageDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('langDropdown');
            dropdown.classList.toggle('show');
        }

        // é€‰æ‹©è¯­è¨€
        function changeLanguage(lang, event) {
            event.stopPropagation();
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.lang-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.lang-option').classList.add('active');
            
            // ä¿å­˜è¯­è¨€è®¾ç½®
            localStorage.setItem('touchscreen_lang', lang);
            
            // å…³é—­ä¸‹æ‹‰èœå•
            document.getElementById('langDropdown').classList.remove('show');
            
            console.log('åˆ‡æ¢è¯­è¨€åˆ°:', lang);
        }

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
        document.addEventListener('click', function(e) {
            const langSwitcher = document.querySelector('.lang-switcher');
            if (langSwitcher && !langSwitcher.contains(e.target)) {
                document.getElementById('langDropdown').classList.remove('show');
            }
        });

        // åˆ‡æ¢é¡µé¢
        function switchPage(page) {
            if (page === 'home') {
                window.location.href = 'home.html';
            } else if (page === 'data') {
                window.location.href = 'data.html';
            } else if (page === 'control') {
                window.location.href = 'control.html';
            } else if (page === 'alarm') {
                window.location.href = 'alarm.html';
            } else if (page === 'history') {
                // å½“å‰é¡µé¢ï¼Œä¸è·³è½¬
                return;
            } else if (page === 'log') {
                window.location.href = 'logs.html';
            } else if (page === 'settings') {
                window.location.href = 'settings.html';
            }
        }

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('headerTime').textContent = timeString;
        }

        // ç¦ç”¨Chart.jsåŠ¨ç”»
        if (typeof Chart !== 'undefined') {
            Chart.defaults.animation = false;
            Chart.defaults.animations.active = false;
            Chart.defaults.animations.resize = false;
            Chart.defaults.transitions.active.animation.duration = 0;
            Chart.defaults.transitions.resize.animation.duration = 0;
            Chart.defaults.transitions.show.animations = false;
            Chart.defaults.transitions.hide.animations = false;
            
            // è¦†ç›–Chartæ„é€ å‡½æ•°ä»¥å¼ºåˆ¶ç¦ç”¨åŠ¨ç”»
            const RealChart = Chart;
            window.Chart = function(ctx, config) {
                if (!config.options) config.options = {};
                if (!config.options.animation) config.options.animation = {};
                if (!config.options.animations) config.options.animations = {};
                
                config.options.animation = false;
                config.options.animations = false;
                config.options.responsive = true;
                config.options.maintainAspectRatio = false;
                
                // ç¡®ä¿æ‰€æœ‰æ•°æ®é›†éƒ½æ²¡æœ‰åŠ¨ç”»
                if (config.data && config.data.datasets) {
                    config.data.datasets.forEach(dataset => {
                        dataset.animation = false;
                    });
                }
                
                const chart = new RealChart(ctx, config);
                
                // è¦†ç›–updateæ–¹æ³•ä»¥ç¦ç”¨åŠ¨ç”»
                const originalUpdate = chart.update.bind(chart);
                chart.update = function(mode) {
                    return originalUpdate('none');
                };
                
                return chart;
            };
            
            // ä¿ç•™å…¶ä»–Chartå±æ€§
            Object.keys(RealChart).forEach(key => {
                if (!window.Chart[key]) {
                    window.Chart[key] = RealChart[key];
                }
            });
        }

        // ç”Ÿæˆå†å²æ•°æ®
        function generateHistoryDailyData(timeRange, endDate) {
            const labels = [];
            const powerData = [];
            const socData = [];
            
            // ç”Ÿæˆ24å°æ—¶çš„æ—¶é—´ç‚¹æ•°æ®
            for (let hour = 0; hour < 24; hour++) {
                labels.push(`${hour.toString().padStart(2, '0')}:00`);
                
                // æ¨¡æ‹ŸåŠŸç‡æ•°æ® (-50 åˆ° 50 kW)ï¼Œæ ¹æ®æ—¶é—´æ®µè°ƒæ•´
                let basePower = 0;
                if (hour >= 8 && hour <= 18) {
                    // ç™½å¤©æ”¾ç”µ
                    basePower = -20 - Math.random() * 30;
                } else if (hour >= 23 || hour <= 6) {
                    // å¤œé—´å……ç”µ
                    basePower = 15 + Math.random() * 25;
                } else {
                    // è¿‡æ¸¡æ—¶æ®µ
                    basePower = (Math.random() - 0.5) * 20;
                }
                powerData.push(basePower);
                
                // æ¨¡æ‹ŸSOCæ•°æ®ï¼Œæ ¹æ®å……æ”¾ç”µè°ƒæ•´
                let socValue;
                if (hour === 0) {
                    socValue = 45;
                } else {
                    const prevSoc = socData[hour - 1] || 45;
                    const powerImpact = powerData[hour - 1] / 10; // åŠŸç‡å¯¹SOCçš„å½±å“
                    socValue = Math.max(10, Math.min(95, prevSoc + powerImpact + (Math.random() - 0.5) * 2));
                }
                socData.push(socValue);
            }
            
            return { labels, powerData, socData };
        }

        // åˆå§‹åŒ–åŠŸç‡SOCå›¾è¡¨
        function initPowerSocChart() {
            const powerSocCtx = document.getElementById('powerSocChart');
            if (powerSocCtx) {
                const { labels, powerData, socData } = generateHistoryDailyData('30d', new Date().toISOString().split('T')[0]);
                
                // é”€æ¯æ—§å›¾è¡¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                if (window.powerSocChartInstance) {
                    window.powerSocChartInstance.destroy();
                }
                
                const chartConfig = {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'åŠŸç‡ (kW)',
                            data: powerData,
                            borderColor: '#00d4ff',
                            backgroundColor: 'rgba(0, 212, 255, 0.3)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true,
                            yAxisID: 'y',
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }, {
                            label: 'SOC (%)',
                            data: socData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y1',
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: {
                            duration: 0
                        },
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: 'rgba(0, 150, 255, 0.3)',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'åŠŸç‡ (kW)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'SOC (%)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    drawOnChartArea: false
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                };
                
                // åˆ›å»ºå›¾è¡¨å®ä¾‹ï¼ˆåŠ¨ç”»å·²åœ¨æ„é€ å‡½æ•°ä¸­ç¦ç”¨ï¼‰
                window.powerSocChartInstance = new Chart(powerSocCtx.getContext('2d'), chartConfig);
            }
        }

        // æ›´æ–°å†å²å›¾è¡¨
        function updateHistoryChart() {
            const endDate = document.getElementById('historyEndDatePicker').value;
            initPowerSocChart();
        }

        // ç”Ÿæˆæ”¶ç›Šæ•°æ®
        function generateRevenueData(timeType) {
            const labels = [];
            const chargingData = [];
            const dischargingData = [];
            const revenueData = [];
            
            if (timeType === 'day') {
                // ç”Ÿæˆ24å°æ—¶æ•°æ®
                for (let hour = 0; hour < 24; hour++) {
                    labels.push(`${hour.toString().padStart(2, '0')}:00`);
                    
                    // æ¨¡æ‹Ÿå……ç”µé‡ (å¤œé—´å……ç”µå¤š)
                    const charging = hour >= 23 || hour <= 6 ? 20 + Math.random() * 15 : Math.random() * 10;
                    chargingData.push(charging.toFixed(1));
                    
                    // æ¨¡æ‹Ÿæ”¾ç”µé‡ (ç™½å¤©æ”¾ç”µå¤š)
                    const discharging = hour >= 8 && hour <= 18 ? 15 + Math.random() * 20 : Math.random() * 8;
                    dischargingData.push(discharging.toFixed(1));
                    
                    // è®¡ç®—æ”¶ç›Š (å³°è°·ç”µä»·å·®)
                    const revenue = discharging * 1.2 - charging * 0.5;
                    revenueData.push(revenue.toFixed(2));
                }
            } else if (timeType === 'month') {
                // ç”Ÿæˆ30å¤©æ•°æ®
                for (let day = 1; day <= 30; day++) {
                    labels.push(`${day}æ—¥`);
                    
                    const charging = 200 + Math.random() * 100;
                    chargingData.push(charging.toFixed(1));
                    
                    const discharging = 180 + Math.random() * 120;
                    dischargingData.push(discharging.toFixed(1));
                    
                    const revenue = discharging * 1.2 - charging * 0.5;
                    revenueData.push(revenue.toFixed(2));
                }
            } else if (timeType === 'year') {
                // ç”Ÿæˆ12ä¸ªæœˆæ•°æ®
                const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
                months.forEach(month => {
                    labels.push(month);
                    
                    const charging = 6000 + Math.random() * 2000;
                    chargingData.push(charging.toFixed(1));
                    
                    const discharging = 5500 + Math.random() * 2500;
                    dischargingData.push(discharging.toFixed(1));
                    
                    const revenue = discharging * 1.2 - charging * 0.5;
                    revenueData.push(revenue.toFixed(2));
                });
            } else {
                // åˆè®¡æ•°æ®
                labels.push('åˆè®¡');
                chargingData.push(85000);
                dischargingData.push(80000);
                revenueData.push(75000);
            }
            
            return { labels, chargingData, dischargingData, revenueData };
        }

        // åˆå§‹åŒ–æ”¶ç›Šåˆ†æ
        function initRevenueAnalysisChart() {
            const ctx = document.getElementById('revenueAnalysisChart');
            if (!ctx) return;
            
            const timeType = document.getElementById('revenueTimeType')?.value || 'day';
            const { labels, chargingData, dischargingData, revenueData } = generateRevenueData(timeType);
            
            // é”€æ¯æ—§å›¾è¡¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (window.revenueChartInstance) {
                window.revenueChartInstance.destroy();
            }
            
            // åˆ›å»ºæ–°å›¾è¡¨ï¼Œå®Œå…¨ç¦ç”¨åŠ¨ç”»
            const revenueConfig = {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å……ç”µé‡ (kWh)',
                        data: chargingData,
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderColor: '#10b981',
                        borderWidth: 1,
                        yAxisID: 'y'
                    }, {
                        label: 'æ”¾ç”µé‡ (kWh)',
                        data: dischargingData,
                        backgroundColor: 'rgba(239, 68, 68, 0.8)',
                        borderColor: '#ef4444',
                        borderWidth: 1,
                        yAxisID: 'y'
                    }, {
                        label: 'å‡€æ”¶ç›Š (Â¥)',
                        data: revenueData,
                        type: 'line',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderColor: '#f59e0b',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: false,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 0
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(0, 150, 255, 0.3)',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                drawOnChartArea: false,
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'ç”µé‡ (kWh)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'æ”¶ç›Š (Â¥)',
                                color: 'rgba(255, 255, 255, 0.7)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            };
            
            // åˆ›å»ºå›¾è¡¨å®ä¾‹ï¼ˆåŠ¨ç”»å·²åœ¨æ„é€ å‡½æ•°ä¸­ç¦ç”¨ï¼‰
            window.revenueChartInstance = new Chart(ctx.getContext('2d'), revenueConfig);
        }

        // æ›´æ–°æ”¶ç›Šåˆ†æå›¾è¡¨
        function updateRevenueAnalysisChart() {
            const timeType = document.getElementById('revenueTimeType').value;
            const datePickerWrapper = document.getElementById('revenueDatePickerWrapper');
            const datePicker = document.getElementById('revenueDatePicker');
            const monthPicker = document.getElementById('revenueMonthPicker');
            const yearPicker = document.getElementById('revenueYearPicker');
            
            // éšè—æ‰€æœ‰é€‰æ‹©å™¨
            datePickerWrapper.style.display = 'none';
            monthPicker.style.display = 'none';
            yearPicker.style.display = 'none';
            
            // æ ¹æ®æ—¶é—´ç±»å‹æ˜¾ç¤ºå¯¹åº”çš„é€‰æ‹©å™¨å¹¶è®¾ç½®é»˜è®¤å€¼
            const today = new Date();
            switch(timeType) {
                case 'day':
                    datePickerWrapper.style.display = 'inline-block';
                    // è®¾ç½®é»˜è®¤ä¸ºä»Šæ—¥
                    if (!datePicker.value) {
                        datePicker.value = today.toISOString().split('T')[0];
                    }
                    break;
                case 'month':
                    monthPicker.style.display = 'block';
                    // è®¾ç½®é»˜è®¤ä¸ºæœ¬æœˆ
                    if (!monthPicker.value) {
                        const year = today.getFullYear();
                        const month = (today.getMonth() + 1).toString().padStart(2, '0');
                        monthPicker.value = `${year}-${month}`;
                    }
                    break;
                case 'year':
                    yearPicker.style.display = 'block';
                    break;
                case 'total':
                    // åˆè®¡ä¸éœ€è¦é¢å¤–é€‰æ‹©å™¨
                    break;
            }
            
            initRevenueAnalysisChart();
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateTime();
            setInterval(updateTime, 1000);
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            const today = new Date();
            const datePicker = document.getElementById('historyEndDatePicker');
            const revenueDatePicker = document.getElementById('revenueDatePicker');
            const revenueMonthPicker = document.getElementById('revenueMonthPicker');
            
            if (datePicker) {
                datePicker.value = today.toISOString().split('T')[0];
            }
            
            if (revenueDatePicker) {
                revenueDatePicker.value = today.toISOString().split('T')[0];
            }
            
            if (revenueMonthPicker) {
                const year = today.getFullYear();
                const month = (today.getMonth() + 1).toString().padStart(2, '0');
                revenueMonthPicker.value = `${year}-${month}`;
            }
            
            // å»¶è¿Ÿåˆå§‹åŒ–å›¾è¡¨ï¼Œç¡®ä¿DOMå®Œå…¨åŠ è½½
            setTimeout(() => {
                initPowerSocChart();
                initRevenueAnalysisChart();
            }, 100);
            
            // å¯ç”¨é¼ æ ‡æ»šè½®å’Œè§¦æ‘¸æ»šåŠ¨
            enableMouseWheelScroll();
        });
    </script>
    
    <!-- è‡ªå®šä¹‰æ—¥æœŸé€‰æ‹©å¼¹çª— -->
    <div id="customCalendarPopup" class="custom-calendar-popup">
        <div class="calendar-header">
            <button class="calendar-nav-btn" onclick="changeMonth(-1)">â€¹</button>
            <div class="calendar-month-year">
                <select id="calendarMonth" onchange="updateCalendar()">
                    <option value="0">ä¸€æœˆ</option>
                    <option value="1">äºŒæœˆ</option>
                    <option value="2">ä¸‰æœˆ</option>
                    <option value="3">å››æœˆ</option>
                    <option value="4">äº”æœˆ</option>
                    <option value="5">å…­æœˆ</option>
                    <option value="6">ä¸ƒæœˆ</option>
                    <option value="7">å…«æœˆ</option>
                    <option value="8">ä¹æœˆ</option>
                    <option value="9">åæœˆ</option>
                    <option value="10">åä¸€æœˆ</option>
                    <option value="11">åäºŒæœˆ</option>
                </select>
                <select id="calendarYear" onchange="updateCalendar()">
                    <!-- å¹´ä»½é€‰é¡¹å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </select>
            </div>
            <button class="calendar-nav-btn" onclick="changeMonth(1)">â€º</button>
        </div>
        <div class="calendar-weekdays">
            <div class="calendar-weekday">æ—¥</div>
            <div class="calendar-weekday">ä¸€</div>
            <div class="calendar-weekday">äºŒ</div>
            <div class="calendar-weekday">ä¸‰</div>
            <div class="calendar-weekday">å››</div>
            <div class="calendar-weekday">äº”</div>
            <div class="calendar-weekday">å…­</div>
        </div>
        <div class="calendar-days" id="calendarDays">
            <!-- æ—¥æœŸå°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div class="calendar-footer">
            <button class="calendar-btn secondary" onclick="setToday()">ä»Šå¤©</button>
            <button class="calendar-btn secondary" onclick="closeCustomCalendar()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <script>
        // è‡ªå®šä¹‰æ—¥å†ç›¸å…³å˜é‡
        let currentCalendarInput = null;
        let selectedDate = new Date();
        let displayMonth = new Date();
        
        // æ˜¾ç¤ºè‡ªå®šä¹‰æ—¥å†
        function showCustomCalendar(inputId) {
            currentCalendarInput = document.getElementById(inputId);
            const popup = document.getElementById('customCalendarPopup');
            const inputRect = currentCalendarInput.getBoundingClientRect();
            
            // è·å–å½“å‰è¾“å…¥æ¡†çš„å€¼ï¼Œå¦‚æœæœ‰çš„è¯
            const currentValue = currentCalendarInput.value;
            if (currentValue) {
                selectedDate = new Date(currentValue);
                displayMonth = new Date(currentValue);
            } else {
                selectedDate = new Date();
                displayMonth = new Date();
            }
            
            // åˆå§‹åŒ–å¹´ä»½é€‰é¡¹
            const yearSelect = document.getElementById('calendarYear');
            yearSelect.innerHTML = '';
            const currentYear = new Date().getFullYear();
            for (let year = currentYear - 5; year <= currentYear + 5; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'å¹´';
                if (year === displayMonth.getFullYear()) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
            
            // è®¾ç½®æœˆä»½
            document.getElementById('calendarMonth').value = displayMonth.getMonth();
            
            // æ˜¾ç¤ºé®ç½©å±‚
            let overlay = document.getElementById('calendarOverlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'calendarOverlay';
                overlay.className = 'calendar-overlay';
                document.body.appendChild(overlay);
                overlay.onclick = closeCustomCalendar;
            }
            overlay.classList.add('show');
            
            // å±…ä¸­æ˜¾ç¤ºå¼¹çª—
            popup.classList.add('show');
            
            updateCalendar();
        }
        
        // å…³é—­è‡ªå®šä¹‰æ—¥å†
        function closeCustomCalendar() {
            document.getElementById('customCalendarPopup').classList.remove('show');
            const overlay = document.getElementById('calendarOverlay');
            if (overlay) {
                overlay.classList.remove('show');
            }
        }
        
        // æ›´æ–°æ—¥å†æ˜¾ç¤º
        function updateCalendar() {
            const month = parseInt(document.getElementById('calendarMonth').value);
            const year = parseInt(document.getElementById('calendarYear').value);
            displayMonth = new Date(year, month, 1);
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            
            const daysContainer = document.getElementById('calendarDays');
            daysContainer.innerHTML = '';
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // æ·»åŠ ä¸Šæœˆçš„æ—¥æœŸ
            const firstDayOfWeek = firstDay.getDay();
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = prevLastDay.getDate() - i;
                const dayDiv = createDayElement(day, true, new Date(year, month - 1, day));
                daysContainer.appendChild(dayDiv);
            }
            
            // æ·»åŠ æœ¬æœˆçš„æ—¥æœŸ
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const currentDate = new Date(year, month, day);
                const dayDiv = createDayElement(day, false, currentDate);
                
                // æ ‡è®°ä»Šå¤©
                if (currentDate.getTime() === today.getTime()) {
                    dayDiv.classList.add('today');
                }
                
                // æ ‡è®°é€‰ä¸­çš„æ—¥æœŸ
                if (selectedDate && 
                    currentDate.getDate() === selectedDate.getDate() &&
                    currentDate.getMonth() === selectedDate.getMonth() &&
                    currentDate.getFullYear() === selectedDate.getFullYear()) {
                    dayDiv.classList.add('selected');
                }
                
                daysContainer.appendChild(dayDiv);
            }
            
            // æ·»åŠ ä¸‹æœˆçš„æ—¥æœŸ
            const remainingDays = 42 - daysContainer.children.length;
            for (let day = 1; day <= remainingDays; day++) {
                const dayDiv = createDayElement(day, true, new Date(year, month + 1, day));
                daysContainer.appendChild(dayDiv);
            }
        }
        
        // åˆ›å»ºæ—¥æœŸå…ƒç´ 
        function createDayElement(day, isOtherMonth, date) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day';
            dayDiv.textContent = day;
            
            if (isOtherMonth) {
                dayDiv.classList.add('other-month');
            }
            
            dayDiv.onclick = function() {
                selectedDate = date;
                confirmDate();
            };
            
            return dayDiv;
        }
        
        // åˆ‡æ¢æœˆä»½
        function changeMonth(direction) {
            const month = parseInt(document.getElementById('calendarMonth').value);
            const year = parseInt(document.getElementById('calendarYear').value);
            
            let newMonth = month + direction;
            let newYear = year;
            
            if (newMonth < 0) {
                newMonth = 11;
                newYear--;
            } else if (newMonth > 11) {
                newMonth = 0;
                newYear++;
            }
            
            document.getElementById('calendarMonth').value = newMonth;
            document.getElementById('calendarYear').value = newYear;
            
            updateCalendar();
        }
        
        // è®¾ç½®ä¸ºä»Šå¤©
        function setToday() {
            selectedDate = new Date();
            displayMonth = new Date();
            document.getElementById('calendarMonth').value = displayMonth.getMonth();
            document.getElementById('calendarYear').value = displayMonth.getFullYear();
            confirmDate();
        }
        
        // ç¡®è®¤é€‰æ‹©
        function confirmDate() {
            if (currentCalendarInput && selectedDate) {
                const year = selectedDate.getFullYear();
                const month = (selectedDate.getMonth() + 1).toString().padStart(2, '0');
                const day = selectedDate.getDate().toString().padStart(2, '0');
                currentCalendarInput.value = `${year}-${month}-${day}`;
                
                // è§¦å‘æ›´æ–°äº‹ä»¶
                if (currentCalendarInput.id === 'historyEndDatePicker') {
                    updateHistoryChart();
                } else if (currentCalendarInput.id === 'revenueDatePicker') {
                    updateRevenueAnalysisChart();
                }
            }
            closeCustomCalendar();
        }
        
        // ç‚¹å‡»å¤–éƒ¨å…³é—­æ—¥å†
        document.addEventListener('click', function(e) {
            const popup = document.getElementById('customCalendarPopup');
            const isClickInside = popup.contains(e.target) || 
                                  e.target.classList.contains('calendar-icon') ||
                                  (currentCalendarInput && currentCalendarInput.contains(e.target));
            
            if (!isClickInside && popup.classList.contains('show')) {
                closeCustomCalendar();
            }
        });
    </script>
    <!-- é€€å‡ºç¡®è®¤å¼¹çª— -->
    <div id="logoutModal" class="logout-modal">
        <div class="logout-content">
            <div class="logout-icon">
                <i class="fas fa-sign-out-alt"></i>
            </div>
            <div class="logout-title" id="logoutTitle">é€€å‡ºç™»å½•</div>
            <div class="logout-message" id="logoutMessage">æ‚¨ç¡®å®šè¦é€€å‡ºå½“å‰è´¦æˆ·å—ï¼Ÿé€€å‡ºåéœ€è¦é‡æ–°ç™»å½•ã€‚</div>
            <div class="logout-buttons">
                <button class="logout-btn-action cancel" id="logoutCancelBtn" onclick="closeLogoutModal()">
                    <i class="fas fa-times"></i> å–æ¶ˆ
                </button>
                <button class="logout-btn-action confirm" id="logoutConfirmBtn" onclick="confirmLogout()">
                    <i class="fas fa-sign-out-alt"></i> é€€å‡º
                </button>
            </div>
        </div>
    </div>
    <script src="common-header-scripts.js"></script>
    <script>
        // é€€å‡ºåŠŸèƒ½ - ç›´æ¥å®šä¹‰åœ¨é¡µé¢ä¸­ç¡®ä¿å¯ç”¨
        if (typeof logout === 'undefined') {
            window.logout = function() {
                console.log('logout function called from inline script');
                const modal = document.getElementById('logoutModal');
                if (modal) {
                    modal.classList.add('show');
                    // æ›´æ–°æ–‡æœ¬
                    const titleEl = document.getElementById('logoutTitle');
                    const messageEl = document.getElementById('logoutMessage');
                    if (titleEl) titleEl.textContent = 'é€€å‡ºç™»å½•';
                    if (messageEl) messageEl.textContent = 'æ‚¨ç¡®å®šè¦é€€å‡ºå½“å‰è´¦æˆ·å—ï¼Ÿé€€å‡ºåéœ€è¦é‡æ–°ç™»å½•ã€‚';
                } else {
                    console.error('logoutModal not found');
                }
            };
        }
        
        if (typeof closeLogoutModal === 'undefined') {
            window.closeLogoutModal = function() {
                const modal = document.getElementById('logoutModal');
                if (modal) {
                    modal.classList.remove('show');
                }
            };
        }
        
        if (typeof confirmLogout === 'undefined') {
            window.confirmLogout = function() {
                // æ¸…é™¤ç™»å½•ä¿¡æ¯
                localStorage.removeItem('touchscreen_user');
                sessionStorage.removeItem('touchscreen_user');
                localStorage.removeItem('login_time');
                // è·³è½¬åˆ°ç™»å½•é¡µ
                window.location.href = 'login.html';
            };
        }
    </script>
</body>
</html>