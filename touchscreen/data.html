<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êï∞ÊçÆÁõëÊéß - ÂÇ®ËÉΩÊüúÁÆ°ÁêÜÁ≥ªÁªü</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="common-header-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #0a0e1a;
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* ÁßëÊäÄÈ£éËÉåÊôØÁΩëÊ†º */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(0, 150, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 150, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        /* Âä®ÊÄÅÂÖâÊïàËÉåÊôØ */
        .bg-effects {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            z-index: 0;
        }

        .bg-effects::after {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 150, 255, 0.15) 0%, transparent 50%);
            animation: rotate 20s linear infinite;
            top: -50%;
            left: -50%;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Â§¥ÈÉ®ÂØºËà™ */
        .header {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 30px;
            border-bottom: 1px solid rgba(0, 150, 255, 0.3);
            position: relative;
            z-index: 100;
            gap: 40px;
            flex-wrap: nowrap;
            min-width: 0;
        }

        /* LogoÂå∫Âüü */
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: none;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 600;
            background: linear-gradient(90deg, #0096ff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ÂØºËà™ËèúÂçï */
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            justify-content: center;
            flex-wrap: nowrap;
            min-width: 0;
        }

        .nav-item {
            padding: 12px 28px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 17px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 8px;
            white-space: nowrap;
            display: inline-block;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00d4ff, transparent);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-item:hover {
            color: #00d4ff;
            background: rgba(0, 150, 255, 0.1);
        }

        .nav-item:hover::before {
            width: 80%;
        }

        .nav-item.active {
            color: #00d4ff;
            background: rgba(0, 150, 255, 0.15);
        }

        .nav-item.active::before {
            width: 80%;
            background: #00d4ff;
            box-shadow: 0 0 10px #00d4ff;
        }

        /* Â§¥ÈÉ®Âè≥‰æß */
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Êó∂Èó¥ÊòæÁ§∫ */
        .header-time {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-family: 'SF Mono', monospace;
            letter-spacing: 1px;
        }

        /* ÁßëÊäÄÈ£éÂõæÊ†áÊåâÈíÆ */
        .tech-icon-btn {
            width: 40px;
            height: 40px;
            background: rgba(0, 150, 255, 0.1);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tech-icon-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(0, 150, 255, 0.6) 0%, transparent 70%);
            transition: all 0.3s ease;
            transform: translate(-50%, -50%);
        }

        .tech-icon-btn:hover {
            background: rgba(0, 150, 255, 0.2);
            border-color: rgba(0, 150, 255, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 150, 255, 0.4);
        }

        .tech-icon-btn:hover::before {
            width: 100px;
            height: 100px;
        }

        .tech-icon-btn:active {
            transform: translateY(0);
        }

        /* ÂõæÊ†áÊ†∑Âºè */
        .tech-icon {
            width: 20px;
            height: 20px;
            position: relative;
            z-index: 1;
        }

        /* ËØ≠Ë®ÄÂàáÊç¢ÂõæÊ†á */
        .lang-icon {
            width: 20px;
            height: 20px;
            border: 2px solid #00d4ff;
            border-radius: 50%;
            position: relative;
        }

        .lang-icon::before,
        .lang-icon::after {
            content: '';
            position: absolute;
            border: 1px solid #00d4ff;
            border-radius: 50%;
        }

        .lang-icon::before {
            width: 100%;
            height: 8px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .lang-icon::after {
            width: 8px;
            height: 100%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Êñ∞ÁöÑËØ≠Ë®ÄÂàáÊç¢Âô®Ê†∑Âºè */
        .lang-switcher {
            position: relative;
            margin-left: 15px;
        }
        
        .lang-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
        }
        
        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .lang-btn svg {
            width: 20px;
            height: 20px;
        }
        
        /* ËØ≠Ë®Ä‰∏ãÊãâËèúÂçï - ÁôΩËâ≤Âç°ÁâáÈ£éÊ†º */
        .lang-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: white;
            border-radius: 12px;
            padding: 8px;
            min-width: 140px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .lang-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .lang-option {
            padding: 10px 12px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: #1f2937;
            font-weight: 500;
        }

        .lang-option:hover {
            background: #f3f4f6;
        }

        .lang-option.active {
            background: #e5f3ff;
            color: #2563eb;
        }
        
        .lang-option .flag {
            font-size: 18px;
            line-height: 1;
        }
        
        /* Â∑•ÂÖ∑ÊèêÁ§∫ */
        .tooltip {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .tech-icon-btn:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* ‰∏ªÂÜÖÂÆπÂÆπÂô® */
        .main-container {
            height: calc(100vh - 60px);
            display: flex;
            position: relative;
            z-index: 1;
        }

        /* Â∑¶‰æßÁªÑ‰ª∂ÂàóË°® */
        .component-sidebar {
            width: 220px;
            padding: 20px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-right: 1px solid rgba(0, 150, 255, 0.1);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .component-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
        }

        /* OTAÂçáÁ∫ßÊåâÈíÆ */
        .ota-upgrade-box {
            margin-top: auto;
            margin-bottom: 15px;
        }
        
        .ota-upgrade-btn {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, #0096ff 0%, #00d4ff 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 150, 255, 0.3);
        }
        
        .ota-upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 150, 255, 0.4);
        }
        
        .ota-upgrade-btn:active {
            transform: translateY(0);
        }
        
        .ota-upgrade-btn i {
            font-size: 18px;
        }

        .component-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(0, 150, 255, 0.2);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }

        .component-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 150, 255, 0.15), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .component-item:hover {
            color: rgba(255, 255, 255, 0.95);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(0, 150, 255, 0.4);
            transform: translateX(5px);
        }

        .component-item.active {
            color: #00d4ff;
            background: rgba(0, 150, 255, 0.15);
            border-color: rgba(0, 150, 255, 0.5);
            box-shadow: inset 0 0 20px rgba(0, 150, 255, 0.2);
        }

        .component-item.active::before {
            opacity: 1;
        }

        .component-status {
            margin-left: auto;
            font-size: 14px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-normal {
            color: #00ff88;
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid rgba(0, 255, 136, 0.5);
        }
        
        .status-error {
            color: #ffffff;
            background: #ff4444;
            border: 1px solid #ff6666;
        }
        
        .status-offline {
            color: #ffffff;
            background: rgba(255, 193, 7, 0.9);
            border: 1px solid rgba(255, 193, 7, 1);
        }

        /* Âè≥‰æßÂÜÖÂÆπÂå∫ */
        .content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(10, 14, 26, 0.5);
            overflow: hidden;
        }

        /* ÂÆπÂô® */
        .data-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            width: 100%;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        /* ÂÜÖÂÆπÂå∫Âüü */
        .content-section {
            display: none;
            flex: 1;
            flex-direction: column;
            overflow: hidden;
        }

        .content-section.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        /* Â≠êÊ†áÁ≠æÈ°µ */
        .sub-tabs {
            display: flex;
            gap: 30px;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(0, 150, 255, 0.1);
            flex-shrink: 0;
            position: relative;
        }
        
        /* Êï∞ÊçÆËÆæÁΩÆÊåâÈíÆ */
        .data-settings-btn {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 150, 255, 0.1);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 6px;
            padding: 10px 16px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }
        
        .data-settings-btn:hover {
            background: rgba(0, 150, 255, 0.2);
            color: #00d4ff;
            border-color: rgba(0, 150, 255, 0.5);
        }
        
        /* ËÆæÁΩÆÈù¢Êùø */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(0, 150, 255, 0.3);
            z-index: 1000;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        .settings-panel.show {
            right: 0;
        }
        
        .settings-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 150, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-title {
            font-size: 18px;
            color: #00d4ff;
        }
        
        .settings-close {
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .settings-close:hover {
            background: rgba(255, 0, 0, 0.2);
            color: #ff6b6b;
        }
        
        .settings-content {
            padding: 20px;
        }
        
        .settings-section {
            margin-bottom: 30px;
        }
        
        .settings-section-title {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .field-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(0, 150, 255, 0.1);
            border-radius: 6px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        
        .field-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(0, 150, 255, 0.3);
        }
        
        .field-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .field-toggle {
            position: relative;
            width: 40px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .field-toggle.active {
            background: rgba(0, 150, 255, 0.5);
        }
        
        .field-toggle::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }
        
        .field-toggle.active::after {
            left: 22px;
        }

        /* ËÆæÁΩÆÁ±ªÂûãÈÄâÊã© */
        .settings-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .type-btn {
            flex: 1;
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .type-btn.active {
            background: rgba(0, 150, 255, 0.3);
            color: #00d4ff;
        }

        .sub-tab {
            padding: 10px 5px;
            padding-bottom: 18px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 22px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .sub-tab:hover {
            color: rgba(255, 255, 255, 0.9);
        }

        .sub-tab.active {
            color: #00d4ff;
        }

        .sub-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        /* Â≠êÂÜÖÂÆπÂå∫Âüü */
        .sub-content {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .sub-content.active {
            display: block;
        }
        
        /* Ëá™ÂÆö‰πâÊªöÂä®Êù°Ê†∑Âºè */
        .sub-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .sub-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        .sub-content::-webkit-scrollbar-thumb {
            background: rgba(0, 150, 255, 0.3);
            border-radius: 4px;
        }
        
        .sub-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 150, 255, 0.5);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ÂÆûÊó∂Êï∞ÊçÆÁΩëÊ†º - Âõ∫ÂÆö4ÂàóÂ∏ÉÂ±Ä */
        .realtime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 45px;
            max-width: 1100px;
        }
        
        /* ËäÇÊ†áÈ¢òÂú®ÁΩëÊ†º‰∏≠Ë∑®Ë∂äÊâÄÊúâÂàó */
        .realtime-grid .section-header {
            grid-column: 1 / -1;
        }
        
        /* ÂéÜÂè≤Êï∞ÊçÆÁΩëÊ†º */
        .history-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* ÁîµË°®ËØ¶ÁªÜÊï∞ÊçÆÁΩëÊ†º */
        .meter-detail-grid {
            display: flex;
            flex-direction: column;
            gap: 25px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 12px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .meter-section {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(0, 150, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
        }
        
        .meter-section .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #00d4ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .meter-section .section-title::before {
            content: '‚ö°';
            font-size: 18px;
        }
        
        .meter-params-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .meter-params-grid.energy-stats {
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        }
        
        .meter-param-card {
            background: rgba(0, 150, 255, 0.08);
            border: 1px solid rgba(0, 150, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .meter-param-card:hover {
            background: rgba(0, 150, 255, 0.12);
            border-color: rgba(0, 150, 255, 0.4);
            transform: translateY(-2px);
        }
        
        .meter-param-card .param-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 8px;
        }
        
        .meter-param-card .param-value {
            font-size: 24px;
            font-weight: 600;
            color: #00d4ff;
            margin-bottom: 5px;
        }
        
        .meter-param-card .param-unit {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: normal;
        }
        
        .meter-param-card .param-status {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            display: inline-block;
        }
        
        .meter-param-card .param-status.normal {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .data-card {
            background: rgba(15, 25, 42, 0.6);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 12px;
            padding: 16px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            min-width: 0;
            backdrop-filter: blur(10px);
            width: 260px;
            height: 130px;
            box-sizing: border-box;
        }

        .data-card:hover {
            border-color: rgba(0, 150, 255, 0.5);
            box-shadow: 0 8px 32px rgba(0, 150, 255, 0.15);
            transform: translateY(-3px);
        }

        .data-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #0096ff, #00d4ff);
        }

        .card-title {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .card-icon {
            font-size: 20px;
            opacity: 0.9;
        }

        .card-value {
            font-size: 32px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.2;
        }

        .card-unit {
            font-size: 14px;
            color: rgba(0, 212, 255, 0.8);
            margin-left: 4px;
            font-weight: 500;
        }

        .card-status {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
            margin-top: 4px;
        }

        .card-status.good {
            color: #00ff88;
        }

        .card-status.warning {
            color: #ffdd00;
        }

        .card-status.error {
            color: #ffdd00;
        }

        .card-status.normal {
            color: #00ff88;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 136, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); }
        }
        
        /* ‰∏âÁõ∏ÂèÇÊï∞Âç°ÁâáÊ†∑Âºè */
        .three-phase-card {
            min-height: 150px;
        }
        
        .three-phase-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 12px 0;
        }
        
        .phase-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: rgba(0, 150, 255, 0.05);
            border-radius: 6px;
            border-left: 3px solid rgba(0, 150, 255, 0.4);
        }
        
        .phase-item.total {
            grid-column: 1 / -1;
            background: rgba(0, 212, 255, 0.1);
            border-left-color: rgba(0, 212, 255, 0.6);
        }
        
        .phase-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
        }
        
        .phase-value {
            font-size: 16px;
            color: #ffffff;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* ÂõæË°®ÂÆπÂô® */
        .chart-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(0, 150, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            flex-shrink: 0;
            height: 40px;
        }

        .chart-title {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .chart-wrapper {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chart-wrapper canvas {
            width: 100% !important;
            height: 100% !important;
            max-height: inherit !important;
        }
        
        .chart-wrapper[style*="height: 450px"] canvas {
            height: 450px !important;
            max-height: 450px !important;
        }

        .time-range-selector {
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.05);
            padding: 3px;
            border-radius: 6px;
        }

        .time-btn {
            padding: 6px 12px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .time-btn:hover {
            color: #00d4ff;
        }

        .time-btn.active {
            background: rgba(0, 150, 255, 0.3);
            color: #00d4ff;
        }

        /* Êï∞ÊçÆÂå∫ÂùóÊ†áÈ¢ò */
        .section-header {
            margin-bottom: 5px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 150, 255, 0.1);
        }

        .section-title {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }
        
        .settings-btn {
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 12px;
            color: #374151;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        
        .settings-btn:hover {
            background: #e5e7eb;
            border-color: #d1d5db;
        }
        
        .settings-btn i {
            font-size: 12px;
        }

        /* ÈÅÆÁΩ©Â±Ç */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* ÂìçÂ∫îÂºè - Â∞èÂ±èÂπï3Âàó */
        /* ÈÄÄÂá∫ÊåâÈíÆÊ†∑Âºè */
        .logout-btn {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 18px;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.4);
            transform: scale(1.05);
            color: #ef4444;
        }

        @media (max-width: 1200px) {
            .realtime-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .confirm-icon i {
            font-size: 36px;
            color: #ef4444;
        }




/* ÂìçÂ∫îÂºè - Êõ¥Â∞èÂ±èÂπï2Âàó */
        @media (max-width: 768px) {
            .data-container {
                padding: 15px;
            }

            .realtime-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ÂìçÂ∫îÂºè - ÊâãÊú∫1Âàó */
        @media (max-width: 480px) {
            .realtime-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ÊÇ¨ÊµÆÊªöÂä®ÊåâÈíÆ */
        .floating-scroll-buttons {
            position: fixed;
            right: 15px;
            bottom: 50%;
            transform: translateY(50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .scroll-btn {
            width: 60px;
            height: 60px;
            background: rgba(0, 150, 255, 0.9);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 150, 255, 0.4);
            transition: all 0.3s ease;
        }

        .scroll-btn:hover {
            background: rgba(0, 150, 255, 1);
            transform: scale(1.1);
            box-shadow: 0 6px 24px rgba(0, 150, 255, 0.6);
        }

        .scroll-btn:active {
            transform: scale(0.95);
        }

        .scroll-btn.up {
            background: linear-gradient(135deg, #00d4ff 0%, #0096ff 100%);
        }

        .scroll-btn.down {
            background: linear-gradient(135deg, #0096ff 0%, #00d4ff 100%);
        }

        .scroll-btn i {
            pointer-events: none;
        }
        
        /* ÈöêËóèÂéüÁîüÊó•ÊúüÈÄâÊã©Âô® */
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="month"]::-webkit-calendar-picker-indicator {
            display: none;
        }
        
        /* Ëá™ÂÆö‰πâÊó•ÊúüËæìÂÖ•Ê°ÜÊ†∑Âºè */
        .custom-date-input {
            position: relative;
            display: inline-block;
        }
        
        .custom-date-input input {
            background: rgba(15, 25, 42, 0.8);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.9);
            padding: 4px 32px 4px 8px;
            font-size: 13px;
            width: 140px;
            height: 32px;
            cursor: pointer;
        }
        
        .custom-date-input .calendar-icon {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 16px;
        }
        
        .custom-date-input .calendar-icon:hover {
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* Ëá™ÂÆö‰πâÊó•ÊúüÈÄâÊã©ÂºπÁ™ó */
        .custom-calendar-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 25, 42, 0.98);
            border: 2px solid rgba(0, 150, 255, 0.4);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.8);
            z-index: 10000;
            min-width: 450px;
            backdrop-filter: blur(10px);
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        .custom-calendar-popup.show {
            display: block;
        }
        
        /* ÈÅÆÁΩ©Â±Ç */
        .calendar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        .calendar-overlay.show {
            display: block;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 150, 255, 0.2);
        }
        
        .calendar-nav-btn {
            width: 60px;
            height: 60px;
            background: rgba(0, 150, 255, 0.2);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            touch-action: manipulation;
        }
        
        .calendar-nav-btn:hover {
            background: rgba(0, 150, 255, 0.3);
            border-color: rgba(0, 150, 255, 0.5);
        }
        
        .calendar-month-year {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .calendar-month-year select {
            background: rgba(15, 25, 42, 0.8);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            font-size: 16px;
            height: 45px;
            cursor: pointer;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .calendar-weekday {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
            font-weight: 600;
            padding: 10px 0;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day {
            width: 55px;
            height: 55px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 150, 255, 0.2);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 20px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            touch-action: manipulation;
            pointer-events: auto;
            position: relative;
            z-index: 1;
        }
        
        .calendar-day:hover {
            background: rgba(0, 150, 255, 0.2);
            border-color: rgba(0, 150, 255, 0.4);
            color: white;
        }
        
        .calendar-day.other-month {
            color: rgba(255, 255, 255, 0.3);
        }
        
        .calendar-day.selected {
            background: linear-gradient(135deg, #0096ff, #00d4ff);
            border-color: #00d4ff;
            color: white;
            font-weight: 600;
        }
        
        .calendar-day.today {
            border-color: #00d4ff;
            position: relative;
        }
        
        .calendar-day.today::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 4px;
            height: 4px;
            background: #00d4ff;
            border-radius: 50%;
        }
        
        .calendar-footer {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 150, 255, 0.2);
        }
        
        .calendar-btn {
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            min-width: 120px;
            touch-action: manipulation;
        }
        
        .calendar-btn.primary {
            background: linear-gradient(135deg, #0096ff, #00d4ff);
            color: white;
        }
        
        .calendar-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 150, 255, 0.4);
        }
        
        .calendar-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .calendar-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }



    </style>
</head>
<body>
    <!-- ËÉåÊôØÊïàÊûú -->
    <div class="bg-effects"></div>

    <!-- ÊÇ¨ÊµÆÊªöÂä®ÊåâÈíÆ -->
    <div class="floating-scroll-buttons">
        <button class="scroll-btn up" onclick="scrollPage('up')" title="Âêë‰∏äÊªöÂä®">
            <i class="fas fa-chevron-up"></i>
        </button>
        <button class="scroll-btn down" onclick="scrollPage('down')" title="Âêë‰∏ãÊªöÂä®">
            <i class="fas fa-chevron-down"></i>
        </button>
    </div>

    <!-- Â§¥ÈÉ®ÂØºËà™ -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <div class="logo-icon">
                    <img src="logo.png" alt="Logo">
                </div>
                <div class="logo-text">ÂÇ®ËÉΩÊüúÁÆ°ÁêÜÁ≥ªÁªü</div>
            </div>
        </div>
        
        <!-- ÂØºËà™ËèúÂçï -->
        <nav class="nav-menu">
            <div class="nav-item" onclick="switchPage('home')">È¶ñÈ°µ</div>
            <a href="#data" class="nav-item active" onclick="switchPage('data')">Êï∞ÊçÆ</a>
            <a href="#" class="nav-item" onclick="switchPage('history')">ÂéÜÂè≤</a>
            <a href="#control" class="nav-item" onclick="switchPage('control')">ÊéßÂà∂</a>
            <a href="#alarm" class="nav-item" onclick="switchPage('alarm')">ÂëäË≠¶</a>
            <a href="#log" class="nav-item" onclick="switchPage('log')">Êó•Âøó</a>
            <a href="#settings" class="nav-item" onclick="switchPage('settings')">ËÆæÁΩÆ</a>
        </nav>
        
        <div class="header-right">
            <div class="header-time" id="currentTime">2024-01-31 14:30:00</div>
            
            <!-- ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆ -->
            <div class="lang-switcher">
                <button class="lang-btn" onclick="toggleLanguageDropdown(event)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                </button>
                <div class="lang-dropdown" id="langDropdown">
                    <div class="lang-option" onclick="changeLanguage('zh', event)">
                        <span class="flag">üá®üá≥</span>
                        <span>‰∏≠Êñá</span>
                    </div>
                    <div class="lang-option" onclick="changeLanguage('en', event)">
                        <span class="flag">üá∫üá∏</span>
                        <span>English</span>
                    </div>
                </div>
            </div>
            
            <!-- ÈÄÄÂá∫ÊåâÈíÆ -->
            <button class="logout-btn" onclick="logout()" title="ÈÄÄÂá∫ÁôªÂΩï">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </header>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
    <div class="main-container">
        <!-- Â∑¶‰æßÁªÑ‰ª∂ÂàóË°® -->
        <div class="component-sidebar">
            <!-- Component List - Updated 2025-01-05 -->
            <div class="component-list">
                <div class="component-item active" onclick="switchDataTab('overall')">
                    <span>Êï¥Êú∫</span>
                </div>
                <div class="component-item" onclick="switchDataTab('ems')">
                    <span>EMS</span>
                    <span class="component-status status-normal">Ê≠£Â∏∏</span>
                </div>
                <div class="component-item" onclick="switchDataTab('pcs')">
                    <span>PCS</span>
                    <span class="component-status status-normal" id="pcs-status">Ê≠£Â∏∏</span>
                </div>
                <div class="component-item" onclick="switchDataTab('bms')">
                    <span>BMS</span>
                    <span class="component-status status-error" id="bms-status">ÂºÇÂ∏∏</span>
                </div>
                <div class="component-item" onclick="switchDataTab('meter')">
                    <span>ÁîµË°®</span>
                    <span class="component-status status-normal" id="meter-status">Ê≠£Â∏∏</span>
                </div>
                <div class="component-item" onclick="switchDataTab('thermal')">
                    <span>Ê∏©Â∫¶</span>
                    <span class="component-status status-normal" id="thermal-status">Ê≠£Â∏∏</span>
                </div>
                <div class="component-item" onclick="switchDataTab('fire')">
                    <span>Ê∂àÈò≤</span>
                    <span class="component-status status-offline" id="fire-status">Á¶ªÁ∫ø</span>
                </div>
            </div>
            
            <!-- OTAÂçáÁ∫ßÊåâÈíÆ -->
            <div class="ota-upgrade-box">
                <button class="ota-upgrade-btn" onclick="showOTAUpgrade()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>OTAÂçáÁ∫ß</span>
                </button>
            </div>
        </div>

        <!-- Âè≥‰æßÂÜÖÂÆπÂå∫ -->
        <div class="content-wrapper">
            <div class="data-container">

        <!-- Êï¥Êú∫Ê¶ÇËßà -->
        <div class="content-section active" id="overallSection">
            <!-- Â≠êÊ†áÁ≠æÈ°µ -->
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchSubTab('overall', 'realtime')">ÂÆûÊó∂Êï∞ÊçÆ</button>
                <button class="sub-tab" onclick="switchSubTab('overall', 'history')">ÂéÜÂè≤Êï∞ÊçÆ</button>
                <button class="data-settings-btn" onclick="openSettings('overall')">
                    <span>‚öôÔ∏è</span>
                    <span>Ëá™ÂÆö‰πâ</span>
                </button>
            </div>
            
            <!-- ÂÆûÊó∂Êï∞ÊçÆÂÜÖÂÆπ -->
            <div class="sub-content active" id="overall-realtime">
                <!-- Á≠ñÁï•Ë∞ÉÂ∫¶ÂèÇÊï∞ -->
                <div class="section-header">
                    <h3 class="section-title">Á≠ñÁï•Ë∞ÉÂ∫¶ÂèÇÊï∞</h3>
                </div>
                <div class="realtime-grid" id="overall-Á≠ñÁï•Ë∞ÉÂ∫¶ÂèÇÊï∞">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>

                <!-- Ê†∏ÂøÉËøêË°åÂèÇÊï∞ -->
                <div class="section-header">
                    <h3 class="section-title">Ê†∏ÂøÉËøêË°åÂèÇÊï∞</h3>
                </div>
                <div class="realtime-grid" id="overall-Ê†∏ÂøÉËøêË°åÂèÇÊï∞">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>

                <!-- ËøêË°åÁªüËÆ° -->
                <div class="section-header">
                    <h3 class="section-title">ËøêË°åÁªüËÆ°</h3>
                </div>
                <div class="realtime-grid" id="overall-ËøêË°åÁªüËÆ°">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>

                <!-- ÂÖ∂‰ªñÂèÇÊï∞ -->
                <div class="section-header">
                    <h3 class="section-title">ÂÖ∂‰ªñÂèÇÊï∞</h3>
                </div>
                <div class="realtime-grid" id="overall-ÂÖ∂‰ªñÂèÇÊï∞">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>

            </div>
            
            <!-- ÂéÜÂè≤Êï∞ÊçÆÂÜÖÂÆπ -->
            <div class="sub-content" id="overall-history">
                <div class="history-grid" id="overall-history-charts">
                    <!-- Âä®ÊÄÅÁîüÊàêÂéÜÂè≤Êï∞ÊçÆÂõæË°® -->
                </div>
            </div>
        </div>

        <!-- EMSÊéßÂà∂Âô® -->
        <div class="content-section" id="emsSection">
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchSubTab('ems', 'realtime')">ÂÆûÊó∂Êï∞ÊçÆ</button>
                <button class="sub-tab" onclick="switchSubTab('ems', 'history')">ÂéÜÂè≤Êï∞ÊçÆ</button>
                <button class="data-settings-btn" onclick="openSettings('ems')">
                    <span>‚öôÔ∏è</span>
                    <span>Ëá™ÂÆö‰πâ</span>
                </button>
            </div>
            
            <div class="sub-content active" id="ems-realtime">
                <div class="realtime-grid" id="ems-data">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <div class="sub-content" id="ems-history">
                <div class="history-grid" id="ems-history-charts">
                    <!-- Âä®ÊÄÅÁîüÊàêÂéÜÂè≤Êï∞ÊçÆÂõæË°® -->
                </div>
                <div style="text-align: center; padding: 100px 20px 60px 20px; color: rgba(255, 255, 255, 0.8); font-size: 28px; font-weight: 600;">
                    Êõ¥Â§öÊï∞ÊçÆÂºÄÂèë‰∏≠...
                </div>
            </div>
        </div>

        <!-- PCSÈÄÜÂèòÂô® -->
        <div class="content-section" id="pcsSection">
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchSubTab('pcs', 'realtime')">ÂÆûÊó∂Êï∞ÊçÆ</button>
                <button class="sub-tab" onclick="switchSubTab('pcs', 'history')">ÂéÜÂè≤Êï∞ÊçÆ</button>
                <button class="data-settings-btn" onclick="openSettings('pcs')">
                    <span>‚öôÔ∏è</span>
                    <span>Ëá™ÂÆö‰πâ</span>
                </button>
            </div>
            
            <div class="sub-content active" id="pcs-realtime">
                <div class="realtime-grid" id="pcs-data">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <div class="sub-content" id="pcs-history">
                <div class="history-grid" id="pcs-history-charts">
                    <!-- Âä®ÊÄÅÁîüÊàêÂéÜÂè≤Êï∞ÊçÆÂõæË°® -->
                </div>
            </div>
        </div>

        <!-- ÁîµË°®Á≥ªÁªü -->
        <div class="content-section" id="meterSection">
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchSubTab('meter', 'realtime')">ÂÆûÊó∂Êï∞ÊçÆ</button>
                <button class="sub-tab" onclick="switchSubTab('meter', 'history')">ÂéÜÂè≤Êï∞ÊçÆ</button>
                <button class="data-settings-btn" onclick="openSettings('meter')">
                    <span>‚öôÔ∏è</span>
                    <span>Ëá™ÂÆö‰πâ</span>
                </button>
            </div>
            
            <div class="sub-content active" id="meter-realtime">
                <div class="realtime-grid" id="meter-data">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <div class="sub-content" id="meter-history">
                <div class="history-grid" id="meter-history-charts">
                    <!-- Âä®ÊÄÅÁîüÊàêÂéÜÂè≤Êï∞ÊçÆÂõæË°® -->
                </div>
            </div>
        </div>

        <!-- BMSÁ≥ªÁªü(ÂåÖÂê´BMSÂíåÁîµÊ±†Ê®°ÁªÑ) -->
        <div class="content-section" id="bmsSection">
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchSubTab('bms', 'realtime')">ÂÆûÊó∂Êï∞ÊçÆ</button>
                <button class="sub-tab" onclick="switchSubTab('bms', 'history')">ÂéÜÂè≤Êï∞ÊçÆ</button>
                <button class="data-settings-btn" onclick="openSettings('bms')">
                    <span>‚öôÔ∏è</span>
                    <span>Ëá™ÂÆö‰πâ</span>
                </button>
            </div>
            
            <div class="sub-content active" id="bms-realtime">
                <div class="realtime-grid" id="bms-data">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <div class="sub-content" id="bms-history">
                <div class="history-grid" id="bms-history-charts">
                    <!-- Âä®ÊÄÅÁîüÊàêÂéÜÂè≤Êï∞ÊçÆÂõæË°® -->
                </div>
            </div>
        </div>

        <!-- Ê∏©Â∫¶ -->
        <div class="content-section" id="thermalSection">
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchSubTab('thermal', 'realtime')">ÂÆûÊó∂Êï∞ÊçÆ</button>
                <button class="sub-tab" onclick="switchSubTab('thermal', 'history')">ÂéÜÂè≤Êï∞ÊçÆ</button>
                <button class="data-settings-btn" onclick="openSettings('thermal')">
                    <span>‚öôÔ∏è</span>
                    <span>Ëá™ÂÆö‰πâ</span>
                </button>
            </div>
            
            <div class="sub-content active" id="thermal-realtime">
                <div class="realtime-grid" id="thermal-data">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <div class="sub-content" id="thermal-history">
                <div class="history-grid" id="thermal-history-charts">
                    <!-- Âä®ÊÄÅÁîüÊàêÂéÜÂè≤Êï∞ÊçÆÂõæË°® -->
                </div>
            </div>
        </div>

        <!-- Ê∂àÈò≤ -->
        <div class="content-section" id="fireSection">
            <div class="sub-tabs">
                <button class="sub-tab active" onclick="switchSubTab('fire', 'realtime')">ÂÆûÊó∂Êï∞ÊçÆ</button>
                <button class="sub-tab" onclick="switchSubTab('fire', 'history')">ÂéÜÂè≤Êï∞ÊçÆ</button>
                <button class="data-settings-btn" onclick="openSettings('fire')">
                    <span>‚öôÔ∏è</span>
                    <span>Ëá™ÂÆö‰πâ</span>
                </button>
            </div>
            
            <div class="sub-content active" id="fire-realtime">
                <div class="realtime-grid" id="fire-data">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <div class="sub-content" id="fire-history">
                <div class="history-grid" id="fire-history-charts">
                    <!-- Âä®ÊÄÅÁîüÊàêÂéÜÂè≤Êï∞ÊçÆÂõæË°® -->
                </div>
            </div>
        </div>

            </div>
        </div>
    </div>

    <!-- ÈÅÆÁΩ©Â±Ç -->
    <div class="overlay" id="overlay" onclick="closeSettings()"></div>

    <!-- ËÆæÁΩÆÈù¢Êùø -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h3 class="settings-title">Êï∞ÊçÆÊòæÁ§∫ËÆæÁΩÆ</h3>
            <button class="settings-close" onclick="closeSettings()">‚úï</button>
        </div>
        
        <!-- ËÆæÁΩÆÁ±ªÂûãÈÄâÊã© -->
        <div class="settings-type-selector">
            <button class="type-btn active" id="realtime-type-btn" onclick="switchSettingsType('realtime')">ÂÆûÊó∂Êï∞ÊçÆ</button>
            <button class="type-btn" id="history-type-btn" onclick="switchSettingsType('history')">ÂéÜÂè≤Êï∞ÊçÆ</button>
        </div>
        
        <div class="settings-content" id="settingsContent">
            <!-- Âä®ÊÄÅÁîüÊàêËÆæÁΩÆÂÜÖÂÆπ -->
        </div>
    </div>

    <script>
        // Êï∞ÊçÆÂ≠óÊÆµÈÖçÁΩÆ
        const dataFieldsConfig = {
            overall: {
                realtime: {
                    'Á≠ñÁï•Ë∞ÉÂ∫¶ÂèÇÊï∞': {
                        strategy: { label: 'ÂΩìÂâçÁ≠ñÁï•', unit: '', default: true, value: 'Â≥∞Ë∞∑Â•óÂà©', status: 'Ëá™Âä®ÊâßË°å‰∏≠', statusColor: '#00ff88' },
                        dispatch: { label: 'Ë∞ÉÂ∫¶Êåá‰ª§', unit: '', default: true, value: 'ÂÖÖÁîµ', statusColor: '#00ff88', subValue: 'ÊúÄÂ§ßÂäüÁéáÔºö300kW' },
                        targetSOC: { label: 'ÁõÆÊ†áSOC', unit: '%', default: true, value: '90' },
                        maxPower: { label: 'ÊúÄÂ§ßÂäüÁéá', unit: 'kW', default: true }
                    },
                    'Ê†∏ÂøÉËøêË°åÂèÇÊï∞': {
                        soc: { label: 'SOC', unit: '%', default: true },
                        soh: { label: 'SOH', unit: '%', default: true },
                        temperature: { label: 'Ê∏©Â∫¶', unit: '¬∞C', default: true },
                        power: { label: 'ÂÖÖÊîæÁîµÂäüÁéá', unit: 'kW', default: true },
                        batteryCurrent: { label: 'ÁîµÊ±†ÁîµÊµÅ', unit: 'A', default: true },
                        batteryVoltage: { label: 'ÁîµÊ±†ÁîµÂéã', unit: 'V', default: true }
                    },
                    'ËøêË°åÁªüËÆ°': {
                        todayCharge: { label: '‰ªäÊó•ÂÖÖÁîµÈáè', unit: 'kWh', default: true },
                        todayDischarge: { label: '‰ªäÊó•ÊîæÁîµÈáè', unit: 'kWh', default: true },
                        totalCharge: { label: 'Á¥ØËÆ°ÂÖÖÁîµÈáè', unit: 'MWh', default: true },
                        totalDischarge: { label: 'Á¥ØËÆ°ÊîæÁîµÈáè', unit: 'MWh', default: true }
                    },
                    'ÂÖ∂‰ªñÂèÇÊï∞': {
                        cycles: { label: 'Âæ™ÁéØÊ¨°Êï∞', unit: 'Ê¨°', default: true }
                    },
                },
                history: {
                    'ÂõæË°®ÂàÜÊûê': {
                        powerTrend: { label: 'ÂäüÁéá‰∏éSOCÁªºÂêàÂàÜÊûê', default: true },
                        efficiency: { label: 'Êî∂ÁõäÂàÜÊûê', default: true }
                    }
                }
            },
            // EMSÊéßÂà∂Âô®
            ems: {
                realtime: {
                    'CPUÁä∂ÊÄÅ': {
                        cpuUsage: { label: '‰ΩøÁî®Áéá', unit: '%', default: true },
                        cpuTemp: { label: 'Ê∏©Â∫¶', unit: '¬∞C', default: true }
                    },
                    'ÂÜÖÂ≠òÁä∂ÊÄÅ': {
                        memoryUsage: { label: 'Âç†Áî®Áéá', unit: '%', default: true }
                    },
                    'Á£ÅÁõòÁä∂ÊÄÅ': {
                        diskUsage: { label: 'Á©∫Èó¥‰ΩøÁî®Áéá', unit: '%', default: true }
                    },
                    'ÂºÄÂèëÊùøÊ∏©Â∫¶': {
                        boardTemp: { label: 'ÂΩìÂâçÊ∏©Â∫¶', unit: '¬∞C', default: true }
                    },
                    '4GÁΩëÁªúÁä∂ÊÄÅ': {
                        signalStrength: { label: '‰ø°Âè∑Âº∫Â∫¶', unit: 'dBm', default: true },
                        simStatus: { label: 'SIMÂç°Áä∂ÊÄÅ', unit: '', default: true },
                        networkStatus: { label: 'ÁΩëÁªúÊé•Âè£', unit: '', default: true }
                    },
                    'WiFiÁä∂ÊÄÅ': {
                        wifiSignal: { label: '‰ø°Âè∑Âº∫Â∫¶', unit: 'dBm', default: true },
                        wifiConnection: { label: 'ÁΩëÁªúÊé•Âè£', unit: '', default: true }
                    },
                    'Á≥ªÁªü‰ø°ÊÅØ': {
                        runTime: { label: 'Á≥ªÁªüËøêË°åÊó∂Èïø', unit: '', default: true },
                        systemTime: { label: 'ÂΩìÂâçÁ≥ªÁªüÊó∂Èó¥', unit: '', default: true },
                        hardwareTime: { label: 'ÂΩìÂâçÁ°¨‰ª∂Êó∂Èó¥', unit: '', default: true }
                    }
                },
                history: {
                    'ÊÄßËÉΩÁõëÊéß': {
                        cpuHistory: { label: 'CPU‰ΩøÁî®ÁéáÂéÜÂè≤', default: true },
                        memoryHistory: { label: 'ÂÜÖÂ≠ò‰ΩøÁî®ÁéáÂéÜÂè≤', default: true },
                        temperatureHistory: { label: 'Ê∏©Â∫¶ÂèòÂåñË∂ãÂäø', default: true }
                    },
                    'ÁΩëÁªúÁä∂ÊÄÅ': {
                        networkHistory: { label: 'ÁΩëÁªúËøûÊé•ÂéÜÂè≤', default: true },
                        signalHistory: { label: '‰ø°Âè∑Âº∫Â∫¶ÂèòÂåñ', default: true }
                    },
                    'Á≥ªÁªüÊó•Âøó': {
                        systemLog: { label: 'Á≥ªÁªüËøêË°åÊó•Âøó', default: true },
                        eventLog: { label: 'ÈáçË¶Å‰∫ã‰ª∂ËÆ∞ÂΩï', default: true }
                    }
                }
            },
            // PCSÈÄÜÂèòÂô®
            pcs: {
                realtime: {
                    'PCSÁîµÁΩë‰æßÂèÇÊï∞': {
                        gridVoltage: { label: 'PCSÁîµÁΩë‰æßÁîµÂéã', unit: 'V', default: true, type: 'three-phase' },
                        gridCurrent: { label: 'PCSÁîµÁΩë‰æßÁîµÊµÅ', unit: 'A', default: true, type: 'three-phase' },
                        gridPower: { label: 'PCSÁîµÁΩë‰æßÂäüÁéá', unit: 'kW', default: true, type: 'three-phase-power' }
                    },
                    'PCSÊ∏©Â∫¶': {
                        transformerTemp: { label: 'PCSÊ∏©Â∫¶', unit: '¬∞C', default: true }
                    }
                },
                history: {
                    'ÂõæË°®': {
                        powerConversion: { label: 'ÂäüÁéáËΩ¨Êç¢ÂéÜÂè≤', default: true },
                        voltageCurrent: { label: 'ÁîµÂéãÁîµÊµÅË∂ãÂäø', default: true },
                        efficiency: { label: 'ËΩ¨Êç¢ÊïàÁéáÂàÜÊûê', default: true }
                    }
                }
            },
            // ÁîµË°®Á≥ªÁªü
            meter: {
                realtime: {
                    'ÁîµËÉΩËÆ°Èáè': {
                        totalActivePower: { label: 'ÊÄªÊúâÂäüÂäüÁéá', unit: 'kW', default: true },
                        totalReactivePower: { label: 'ÊÄªÊó†ÂäüÂäüÁéá', unit: 'kVar', default: true },
                        totalApparentPower: { label: 'ÊÄªËßÜÂú®ÂäüÁéá', unit: 'kVA', default: true },
                        frequency: { label: 'È¢ëÁéá', unit: 'Hz', default: true }
                    },
                    'ÁîµÂéãÁîµÊµÅ': {
                        meterVoltage: { label: 'ÁîµË°®ÁîµÂéã', unit: 'V', default: true, type: 'three-phase' },
                        meterCurrent: { label: 'ÁîµË°®ÁîµÊµÅ', unit: 'A', default: true, type: 'three-phase' }
                    },
                    'ÁîµËÉΩÁªüËÆ°': {
                        dailyActiveEnergy: { label: 'Êó•ÊúâÂäüÁîµÈáè', unit: 'kWh', default: true },
                        dailyReactiveEnergy: { label: 'Êó•Êó†ÂäüÁîµÈáè', unit: 'kVarh', default: true },
                        totalActiveEnergy: { label: 'Á¥ØËÆ°ÊúâÂäüÁîµÈáè', unit: 'MWh', default: true },
                        totalReactiveEnergy: { label: 'Á¥ØËÆ°Êó†ÂäüÁîµÈáè', unit: 'MVarh', default: true }
                    }
                },
                history: {
                    'ÂõæË°®': {
                        powerTrend: { label: 'ÂäüÁéáË∂ãÂäøÂàÜÊûê', default: true },
                        energyConsumption: { label: 'ÁîµÈáèÊ∂àËÄóÁªüËÆ°', default: true },
                        voltageQuality: { label: 'ÁîµÂéãË¥®ÈáèÁõëÊµã', default: true },
                        harmonicAnalysis: { label: 'Ë∞êÊ≥¢ÂàÜÊûê', default: true }
                    }
                }
            },
            // BMSÁ≥ªÁªüÔºàÂêàÂπ∂BMSÂíåÁîµÊ±†Ê®°ÁªÑÔºâ
            bms: {
                realtime: {
                    'Ê†∏ÂøÉÊåáÊ†á': {
                        totalVoltage: { label: 'ÁîµÊ±†ÊÄªÁîµÂéã', unit: 'V', default: true },
                        totalCurrent: { label: 'ÁîµÊ±†ÊÄªÁîµÊµÅ', unit: 'A', default: true },
                        batteryPower: { label: 'ÁîµÊ±†ÂäüÁéá', unit: 'kW', default: true },
                        soc: { label: 'SOC', unit: '%', default: true },
                        soh: { label: 'SOH', unit: '%', default: true },
                        pack: { label: 'Pack', unit: '‰∏™', default: true },
                        cycles: { label: 'Âæ™ÁéØÊ¨°Êï∞', unit: 'Ê¨°', default: true }
                    },
                    'ËøêË°åÁªüËÆ°': {
                        dailyCharge: { label: 'Êó•ÂÖÖÁîµÈáè', unit: 'kWh', default: true },
                        dailyDischarge: { label: 'Êó•ÊîæÁîµÈáè', unit: 'kWh', default: true },
                        totalCharge: { label: 'Á¥ØËÆ°ÂÖÖÁîµÈáè', unit: 'MWh', default: true },
                        totalDischarge: { label: 'Á¥ØËÆ°ÊîæÁîµÈáè', unit: 'MWh', default: true }
                    },
                    'PackÁîµÊ±†Á∞á‰ø°ÊÅØ': {
                        pack1: { label: 'Pack1', unit: '', default: true },
                        pack2: { label: 'Pack2', unit: '', default: true },
                        pack3: { label: 'Pack3', unit: '', default: true },
                        pack4: { label: 'Pack4', unit: '', default: true }
                    }
                },
                history: {
                    'ÂõæË°®': {
                        performance: { label: 'ÁîµÊ±†ÊÄßËÉΩË∂ãÂäø', default: true },
                        cycles: { label: 'Âæ™ÁéØÂØøÂëΩÁªüËÆ°', default: true },
                        capacity: { label: 'ÂÆπÈáèË°∞ÂáèÂàÜÊûê', default: true },
                        voltageHistory: { label: 'ÁîµÊ±†ÁîµÂéãÂéÜÂè≤', default: true },
                        socBalance: { label: 'ÁîµÊ±†SOCË∂ãÂäø', default: true },
                        tempDistribution: { label: 'Ê∏©Â∫¶ÂàÜÂ∏ÉÂàÜÊûê', default: true }
                    }
                }
            },
            // Ê∏©ÊéßÁ≥ªÁªü
            thermal: {
                realtime: {
                    'ËøêË°åÁä∂ÊÄÅ': {
                        thermalManagementStatus: { label: 'ÂÇ®ËÉΩÊüúÊ∏©Â∫¶', unit: '¬∞C', default: true },
                        runningMode: { label: 'ËøêË°åÊ®°Âºè', unit: '', default: true },
                        humidity: { label: 'Áõ∏ÂØπÊπøÂ∫¶', unit: '%', default: true }
                    },
                    'Ê†∏ÂøÉÁõëÊéßÂèÇÊï∞': {
                        battMaxTemp: { label: 'ÁîµÊ±†ÂåÖÊúÄÈ´òÊ∏©Â∫¶', unit: '‚ÑÉ', default: true },
                        battMinTemp: { label: 'ÁîµÊ±†ÂåÖÊúÄ‰ΩéÊ∏©Â∫¶', unit: '‚ÑÉ', default: true },
                        battAvgTemp: { label: 'ÁîµÊ±†ÂåÖÂπ≥ÂùáÊ∏©Â∫¶', unit: '‚ÑÉ', default: true },
                        battTempDiff: { label: 'ÁîµÊ±†ÂåÖÊ∏©Â∑Æ', unit: '‚ÑÉ', default: true },
                        inletTemp: { label: 'ËøõÈ£éÊ∏©Â∫¶', unit: '‚ÑÉ', default: true },
                        outletTemp: { label: 'Âá∫È£éÊ∏©Â∫¶', unit: '‚ÑÉ', default: true },
                        coolantTemp: { label: 'ÂÜ∑Âç¥Ê∂≤Ê∏©Â∫¶', unit: '‚ÑÉ', default: true }
                    }
                },
                history: {
                    'ÂõæË°®': {
                        tempDistribution: { label: 'Ê∏©Â∫¶ÂàÜÂ∏ÉÂéÜÂè≤', default: true },
                        coolingSystem: { label: 'ÂÜ∑Âç¥Á≥ªÁªüËøêË°å', default: true },
                        heatMap: { label: 'Ê∏©Â∫¶ÁÉ≠ÂäõÂõæ', default: true }
                    }
                }
            },
            // Ê∂àÈò≤Á≥ªÁªü
            fire: {
                realtime: {
                    'ÁÅ´ÁÅæÊé¢Êµã': {
                        smokeDetector1: { label: 'ÁÉüÊÑüÊé¢ÊµãÂô®', unit: '', default: true },
                        fireAlarmStatus: { label: 'ÁÅ´Ë≠¶Áä∂ÊÄÅ', unit: '', default: true }
                    },
                    'Ê∂àÈò≤ËÅîÂä®': {
                        extinguisherStatus: { label: 'ÁÅ≠ÁÅ´Âô®Áä∂ÊÄÅ', unit: '', default: true },
                        emergencyStop: { label: 'Á¥ßÊÄ•ÂÅúÊú∫', unit: '', default: true },
                        evacuationAlarm: { label: 'Â£∞ÂÖâÊä•Ë≠¶Âô®', unit: '', default: true }
                    }
                },
                history: {
                    'ÂõæË°®': {
                        systemStatus: { label: 'Á≥ªÁªüÁä∂ÊÄÅÂéÜÂè≤', default: true },
                        gasConcentration: { label: 'Ê∞î‰ΩìÊµìÂ∫¶ÁõëÊµã', default: true },
                        alarmHistory: { label: 'ÂëäË≠¶ËÆ∞ÂΩïÂàÜÊûê', default: true }
                    }
                }
            }
        };

        // Â≠òÂÇ®Áî®Êà∑Ëá™ÂÆö‰πâÊòæÁ§∫ËÆæÁΩÆ
        // Ê∏ÖÁêÜÊóßÁöÑlocalStorageÊï∞ÊçÆ
        if (localStorage.getItem('dataFieldSettings')) {
            localStorage.removeItem('dataFieldSettings');
        }
        
        let userFieldSettings = JSON.parse(localStorage.getItem('touchscreenFieldSettings') || '{}');
        
        let currentComponent = '';
        let currentSettingsType = 'realtime';

        // ÊâìÂºÄÂ≠óÊÆµËÆæÁΩÆÂØπËØùÊ°Ü
        function openFieldSettings(component) {
            const config = dataFieldsConfig[component];
            if (!config) return;
            
            // ÂàõÂª∫ËÆæÁΩÆÂØπËØùÊ°Ü
            const dialog = document.createElement('div');
            dialog.className = 'field-settings-dialog';
            dialog.innerHTML = `
                <div class="field-settings-overlay" onclick="closeFieldSettings()"></div>
                <div class="field-settings-content">
                    <div class="field-settings-header">
                        <h3>${translations[currentLanguage].fieldSettings || 'Â≠óÊÆµËÆæÁΩÆ'}</h3>
                        <button class="close-btn" onclick="closeFieldSettings()">√ó</button>
                    </div>
                    <div class="field-settings-body">
                        <div class="settings-tabs">
                            <button class="settings-tab active" onclick="switchSettingsTab('${component}', 'realtime')">
                                ${translations[currentLanguage].realtimeData || 'ÂÆûÊó∂Êï∞ÊçÆ'}
                            </button>
                            ${config.history ? `
                                <button class="settings-tab" onclick="switchSettingsTab('${component}', 'history')">
                                    ${translations[currentLanguage].historyData || 'ÂéÜÂè≤Êï∞ÊçÆ'}
                                </button>
                            ` : ''}
                        </div>
                        <div class="settings-content" id="settingsContent">
                            ${generateFieldSettingsContent(component, 'realtime')}
                        </div>
                    </div>
                    <div class="field-settings-footer">
                        <button class="btn btn-secondary" onclick="closeFieldSettings()">
                            ${translations[currentLanguage].cancel || 'ÂèñÊ∂à'}
                        </button>
                        <button class="btn btn-primary" onclick="saveFieldSettings('${component}')">
                            ${translations[currentLanguage].save || '‰øùÂ≠ò'}
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(dialog);
            
            // Ê∑ªÂä†Ê†∑Âºè
            if (!document.getElementById('fieldSettingsStyles')) {
                const style = document.createElement('style');
                style.id = 'fieldSettingsStyles';
                style.textContent = `
                    .field-settings-dialog {
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        z-index: 10000;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    
                    .field-settings-overlay {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(0, 0, 0, 0.5);
                    }
                    
                    .field-settings-content {
                        position: relative;
                        background: white;
                        border-radius: 8px;
                        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
                        max-width: 600px;
                        width: 90%;
                        max-height: 80vh;
                        display: flex;
                        flex-direction: column;
                    }
                    
                    .field-settings-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 20px;
                        border-bottom: 1px solid #e5e7eb;
                    }
                    
                    .field-settings-header h3 {
                        margin: 0;
                        font-size: 18px;
                        color: #111827;
                    }
                    
                    .close-btn {
                        background: none;
                        border: none;
                        font-size: 24px;
                        color: #6b7280;
                        cursor: pointer;
                        padding: 0;
                        width: 30px;
                        height: 30px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    
                    .close-btn:hover {
                        color: #111827;
                    }
                    
                    .field-settings-body {
                        flex: 1;
                        overflow: hidden;
                        display: flex;
                        flex-direction: column;
                    }
                    
                    .settings-tabs {
                        display: flex;
                        padding: 0 20px;
                        border-bottom: 1px solid #e5e7eb;
                    }
                    
                    .settings-tab {
                        background: none;
                        border: none;
                        padding: 12px 20px;
                        font-size: 14px;
                        color: #6b7280;
                        cursor: pointer;
                        border-bottom: 2px solid transparent;
                        margin-bottom: -1px;
                    }
                    
                    .settings-tab.active {
                        color: #3b82f6;
                        border-bottom-color: #3b82f6;
                    }
                    
                    .settings-content {
                        flex: 1;
                        overflow-y: auto;
                        padding: 20px;
                    }
                    
                    .field-category {
                        margin-bottom: 20px;
                    }
                    
                    .field-category-title {
                        font-size: 14px;
                        font-weight: 600;
                        color: #374151;
                        margin-bottom: 10px;
                    }
                    
                    .field-item {
                        display: flex;
                        align-items: center;
                        padding: 8px 0;
                    }
                    
                    .field-checkbox {
                        margin-right: 10px;
                    }
                    
                    .field-label {
                        font-size: 14px;
                        color: #4b5563;
                    }
                    
                    .field-settings-footer {
                        display: flex;
                        justify-content: flex-end;
                        gap: 10px;
                        padding: 20px;
                        border-top: 1px solid #e5e7eb;
                    }
                    
                    .btn {
                        padding: 8px 16px;
                        border-radius: 4px;
                        font-size: 14px;
                        cursor: pointer;
                        border: none;
                    }
                    
                    .btn-primary {
                        background: #3b82f6;
                        color: white;
                    }
                    
                    .btn-primary:hover {
                        background: #2563eb;
                    }
                    
                    .btn-secondary {
                        background: #e5e7eb;
                        color: #374151;
                    }
                    
                    .btn-secondary:hover {
                        background: #d1d5db;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // ÁîüÊàêÂ≠óÊÆµËÆæÁΩÆÂÜÖÂÆπ
        function generateFieldSettingsContent(component, type) {
            const config = dataFieldsConfig[component][type];
            if (!config) return '';
            
            let html = '';
            
            for (const category in config) {
                html += `<div class="field-category">`;
                html += `<div class="field-category-title">${category}</div>`;
                
                for (const field in config[category]) {
                    const fieldConfig = config[category][field];
                    const isChecked = shouldShowField(component, type, field);
                    
                    html += `
                        <div class="field-item">
                            <input type="checkbox" 
                                   class="field-checkbox" 
                                   id="${component}_${type}_${field}"
                                   ${isChecked ? 'checked' : ''}>
                            <label class="field-label" for="${component}_${type}_${field}">
                                ${fieldConfig.label}
                            </label>
                        </div>
                    `;
                }
                
                html += `</div>`;
            }
            
            return html;
        }
        
        // ÂàáÊç¢ËÆæÁΩÆÊ†áÁ≠æ
        function switchSettingsTab(component, tab) {
            // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
            document.querySelectorAll('.settings-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Êõ¥Êñ∞ÂÜÖÂÆπ
            document.getElementById('settingsContent').innerHTML = generateFieldSettingsContent(component, tab);
        }
        
        // ÂÖ≥Èó≠Â≠óÊÆµËÆæÁΩÆ
        function closeFieldSettings() {
            const dialog = document.querySelector('.field-settings-dialog');
            if (dialog) {
                dialog.remove();
            }
        }
        
        // ‰øùÂ≠òÂ≠óÊÆµËÆæÁΩÆ
        function saveFieldSettings(component) {
            // Ëé∑ÂèñÊâÄÊúâÂ§çÈÄâÊ°ÜÁä∂ÊÄÅ
            const checkboxes = document.querySelectorAll('.field-checkbox');
            
            checkboxes.forEach(checkbox => {
                const [comp, type, field] = checkbox.id.split('_');
                if (comp === component) {
                    // ÂàùÂßãÂåñÂµåÂ•óÁªìÊûÑ
                    if (!userFieldSettings[component]) {
                        userFieldSettings[component] = {};
                    }
                    if (!userFieldSettings[component][type]) {
                        userFieldSettings[component][type] = {};
                    }
                    
                    // ‰øùÂ≠òÁä∂ÊÄÅ
                    userFieldSettings[component][type][field] = checkbox.checked;
                }
            });
            
            // ‰øùÂ≠òÂà∞localStorage
            localStorage.setItem('touchscreenFieldSettings', JSON.stringify(userFieldSettings));
            
            // ÂÖ≥Èó≠ÂØπËØùÊ°Ü
            closeFieldSettings();
            
            // Âà∑Êñ∞ÂΩìÂâçÁªÑ‰ª∂ÊòæÁ§∫
            renderComponentData(component);
            
            // Â¶ÇÊûúÂΩìÂâçÂú®ÂéÜÂè≤Êï∞ÊçÆÊ†áÁ≠æÈ°µÔºåÂà∑Êñ∞ÂéÜÂè≤Êï∞ÊçÆ
            const activeSubTab = document.querySelector(`#${component}Section .sub-tab.active`);
            if (activeSubTab && activeSubTab.textContent.includes('ÂéÜÂè≤Êï∞ÊçÆ')) {
                renderHistoryData(component);
            }
        }
        
        // ÂàùÂßãÂåñÂ≠óÊÆµËÆæÁΩÆ
        function initFieldSettings() {
            let needsSave = false;
            
            for (const component in dataFieldsConfig) {
                if (!userFieldSettings[component]) {
                    userFieldSettings[component] = { realtime: {}, history: {} };
                    needsSave = true;
                }
                
                // ÂàùÂßãÂåñÂÆûÊó∂Êï∞ÊçÆËÆæÁΩÆ
                for (const section in dataFieldsConfig[component].realtime) {
                    for (const field in dataFieldsConfig[component].realtime[section]) {
                        if (userFieldSettings[component].realtime[field] === undefined) {
                            const defaultValue = dataFieldsConfig[component].realtime[section][field].default;
                            userFieldSettings[component].realtime[field] = defaultValue;
                            needsSave = true;
                        }
                    }
                }
                
                // ÂàùÂßãÂåñÂéÜÂè≤Êï∞ÊçÆËÆæÁΩÆ
                if (dataFieldsConfig[component].history) {
                    for (const field in dataFieldsConfig[component].history) {
                        if (userFieldSettings[component].history[field] === undefined) {
                            const defaultValue = dataFieldsConfig[component].history[field].default;
                            userFieldSettings[component].history[field] = defaultValue;
                            needsSave = true;
                        }
                    }
                }
            }
            
            if (needsSave) {
                localStorage.setItem('touchscreenFieldSettings', JSON.stringify(userFieldSettings));
            }
        }

        // ÂàáÊç¢ËÆæÁΩÆÁ±ªÂûã
        function switchSettingsType(type) {
            currentSettingsType = type;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`${type}-type-btn`).classList.add('active');
            
            // ÈáçÊñ∞Ê∏≤ÊüìËÆæÁΩÆÂÜÖÂÆπ
            if (currentComponent) {
                renderSettingsContent(currentComponent);
            }
        }

        // ÊâìÂºÄËÆæÁΩÆÈù¢Êùø
        function openSettings(component) {
            currentComponent = component;
            const activeSubTab = document.querySelector(`#${component}Section .sub-tab.active`);
            const isHistory = activeSubTab && activeSubTab.textContent === 'ÂéÜÂè≤Êï∞ÊçÆ';
            
            // ËÆæÁΩÆÈªòËÆ§Á±ªÂûã
            currentSettingsType = isHistory ? 'history' : 'realtime';
            switchSettingsType(currentSettingsType);
            
            renderSettingsContent(component);
            
            document.getElementById('settingsPanel').classList.add('show');
            document.getElementById('overlay').classList.add('show');
        }

        // Ê∏≤ÊüìËÆæÁΩÆÂÜÖÂÆπ
        function renderSettingsContent(component) {
            const settingsContent = document.getElementById('settingsContent');
            settingsContent.innerHTML = '';

            const config = dataFieldsConfig[component][currentSettingsType];
            if (!config) {
                settingsContent.innerHTML = '<p style="color: rgba(255,255,255,0.5); text-align: center;">ËØ•ÁªÑ‰ª∂ÊöÇÊó†ÂèØÈÖçÁΩÆÈ°π</p>';
                return;
            }
            
            if (currentSettingsType === 'realtime') {
                // ÂÆûÊó∂Êï∞ÊçÆÔºöÊåâsectionÂàÜÁªÑ
                for (const section in config) {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'settings-section';
                    
                    const sectionTitle = document.createElement('div');
                    sectionTitle.className = 'settings-section-title';
                    sectionTitle.textContent = section;
                    sectionDiv.appendChild(sectionTitle);

                    for (const field in config[section]) {
                        const fieldItem = document.createElement('div');
                        fieldItem.className = 'field-item';
                        
                        const label = document.createElement('span');
                        label.className = 'field-label';
                        label.textContent = config[section][field].label;
                        
                        const toggle = document.createElement('div');
                        toggle.className = 'field-toggle';
                        
                        // Ê£ÄÊü•Â≠óÊÆµÁä∂ÊÄÅÔºöÂ¶ÇÊûúÁî®Êà∑ËÆæÁΩÆÂ≠òÂú®Â∞±Áî®Áî®Êà∑ËÆæÁΩÆÔºåÂê¶ÂàôÁî®ÈªòËÆ§ÂÄº
                        let isActive = config[section][field].default; // ÈªòËÆ§ÂÄº
                        if (userFieldSettings[component] && userFieldSettings[component][currentSettingsType] && userFieldSettings[component][currentSettingsType][field] !== undefined) {
                            isActive = userFieldSettings[component][currentSettingsType][field];
                        }
                        
                        if (isActive) {
                            toggle.classList.add('active');
                        }
                        
                        toggle.onclick = () => {
                            toggle.classList.toggle('active');
                            
                            // Á°Æ‰øùÁî®Êà∑ËÆæÁΩÆÂØπË±°Â≠òÂú®
                            if (!userFieldSettings[component]) {
                                userFieldSettings[component] = { realtime: {}, history: {} };
                            }
                            if (!userFieldSettings[component][currentSettingsType]) {
                                userFieldSettings[component][currentSettingsType] = {};
                            }
                            
                            userFieldSettings[component][currentSettingsType][field] = toggle.classList.contains('active');
                            localStorage.setItem('touchscreenFieldSettings', JSON.stringify(userFieldSettings));
                            
                            renderComponentData(component);
                        };
                        
                        fieldItem.appendChild(label);
                        fieldItem.appendChild(toggle);
                        sectionDiv.appendChild(fieldItem);
                    }
                    
                    settingsContent.appendChild(sectionDiv);
                }
            } else {
                // ÂéÜÂè≤Êï∞ÊçÆÔºöÊåâÂàÜÁ±ªÊòæÁ§∫
                for (const category in config) {
                    const sectionDiv = document.createElement('div');
                    sectionDiv.className = 'settings-section';
                    
                    const sectionTitle = document.createElement('div');
                    sectionTitle.className = 'settings-section-title';
                    sectionTitle.textContent = category;
                    sectionDiv.appendChild(sectionTitle);

                    const categoryFields = config[category];
                    for (const field in categoryFields) {
                        const fieldItem = document.createElement('div');
                        fieldItem.className = 'field-item';
                        
                        const label = document.createElement('span');
                        label.className = 'field-label';
                        label.textContent = categoryFields[field].label;
                        
                        const toggle = document.createElement('div');
                        toggle.className = 'field-toggle';
                        
                        // Ê£ÄÊü•Â≠óÊÆµÁä∂ÊÄÅÔºöÂ¶ÇÊûúÁî®Êà∑ËÆæÁΩÆÂ≠òÂú®Â∞±Áî®Áî®Êà∑ËÆæÁΩÆÔºåÂê¶ÂàôÁî®ÈªòËÆ§ÂÄº
                        let isActive = categoryFields[field].default; // ÈªòËÆ§ÂÄº
                        if (userFieldSettings[component] && userFieldSettings[component][currentSettingsType] && userFieldSettings[component][currentSettingsType][field] !== undefined) {
                            isActive = userFieldSettings[component][currentSettingsType][field];
                        }
                        
                        if (isActive) {
                            toggle.classList.add('active');
                        }
                        
                        toggle.onclick = () => {
                            toggle.classList.toggle('active');
                            
                            // Á°Æ‰øùÁî®Êà∑ËÆæÁΩÆÂØπË±°Â≠òÂú®
                            if (!userFieldSettings[component]) {
                                userFieldSettings[component] = { realtime: {}, history: {} };
                            }
                            if (!userFieldSettings[component][currentSettingsType]) {
                                userFieldSettings[component][currentSettingsType] = {};
                            }
                            
                            userFieldSettings[component][currentSettingsType][field] = toggle.classList.contains('active');
                            localStorage.setItem('touchscreenFieldSettings', JSON.stringify(userFieldSettings));
                            
                            renderHistoryData(component);
                        };
                        
                        fieldItem.appendChild(label);
                        fieldItem.appendChild(toggle);
                        sectionDiv.appendChild(fieldItem);
                    }
                    
                    settingsContent.appendChild(sectionDiv);
                }
            }
        }

        // ÂÖ≥Èó≠ËÆæÁΩÆÈù¢Êùø
        function closeSettings() {
            document.getElementById('settingsPanel').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        // Ê∏≤ÊüìÁªÑ‰ª∂Êï∞ÊçÆ
        function renderComponentData(component) {
            console.log(`ÂºÄÂßãÊ∏≤ÊüìÁªÑ‰ª∂: ${component}`);
            const config = dataFieldsConfig[component]?.realtime;
            if (!config) {
                console.log(`No config found for component: ${component}`);
                return;
            }
            console.log(`${component} ÈÖçÁΩÆ:`, config);
            console.log(`Rendering component: ${component}`, config);
            
            // Êï¥Êú∫Ê¶ÇËßà‰ΩøÁî®ÂàÜÂå∫ÂüüÂ∏ÉÂ±Ä
            if (component === 'overall') {
                for (const section in config) {
                    const containerId = `${component}-${section}`;
                    const container = document.getElementById(containerId);
                    
                    if (!container) continue;
                    
                    container.innerHTML = '';
                    
                    for (const field in config[section]) {
                        const fieldConfig = config[section][field];
                        
                        // ÁÆÄÂåñÈÄªËæëÔºöÂ¶ÇÊûúÁî®Êà∑ËÆæÁΩÆÂ≠òÂú®Â∞±Áî®Áî®Êà∑ËÆæÁΩÆÔºåÂê¶ÂàôÁî®ÈªòËÆ§ÂÄº
                        let shouldShow = fieldConfig.default; // ÂÖàËÆæ‰∏∫ÈªòËÆ§ÂÄº
                        if (userFieldSettings[component] && userFieldSettings[component].realtime && userFieldSettings[component].realtime[field] !== undefined) {
                            shouldShow = userFieldSettings[component].realtime[field];
                        }
                        
                        if (shouldShow) {
                            const card = createDataCard(field, fieldConfig);
                            container.appendChild(card);
                        }
                    }
                }
            } else {
                // ÂÖ∂‰ªñÁªÑ‰ª∂‰ΩøÁî®ÁÆÄÂåñÂ∏ÉÂ±Ä
                const containerId = `${component}-data`;
                const container = document.getElementById(containerId);
                
                if (!container) {
                    console.log(`Container not found: ${containerId}`);
                    return;
                }
                
                container.innerHTML = '';
                
                // ÈúÄË¶ÅÊòæÁ§∫ËäÇÊ†áÈ¢òÁöÑÁªÑ‰ª∂
                const componentsWithSections = ['ems', 'pcs', 'bms', 'meter', 'thermal', 'fire'];
                if (componentsWithSections.includes(component)) {
                    let firstSection = true;
                    for (const section in config) {
                        // ÂàõÂª∫ËäÇÊ†áÈ¢òÂíåËÆæÁΩÆÊåâÈíÆ
                        const sectionHeader = document.createElement('div');
                        sectionHeader.className = 'section-header';
                        sectionHeader.style.gridColumn = '1 / -1'; // Ë∑®Ë∂äÊâÄÊúâÂàó
                        sectionHeader.style.display = 'flex';
                        sectionHeader.style.justifyContent = 'space-between';
                        sectionHeader.style.alignItems = 'center';
                        sectionHeader.style.marginBottom = '5px';
                        
                        let headerContent = `<h3 class="section-title" style="margin: 0;">${section}</h3>`;
                        
                        // Âè™Âú®Á¨¨‰∏Ä‰∏™ÂàÜÊÆµÊ∑ªÂä†ËÆæÁΩÆÊåâÈíÆÔºàÊéíÈô§ÁâπÂÆöÁªÑ‰ª∂Ôºâ
                        const excludedComponents = ['ems', 'pcs', 'bms', 'meter', 'thermal', 'fire'];
                        if (firstSection && !excludedComponents.includes(component)) {
                            headerContent += `
                                <button class="settings-btn" onclick="openFieldSettings('${component}')" title="Â≠óÊÆµËÆæÁΩÆ" style="padding: 4px 12px; font-size: 12px;">
                                    <i class="fas fa-cog"></i>
                                    <span>ËÆæÁΩÆ</span>
                                </button>
                            `;
                            firstSection = false;
                        }
                        
                        sectionHeader.innerHTML = headerContent;
                        container.appendChild(sectionHeader);
                        
                        // BMSÁªÑ‰ª∂PackÁîµÊ±†Á∞á‰ø°ÊÅØÁâπÊÆäÂ§ÑÁêÜ - ÊØè‰∏™ÁîµÊ±†Á∞á‰Ωú‰∏∫‰∏Ä‰∏™Âç°Áâá
                        if (component === 'bms' && section === 'PackÁîµÊ±†Á∞á‰ø°ÊÅØ') {
                            const packContainer = createPackBatteryCards(config[section]);
                            packContainer.style.gridColumn = '1 / -1'; // PackÂÆπÂô®Ë∑®Ë∂äÊâÄÊúâÂàó
                            container.appendChild(packContainer);
                        } else {
                            // Áõ¥Êé•Â∞ÜÊï∞ÊçÆÂç°ÁâáÊ∑ªÂä†Âà∞‰∏ªÂÆπÂô®Ôºå‰øùÊåÅÁΩëÊ†ºÂ∏ÉÂ±Ä
                            for (const field in config[section]) {
                                const fieldConfig = config[section][field];
                                
                                let shouldShow = fieldConfig.default;
                                if (userFieldSettings[component] && userFieldSettings[component].realtime && userFieldSettings[component].realtime[field] !== undefined) {
                                    shouldShow = userFieldSettings[component].realtime[field];
                                }
                                
                                if (shouldShow) {
                                    const card = createDataCard(field, fieldConfig);
                                    container.appendChild(card);
                                }
                            }
                        }
                    }
                } else {
                    // ÂÖ∂‰ªñÁªÑ‰ª∂‰∏çÊòæÁ§∫ËäÇÊ†áÈ¢ò - Áõ¥Êé•Â§ÑÁêÜÊâÅÂπ≥ÁªìÊûÑÂ≠óÊÆµ
                    for (const field in config) {
                        const fieldConfig = config[field];
                        
                        let shouldShow = fieldConfig.default;
                        if (userFieldSettings[component] && userFieldSettings[component].realtime && userFieldSettings[component].realtime[field] !== undefined) {
                            shouldShow = userFieldSettings[component].realtime[field];
                        }
                        
                        if (shouldShow) {
                            const card = createDataCard(field, fieldConfig);
                            container.appendChild(card);
                        }
                    }
                }
            }
        }

        // Ê∏≤ÊüìÂéÜÂè≤Êï∞ÊçÆ
        function renderHistoryData(component) {
            const container = document.getElementById(`${component}-history-charts`);
            if (!container) return;
            
            if (component === 'overall') {
                // Êï¥Êú∫ÂéÜÂè≤Êï∞ÊçÆ - Ê†πÊçÆÂ≠óÊÆµËÆæÁΩÆÂä®ÊÄÅÊòæÁ§∫
                let historyHtml = ``;
                
                const config = dataFieldsConfig[component].history;
                
                // ÂäüÁéá‰∏éSOCÁªºÂêàÂàÜÊûê
                if (shouldShowField('overall', 'history', 'powerTrend')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    ÂäüÁéá‰∏éSOCÁªºÂêàÂàÜÊûê
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="historyEndDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('historyEndDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('historyEndDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="powerSocChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // Êî∂ÁõäÂàÜÊûê
                if (shouldShowField('overall', 'history', 'efficiency')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    Êî∂ÁõäÂàÜÊûê
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <select id="revenueTimeType" class="form-input" style="width: 220px; height: 55px; padding: 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9);" onchange="updateRevenueAnalysisChart()">
                                        <option value="day" selected>Êó•</option>
                                        <option value="month">Êúà</option>
                                        <option value="year">Âπ¥</option>
                                        <option value="total">ÂêàËÆ°</option>
                                    </select>
                                    <div class="custom-date-input" id="revenueDatePickerWrapper" style="display: inline-block;">
                                        <input type="text" id="revenueDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('revenueDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('revenueDatePicker')">üìÖ</span>
                                    </div>
                                    <input type="month" id="revenueMonthPicker" class="form-input" style="width: 220px; height: 55px; padding: 12px 16px; font-size: 24px; font-weight: 600; display: none; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9);" onchange="updateRevenueAnalysisChart()">
                                    <select id="revenueYearPicker" class="form-input" style="width: 220px; height: 55px; padding: 12px 16px; font-size: 24px; font-weight: 600; display: none; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9);" onchange="updateRevenueAnalysisChart()">
                                        <option value="2023">2023Âπ¥</option>
                                        <option value="2024">2024Âπ¥</option>
                                        <option value="2025" selected>2025Âπ¥</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="revenueAnalysisChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = historyHtml;
                
                // ÂàùÂßãÂåñÂõæË°®
                setTimeout(() => {
                    // ËÆæÁΩÆÈªòËÆ§Êó•ÊúüÂÄº
                    const today = new Date();
                    const datePicker = document.getElementById('revenueDatePicker');
                    const monthPicker = document.getElementById('revenueMonthPicker');
                    
                    if (datePicker) {
                        datePicker.value = today.toISOString().split('T')[0];
                    }
                    if (monthPicker) {
                        const year = today.getFullYear();
                        const month = (today.getMonth() + 1).toString().padStart(2, '0');
                        monthPicker.value = `${year}-${month}`;
                    }
                    
                    initOverallHistoryCharts();
                }, 100);
                return;
            }
            
            // EMSÂéÜÂè≤Êï∞ÊçÆ
            if (component === 'ems') {
                let historyHtml = ``;
                
                // EMSÁ≠ñÁï•ÊâßË°åÂéÜÂè≤
                if (shouldShowField('ems', 'history', 'strategyHistory')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">EMSÁ≠ñÁï•ÊâßË°åÂéÜÂè≤</h3>
                            </div>
                            <div class="chart-wrapper" style="height: 400px !important;">
                                <canvas id="emsStrategyChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // Ë∞ÉÂ∫¶ÂìçÂ∫îÊó∂Èó¥ÂàÜÊûê
                if (shouldShowField('ems', 'history', 'responseTimeAnalysis')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Ë∞ÉÂ∫¶ÂìçÂ∫îÊó∂Èó¥ÂàÜÊûê</h3>
                            </div>
                            <div class="chart-wrapper" style="height: 400px !important;">
                                <canvas id="emsResponseChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = historyHtml;
                
                // Âª∂ËøüÂàùÂßãÂåñEMSÂõæË°®
                setTimeout(() => {
                    initEMSHistoryCharts();
                }, 100);
                return;
            }
            
            // PCSÂéÜÂè≤Êï∞ÊçÆ
            if (component === 'pcs') {
                let historyHtml = ``;
                
                // PCSÂäüÁéáËΩ¨Êç¢ÂéÜÂè≤
                if (shouldShowField('pcs', 'history', 'powerConversion')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    PCSÂäüÁéáËΩ¨Êç¢ÂéÜÂè≤
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="pcsPowerDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('pcsPowerDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('pcsPowerDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="pcsPowerChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // ÁîµÂéãÁîµÊµÅË∂ãÂäø
                if (shouldShowField('pcs', 'history', 'voltageCurrent')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    ÁîµÂéãÁîµÊµÅË∂ãÂäø
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="pcsVoltageDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('pcsVoltageDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('pcsVoltageDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="pcsVoltageChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // ËΩ¨Êç¢ÊïàÁéáÂàÜÊûê
                if (shouldShowField('pcs', 'history', 'efficiency')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    ËΩ¨Êç¢ÊïàÁéáÂàÜÊûê
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <select id="pcsEfficiencyTimePicker" class="form-input" style="width: 120px; height: 55px; padding: 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onchange="updatePcsEfficiencyTimePeriod()">
                                        <option value="day" selected>Êó•</option>
                                        <option value="month">Êúà</option>
                                        <option value="year">Âπ¥</option>
                                        <option value="total">ÂêàËÆ°</option>
                                    </select>
                                    <div class="custom-date-input" id="pcsEfficiencyDatePickerWrapper" style="display: inline-block;">
                                        <input type="text" id="pcsEfficiencyDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('pcsEfficiencyDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('pcsEfficiencyDatePicker')">üìÖ</span>
                                    </div>
                                    <input type="month" id="pcsEfficiencyMonthPicker" class="form-input" style="width: 220px; height: 55px; padding: 12px 16px; font-size: 24px; font-weight: 600; display: none; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9);" onchange="updatePcsEfficiencyChart()">
                                    <select id="pcsEfficiencyYearPicker" class="form-input" style="width: 220px; height: 55px; padding: 12px 16px; font-size: 24px; font-weight: 600; display: none; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9);" onchange="updatePcsEfficiencyChart()">
                                        <option value="2023">2023Âπ¥</option>
                                        <option value="2024">2024Âπ¥</option>
                                        <option value="2025" selected>2025Âπ¥</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="pcsEfficiencyChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = historyHtml;
                
                setTimeout(() => {
                    // ËÆæÁΩÆÈªòËÆ§Êó•ÊúüÂÄº
                    const today = new Date();
                    const dateString = today.toISOString().split('T')[0];
                    
                    const pickers = ['pcsPowerDatePicker', 'pcsVoltageDatePicker', 'pcsEfficiencyDatePicker'];
                    pickers.forEach(pickerId => {
                        const picker = document.getElementById(pickerId);
                        if (picker) {
                            picker.value = dateString;
                        }
                    });
                    
                    // ËÆæÁΩÆÈªòËÆ§Êó•ÊúüÂÄº for PCSÊïàÁéáÂàÜÊûê
                    const datePicker = document.getElementById('pcsEfficiencyDatePicker');
                    const monthPicker = document.getElementById('pcsEfficiencyMonthPicker');
                    
                    if (datePicker) {
                        datePicker.value = today.toISOString().split('T')[0];
                    }
                    if (monthPicker) {
                        const year = today.getFullYear();
                        const month = (today.getMonth() + 1).toString().padStart(2, '0');
                        monthPicker.value = `${year}-${month}`;
                    }
                    
                    initPCSHistoryCharts();
                }, 100);
                return;
            }
            
            // ÁîµË°®ÂéÜÂè≤Êï∞ÊçÆ
            if (component === 'meter') {
                console.log('Rendering meter history data');
                console.log('Meter config:', dataFieldsConfig.meter);
                console.log('User settings:', userFieldSettings.meter);
                
                let historyHtml = ``;
                
                // ÂäüÁéáË∂ãÂäøÂàÜÊûê
                const shouldShowPowerTrend = shouldShowField('meter', 'history', 'powerTrend');
                console.log('shouldShowPowerTrend:', shouldShowPowerTrend);
                
                if (shouldShowPowerTrend) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    ÂäüÁéáË∂ãÂäøÂàÜÊûê
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="meterPowerDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('meterPowerDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('meterPowerDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="meterPowerChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // ÁîµÈáèÊ∂àËÄóÁªüËÆ°
                const shouldShowEnergyConsumption = shouldShowField('meter', 'history', 'energyConsumption');
                console.log('shouldShowEnergyConsumption:', shouldShowEnergyConsumption);
                
                if (shouldShowEnergyConsumption) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    ÁîµÈáèÊ∂àËÄóÁªüËÆ°
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="meterEnergyDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('meterEnergyDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('meterEnergyDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="meterEnergyChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // ÁîµÂéãË¥®ÈáèÁõëÊµã
                if (shouldShowField('meter', 'history', 'voltageQuality')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    ÁîµÂéãË¥®ÈáèÁõëÊµã
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="meterVoltageDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('meterVoltageDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('meterVoltageDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="meterVoltageChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // Ë∞êÊ≥¢ÂàÜÊûê
                if (shouldShowField('meter', 'history', 'harmonicAnalysis')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    Ë∞êÊ≥¢ÂàÜÊûê
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="meterHarmonicDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('meterHarmonicDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('meterHarmonicDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="meterHarmonicChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                console.log('Final meter historyHtml:', historyHtml);
                console.log('Container element:', container);
                
                container.innerHTML = historyHtml;
                
                setTimeout(() => {
                    // ËÆæÁΩÆÈªòËÆ§Êó•ÊúüÂÄº
                    const today = new Date();
                    const dateString = today.toISOString().split('T')[0];
                    
                    const meterPickers = ['meterPowerDatePicker', 'meterEnergyDatePicker', 'meterVoltageDatePicker', 'meterHarmonicDatePicker'];
                    meterPickers.forEach(pickerId => {
                        const picker = document.getElementById(pickerId);
                        if (picker) {
                            picker.value = dateString;
                        }
                    });
                    
                    initMeterHistoryCharts();
                    
                    // ÂàùÂßãÂåñÂêÑ‰∏™ÂõæË°®ÁöÑÈªòËÆ§Êï∞ÊçÆ
                    setTimeout(() => {
                        updateMeterPowerChart(dateString);
                        updateMeterEnergyChart(dateString);
                        updateMeterVoltageChart(dateString);
                        updateMeterHarmonicChart(dateString);
                    }, 200);
                }, 100);
                return;
            }
            
            // BMSÂéÜÂè≤Êï∞ÊçÆ
            if (component === 'bms') {
                let historyHtml = ``;
                
                // ÁîµÊ±†SOCË∂ãÂäø
                if (shouldShowField('bms', 'history', 'socBalance')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    ÁîµÊ±†SOCË∂ãÂäø
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="bmsBalanceDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('bmsBalanceDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('bmsBalanceDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="bmsBalanceChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // ÁîµÊ±†ÁîµÂéãÂéÜÂè≤
                if (shouldShowField('bms', 'history', 'voltageHistory')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    ÁîµÊ±†ÁîµÂéãÂéÜÂè≤
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="bmsVoltageDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('bmsVoltageDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('bmsVoltageDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="bmsVoltageChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // Ê∏©Â∫¶ÂàÜÂ∏ÉÂàÜÊûê
                if (shouldShowField('bms', 'history', 'tempDistribution')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    Ê∏©Â∫¶ÂàÜÂ∏ÉÂàÜÊûê
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="bmsTempDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('bmsTempDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('bmsTempDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="bmsTempChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = historyHtml;
                
                setTimeout(() => {
                    // ËÆæÁΩÆÈªòËÆ§Êó•ÊúüÂÄº
                    const today = new Date();
                    const dateString = today.toISOString().split('T')[0];
                    
                    const bmsPickers = ['bmsVoltageDatePicker', 'bmsBalanceDatePicker', 'bmsTempDatePicker'];
                    bmsPickers.forEach(pickerId => {
                        const picker = document.getElementById(pickerId);
                        if (picker) {
                            picker.value = dateString;
                        }
                    });
                    
                    initBMSHistoryCharts();
                }, 100);
                return;
            }
            
            // BatteryÂéÜÂè≤Êï∞ÊçÆ
            if (component === 'battery') {
                let historyHtml = ``;
                
                // ÁîµÊ±†ÊÄßËÉΩË∂ãÂäø
                if (shouldShowField('battery', 'history', 'performance')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">ÁîµÊ±†ÊÄßËÉΩË∂ãÂäø</h3>
                            </div>
                            <div class="chart-wrapper" style="height: 400px !important;">
                                <canvas id="batteryPerformanceChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // Âæ™ÁéØÂØøÂëΩÁªüËÆ°
                if (shouldShowField('battery', 'history', 'cycles')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">Âæ™ÁéØÂØøÂëΩÁªüËÆ°</h3>
                            </div>
                            <div class="chart-wrapper" style="height: 400px !important;">
                                <canvas id="batteryCycleChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // ÂÆπÈáèË°∞ÂáèÂàÜÊûê
                if (shouldShowField('battery', 'history', 'capacity')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header">
                                <h3 class="chart-title">ÂÆπÈáèË°∞ÂáèÂàÜÊûê</h3>
                            </div>
                            <div class="chart-wrapper" style="height: 400px !important;">
                                <canvas id="batteryCapacityChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = historyHtml;
                
                setTimeout(() => {
                    initBatteryHistoryCharts();
                }, 100);
                return;
            }
            
            // ThermalÂéÜÂè≤Êï∞ÊçÆ
            if (component === 'thermal') {
                let historyHtml = ``;
                
                // Ê∏©Â∫¶ÂàÜÂ∏ÉÂéÜÂè≤
                if (shouldShowField('thermal', 'history', 'tempDistribution')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    Ê∏©Â∫¶ÂàÜÂ∏ÉÂéÜÂè≤
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="thermalTempDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('thermalTempDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('thermalTempDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="thermalTempChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // ÂÜ∑Âç¥Á≥ªÁªüËøêË°å
                if (shouldShowField('thermal', 'history', 'coolingSystem')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    ÂÜ∑Âç¥Á≥ªÁªüËøêË°å
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="thermalCoolingDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('thermalCoolingDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('thermalCoolingDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="thermalCoolingChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // Ê∏©Â∫¶ÁÉ≠ÂäõÂõæ
                if (shouldShowField('thermal', 'history', 'heatMap')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    Ê∏©Â∫¶ÁÉ≠ÂäõÂõæ
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="thermalHeatMapDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('thermalHeatMapDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('thermalHeatMapDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="thermalHeatMapChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = historyHtml;
                
                setTimeout(() => {
                    // ËÆæÁΩÆÈªòËÆ§Êó•ÊúüÂÄº
                    const today = new Date();
                    const dateString = today.toISOString().split('T')[0];
                    
                    const thermalPickers = ['thermalTempDatePicker', 'thermalCoolingDatePicker', 'thermalHeatMapDatePicker'];
                    thermalPickers.forEach(pickerId => {
                        const picker = document.getElementById(pickerId);
                        if (picker) {
                            picker.value = dateString;
                        }
                    });
                    
                    initThermalHistoryCharts();
                }, 100);
                return;
            }
            
            // FireÂéÜÂè≤Êï∞ÊçÆ
            if (component === 'fire') {
                let historyHtml = ``;
                
                // Á≥ªÁªüÁä∂ÊÄÅÂéÜÂè≤
                if (shouldShowField('fire', 'history', 'systemStatus')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    Á≥ªÁªüÁä∂ÊÄÅÂéÜÂè≤
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="fireSystemDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('fireSystemDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('fireSystemDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="fireSystemChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // Ê∞î‰ΩìÊµìÂ∫¶ÁõëÊµã
                if (shouldShowField('fire', 'history', 'gasConcentration')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    Ê∞î‰ΩìÊµìÂ∫¶ÁõëÊµã
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="fireGasDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('fireGasDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('fireGasDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="fireGasChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                // ÂëäË≠¶ËÆ∞ÂΩïÂàÜÊûê
                if (shouldShowField('fire', 'history', 'alarmHistory')) {
                    historyHtml += `
                        <div class="chart-container">
                            <div class="chart-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div class="chart-title" style="font-size: 18px; font-weight: 600; color: rgba(255, 255, 255, 0.95); display: flex; align-items: center; gap: 8px;">
                                    <span style="width: 4px; height: 18px; background: linear-gradient(45deg, #0096ff, #00d4ff); border-radius: 2px;"></span>
                                    ÂëäË≠¶ËÆ∞ÂΩïÂàÜÊûê
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div class="custom-date-input">
                                        <input type="text" id="fireAlarmDatePicker" readonly style="width: 220px; height: 55px; padding: 12px 45px 12px 16px; font-size: 24px; font-weight: 600; background: rgba(15, 25, 42, 0.8); border: 1px solid rgba(0, 150, 255, 0.3); border-radius: 8px; color: rgba(255, 255, 255, 0.9); cursor: pointer;" onclick="showCustomCalendar('fireAlarmDatePicker')">
                                        <span class="calendar-icon" onclick="showCustomCalendar('fireAlarmDatePicker')">üìÖ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-wrapper" style="height: 450px !important;">
                                <canvas id="fireAlarmChart"></canvas>
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = historyHtml;
                
                setTimeout(() => {
                    // ËÆæÁΩÆÈªòËÆ§Êó•ÊúüÂÄº
                    const today = new Date();
                    const dateString = today.toISOString().split('T')[0];
                    
                    const firePickers = ['fireSystemDatePicker', 'fireGasDatePicker', 'fireAlarmDatePicker'];
                    firePickers.forEach(pickerId => {
                        const picker = document.getElementById(pickerId);
                        if (picker) {
                            picker.value = dateString;
                        }
                    });
                    
                    initFireHistoryCharts();
                }, 100);
                return;
            }
            
            // ÂÖ∂‰ªñÁªÑ‰ª∂‰øùÊåÅÂéüÊúâÈÄªËæë
            container.innerHTML = '';
            
            const config = dataFieldsConfig[component].history;
            if (!config) return;
            
            for (const field in config) {
                // ‰ΩøÁî®ËÆæÁΩÆÂÄºÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®Âàô‰ΩøÁî®ÈªòËÆ§ÂÄº
                let shouldShow = config[field].default;
                if (userFieldSettings[component] && userFieldSettings[component].history && userFieldSettings[component].history[field] !== undefined) {
                    shouldShow = userFieldSettings[component].history[field];
                }
                
                if (shouldShow) {
                    const chartContainer = createHistoryChart(field, config[field]);
                    container.appendChild(chartContainer);
                }
            }
        }

        // ÂàõÂª∫ÂéÜÂè≤Êï∞ÊçÆÂõæË°®
        function createHistoryChart(field, config) {
            const div = document.createElement('div');
            div.className = 'chart-container';
            div.innerHTML = `
                <div class="chart-header">
                    <h3 class="chart-title">${config.label}</h3>
                    <div class="time-range-selector">
                        <button class="time-btn active" onclick="changeHistoryRange('${field}', '24h')">24Â∞èÊó∂</button>
                        <button class="time-btn" onclick="changeHistoryRange('${field}', '7d')">7Â§©</button>
                        <button class="time-btn" onclick="changeHistoryRange('${field}', '30d')">30Â§©</button>
                    </div>
                </div>
                <div class="chart-wrapper" style="height: 400px !important;">
                    <canvas id="${field}Chart"></canvas>
                </div>
            `;
            
            // Âª∂ËøüÂàùÂßãÂåñÂõæË°®
            setTimeout(() => {
                const canvas = div.querySelector('canvas');
                if (canvas) {
                    initSpecificChart(canvas, field);
                }
            }, 100);
            
            return div;
        }

        // ÂàõÂª∫PackÁîµÊ±†Á∞áÂç°ÁâáËßÜÂõæ - ÊØè‰∏™ÁîµÊ±†Á∞á‰Ωú‰∏∫‰∏Ä‰∏™Êï¥‰ΩìÂç°Áâá
        function createPackBatteryCards(packFields) {
            const container = document.createElement('div');
            container.className = 'pack-battery-cards-container';
            
            // Ê†πÊçÆÁî®Êà∑ËÆæÁΩÆËé∑ÂèñË¶ÅÊòæÁ§∫ÁöÑPack
            const allPackData = [
                { 
                    id: 1, 
                    voltage: getFieldValue('pack1Voltage'), 
                    current: getFieldValue('pack1Current'), 
                    soc: getFieldValue('pack1Soc'), 
                    soh: getFieldValue('pack1Soh'),
                    temp: getFieldValue('pack1Temp') 
                },
                { 
                    id: 2, 
                    voltage: getFieldValue('pack2Voltage'), 
                    current: getFieldValue('pack2Current'), 
                    soc: getFieldValue('pack2Soc'), 
                    soh: getFieldValue('pack2Soh'),
                    temp: getFieldValue('pack2Temp') 
                },
                { 
                    id: 3, 
                    voltage: getFieldValue('pack3Voltage'), 
                    current: getFieldValue('pack3Current'), 
                    soc: getFieldValue('pack3Soc'), 
                    soh: getFieldValue('pack3Soh'),
                    temp: getFieldValue('pack3Temp') 
                },
                { 
                    id: 4, 
                    voltage: getFieldValue('pack4Voltage'), 
                    current: getFieldValue('pack4Current'), 
                    soc: getFieldValue('pack4Soc'), 
                    soh: getFieldValue('pack4Soh'),
                    temp: getFieldValue('pack4Temp') 
                }
            ];
            
            // Ê†πÊçÆÈÖçÁΩÆËøáÊª§Ë¶ÅÊòæÁ§∫ÁöÑPack
            const packData = allPackData.filter(pack => {
                const packKey = `pack${pack.id}`;
                const fieldConfig = packFields[packKey];
                if (!fieldConfig) return false;
                
                // Ê£ÄÊü•Áî®Êà∑ËÆæÁΩÆ
                let shouldShow = fieldConfig.default;
                if (userFieldSettings.bms && userFieldSettings.bms.realtime && userFieldSettings.bms.realtime[packKey] !== undefined) {
                    shouldShow = userFieldSettings.bms.realtime[packKey];
                }
                return shouldShow;
            });
            
            // Ê†πÊçÆÂÆûÈôÖPackÊï∞ÈáèËÆæÁΩÆÁΩëÊ†º
            const packCount = packData.length;
            container.style.display = 'grid';
            container.style.gridTemplateColumns = `repeat(${packCount}, minmax(250px, 1fr))`;
            container.style.gap = '25px';
            container.style.marginBottom = '20px';
            container.style.width = '100%';
            container.style.overflow = 'visible';
            
            // Ê∑ªÂä†Ë∞ÉËØï‰ø°ÊÅØ
            console.log(`PackÂÆπÂô®Â∑≤ÂàõÂª∫ÔºåÂ∞ÜÊòæÁ§∫${packCount}‰∏™PackÂç°Áâá`);
            
            // ‰∏∫ÊØè‰∏™PackÂàõÂª∫‰∏Ä‰∏™Êï¥‰ΩìÂç°Áâá
            packData.forEach(pack => {
                const packCard = document.createElement('div');
                packCard.className = 'data-card pack-cluster-card';
                
                packCard.innerHTML = `
                    <div class="pack-header">
                        <div class="pack-title">Pack${pack.id}</div>
                        <div class="pack-status">Ê≠£Â∏∏</div>
                    </div>
                    <div class="pack-grid">
                        <div class="pack-item">
                            <div class="pack-label">ÁîµÂéã</div>
                            <div class="pack-value">${pack.voltage}V</div>
                        </div>
                        <div class="pack-item">
                            <div class="pack-label">ÁîµÊµÅ</div>
                            <div class="pack-value">${pack.current}A</div>
                        </div>
                        <div class="pack-item">
                            <div class="pack-label">SOC</div>
                            <div class="pack-value">${pack.soc}%</div>
                        </div>
                        <div class="pack-item">
                            <div class="pack-label">SOH</div>
                            <div class="pack-value">${pack.soh}%</div>
                        </div>
                        <div class="pack-item">
                            <div class="pack-label">Ê∏©Â∫¶</div>
                            <div class="pack-value">${pack.temp}¬∞C</div>
                        </div>
                    </div>
                `;
                
                container.appendChild(packCard);
                console.log(`Pack${pack.id} Âç°ÁâáÂ∑≤Ê∑ªÂä†Âà∞ÂÆπÂô®`);
            });
            
            console.log(`ÊÄªÂÖ±ÂàõÂª∫‰∫Ü ${packData.length} ‰∏™PackÂç°Áâá`);
            
            // Ê∑ªÂä†Pack‰∏ìÁî®Ê†∑Âºè
            const style = document.createElement('style');
            if (!document.getElementById('pack-industrial-styles')) {
                style.id = 'pack-industrial-styles';
                style.textContent = `
                    .pack-cluster-card {
                        min-height: 250px;
                        height: auto;
                        padding: 20px;
                        background: rgba(15, 25, 42, 0.8);
                        border: 2px solid rgba(0, 150, 255, 0.5);
                        margin: 0;
                    }
                    
                    .pack-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 15px;
                        border-bottom: 1px solid rgba(0, 150, 255, 0.3);
                        padding-bottom: 10px;
                    }
                    
                    .pack-title {
                        font-size: 18px;
                        font-weight: 700;
                        color: #00d4ff;
                        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
                    }
                    
                    .pack-status {
                        font-size: 12px;
                        color: #00ff88;
                        background: rgba(0, 255, 136, 0.1);
                        padding: 4px 8px;
                        border-radius: 4px;
                        border: 1px solid rgba(0, 255, 136, 0.3);
                    }
                    
                    .pack-grid {
                        display: flex;
                        flex-direction: column;
                        gap: 8px;
                    }
                    
                    .pack-item {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 6px 8px;
                        background: rgba(0, 150, 255, 0.05);
                        border-radius: 4px;
                    }
                    
                    .pack-label {
                        font-size: 16px;
                        color: rgba(255, 255, 255, 0.8);
                        margin-bottom: 4px;
                        font-weight: 600;
                    }
                    
                    .pack-value {
                        font-size: 18px;
                        font-weight: 700;
                        color: #ffffff;
                        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
                        line-height: 1.2;
                    }
                `;
                document.head.appendChild(style);
            }
            
            return container;
        }

        // ÂàõÂª∫PackÁîµÊ±†Á∞áÂØπÊØîËßÜÂõæ
        function createPackBatteryComparisonView(packFields) {
            const container = document.createElement('div');
            container.className = 'pack-battery-container';
            
            // Ê∑ªÂä†Ê†∑Âºè
            container.innerHTML = `
                <style>
                    .pack-battery-container {
                        display: grid;
                        grid-template-columns: repeat(2, 1fr);
                        gap: 20px;
                        margin-bottom: 20px;
                    }
                    
                    .pack-card {
                        background: linear-gradient(135deg, rgba(15, 25, 42, 0.8) 0%, rgba(20, 35, 60, 0.6) 100%);
                        border: 1px solid rgba(0, 150, 255, 0.3);
                        border-radius: 12px;
                        padding: 20px;
                        position: relative;
                        overflow: hidden;
                        transition: all 0.3s ease;
                        backdrop-filter: blur(10px);
                    }
                    
                    .pack-card:hover {
                        border-color: rgba(0, 150, 255, 0.6);
                        transform: translateY(-2px);
                        box-shadow: 0 8px 25px rgba(0, 150, 255, 0.15);
                    }
                    
                    .pack-card.best-performance {
                        border-color: rgba(0, 255, 136, 0.6);
                        background: linear-gradient(135deg, rgba(0, 50, 25, 0.3) 0%, rgba(15, 25, 42, 0.8) 100%);
                    }
                    
                    .pack-card.needs-attention {
                        border-color: rgba(255, 193, 7, 0.6);
                        background: linear-gradient(135deg, rgba(50, 35, 0, 0.3) 0%, rgba(15, 25, 42, 0.8) 100%);
                    }
                    
                    .pack-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 15px;
                        padding-bottom: 10px;
                        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                    }
                    
                    .pack-title {
                        font-size: 16px;
                        font-weight: 600;
                        color: rgba(255, 255, 255, 0.95);
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }
                    
                    .pack-status {
                        font-size: 12px;
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-weight: 500;
                    }
                    
                    .pack-status.excellent {
                        background: rgba(0, 255, 136, 0.2);
                        color: #00ff88;
                    }
                    
                    .pack-status.good {
                        background: rgba(0, 255, 136, 0.2);
                        color: #00ff88;
                    }
                    
                    .pack-status.warning {
                        background: rgba(255, 221, 0, 0.2);
                        color: #ffdd00;
                    }
                    
                    .pack-metrics {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 12px;
                    }
                    
                    .metric-item {
                        display: flex;
                        flex-direction: column;
                        gap: 4px;
                    }
                    
                    .metric-label {
                        font-size: 11px;
                        color: rgba(255, 255, 255, 0.6);
                        font-weight: 500;
                    }
                    
                    .metric-value {
                        font-size: 14px;
                        font-weight: 600;
                        color: rgba(255, 255, 255, 0.95);
                        display: flex;
                        align-items: center;
                        gap: 4px;
                    }
                    
                    .metric-trend {
                        font-size: 10px;
                        opacity: 0.8;
                    }
                    
                    .trend-up { color: #00ff88; }
                    .trend-down { color: #ff4757; }
                    .trend-stable { color: #ffc107; }
                    
                    .pack-comparison-summary {
                        grid-column: 1 / -1;
                        background: rgba(15, 25, 42, 0.6);
                        border: 1px solid rgba(0, 150, 255, 0.2);
                        border-radius: 8px;
                        padding: 15px;
                        margin-top: 15px;
                    }
                    
                    .comparison-title {
                        font-size: 14px;
                        font-weight: 600;
                        color: rgba(255, 255, 255, 0.9);
                        margin-bottom: 10px;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }
                    
                    .comparison-stats {
                        display: grid;
                        grid-template-columns: repeat(4, 1fr);
                        gap: 15px;
                        font-size: 12px;
                    }
                    
                    .stat-item {
                        text-align: center;
                    }
                    
                    .stat-label {
                        color: rgba(255, 255, 255, 0.6);
                        margin-bottom: 4px;
                    }
                    
                    .stat-value {
                        color: rgba(255, 255, 255, 0.95);
                        font-weight: 600;
                    }
                </style>
            `;
            
            // Ëé∑ÂèñPackÊï∞ÊçÆ
            const packs = [
                { 
                    id: 1, 
                    voltage: getFieldValue('pack1Voltage'), 
                    current: getFieldValue('pack1Current'), 
                    soc: getFieldValue('pack1Soc'), 
                    temp: getFieldValue('pack1Temp') 
                },
                { 
                    id: 2, 
                    voltage: getFieldValue('pack2Voltage'), 
                    current: getFieldValue('pack2Current'), 
                    soc: getFieldValue('pack2Soc'), 
                    temp: getFieldValue('pack2Temp') 
                },
                { 
                    id: 3, 
                    voltage: getFieldValue('pack3Voltage'), 
                    current: getFieldValue('pack3Current'), 
                    soc: getFieldValue('pack3Soc'), 
                    temp: getFieldValue('pack3Temp') 
                },
                { 
                    id: 4, 
                    voltage: getFieldValue('pack4Voltage'), 
                    current: getFieldValue('pack4Current'), 
                    soc: getFieldValue('pack4Soc'), 
                    temp: getFieldValue('pack4Temp') 
                }
            ];
            
            // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
            const avgVoltage = packs.reduce((sum, p) => sum + parseFloat(p.voltage), 0) / packs.length;
            const avgSOC = packs.reduce((sum, p) => sum + parseFloat(p.soc), 0) / packs.length;
            const avgTemp = packs.reduce((sum, p) => sum + parseFloat(p.temp), 0) / packs.length;
            const maxTemp = Math.max(...packs.map(p => parseFloat(p.temp)));
            const minTemp = Math.min(...packs.map(p => parseFloat(p.temp)));
            const tempDiff = maxTemp - minTemp;
            
            // ÂàõÂª∫PackÂç°Áâá
            packs.forEach(pack => {
                const packCard = document.createElement('div');
                const soc = parseFloat(pack.soc);
                const temp = parseFloat(pack.temp);
                const voltage = parseFloat(pack.voltage);
                
                // Âà§Êñ≠PackÁä∂ÊÄÅ
                let statusClass = 'good';
                let statusText = 'Ê≠£Â∏∏';
                let cardClass = '';
                
                if (soc > avgSOC && temp < avgTemp && voltage > avgVoltage - 1) {
                    statusClass = 'excellent';
                    statusText = '‰ºòÁßÄ';
                    cardClass = 'best-performance';
                } else if (soc < avgSOC - 5 || temp > avgTemp + 2 || Math.abs(voltage - avgVoltage) > 2) {
                    statusClass = 'warning';
                    statusText = 'ÂÖ≥Ê≥®';
                    cardClass = 'needs-attention';
                }
                
                packCard.className = `pack-card ${cardClass}`;
                packCard.innerHTML = `
                    <div class="pack-header">
                        <div class="pack-title">
                            üîã Pack ${pack.id}
                        </div>
                        <div class="pack-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="pack-metrics">
                        <div class="metric-item">
                            <div class="metric-label">ÁîµÂéã</div>
                            <div class="metric-value">
                                ${pack.voltage}<span style="font-size: 10px; margin-left: 2px;">V</span>
                                <span class="metric-trend ${voltage > avgVoltage ? 'trend-up' : voltage < avgVoltage ? 'trend-down' : 'trend-stable'}">
                                    ${voltage > avgVoltage ? '‚Üë' : voltage < avgVoltage ? '‚Üì' : '~'}
                                </span>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">ÁîµÊµÅ</div>
                            <div class="metric-value">
                                ${pack.current}<span style="font-size: 10px; margin-left: 2px;">A</span>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">SOC</div>
                            <div class="metric-value">
                                ${pack.soc}<span style="font-size: 10px; margin-left: 2px;">%</span>
                                <span class="metric-trend ${soc > avgSOC ? 'trend-up' : soc < avgSOC ? 'trend-down' : 'trend-stable'}">
                                    ${soc > avgSOC ? '‚Üë' : soc < avgSOC ? '‚Üì' : '~'}
                                </span>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Ê∏©Â∫¶</div>
                            <div class="metric-value">
                                ${pack.temp}<span style="font-size: 10px; margin-left: 2px;">¬∞C</span>
                                <span class="metric-trend ${temp > avgTemp ? 'trend-up' : temp < avgTemp ? 'trend-down' : 'trend-stable'}">
                                    ${temp > avgTemp ? '‚Üë' : temp < avgTemp ? '‚Üì' : '~'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(packCard);
            });
            
            // Ê∑ªÂä†ÂØπÊØîÁªüËÆ°ÊëòË¶Å
            const summaryCard = document.createElement('div');
            summaryCard.className = 'pack-comparison-summary';
            summaryCard.innerHTML = `
                <div class="comparison-title">
                    üìä ÈõÜÁæ§ÁªüËÆ°ÂØπÊØî
                </div>
                <div class="comparison-stats">
                    <div class="stat-item">
                        <div class="stat-label">Âπ≥ÂùáÁîµÂéã</div>
                        <div class="stat-value">${avgVoltage.toFixed(1)}V</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Âπ≥ÂùáSOC</div>
                        <div class="stat-value">${avgSOC.toFixed(1)}%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Ê∏©Â∫¶ËåÉÂõ¥</div>
                        <div class="stat-value">${minTemp.toFixed(1)}~${maxTemp.toFixed(1)}¬∞C</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Ê∏©Â∑Æ</div>
                        <div class="stat-value" style="color: ${tempDiff > 3 ? '#ffc107' : '#00ff88'}">${tempDiff.toFixed(1)}¬∞C</div>
                    </div>
                </div>
            `;
            container.appendChild(summaryCard);
            
            return container;
        }

        // ÂàõÂª∫‰∏âÁõ∏ÂèÇÊï∞Âç°Áâá
        function createThreePhaseCard(field, config) {
            // ÊâÄÊúâÂÆûÊó∂Êï∞ÊçÆÈÉΩ‰∏çÊòæÁ§∫ÂõæÊ†á
            const showIcon = false;
            const card = document.createElement('div');
            card.className = 'data-card three-phase-card';
            card.style.cssText = 'height: auto !important; min-height: 130px;';
            
            const isPower = config.type === 'three-phase-power';
            
            // Ëé∑Âèñ‰∏âÁõ∏Êï∞ÊçÆ
            const phaseA = getFieldValue(field + 'A');
            const phaseB = getFieldValue(field + 'B');
            const phaseC = getFieldValue(field + 'C');
            const total = isPower ? getFieldValue('totalPower') : null;
            
            card.innerHTML = `
                <div class="card-title" style="font-size: 18px; margin-bottom: 8px; color: rgba(255, 255, 255, 0.85); font-weight: 600;">
                    ${showIcon ? `<span class="card-icon">${getFieldIcon(field)}</span>` : ''}
                    ${config.label}
                </div>
                <div class="three-phase-list" style="
                    display: flex;
                    flex-direction: column;
                    gap: 6px;
                ">
                    <div class="phase-row" style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 5px 0;
                        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                    ">
                        <span class="phase-label" style="
                            font-size: 16px;
                            color: #ffffff;
                            font-weight: 500;
                            min-width: 45px;
                        ">AÁõ∏</span>
                        <span class="phase-value" style="
                            font-size: 18px;
                            color: #ffffff;
                            font-weight: bold;
                            text-align: right;
                        ">${phaseA} ${config.unit}</span>
                    </div>
                    <div class="phase-row" style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 5px 0;
                        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                    ">
                        <span class="phase-label" style="
                            font-size: 16px;
                            color: #ffffff;
                            font-weight: 500;
                            min-width: 45px;
                        ">BÁõ∏</span>
                        <span class="phase-value" style="
                            font-size: 18px;
                            color: #ffffff;
                            font-weight: bold;
                            text-align: right;
                        ">${phaseB} ${config.unit}</span>
                    </div>
                    <div class="phase-row" style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 5px 0;
                    ">
                        <span class="phase-label" style="
                            font-size: 16px;
                            color: #ffffff;
                            font-weight: 500;
                            min-width: 45px;
                        ">CÁõ∏</span>
                        <span class="phase-value" style="
                            font-size: 18px;
                            color: #ffffff;
                            font-weight: bold;
                            text-align: right;
                        ">${phaseC} ${config.unit}</span>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // ÂàõÂª∫Êï∞ÊçÆÂç°Áâá
        function createDataCard(field, config) {
            // Ê£ÄÊü•ÊòØÂê¶ÊòØ‰∏âÁõ∏ÂèÇÊï∞
            if (config.type === 'three-phase' || config.type === 'three-phase-power') {
                return createThreePhaseCard(field, config);
            }
            
            // ÊâÄÊúâÂÆûÊó∂Êï∞ÊçÆÈÉΩ‰∏çÊòæÁ§∫ÂõæÊ†á
            const showIcon = false;
            
            const card = document.createElement('div');
            card.className = 'data-card';
            
            // Ê£ÄÊü•ÊòØÂê¶ÊúâÈ¢ÑÂÆö‰πâÁöÑÂÄºÔºàÁî®‰∫éEMSÁ≠âÁâπÊÆäÁªÑ‰ª∂Ôºâ
            if (config.value !== undefined) {
                const statusColor = config.statusColor || '#666';
                
                // ÁâπÊÆäÂ§ÑÁêÜ‰∏çÂêåÁ±ªÂûãÁöÑÂÄºÊòæÁ§∫
                if (field === 'dispatch' && config.subValue) {
                    // Ë∞ÉÂ∫¶Êåá‰ª§ÁâπÊÆäÂ§ÑÁêÜ
                    card.innerHTML = `
                        <div class="card-title">
                            ${showIcon ? `<span class="card-icon">${getFieldIcon(field)}</span>` : ''}
                            ${config.label}
                        </div>
                        <div class="card-value">
                            <span style="font-size: 24px; color: ${statusColor};">${config.value}</span>
                        </div>
                        <div style="font-size: 16px; color: ${statusColor}; margin-top: 4px;">${config.subValue}</div>
                    `;
                } else if (config.unit) {
                    // ÊúâÂçï‰ΩçÁöÑÊï∞ÂÄº
                    card.innerHTML = `
                        <div class="card-title">
                            ${showIcon ? `<span class="card-icon">${getFieldIcon(field)}</span>` : ''}
                            ${config.label}
                        </div>
                        <div class="card-value">
                            <span id="${field}Value">${config.value}</span>
                            <span class="card-unit">${config.unit}</span>
                        </div>
                        ${config.status ? `<div style="font-size: 16px; color: ${statusColor || '#666'}; margin-top: 4px;">${config.status}</div>` : ''}
                    `;
                } else {
                    // Á∫ØÊñáÊú¨ÂÄº
                    card.innerHTML = `
                        <div class="card-title">
                            ${showIcon ? `<span class="card-icon">${getFieldIcon(field)}</span>` : ''}
                            ${config.label}
                        </div>
                        <div class="card-value">
                            <span style="font-size: 24px; color: ${statusColor};">${config.value}</span>
                        </div>
                        ${config.status ? `<div style="font-size: 16px; color: ${statusColor || '#666'}; margin-top: 4px;">${config.status}</div>` : ''}
                    `;
                }
            } else {
                // ‰ΩøÁî®ÂéüÊúâÁöÑÂä®ÊÄÅÂÄºÈÄªËæë
                const statusText = getFieldStatus(field);
                const statusClass = getStatusClass(statusText);
                const fieldValue = getFieldValue(field);
                
                // Ê£ÄÊü•ÊòØÂê¶ÊòØÁä∂ÊÄÅÂûãÂ≠óÊÆµÔºàÊ∂àÈò≤Á≥ªÁªüÁöÑÊé¢ÊµãÂô®Á≠âÔºâ
                const isStatusOnlyField = ['smokeDetector1', 'smokeDetector2', 'tempDetector1', 'tempDetector2', 
                                         'fireAlarmStatus', 'extinguisherStatus', 'emergencyStop', 'evacuationAlarm'].includes(field);
                
                if (isStatusOnlyField) {
                    // Áä∂ÊÄÅÂûãÂ≠óÊÆµÂè™ÊòæÁ§∫Áä∂ÊÄÅÔºå‰∏çÊòæÁ§∫Êï∞ÂÄº
                    const statusColor = statusClass === 'warning' || statusClass === 'error' ? '#ffdd00' : '#00ff88';
                    card.innerHTML = `
                        <div class="card-title">
                            ${showIcon ? `<span class="card-icon">${getFieldIcon(field)}</span>` : ''}
                            ${config.label}
                        </div>
                        <div class="card-value" style="font-size: 24px; color: ${statusColor}; padding: 15px 0;">
                            <span>${statusText}</span>
                        </div>
                    `;
                } else {
                    // ÊôÆÈÄöÂ≠óÊÆµÊòæÁ§∫Êï∞ÂÄºÂíåÁä∂ÊÄÅ
                    card.innerHTML = `
                        <div class="card-title">
                            ${showIcon ? `<span class="card-icon">${getFieldIcon(field)}</span>` : ''}
                            ${config.label}
                        </div>
                        <div class="card-value">
                            <span id="${field}Value">${fieldValue}</span>
                            ${config.unit ? `<span class="card-unit">${config.unit}</span>` : ''}
                        </div>
                        ${statusText ? `<div class="card-status ${statusClass}">
                            <span>${statusText}</span>
                        </div>` : ''}
                    `;
                }
            }
            
            return card;
        }

        // Ê†πÊçÆÁä∂ÊÄÅÊñáÂ≠óËøîÂõûÂØπÂ∫îÁöÑCSSÁ±ª
        function getStatusClass(statusText) {
            if (statusText.includes('ËâØÂ•Ω') || statusText.includes('ÂÖÖË∂≥') || statusText.includes('ÂÅ•Â∫∑') || 
                statusText.includes('Ê≠£Â∏∏') || statusText.includes('Á®≥ÂÆö') || statusText.includes('ËøêË°å') ||
                statusText.includes('‰ºòÁßÄ') || statusText.includes('Âú®Á∫ø') || statusText.includes('ÂêØÁî®') ||
                statusText.includes('Ê≠£Â∏∏Â∑•‰Ωú') || statusText.includes('Ê≠£Â∏∏Áä∂ÊÄÅ')) {
                return 'normal'; // ÁªøËâ≤ - Â•ΩÁöÑÁä∂ÊÄÅ
            } else if (statusText.includes('Ë≠¶Âëä') || statusText.includes('ÂÅèÈ´ò') || statusText.includes('ÂÅè‰Ωé') ||
                       statusText.includes('ÈîôËØØ') || statusText.includes('ÊïÖÈöú') || statusText.includes('ÂºÇÂ∏∏') ||
                       statusText.includes('ÂÖ≥Ê≥®') || statusText.includes('Êú™ÂêØÂä®') || statusText.includes('ÂÅúÊ≠¢')) {
                return 'warning'; // ÈªÑËâ≤ - ‰∏çÂ•ΩÁöÑÁä∂ÊÄÅ
            }
            return 'normal'; // ÈªòËÆ§ÁªøËâ≤
        }

        // Ëé∑ÂèñÂ≠óÊÆµÂõæÊ†á
        function getFieldIcon(field) {
            const iconMap = {
                // Ê†∏ÂøÉËøêË°åÂèÇÊï∞
                soc: 'üîã',
                soh: 'üíö',
                temperature: 'üå°Ô∏è',
                power: '‚ö°',
                batteryCurrent: 'üìà',
                batteryVoltage: 'üìä',
                
                // ËøêË°åÁªüËÆ°
                todayCharge: 'üîã',
                todayDischarge: '‚ö°',
                totalCharge: 'üìà',
                totalDischarge: 'üìâ',
                
                // ÂÖ∂‰ªñÂèÇÊï∞
                cycles: 'üîÑ',
                
                // Á≠ñÁï•Ë∞ÉÂ∫¶ÂèÇÊï∞
                strategy: 'üìã',
                dispatch: 'üéØ',
                targetSOC: 'üéØ',
                maxPower: '‚ö°',
                
                // ÈÄö‰ø°ÊéßÂà∂ÂèÇÊï∞
                communication: 'üì°',
                responseTime: '‚è±Ô∏è',
                agc: 'üìä',
                gridFrequency: '„Ä∞Ô∏è',
                powerDeviation: 'üìà',
                protectionStatus: 'üõ°Ô∏è',
                
                // EMSÊéßÂà∂Âô®
                cpuUsage: 'üíª',
                cpuTemp: 'üå°Ô∏è',
                memoryUsage: 'üíæ',
                diskUsage: 'üíø',
                boardTemp: 'üå°Ô∏è',
                signalStrength: 'üì∂',
                simStatus: 'üì±',
                networkStatus: 'üåê',
                wifiSignal: 'üì∂',
                wifiConnection: 'üì°',
                runTime: '',  // ÁßªÈô§Êó∂ÈíüÂõæÊ†á
                systemTime: '',  // ÁßªÈô§Êó∂ÈíüÂõæÊ†á
                hardwareTime: '',  // ÁßªÈô§Êó∂ÈíüÂõæÊ†á
                
                // PCSÈÄÜÂèòÂô®
                acVoltage: 'üìä',
                acCurrent: 'üìà',
                frequency: '„Ä∞Ô∏è',
                powerFactor: 'üìê',
                
                // BMSÁ≥ªÁªü - ÂÆûÊó∂Êï∞ÊçÆ
                totalVoltage: '‚ö°',
                totalCurrent: 'üîå',
                batteryPower: 'üîã',
                soc: 'üìä',
                soh: 'üíØ',
                pack: 'üì¶',
                cycles: 'üîÑ',
                
                // BMSÁ≥ªÁªü - ËøêË°åÁªüËÆ°
                dailyCharge: 'üîã',
                dailyDischarge: '‚ö°',
                totalCharge: 'üìà',
                totalDischarge: 'üìâ',
                
                // ÁîµÊ±†Ê®°ÁªÑ
                nominalCapacity: 'üîã',
                batteryActualCapacity: 'üìä',
                batteryEnergyDensity: '‚ö°',
                batteryCRate: 'üìà',
                batteryDod: 'üìâ',
                batteryWeight: '‚öñÔ∏è',
                batteryEfficiency: 'üíØ',
                batteryAgingRate: 'üìÖ',
                
                // Ê∏©ÊéßÁ≥ªÁªü - Ê†∏ÂøÉÁõëÊéßÂèÇÊï∞
                battMaxTemp: 'üå°Ô∏è',
                battMinTemp: 'üå°Ô∏è',
                battAvgTemp: 'üå°Ô∏è',
                battTempDiff: 'üìä',
                inletTemp: 'üå°Ô∏è',
                outletTemp: 'üå°Ô∏è',
                humidity: 'üíß',
                coolantTemp: 'üå°Ô∏è',
                
                // Ê∏©ÊéßÁ≥ªÁªü - ËøêË°åÁä∂ÊÄÅ
                thermalManagementStatus: 'üå°Ô∏è',
                runningMode: '‚ùÑÔ∏è',
                
                // Ê∂àÈò≤Á≥ªÁªü
                smokeLevel: 'üí®',
                fireAlarm: 'üö®',
                extinguisherStatus: 'üßØ',
                emergencyStop: 'üõë',
                
                // ÁîµË°®Á≥ªÁªü - ÁîµËÉΩËÆ°Èáè
                totalActivePower: 'üè≠',
                totalReactivePower: 'üåä',
                totalApparentPower: 'üíé',
                frequency: '‚ö°',
                
                // ÁîµË°®Á≥ªÁªü - ÁîµÂéãÁîµÊµÅ
                meterVoltage: 'üî∫',
                meterCurrent: 'üîÉ',
                
                // ÁîµË°®Á≥ªÁªü - ÁîµËÉΩÁªüËÆ°
                dailyActiveEnergy: 'üìÑ',
                dailyReactiveEnergy: 'üåÄ',
                totalActiveEnergy: 'üìö',
                totalReactiveEnergy: 'üí∞'
            };
            return iconMap[field] || 'üìä';
        }

        // Ëé∑ÂèñÂ≠óÊÆµÂÄºÔºàÊ®°ÊãüÊï∞ÊçÆÔºâ
        function getFieldValue(field) {
            const valueMap = {
                // Êï¥Êú∫Ê¶ÇËßà - Ê†∏ÂøÉËøêË°åÂèÇÊï∞
                soc: (85 + Math.random() * 10).toFixed(1),
                soh: (96 + Math.random() * 2).toFixed(1),
                temperature: (25 + Math.random() * 10).toFixed(1),
                power: (Math.random() > 0.5 ? '+' : '-') + (100 + Math.random() * 50).toFixed(1),
                batteryCurrent: (150 + Math.random() * 50).toFixed(1),
                batteryVoltage: (750 + Math.random() * 20).toFixed(1),
                
                // Êï¥Êú∫Ê¶ÇËßà - ËøêË°åÁªüËÆ°
                todayCharge: (850 + Math.random() * 100).toFixed(1),
                todayDischarge: (720 + Math.random() * 100).toFixed(1),
                totalCharge: (186.5 + Math.random() * 0.5).toFixed(1),
                totalDischarge: (179.0 + Math.random() * 0.5).toFixed(1),
                
                // Êï¥Êú∫Ê¶ÇËßà - ÂÖ∂‰ªñÂèÇÊï∞
                cycles: Math.floor(1850 + Math.random() * 50),
                maxPower: '250',
                
                // EMSÊéßÂà∂Âô® - CPUÁä∂ÊÄÅ
                cpuUsage: '35',
                cpuTemp: '45',
                
                // EMSÊéßÂà∂Âô® - ÂÜÖÂ≠òÁä∂ÊÄÅ
                memoryUsage: '62',
                
                // EMSÊéßÂà∂Âô® - Á£ÅÁõòÁä∂ÊÄÅ
                diskUsage: '35',
                
                // EMSÊéßÂà∂Âô® - ÂºÄÂèëÊùøÊ∏©Â∫¶
                boardTemp: '38',
                
                // EMSÊéßÂà∂Âô® - 4GÁΩëÁªúÁä∂ÊÄÅ
                signalStrength: '-65',
                simStatus: 'Â∑≤ÊèíÂÖ•',
                networkStatus: 'ÂºÄ',
                
                // EMSÊéßÂà∂Âô® - WiFiÁä∂ÊÄÅ
                wifiSignal: '-79',
                wifiConnection: 'ÂÖ≥',
                
                // EMSÊéßÂà∂Âô® - Á≥ªÁªü‰ø°ÊÅØ
                runTime: '15Â§© 8Â∞èÊó∂ 32ÂàÜ',  // ‰øùÁïôÊï∞ÂÄº‰ΩÜ‰∏çÊòæÁ§∫Êó∂Èíü
                systemTime: '2025-07-11 09:42',
                hardwareTime: '2025-07-11 09:42',
                
                // PCSÈÄÜÂèòÂô® - ÁîµÁΩë‰æßÁîµÂéãÔºà‰∏âÁõ∏Ôºâ
                gridVoltageA: (380 + Math.random() * 10).toFixed(1),
                gridVoltageB: (378 + Math.random() * 12).toFixed(1),
                gridVoltageC: (382 + Math.random() * 8).toFixed(1),
                
                // PCSÈÄÜÂèòÂô® - ÁîµÁΩë‰æßÁîµÊµÅÔºà‰∏âÁõ∏Ôºâ
                gridCurrentA: (85 + Math.random() * 15).toFixed(1),
                gridCurrentB: (87 + Math.random() * 13).toFixed(1),
                gridCurrentC: (83 + Math.random() * 17).toFixed(1),
                
                // PCSÈÄÜÂèòÂô® - ÁîµÁΩë‰æßÂäüÁéáÔºà‰∏âÁõ∏Ôºâ
                gridPowerA: (40 + Math.random() * 20).toFixed(1),
                gridPowerB: (42 + Math.random() * 18).toFixed(1),
                gridPowerC: (38 + Math.random() * 22).toFixed(1),
                totalPower: (120 + Math.random() * 50).toFixed(1),
                
                // PCSÈÄÜÂèòÂô® - Ê∏©Â∫¶
                transformerTemp: (50 + Math.random() * 5).toFixed(1),
                
                // ÁîµË°®Á≥ªÁªü - ÁîµËÉΩËÆ°Èáè
                totalActivePower: (150 + Math.random() * 100).toFixed(1),
                totalReactivePower: (25 + Math.random() * 15).toFixed(1),
                totalApparentPower: (155 + Math.random() * 105).toFixed(1),
                frequency: (49.95 + Math.random() * 0.1).toFixed(2),
                
                // ÁîµË°®Á≥ªÁªü - ÁîµÂéãÁîµÊµÅÔºà‰∏âÁõ∏Êï∞ÊçÆÔºâ
                meterVoltageA: (380 + Math.random() * 10).toFixed(1),
                meterVoltageB: (381 + Math.random() * 9).toFixed(1),
                meterVoltageC: (379 + Math.random() * 11).toFixed(1),
                meterCurrentA: (125 + Math.random() * 50).toFixed(1),
                meterCurrentB: (128 + Math.random() * 48).toFixed(1),
                meterCurrentC: (122 + Math.random() * 52).toFixed(1),
                
                // ÁîµË°®Á≥ªÁªü - ÁîµËÉΩÁªüËÆ°
                dailyActiveEnergy: (1250 + Math.random() * 200).toFixed(1),
                dailyReactiveEnergy: (180 + Math.random() * 40).toFixed(1),
                totalActiveEnergy: (45.2 + Math.random() * 10).toFixed(1),
                totalReactiveEnergy: (6.8 + Math.random() * 2).toFixed(1),
                
                // BMSÁ≥ªÁªü - ÂÆûÊó∂Êï∞ÊçÆ
                totalVoltage: (756 + Math.random() * 20).toFixed(1),
                totalCurrent: (150 + Math.random() * 50).toFixed(1),
                batteryPower: (120 + Math.random() * 80).toFixed(1),
                soc: (85 + Math.random() * 10).toFixed(1),
                soh: (96 + Math.random() * 2).toFixed(1),
                pack: 4,
                cycles: (2847 + Math.floor(Math.random() * 100)),
                
                // BMSÁ≥ªÁªü - ËøêË°åÁªüËÆ°
                dailyCharge: (286.5 + Math.random() * 50).toFixed(1),
                dailyDischarge: (245.8 + Math.random() * 40).toFixed(1),
                totalCharge: (1247.3 + Math.random() * 100).toFixed(1),
                totalDischarge: (1156.8 + Math.random() * 80).toFixed(1),
                
                // BMSÁ≥ªÁªü - PackÁîµÊ±†Á∞á‰ø°ÊÅØ
                pack1Voltage: (189 + Math.random() * 5).toFixed(1),
                pack1Current: (37.5 + Math.random() * 12.5).toFixed(1),
                pack1Soc: (85 + Math.random() * 8).toFixed(1),
                pack1Soh: (96 + Math.random() * 3).toFixed(1),
                pack1Temp: (28 + Math.random() * 4).toFixed(1),
                pack2Voltage: (188.5 + Math.random() * 5).toFixed(1),
                pack2Current: (38 + Math.random() * 12).toFixed(1),
                pack2Soc: (84.5 + Math.random() * 8).toFixed(1),
                pack2Soh: (95.5 + Math.random() * 3).toFixed(1),
                pack2Temp: (29 + Math.random() * 4).toFixed(1),
                pack3Voltage: (189.2 + Math.random() * 5).toFixed(1),
                pack3Current: (37.8 + Math.random() * 12.2).toFixed(1),
                pack3Soc: (85.2 + Math.random() * 7.8).toFixed(1),
                pack3Soh: (96.2 + Math.random() * 2.8).toFixed(1),
                pack3Temp: (27.5 + Math.random() * 4.5).toFixed(1),
                pack4Voltage: (188.8 + Math.random() * 5).toFixed(1),
                pack4Current: (38.2 + Math.random() * 11.8).toFixed(1),
                pack4Soc: (84.8 + Math.random() * 8.2).toFixed(1),
                pack4Soh: (95.8 + Math.random() * 3.2).toFixed(1),
                pack4Temp: (28.5 + Math.random() * 4).toFixed(1),
                
                // Ê∏©ÊéßÁ≥ªÁªü - Ê†∏ÂøÉÁõëÊéßÂèÇÊï∞
                battMaxTemp: (35 + Math.random() * 5).toFixed(1),
                battMinTemp: (25 + Math.random() * 3).toFixed(1),
                battAvgTemp: (30 + Math.random() * 3).toFixed(1),
                battTempDiff: (5 + Math.random() * 3).toFixed(1),
                inletTemp: (32 + Math.random() * 3).toFixed(1),
                outletTemp: (26 + Math.random() * 2).toFixed(1),
                humidity: (45 + Math.random() * 10).toFixed(1),
                coolantTemp: (22 + Math.random() * 3).toFixed(1),
                
                // Ê∏©ÊéßÁ≥ªÁªü - ËøêË°åÁä∂ÊÄÅ
                thermalManagementStatus: (28 + Math.random() * 5).toFixed(1),
                runningMode: Math.random() > 0.3 ? 'Âà∂ÂÜ∑' : 'Âà∂ÁÉ≠',
                
                // Ê∂àÈò≤Á≥ªÁªü - ÁÅ´ÁÅæÊé¢Êµã
                smokeDetector1: '',  // Áä∂ÊÄÅÂûãÂ≠óÊÆµÔºå‰∏çÊòæÁ§∫Êï∞ÂÄº
                fireAlarmStatus: '',  // Áä∂ÊÄÅÂûãÂ≠óÊÆµÔºå‰∏çÊòæÁ§∫Êï∞ÂÄº
                
                // Ê∂àÈò≤Á≥ªÁªü - Ê∂àÈò≤ËÅîÂä®
                extinguisherStatus: '',  // Áä∂ÊÄÅÂûãÂ≠óÊÆµÔºå‰∏çÊòæÁ§∫Êï∞ÂÄº
                emergencyStop: '',  // Áä∂ÊÄÅÂûãÂ≠óÊÆµÔºå‰∏çÊòæÁ§∫Êï∞ÂÄº
                evacuationAlarm: ''  // Áä∂ÊÄÅÂûãÂ≠óÊÆµÔºå‰∏çÊòæÁ§∫Êï∞ÂÄº
            };
            return valueMap[field] || '0';
        }

        // Ëé∑ÂèñÂ≠óÊÆµÁä∂ÊÄÅ
        function getFieldStatus(field) {
            const statusMap = {
                // Êï¥Êú∫Ê¶ÇËßà - Ê†∏ÂøÉËøêË°åÂèÇÊï∞
                soc: 'ÁîµÈáèÂÖÖË∂≥',
                soh: 'ÂÅ•Â∫∑ËâØÂ•Ω',
                temperature: 'Ê∏©Â∫¶Ê≠£Â∏∏',
                power: 'ÂÖÖÁîµ‰∏≠',
                batteryCurrent: 'ÁîµÊµÅÊ≠£Â∏∏',
                batteryVoltage: 'ÁîµÂéãÁ®≥ÂÆö',
                
                // Êï¥Êú∫Ê¶ÇËßà - ËøêË°åÁªüËÆ°
                todayCharge: '',
                todayDischarge: '',
                totalCharge: '',
                totalDischarge: '',
                
                // Êï¥Êú∫Ê¶ÇËßà - ÂÖ∂‰ªñÂèÇÊï∞
                cycles: 'ÂÅ•Â∫∑ËåÉÂõ¥',
                maxPower: '',
                
                // EMSÊéßÂà∂Âô®
                cpuUsage: '',
                cpuTemp: 'Ê∏©Â∫¶Ê≠£Â∏∏',
                memoryUsage: '',
                diskUsage: '',
                boardTemp: 'Ê∏©Â∫¶Ê≠£Â∏∏',
                signalStrength: '‰ø°Âè∑ËâØÂ•Ω',
                simStatus: '',
                networkStatus: '',
                wifiSignal: '‰ø°Âè∑ËâØÂ•Ω',
                wifiConnection: '',
                runTime: '',
                systemTime: '',
                hardwareTime: '',
                
                // PCSÈÄÜÂèòÂô® - ÁîµÁΩë‰æßÁîµÂéã
                gridVoltageA: 'AÁõ∏ÁîµÂéãÊ≠£Â∏∏',
                gridVoltageB: 'BÁõ∏ÁîµÂéãÊ≠£Â∏∏',
                gridVoltageC: 'CÁõ∏ÁîµÂéãÊ≠£Â∏∏',
                
                // PCSÈÄÜÂèòÂô® - ÁîµÁΩë‰æßÁîµÊµÅ
                gridCurrentA: 'AÁõ∏ÁîµÊµÅÁ®≥ÂÆö',
                gridCurrentB: 'BÁõ∏ÁîµÊµÅÁ®≥ÂÆö',
                gridCurrentC: 'CÁõ∏ÁîµÊµÅÁ®≥ÂÆö',
                
                // PCSÈÄÜÂèòÂô® - ÁîµÁΩë‰æßÂäüÁéá
                gridPowerA: 'AÁõ∏ÂäüÁéáÊ≠£Â∏∏',
                gridPowerB: 'BÁõ∏ÂäüÁéáÊ≠£Â∏∏',
                gridPowerC: 'CÁõ∏ÂäüÁéáÊ≠£Â∏∏',
                totalPower: 'ÊÄªÂäüÁéáÁ®≥ÂÆö',
                
                // PCSÈÄÜÂèòÂô® - Ê∏©Â∫¶
                transformerTemp: 'Ê∏©Â∫¶Ê≠£Â∏∏',
                
                // ÁîµË°®Á≥ªÁªü - ÁîµËÉΩËÆ°Èáè
                totalActivePower: '',
                totalReactivePower: '',
                totalApparentPower: '',
                frequency: '',
                
                // ÁîµË°®Á≥ªÁªü - ÁîµÂéãÁîµÊµÅ
                meterVoltageA: '',
                meterVoltageB: '',
                meterVoltageC: '',
                meterCurrentA: '',
                meterCurrentB: '',
                meterCurrentC: '',
                
                // ÁîµË°®Á≥ªÁªü - ÁîµËÉΩÁªüËÆ°
                dailyActiveEnergy: '',
                dailyReactiveEnergy: '',
                totalActiveEnergy: '',
                totalReactiveEnergy: '',
                
                // BMSÁ≥ªÁªü - ÂÆûÊó∂Êï∞ÊçÆ
                totalVoltage: 'ÁîµÂéãÊ≠£Â∏∏',
                totalCurrent: 'ÁîµÊµÅÁ®≥ÂÆö',
                batteryPower: 'ÂäüÁéáÁ®≥ÂÆö',
                soc: '',
                soh: 'SOHËâØÂ•Ω',
                pack: '',
                cycles: 'ÂØøÂëΩÊ≠£Â∏∏',
                
                // BMSÁ≥ªÁªü - ËøêË°åÁªüËÆ°
                dailyCharge: '',
                dailyDischarge: '',
                totalCharge: '',
                totalDischarge: '',
                
                // BMSÁ≥ªÁªü - Âçï‰ΩìÁîµËäØÁõëÊéß
                maxCellVoltage: 'ÊúÄÈ´òÁîµÂéãÊ≠£Â∏∏',
                minCellVoltage: 'ÊúÄ‰ΩéÁîµÂéãÊ≠£Â∏∏',
                voltageDiff: 'ÂéãÂ∑ÆÊ≠£Â∏∏',
                consistency: '‰∏ÄËá¥ÊÄßËâØÂ•Ω',
                abnormalCells: 'Êó†ÂºÇÂ∏∏',
                totalCells: 'Êï∞ÈáèÊ≠£Á°Æ',
                samplingAccuracy: 'Á≤æÂ∫¶ËâØÂ•Ω',
                
                // BMSÁ≥ªÁªü - ÂÆâÂÖ®‰øùÊä§ÂèÇÊï∞
                overvoltageProtection: '‰øùÊä§Ê≠£Â∏∏',
                undervoltageProtection: '‰øùÊä§Ê≠£Â∏∏',
                overcurrentProtection: '‰øùÊä§Ê≠£Â∏∏',
                overtemperatureProtection: '‰øùÊä§Ê≠£Â∏∏',
                shortcircuitProtection: '‰øùÊä§Ê≠£Â∏∏',
                faultCode: 'Êó†ÊïÖÈöú',
                hardwareVersion: 'ÊúÄÊñ∞ÁâàÊú¨',
                
                // ÁîµÊ±†Ê®°ÁªÑ - ÁîµÊ±†ÊÄßËÉΩÂèÇÊï∞
                nominalCapacity: 'ËÆæËÆ°ÂÆπÈáè',
                batteryActualCapacity: 'ËøêË°åÂÆπÈáè',
                batteryEnergyDensity: 'È´òËÉΩÈáèÂØÜÂ∫¶',
                batteryCRate: 'Ê†áÂáÜÂÄçÁéá',
                batteryDod: 'Ê∑±Â∫¶ÊîæÁîµ',
                batteryWeight: 'Ê†áÂáÜÈáçÈáè',
                batteryEfficiency: 'È´òÊïàËøêË°å',
                batteryAgingRate: 'Ê≠£Â∏∏ËÄÅÂåñ',
                
                // Ê∏©ÊéßÁ≥ªÁªü - Ê†∏ÂøÉÁõëÊéßÂèÇÊï∞
                battMaxTemp: 'Ê∏©Â∫¶Ê≠£Â∏∏',
                battMinTemp: 'Ê∏©Â∫¶Ê≠£Â∏∏',
                battAvgTemp: 'Âπ≥ÂùáÊ∏©Â∫¶Ê≠£Â∏∏',
                battTempDiff: 'Ê∏©Â∑ÆÊ≠£Â∏∏',
                inletTemp: 'ËøõÈ£éÊ∏©Â∫¶Ê≠£Â∏∏',
                outletTemp: 'Âá∫È£éÊ∏©Â∫¶Ê≠£Â∏∏',
                humidity: 'ÊπøÂ∫¶Ê≠£Â∏∏',
                coolantTemp: 'ÂÜ∑Âç¥Ê∂≤Ê∏©Â∫¶Ê≠£Â∏∏',
                
                // Ê∏©ÊéßÁ≥ªÁªü - ËøêË°åÁä∂ÊÄÅ
                thermalManagementStatus: 'Ê∏©Â∫¶Ê≠£Â∏∏',
                runningMode: '',
                
                // Ê∂àÈò≤Á≥ªÁªü - ÁÅ´ÁÅæÊé¢Êµã
                smokeDetector1: 'Êé¢ÊµãÂô®Ê≠£Â∏∏',
                fireAlarmStatus: 'ÁÅ´Ë≠¶Áä∂ÊÄÅÊ≠£Â∏∏',
                
                // Ê∂àÈò≤Á≥ªÁªü - Ê∂àÈò≤ËÅîÂä®
                extinguisherStatus: 'ÁÅ≠ÁÅ´Âô®Â∞±Áª™',
                emergencyStop: 'Êú™Ëß¶Âèë',
                evacuationAlarm: 'Ë≠¶Êä•Ê≠£Â∏∏'
            };
            return statusMap[field] || '';
        }

        // ÂàùÂßãÂåñÁâπÂÆöÂõæË°®
        function initSpecificChart(canvas, type) {
            const ctx = canvas.getContext('2d');
            
            switch(type) {
                case 'powerHistory':
                    // ÂäüÁéáÊõ≤Á∫ø
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array.from({length: 24}, (_, i) => i + ':00'),
                            datasets: [{
                                label: 'ÂäüÁéá (kW)',
                                data: Array.from({length: 24}, () => (Math.random() - 0.5) * 200),
                                borderColor: '#00d4ff',
                                backgroundColor: 'rgba(0, 212, 255, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: getChartOptions('ÂäüÁéá (kW)')
                    });
                    break;
                    
                case 'socHistory':
                    // SOC‰∏éÂÖÖÊîæÁîµÁä∂ÊÄÅ
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array.from({length: 24}, (_, i) => i + ':00'),
                            datasets: [{
                                label: 'SOC (%)',
                                data: Array.from({length: 24}, (_, i) => {
                                    const base = 85;
                                    return base + Math.sin(i * 0.3) * 15;
                                }),
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: getChartOptions('SOC (%)', 0, 100)
                    });
                    break;
                    
                case 'tempHistory':
                    // ÁîµÊ±†Ê∏©Â∫¶ÂàÜÂ∏É
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array.from({length: 24}, (_, i) => i + ':00'),
                            datasets: [{
                                label: 'ÊúÄÈ´òÊ∏©Â∫¶',
                                data: Array.from({length: 24}, () => 25 + Math.random() * 10),
                                borderColor: '#ef4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                tension: 0.4
                            }, {
                                label: 'Âπ≥ÂùáÊ∏©Â∫¶',
                                data: Array.from({length: 24}, () => 22 + Math.random() * 8),
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                tension: 0.4
                            }, {
                                label: 'ÊúÄ‰ΩéÊ∏©Â∫¶',
                                data: Array.from({length: 24}, () => 20 + Math.random() * 6),
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: getChartOptions('Ê∏©Â∫¶ (¬∞C)')
                    });
                    break;
                    
                case 'voltageConsistency':
                    // ÁîµÂéã‰∏ÄËá¥ÊÄß
                    new Chart(ctx, {
                        type: 'scatter',
                        data: {
                            datasets: [{
                                label: 'ÁîµÂéãÂàÜÂ∏É',
                                data: Array.from({length: 100}, () => ({
                                    x: Math.random() * 100,
                                    y: 3.2 + Math.random() * 0.6
                                })),
                                backgroundColor: 'rgba(0, 212, 255, 0.6)',
                                borderColor: '#00d4ff'
                            }]
                        },
                        options: getChartOptions('ÁîµÂéã (V)', 3.0, 4.0)
                    });
                    break;
                    
                case 'efficiencyAnalysis':
                    // ÂÖÖÊîæÁîµÊïàÁéáÂàÜÊûê
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà'],
                            datasets: [{
                                label: 'ÂÖÖÁîµÊïàÁéá (%)',
                                data: Array.from({length: 6}, () => 92 + Math.random() * 6),
                                backgroundColor: 'rgba(16, 185, 129, 0.8)',
                                borderColor: '#10b981'
                            }, {
                                label: 'ÊîæÁîµÊïàÁéá (%)',
                                data: Array.from({length: 6}, () => 90 + Math.random() * 8),
                                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                borderColor: '#3b82f6'
                            }]
                        },
                        options: getChartOptions('ÊïàÁéá (%)', 80, 100)
                    });
                    break;
                    
                case 'arbitrageAnalysis':
                    // Â≥∞Ë∞∑Â•óÂà©ÂàÜÊûê
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                            datasets: [{
                                label: 'Áîµ‰ª∑ (ÂÖÉ/kWh)',
                                data: [0.3, 0.28, 0.65, 0.58, 0.72, 0.45],
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                yAxisID: 'y'
                            }, {
                                label: 'ÂäüÁéá (kW)',
                                data: [150, 120, -180, -160, -200, 100],
                                borderColor: '#00d4ff',
                                backgroundColor: 'rgba(0, 212, 255, 0.1)',
                                yAxisID: 'y1'
                            }]
                        },
                        options: {
                            ...getChartOptions(),
                            scales: {
                                x: {
                                    grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                    ticks: { 
                                        color: 'rgba(255, 255, 255, 0.7)',
                                        font: { size: 14 }
                                    }
                                },
                                y: {
                                    type: 'linear',
                                    display: true,
                                    position: 'left',
                                    title: { display: true, text: 'Áîµ‰ª∑ (ÂÖÉ/kWh)', color: 'rgba(255, 255, 255, 0.8)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                    ticks: { 
                                        color: 'rgba(255, 255, 255, 0.7)',
                                        font: { size: 14 }
                                    }
                                },
                                y1: {
                                    type: 'linear',
                                    display: true,
                                    position: 'right',
                                    title: { display: true, text: 'ÂäüÁéá (kW)', color: 'rgba(255, 255, 255, 0.8)' },
                                    grid: { drawOnChartArea: false },
                                    ticks: { 
                                        color: 'rgba(255, 255, 255, 0.7)',
                                        font: { size: 14 }
                                    }
                                }
                            }
                        }
                    });
                    break;
                    
                case 'sohTrend':
                    // ÂÅ•Â∫∑Â∫¶Ë∂ãÂäø
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['2024-01', '2024-03', '2024-05', '2024-07', '2024-09', '2024-11'],
                            datasets: [{
                                label: 'SOH (%)',
                                data: [100, 99.2, 98.5, 97.8, 97.1, 96.8],
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: getChartOptions('SOH (%)', 95, 100)
                    });
                    break;
                    
                default:
                    // ÈªòËÆ§ÂõæË°®
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array(24).fill('').map((_, i) => i + ':00'),
                            datasets: [{
                                label: 'Êï∞ÊçÆË∂ãÂäø',
                                data: Array(24).fill(0).map(() => Math.random() * 100),
                                borderColor: '#00d4ff',
                                backgroundColor: 'rgba(0, 212, 255, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: getChartOptions()
                    });
            }
        }

        // Ëé∑ÂèñÂõæË°®ÈÄöÁî®ÈÖçÁΩÆ
        function getChartOptions(yAxisTitle = '', minY = null, maxY = null) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { 
                            color: 'rgba(255, 255, 255, 0.9)',
                            font: { size: 16 }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { color: 'rgba(255, 255, 255, 0.05)' },
                        ticks: { 
                            color: 'rgba(255, 255, 255, 0.7)',
                            font: { size: 14 }
                        }
                    },
                    y: {
                        grid: { color: 'rgba(255, 255, 255, 0.05)' },
                        ticks: { 
                            color: 'rgba(255, 255, 255, 0.7)',
                            font: { size: 14 }
                        },
                        title: yAxisTitle ? { 
                            display: true, 
                            text: yAxisTitle, 
                            color: 'rgba(255, 255, 255, 0.8)' 
                        } : undefined,
                        min: minY,
                        max: maxY
                    }
                }
            };
        }

        // È°µÈù¢ÂØºËà™ÂäüËÉΩ
        function switchPage(page) {
            if (page === 'home') {
                window.location.href = 'index.html';
            } else if (page === 'data') {
                window.location.href = 'data.html';
            } else if (page === 'control') {
                window.location.href = 'control.html';
            } else if (page === 'alarm') {
                window.location.href = 'alarm.html';
            } else if (page === 'history') {
                window.location.href = 'history.html';
            } else if (page === 'log') {
                window.location.href = 'logs.html';
            } else if (page === 'settings') {
                window.location.href = 'settings.html';
            }
        }

        // Êõ¥Êñ∞Êó∂Èó¥
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeStr;
        }
        
        // Êõ¥Êñ∞ÁªÑ‰ª∂Áä∂ÊÄÅ
        function updateComponentStatuses() {
            const components = ['pcs', 'bms', 'meter', 'thermal', 'fire'];
            
            // ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™ÁªÑ‰ª∂ÊòæÁ§∫Á¶ªÁ∫ø
            const offlineIndex = Math.floor(Math.random() * components.length);
            
            // ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™ÁªÑ‰ª∂ÊòæÁ§∫ÂºÇÂ∏∏Ôºà‰∏çËÉΩÊòØÁ¶ªÁ∫øÁöÑÈÇ£‰∏™Ôºâ
            let errorIndex;
            do {
                errorIndex = Math.floor(Math.random() * components.length);
            } while (errorIndex === offlineIndex);
            
            components.forEach((component, index) => {
                const statusElement = document.getElementById(`${component}-status`);
                if (statusElement) {
                    let status;
                    if (index === offlineIndex) {
                        // Ëøô‰∏™ÁªÑ‰ª∂ÊòæÁ§∫Á¶ªÁ∫ø
                        status = { text: 'Á¶ªÁ∫ø', class: 'status-offline' };
                    } else if (index === errorIndex) {
                        // Ëøô‰∏™ÁªÑ‰ª∂ÊòæÁ§∫ÂºÇÂ∏∏
                        status = { text: 'ÂºÇÂ∏∏', class: 'status-error' };
                    } else {
                        // ÂÖ∂‰ªñÁªÑ‰ª∂ÊòæÁ§∫Ê≠£Â∏∏
                        status = { text: 'Ê≠£Â∏∏', class: 'status-normal' };
                    }
                    
                    // Êõ¥Êñ∞Áä∂ÊÄÅÊñáÊú¨ÂíåÊ†∑Âºè
                    statusElement.textContent = status.text;
                    statusElement.className = `component-status ${status.class}`;
                }
            });
        }

        // ËØ≠Ë®ÄÁøªËØëÈÖçÁΩÆ
        const translations = {
            zh: {
                // È°µÈù¢Ê†áÈ¢ò
                pageTitle: 'Êï∞ÊçÆÁõëÊéß',
                currentTime: 'ÂΩìÂâçÊó∂Èó¥',
                switchLanguage: 'ÂàáÊç¢ËØ≠Ë®Ä',
                
                // ÂØºËà™ËèúÂçï
                overview: 'Êï¥Êú∫',
                ems: 'EMS',
                pcs: 'PCS',
                meter: 'ÁîµË°®',
                bms: 'BMS',
                thermal: 'Ê∏©Â∫¶',
                fire: 'Ê∂àÈò≤',
                
                // Ê†áÁ≠æÈ°µ
                realtimeData: 'ÂÆûÊó∂Êï∞ÊçÆ',
                historyData: 'ÂéÜÂè≤Êï∞ÊçÆ',
                customize: 'Ëá™ÂÆö‰πâ',
                
                // Á°ÆËÆ§ÂØπËØùÊ°Ü
                cancel: 'ÂèñÊ∂à',
                confirm: 'Á°ÆÂÆö',
                
                // Â≠óÊÆµËÆæÁΩÆ
                fieldSettings: 'Â≠óÊÆµËÆæÁΩÆ',
                save: '‰øùÂ≠ò',
                
                // ÂÇ®ËÉΩÊüúÁä∂ÊÄÅ
                cabinetStatus: 'ÂÇ®ËÉΩÊüúÁä∂ÊÄÅ',
                onlineRunning: 'Âú®Á∫øËøêË°å',
                
                // Êï∞ÊçÆËäÇÊ†áÈ¢ò
                coreParams: 'Ê†∏ÂøÉËøêË°åÂèÇÊï∞',
                runStats: 'ËøêË°åÁªüËÆ°',
                otherParams: 'ÂÖ∂‰ªñÂèÇÊï∞',
                strategySchedule: 'Á≠ñÁï•Ë∞ÉÂ∫¶ÂèÇÊï∞',
                commControl: 'ÈÄö‰ø°ÊéßÂà∂ÂèÇÊï∞',
                batteryStatus: 'ÁîµÊ±†Áä∂ÊÄÅÂèÇÊï∞',
                systemManagement: 'Á≥ªÁªüÁÆ°ÁêÜ',
                moduleBasicInfo: 'Ê®°ÁªÑÂü∫Êú¨‰ø°ÊÅØ',
                cellMonitoring: 'Âçï‰ΩìÁõëÊéß',
                acSystem: 'Á©∫Ë∞ÉÁ≥ªÁªü',
                fanSystem: 'È£éÊâáÁ≥ªÁªü',
                fireDetection: 'ÁÅ´ÁÅæÊé¢Êµã',
                fireLinkage: 'Ê∂àÈò≤ËÅîÂä®'
            },
            en: {
                // Page titles
                pageTitle: 'Data Monitoring',
                currentTime: 'Current Time',
                switchLanguage: 'Switch Language',
                
                // Navigation menu
                overview: 'System',
                ems: 'EMS',
                pcs: 'PCS',
                meter: 'Meter',
                bms: 'BMS',
                thermal: 'Temperature',
                fire: 'Fire Protection',
                
                // Tabs
                realtimeData: 'Real-time Data',
                historyData: 'History Data',
                customize: 'Customize',
                
                // Confirmation dialog
                cancel: 'Cancel',
                confirm: 'Confirm',
                
                // Field settings
                fieldSettings: 'Field Settings',
                save: 'Save',
                
                // Cabinet status
                cabinetStatus: 'Cabinet Status',
                onlineRunning: 'Online Running',
                
                // Data section titles
                coreParams: 'Core Operating Parameters',
                runStats: 'Running Statistics',
                otherParams: 'Other Parameters',
                strategySchedule: 'Strategy Scheduling Parameters',
                commControl: 'Communication Control Parameters',
                powerConversion: 'Power Conversion Parameters',
                deviceOperation: 'Device Operation Parameters',
                batteryStatus: 'Battery Status Parameters',
                systemManagement: 'System Management',
                moduleBasicInfo: 'Module Basic Info',
                cellMonitoring: 'Cell Monitoring',
                acSystem: 'AC System',
                fanSystem: 'Fan System',
                fireDetection: 'Fire Detection',
                fireLinkage: 'Fire Linkage'
            }
        };
        
        // ÂΩìÂâçËØ≠Ë®Ä
        let currentLang = localStorage.getItem('touchscreen_lang') || 'zh';
        
        // Â∫îÁî®ËØ≠Ë®Ä
        function applyLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            
            // Êõ¥Êñ∞È°µÈù¢Ê†áÈ¢ò
            document.title = t.pageTitle + ' - ÂÇ®ËÉΩÁõëÊéßÁ≥ªÁªü';
            
            // Êõ¥Êñ∞ÂØºËà™ËèúÂçï
            document.querySelectorAll('.component-item span:first-child').forEach((el, index) => {
                const keys = ['overview', 'ems', 'pcs', 'bms', 'meter', 'thermal', 'fire'];
                if (keys[index]) {
                    el.textContent = t[keys[index]];
                }
            });
            
            // Êõ¥Êñ∞ÂÇ®ËÉΩÊüúÁä∂ÊÄÅ
            const cabinetTitle = document.querySelector('.cabinet-status-title');
            if (cabinetTitle) cabinetTitle.textContent = t.cabinetStatus;
            
            const cabinetText = document.querySelector('.cabinet-status-text');
            if (cabinetText) cabinetText.textContent = t.onlineRunning;
            
            // Êõ¥Êñ∞ÊâÄÊúâÊ†áÁ≠æÈ°µÊåâÈíÆ
            document.querySelectorAll('.sub-tab').forEach(tab => {
                if (tab.textContent.includes('ÂÆûÊó∂') || tab.textContent.includes('Real-time')) {
                    tab.textContent = t.realtimeData;
                } else if (tab.textContent.includes('ÂéÜÂè≤') || tab.textContent.includes('History')) {
                    tab.textContent = t.historyData;
                }
            });
            
            // Êõ¥Êñ∞Ëá™ÂÆö‰πâÊåâÈíÆ
            document.querySelectorAll('.data-settings-btn span:last-child').forEach(btn => {
                btn.textContent = t.customize;
            });
            
            // Êõ¥Êñ∞ÊèêÁ§∫ÊñáÂ≠ó
            document.querySelectorAll('.tooltip').forEach((tooltip, index) => {
                if (index === 0) tooltip.textContent = t.switchLanguage;
            });
        }
        
        // ÂàáÊç¢ËØ≠Ë®Ä‰∏ãÊãâËèúÂçï
        // ÂàáÊç¢ËØ≠Ë®Ä‰∏ãÊãâËèúÂçï
        function toggleLanguageDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('langDropdown');
            dropdown.classList.toggle('show');
        }

        // Êõ¥ÊîπËØ≠Ë®Ä
        function changeLanguage(lang, event) {
            event.stopPropagation();
            
            // Êõ¥Êñ∞ÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.lang-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ‰øùÂ≠òËØ≠Ë®ÄËÆæÁΩÆ
            currentLang = lang;
            localStorage.setItem('language', lang);
            
            // ÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
            document.getElementById('langDropdown').classList.remove('show');
            
            // Â∫îÁî®Êñ∞ËØ≠Ë®Ä
            applyLanguage(lang);
        }

        // ÂàáÊç¢Êï∞ÊçÆÊ†áÁ≠æÈ°µ
        function switchDataTab(tab) {
            // Êõ¥Êñ∞ÁªÑ‰ª∂È°πÁä∂ÊÄÅ
            document.querySelectorAll('.component-item').forEach(item => {
                item.classList.remove('active');
                // ÈÄöËøáonclickÂ±ûÊÄßÊü•ÊâæÂØπÂ∫îÁöÑtab
                if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`'${tab}'`)) {
                    item.classList.add('active');
                }
            });

            // ÂàáÊç¢ÂÜÖÂÆπ
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            const targetSection = document.getElementById(tab + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Ê∏≤ÊüìÁªÑ‰ª∂Êï∞ÊçÆ
            renderComponentData(tab);
        }

        // ÂàáÊç¢Â≠êÊ†áÁ≠æÈ°µ
        function switchSubTab(component, tab) {
            // Êõ¥Êñ∞Â≠êÊ†áÁ≠æÁä∂ÊÄÅ
            const section = document.getElementById(component + 'Section');
            section.querySelectorAll('.sub-tab').forEach(btn => {
                btn.classList.remove('active');
                // ÈÄöËøáonclickÂ±ûÊÄßÊü•ÊâæÂØπÂ∫îÁöÑtabÊåâÈíÆ
                if (btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(`'${tab}'`)) {
                    btn.classList.add('active');
                }
            });
            
            // ÂàáÊç¢Â≠êÂÜÖÂÆπ
            section.querySelectorAll('.sub-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(component + '-' + tab).classList.add('active');
            
            // Â¶ÇÊûúÊòØÂéÜÂè≤Êï∞ÊçÆÔºåÊ∏≤ÊüìÂéÜÂè≤ÂõæË°®
            if (tab === 'history') {
                setTimeout(() => {
                    renderHistoryData(component);
                }, 50);
            }
        }

        // ÂàáÊç¢ÂéÜÂè≤Êï∞ÊçÆÊó∂Èó¥ËåÉÂõ¥
        function changeHistoryRange(chart, range, element) {
            if (!element && event && event.target) {
                element = event.target;
            }
            if (element) {
                element.parentElement.querySelectorAll('.time-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                element.classList.add('active');
            }
            // ËøôÈáåÂèØ‰ª•Ê†πÊçÆrangeÊõ¥Êñ∞ÂõæË°®Êï∞ÊçÆ
        }

        // Âº∫Âà∂ÊòæÁ§∫ÊâÄÊúâÈªòËÆ§Êï∞ÊçÆ - ÁÆÄÂçïÂèØÈù†ÁöÑÊñπÊ≥ï
        function showAllDefaultData() {
            const overallConfig = dataFieldsConfig.overall.realtime;
            
            // Á≠ñÁï•Ë∞ÉÂ∫¶ÂèÇÊï∞
            const strategyContainer = document.getElementById('overall-Á≠ñÁï•Ë∞ÉÂ∫¶ÂèÇÊï∞');
            if (strategyContainer) {
                strategyContainer.innerHTML = '';
                const strategyFields = overallConfig['Á≠ñÁï•Ë∞ÉÂ∫¶ÂèÇÊï∞'];
                if (strategyFields) {
                    for (const field in strategyFields) {
                        if (strategyFields[field].default) {
                            const card = createDataCard(field, strategyFields[field]);
                            strategyContainer.appendChild(card);
                        }
                    }
                }
            }
            
            // Ê†∏ÂøÉËøêË°åÂèÇÊï∞
            const coreContainer = document.getElementById('overall-Ê†∏ÂøÉËøêË°åÂèÇÊï∞');
            if (coreContainer) {
                coreContainer.innerHTML = '';
                const coreFields = overallConfig['Ê†∏ÂøÉËøêË°åÂèÇÊï∞'];
                if (coreFields) {
                    for (const field in coreFields) {
                        if (coreFields[field].default) {
                            const card = createDataCard(field, coreFields[field]);
                            coreContainer.appendChild(card);
                        }
                    }
                }
            }
            
            // ËøêË°åÁªüËÆ°
            const statsContainer = document.getElementById('overall-ËøêË°åÁªüËÆ°');
            if (statsContainer) {
                statsContainer.innerHTML = '';
                const statsFields = overallConfig['ËøêË°åÁªüËÆ°'];
                if (statsFields) {
                    for (const field in statsFields) {
                        if (statsFields[field].default) {
                            const card = createDataCard(field, statsFields[field]);
                            statsContainer.appendChild(card);
                        }
                    }
                }
            }
            
            // ÂÖ∂‰ªñÂèÇÊï∞
            const otherContainer = document.getElementById('overall-ÂÖ∂‰ªñÂèÇÊï∞');
            if (otherContainer) {
                otherContainer.innerHTML = '';
                const otherFields = overallConfig['ÂÖ∂‰ªñÂèÇÊï∞'];
                if (otherFields) {
                    for (const field in otherFields) {
                        if (otherFields[field].default) {
                            const card = createDataCard(field, otherFields[field]);
                            otherContainer.appendChild(card);
                        }
                    }
                }
            }
            
        }

        // ÊòæÁ§∫ÂéÜÂè≤Êï∞ÊçÆ
        function showAllHistoryData() {
            renderHistoryData('overall');
        }

        // Ëá™Âä®ÂàùÂßãÂåñÂéÜÂè≤Êï∞ÊçÆ
        function autoInitHistoryData() {
            // Ê£ÄÊü•ÂΩìÂâçÊòØÂê¶Âú®ÂéÜÂè≤Êï∞ÊçÆÊ†áÁ≠æÈ°µ
            const currentTab = document.querySelector('.sub-tab.active');
            if (currentTab && currentTab.textContent === 'ÂéÜÂè≤Êï∞ÊçÆ') {
                // Ëá™Âä®Ê∏≤ÊüìÊï¥Êú∫ÂéÜÂè≤Êï∞ÊçÆ
                renderHistoryData('overall');
            }
        }
        
        // Êõ¥Êñ∞Êï∞ÊçÆÂÄº
        function updateDataValues(component) {
            const section = document.getElementById(component + 'Section');
            if (!section) return;
            
            // Ê£ÄÊü•ÊòØÂê¶Âú®ÂÆûÊó∂Êï∞ÊçÆÊ†áÁ≠æÈ°µ
            const activeSubTab = section.querySelector('.sub-tab.active');
            if (!activeSubTab || !activeSubTab.textContent.includes('ÂÆûÊó∂Êï∞ÊçÆ')) return;
            
            // Êõ¥Êñ∞ÊâÄÊúâÊï∞ÊçÆÂç°ÁâáÁöÑÂÄº
            const dataCards = section.querySelectorAll('.data-card');
            dataCards.forEach(card => {
                // Êü•ÊâæÂ∏¶ÊúâidÁöÑÂÄºÂÖÉÁ¥†
                const valueSpan = card.querySelector('[id$="Value"]');
                if (valueSpan && valueSpan.id) {
                    const fieldName = valueSpan.id.replace('Value', '');
                    
                    // ÁâπÊÆäÂ§ÑÁêÜËøêË°åÊ®°ÂºèÂ≠óÊÆµ
                    if (fieldName === 'runningMode') {
                        valueSpan.textContent = Math.random() > 0.3 ? 'Âà∂ÂÜ∑' : 'Âà∂ÁÉ≠';
                        return;
                    }
                    
                    // ÁâπÊÆäÂ§ÑÁêÜÂÖ∂‰ªñÊñáÊú¨ÂûãÂ≠óÊÆµ
                    if (fieldName === 'thermalManagementStatus' || 
                        fieldName === 'alarmStatus' || 
                        fieldName === 'controlStatus' ||
                        fieldName === 'simStatus' ||
                        fieldName === 'networkStatus' ||
                        fieldName === 'wifiConnection' ||
                        fieldName === 'runTime' ||
                        fieldName === 'systemTime' ||
                        fieldName === 'hardwareTime') {
                        // ‰øùÊåÅÂéüÂÄº‰∏çÂèòÔºåËøô‰∫õÁä∂ÊÄÅÈÄöÂ∏∏‰∏çÈúÄË¶ÅÈ¢ëÁπÅÂèòÂåñ
                        return;
                    }
                    
                    // Êõ¥Êñ∞Êï∞ÂÄºÂûãÊï∞ÊçÆ
                    const currentValue = parseFloat(valueSpan.textContent) || 0;
                    if (!isNaN(currentValue)) {
                        const variation = (Math.random() - 0.5) * 0.1; // ¬±5%ÁöÑÂèòÂåñ
                        const newValue = currentValue * (1 + variation);
                        
                        // ‰øùÁïôÂêàÈÄÇÁöÑÂ∞èÊï∞‰ΩçÊï∞
                        const unitElement = card.querySelector('.card-unit');
                        const unit = unitElement ? unitElement.textContent : '';
                        
                        if (unit.includes('kW') || unit.includes('V') || unit.includes('A') || unit.includes('¬∞C') || unit.includes('‚ÑÉ')) {
                            valueSpan.textContent = newValue.toFixed(1);
                        } else if (unit.includes('%')) {
                            valueSpan.textContent = Math.min(100, Math.max(0, newValue)).toFixed(1);
                        } else {
                            valueSpan.textContent = newValue.toFixed(0);
                        }
                    }
                }
            });
        }

        // Ê£ÄÊü•Â≠óÊÆµÊòØÂê¶Â∫îËØ•ÊòæÁ§∫
        function shouldShowField(component, type, field) {
            // Ê£ÄÊü•Áî®Êà∑ËÆæÁΩÆ
            if (userFieldSettings[component] && userFieldSettings[component][type] && userFieldSettings[component][type][field] !== undefined) {
                return userFieldSettings[component][type][field];
            }
            
            // Â¶ÇÊûúÊ≤°ÊúâÁî®Êà∑ËÆæÁΩÆÔºå‰ΩøÁî®ÈªòËÆ§ÂÄº
            const config = dataFieldsConfig[component] && dataFieldsConfig[component][type];
            if (config) {
                // Ê£ÄÊü•ÊòØÂê¶‰∏∫ÂàÜÁ±ªÁªìÊûÑÔºàÂ¶ÇÂéÜÂè≤Êï∞ÊçÆÔºâ
                for (const category in config) {
                    if (config[category][field]) {
                        return config[category][field].default || false;
                    }
                }
                // Ê£ÄÊü•ÊòØÂê¶‰∏∫Áõ¥Êé•Â≠óÊÆµÁªìÊûÑÔºàÂ¶ÇÂÆûÊó∂Êï∞ÊçÆÁöÑÊüê‰∫õÁªÑ‰ª∂Ôºâ
                if (config[field]) {
                    return config[field].default || false;
                }
            }
            
            return false;
        }

        // Êï¥Êú∫ÂéÜÂè≤Êï∞ÊçÆÂõæË°®ÂàùÂßãÂåñÂáΩÊï∞
        function initOverallHistoryCharts(timeRange = '30d', endDate = null) {
            // ËÆæÁΩÆÈªòËÆ§Êó•Êúü‰∏∫‰ªäÂ§©
            if (!endDate) {
                const today = new Date();
                const picker = document.getElementById('historyEndDatePicker');
                if (picker) {
                    picker.value = today.toISOString().split('T')[0];
                    endDate = today.toISOString().split('T')[0];
                }
            }
            
            // ÁîüÊàêÊØèÊó•Êï∞ÊçÆ
            const { labels, powerData, socData } = generateHistoryDailyData(timeRange, endDate);
            
            // ÂäüÁéá‰∏éSOCÁªºÂêàÂàÜÊûê
            const powerSocCtx = document.getElementById('powerSocChart');
            if (powerSocCtx) {
                // ÈîÄÊØÅÁé∞ÊúâÂõæË°®
                if (chartInstances.powerSocChart) {
                    chartInstances.powerSocChart.destroy();
                }
                
                chartInstances.powerSocChart = new Chart(powerSocCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ÂäüÁéá',
                            data: powerData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y',
                            fill: true
                        }, {
                            label: 'SOC',
                            data: socData,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y1',
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: {
                            padding: {
                                top: 10,
                                right: 15,
                                bottom: 10,
                                left: 15
                            }
                        },
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                align: 'center',
                                labels: {
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    padding: 20,
                                    font: {
                                        size: 13,
                                        weight: '500'
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)',
                                    lineWidth: 1
                                },
                                ticks: {
                                    font: {
                                        size: 12
                                    },
                                    color: '#6b7280'
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'ÂäüÁéá (kW)',
                                    font: {
                                        size: 13,
                                        weight: '600'
                                    },
                                    color: '#10b981'
                                },
                                grid: {
                                    color: 'rgba(16, 185, 129, 0.1)',
                                    lineWidth: 1
                                },
                                ticks: {
                                    font: {
                                        size: 11
                                    },
                                    color: '#10b981'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'SOC (%)',
                                    font: {
                                        size: 13,
                                        weight: '600'
                                    },
                                    color: '#f59e0b'
                                },
                                grid: {
                                    drawOnChartArea: false
                                },
                                ticks: {
                                    font: {
                                        size: 11
                                    },
                                    color: '#f59e0b'
                                }
                            }
                        }
                    }
                });
            }
            
            // Êî∂ÁõäÂàÜÊûê
            initRevenueAnalysisChart();
        }
        
        function generateHistoryDailyData(timeRange, endDate) {
            const labels = [];
            const powerData = [];
            const socData = [];
            
            // ÁîüÊàê24Â∞èÊó∂ÁöÑÊó∂Èó¥ÁÇπÊï∞ÊçÆ
            for (let hour = 0; hour < 24; hour++) {
                labels.push(`${hour.toString().padStart(2, '0')}:00`);
                
                // Ê®°ÊãüÂäüÁéáÊï∞ÊçÆ (-50 Âà∞ 50 kW)ÔºåÊ†πÊçÆÊó∂Èó¥ÊÆµË∞ÉÊï¥
                let basePower = 0;
                if (hour >= 8 && hour <= 18) {
                    // ÁôΩÂ§©ÊîæÁîµ
                    basePower = -20 - Math.random() * 30;
                } else if (hour >= 23 || hour <= 6) {
                    // Â§úÈó¥ÂÖÖÁîµ
                    basePower = 15 + Math.random() * 25;
                } else {
                    // ËøáÊ∏°Êó∂ÊÆµ
                    basePower = (Math.random() - 0.5) * 20;
                }
                powerData.push(basePower);
                
                // Ê®°ÊãüSOCÊï∞ÊçÆÔºåÊ†πÊçÆÂÖÖÊîæÁîµË∞ÉÊï¥
                let socValue;
                if (hour === 0) {
                    socValue = 50 + Math.random() * 20;
                } else {
                    const prevSoc = socData[hour - 1] || 60;
                    const powerEffect = basePower > 0 ? 2 : basePower < 0 ? -1.5 : 0;
                    socValue = Math.max(20, Math.min(95, prevSoc + powerEffect + (Math.random() - 0.5) * 3));
                }
                socData.push(socValue);
            }
            
            return { labels, powerData, socData };
        }
        
        function initRevenueAnalysisChart() {
            const ctx = document.getElementById('revenueAnalysisChart');
            if (!ctx) return;
            
            // ÈîÄÊØÅÁé∞ÊúâÂõæË°®
            if (chartInstances.revenueAnalysisChart) {
                chartInstances.revenueAnalysisChart.destroy();
            }
            
            const timeType = document.getElementById('revenueTimeType')?.value || 'day';
            const { labels, chargingData, dischargingData, revenueData } = generateRevenueData(timeType);
            
            chartInstances.revenueAnalysisChart = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ÂÖÖÁîµÈáè (kWh)',
                        data: chargingData,
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderColor: '#10b981',
                        borderWidth: 1,
                        yAxisID: 'y'
                    }, {
                        label: 'ÊîæÁîµÈáè (kWh)',
                        data: dischargingData,
                        backgroundColor: 'rgba(239, 68, 68, 0.8)',
                        borderColor: '#ef4444',
                        borderWidth: 1,
                        yAxisID: 'y'
                    }, {
                        label: 'ÂáÄÊî∂Áõä (¬•)',
                        data: revenueData,
                        type: 'line',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderColor: '#f59e0b',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: false,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'ÁîµÈáè (kWh)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Êî∂Áõä (¬•)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }
        
        function generateRevenueData(timeType) {
            let labels, chargingData, dischargingData, revenueData;
            
            if (timeType === 'day') {
                // Êó•ÔºöxËΩ¥‰∏∫Êó∂Èó¥ÁÇπÔºà24Â∞èÊó∂Ôºâ
                labels = [];
                chargingData = [];
                dischargingData = [];
                revenueData = [];
                for (let i = 0; i < 24; i += 2) {
                    labels.push(`${i.toString().padStart(2, '0')}:00`);
                    // Â§úÈó¥ÂÖÖÁîµÂ§öÔºåÁôΩÂ§©ÊîæÁîµÂ§ö
                    const charging = (i >= 22 || i <= 6) ? 15 + Math.random() * 20 : 5 + Math.random() * 10;
                    const discharging = (i >= 8 && i <= 18) ? 20 + Math.random() * 25 : 8 + Math.random() * 12;
                    const revenue = discharging * 0.8 - charging * 0.6 + Math.random() * 50;
                    chargingData.push(charging);
                    dischargingData.push(discharging);
                    revenueData.push(revenue);
                }
            } else if (timeType === 'month') {
                // ÊúàÔºöxËΩ¥‰∏∫Â§©Ôºà1-30Â§©Ôºâ
                labels = [];
                chargingData = [];
                dischargingData = [];
                revenueData = [];
                for (let day = 1; day <= 30; day += 3) {
                    labels.push(`${day}Êó•`);
                    const charging = 300 + Math.random() * 200;
                    const discharging = 280 + Math.random() * 180;
                    const revenue = discharging * 0.8 - charging * 0.6 + Math.random() * 100;
                    chargingData.push(charging);
                    dischargingData.push(discharging);
                    revenueData.push(revenue);
                }
            } else if (timeType === 'year') {
                // Âπ¥ÔºöxËΩ¥‰∏∫ÊúàÔºà1-12ÊúàÔºâ
                labels = ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'];
                chargingData = [3200, 2800, 3500, 3800, 4200, 4500, 4800, 4600, 4000, 3600, 3200, 2900];
                dischargingData = [3000, 2600, 3300, 3600, 4000, 4300, 4600, 4400, 3800, 3400, 3000, 2700];
                revenueData = [8500, 7200, 9800, 11200, 13500, 14800, 16200, 15500, 12800, 10500, 8200, 7800];
            } else { // total ÂêàËÆ°
                // ÂêàËÆ°ÔºöxËΩ¥‰∏∫Âπ¥ÔºàÂ§öÂπ¥ÂØπÊØîÔºâ
                labels = ['2021Âπ¥', '2022Âπ¥', '2023Âπ¥', '2024Âπ¥', '2025Âπ¥'];
                chargingData = [32000, 38000, 42000, 45000, 48000];
                dischargingData = [30000, 36000, 40000, 42500, 45500];
                revenueData = [85000, 105000, 125000, 135000, 148000];
            }
            
            return { labels, chargingData, dischargingData, revenueData };
        }
        
        function updateHistoryChart() {
            const endDate = document.getElementById('historyEndDatePicker').value;
            initOverallHistoryCharts('30d', endDate);
        }
        
        function updateRevenueAnalysisChart() {
            const timeType = document.getElementById('revenueTimeType').value;
            const datePickerWrapper = document.getElementById('revenueDatePickerWrapper');
            const datePicker = document.getElementById('revenueDatePicker');
            const monthPicker = document.getElementById('revenueMonthPicker');
            const yearPicker = document.getElementById('revenueYearPicker');
            
            // ÈöêËóèÊâÄÊúâÈÄâÊã©Âô®
            datePickerWrapper.style.display = 'none';
            monthPicker.style.display = 'none';
            yearPicker.style.display = 'none';
            
            // Ê†πÊçÆÊó∂Èó¥Á±ªÂûãÊòæÁ§∫ÂØπÂ∫îÁöÑÈÄâÊã©Âô®Âπ∂ËÆæÁΩÆÈªòËÆ§ÂÄº
            const today = new Date();
            switch(timeType) {
                case 'day':
                    datePickerWrapper.style.display = 'inline-block';
                    // ËÆæÁΩÆÈªòËÆ§‰∏∫‰ªäÊó•
                    if (!datePicker.value) {
                        datePicker.value = today.toISOString().split('T')[0];
                    }
                    break;
                case 'month':
                    monthPicker.style.display = 'block';
                    // ËÆæÁΩÆÈªòËÆ§‰∏∫Êú¨Êúà
                    if (!monthPicker.value) {
                        const year = today.getFullYear();
                        const month = (today.getMonth() + 1).toString().padStart(2, '0');
                        monthPicker.value = `${year}-${month}`;
                    }
                    break;
                case 'year':
                    yearPicker.style.display = 'block';
                    break;
                case 'total':
                    // ÂêàËÆ°‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÈÄâÊã©Âô®
                    break;
            }
            
            initRevenueAnalysisChart();
        }
        
        function updatePcsEfficiencyTimePeriod() {
            const timeType = document.getElementById('pcsEfficiencyTimePicker').value;
            const datePickerWrapper = document.getElementById('pcsEfficiencyDatePickerWrapper');
            const datePicker = document.getElementById('pcsEfficiencyDatePicker');
            const monthPicker = document.getElementById('pcsEfficiencyMonthPicker');
            const yearPicker = document.getElementById('pcsEfficiencyYearPicker');
            
            // ÈöêËóèÊâÄÊúâÈÄâÊã©Âô®
            datePickerWrapper.style.display = 'none';
            monthPicker.style.display = 'none';
            yearPicker.style.display = 'none';
            
            // Ê†πÊçÆÊó∂Èó¥Á±ªÂûãÊòæÁ§∫ÂØπÂ∫îÁöÑÈÄâÊã©Âô®Âπ∂ËÆæÁΩÆÈªòËÆ§ÂÄº
            const today = new Date();
            switch(timeType) {
                case 'day':
                    datePickerWrapper.style.display = 'inline-block';
                    // ËÆæÁΩÆÈªòËÆ§‰∏∫‰ªäÊó•
                    if (!datePicker.value) {
                        datePicker.value = today.toISOString().split('T')[0];
                    }
                    break;
                case 'month':
                    monthPicker.style.display = 'block';
                    // ËÆæÁΩÆÈªòËÆ§‰∏∫Êú¨Êúà
                    if (!monthPicker.value) {
                        const year = today.getFullYear();
                        const month = (today.getMonth() + 1).toString().padStart(2, '0');
                        monthPicker.value = `${year}-${month}`;
                    }
                    break;
                case 'year':
                    yearPicker.style.display = 'block';
                    break;
                case 'total':
                    // ÂêàËÆ°‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÈÄâÊã©Âô®
                    break;
            }
            
            updatePcsEfficiencyChart();
        }
        
        function updatePcsEfficiencyChart() {
            const timeType = document.getElementById('pcsEfficiencyTimePicker').value;
            let labels, efficiencyData;
            
            // Ê†πÊçÆÊó∂Èó¥Á±ªÂûãÁîüÊàêÊï∞ÊçÆ
            switch(timeType) {
                case 'day':
                    // Êó•ÔºöxËΩ¥‰∏∫Êó∂Èó¥ÁÇπÔºà24Â∞èÊó∂Ôºâ
                    labels = Array.from({length: 24}, (_, i) => `${i}:00`);
                    efficiencyData = Array.from({length: 24}, () => Math.random() * 5 + 93);
                    break;
                case 'month':
                    // ÊúàÔºöxËΩ¥‰∏∫Â§©Ôºà1-30Â§©Ôºâ
                    labels = Array.from({length: 30}, (_, i) => `${i + 1}Êó•`);
                    efficiencyData = Array.from({length: 30}, () => Math.random() * 4 + 94);
                    break;
                case 'year':
                    // Âπ¥ÔºöxËΩ¥‰∏∫ÊúàÔºà1-12ÊúàÔºâ
                    labels = ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'];
                    efficiencyData = [95.2, 94.8, 95.5, 95.8, 96.2, 96.5, 96.8, 96.6, 96.0, 95.6, 95.2, 94.9];
                    break;
                case 'total':
                    // ÂêàËÆ°ÔºöxËΩ¥‰∏∫Âπ¥ÔºàÂ§öÂπ¥ÂØπÊØîÔºâ
                    labels = ['2021Âπ¥', '2022Âπ¥', '2023Âπ¥', '2024Âπ¥', '2025Âπ¥'];
                    efficiencyData = [93.5, 94.2, 95.1, 95.8, 96.2];
                    break;
                default:
                    labels = Array.from({length: 24}, (_, i) => `${i}:00`);
                    efficiencyData = Array.from({length: 24}, () => Math.random() * 5 + 93);
            }
            
            // Êõ¥Êñ∞ÂõæË°®
            const ctx = document.getElementById('pcsEfficiencyChart');
            if (ctx && chartInstances.pcsEfficiencyChart) {
                chartInstances.pcsEfficiencyChart.destroy();
            }
            
            if (ctx) {
                chartInstances.pcsEfficiencyChart = new Chart(ctx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'ËΩ¨Êç¢ÊïàÁéá',
                            data: efficiencyData,
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: '#10b981',
                            borderWidth: 1
                        }]
                    },
                    options: getChartOptions('ÊïàÁéá (%)', 85, 100)
                });
            }
        }
        
        // ÂàùÂßãÂåñEMSÂéÜÂè≤Êï∞ÊçÆÂõæË°®
        function initEMSHistoryCharts() {
            // EMSÁ≠ñÁï•ÊâßË°åÂéÜÂè≤
            const strategyCtx = document.getElementById('emsStrategyChart');
            if (strategyCtx) {
                new Chart(strategyCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'Ë∞ÉÂ∫¶Ê¨°Êï∞',
                            data: Array.from({length: 24}, () => Math.floor(Math.random() * 5) + 1),
                            backgroundColor: 'rgba(37, 99, 235, 0.8)',
                            borderColor: '#2563eb',
                            borderWidth: 1
                        }, {
                            label: 'ÊâßË°åÊàêÂäüÁéá',
                            data: Array.from({length: 24}, () => Math.random() * 10 + 90),
                            type: 'line',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderColor: '#10b981',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Ë∞ÉÂ∫¶Ê¨°Êï∞',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'ÊàêÂäüÁéá (%)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)',
                                    min: 80,
                                    max: 100
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Ë∞ÉÂ∫¶ÂìçÂ∫îÊó∂Èó¥ÂàÜÊûê
            const responseCtx = document.getElementById('emsResponseChart');
            if (responseCtx) {
                new Chart(responseCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 30}, (_, i) => `${i + 1}Êó•`),
                        datasets: [{
                            label: 'Âπ≥ÂùáÂìçÂ∫îÊó∂Èó¥',
                            data: Array.from({length: 30}, () => Math.random() * 30 + 10),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'ÊúÄÂ§ßÂìçÂ∫îÊó∂Èó¥',
                            data: Array.from({length: 30}, () => Math.random() * 20 + 40),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        }]
                    },
                    options: getChartOptions('ÂìçÂ∫îÊó∂Èó¥ (ms)', 0, 80)
                });
            }
        }
        
        // ÂàùÂßãÂåñPCSÂéÜÂè≤Êï∞ÊçÆÂõæË°®
        function initPCSHistoryCharts() {
            // PCSÂäüÁéáËΩ¨Êç¢ÂéÜÂè≤
            const powerCtx = document.getElementById('pcsPowerChart');
            if (powerCtx) {
                new Chart(powerCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'ACÂäüÁéáËæìÂá∫',
                            data: Array.from({length: 24}, () => Math.random() * 100 + 50),
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'DCÂäüÁéáËæìÂÖ•',
                            data: Array.from({length: 24}, () => Math.random() * 110 + 55),
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        }]
                    },
                    options: getChartOptions('ÂäüÁéá (kW)')
                });
            }
            
            // ÁîµÂéãÁîµÊµÅË∂ãÂäø
            const voltageCtx = document.getElementById('pcsVoltageChart');
            if (voltageCtx) {
                new Chart(voltageCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'DCÁîµÂéã',
                            data: Array.from({length: 24}, () => Math.random() * 20 + 750),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y'
                        }, {
                            label: 'DCÁîµÊµÅ',
                            data: Array.from({length: 24}, () => Math.random() * 50 + 150),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'ÁîµÂéã (V)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'ÁîµÊµÅ (A)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    drawOnChartArea: false
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }
            
            // ËΩ¨Êç¢ÊïàÁéáÂàÜÊûê - ‰ΩøÁî®‰∏ìÁî®ÂáΩÊï∞ÂàùÂßãÂåñ
            updatePcsEfficiencyChart();
        }
        
        // ÂàùÂßãÂåñÁîµË°®ÂéÜÂè≤Êï∞ÊçÆÂõæË°®
        function initMeterHistoryCharts() {
            // ÂäüÁéáË∂ãÂäøÂàÜÊûê
            const powerCtx = document.getElementById('meterPowerChart');
            if (powerCtx) {
                meterChartInstances.meterPowerChart = new Chart(powerCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}Êó∂`),
                        datasets: [{
                            label: 'ÊúâÂäüÂäüÁéá',
                            data: Array.from({length: 24}, () => Math.random() * 100 + 150),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Êó†ÂäüÂäüÁéá',
                            data: Array.from({length: 24}, () => Math.random() * 15 + 25),
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'ËßÜÂú®ÂäüÁéá',
                            data: Array.from({length: 24}, () => Math.random() * 105 + 155),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: getChartOptions('ÂäüÁéá (kW/kVar/kVA)', 0, 300)
                });
            }
            
            // ÁîµÈáèÊ∂àËÄóÁªüËÆ°
            const energyCtx = document.getElementById('meterEnergyChart');
            if (energyCtx) {
                meterChartInstances.meterEnergyChart = new Chart(energyCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}Êó∂`),
                        datasets: [{
                            label: 'ÊúâÂäüÁîµÈáè',
                            data: Array.from({length: 24}, () => Math.random() * 25 + 45),
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: '#3b82f6',
                            borderWidth: 1
                        }, {
                            label: 'Êó†ÂäüÁîµÈáè',
                            data: Array.from({length: 24}, () => Math.random() * 8 + 4),
                            backgroundColor: 'rgba(245, 158, 11, 0.7)',
                            borderColor: '#f59e0b',
                            borderWidth: 1
                        }]
                    },
                    options: getChartOptions('ÁîµÈáè (kWh/kVarh)', 0, 80)
                });
            }
            
            // ÁîµÂéãË¥®ÈáèÁõëÊµã
            const voltageCtx = document.getElementById('meterVoltageChart');
            if (voltageCtx) {
                meterChartInstances.meterVoltageChart = new Chart(voltageCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}Êó∂`),
                        datasets: [{
                            label: 'AÁõ∏ÁîµÂéã',
                            data: Array.from({length: 24}, () => Math.random() * 10 + 380),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }, {
                            label: 'BÁõ∏ÁîµÂéã',
                            data: Array.from({length: 24}, () => Math.random() * 9 + 381),
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }, {
                            label: 'CÁõ∏ÁîµÂéã',
                            data: Array.from({length: 24}, () => Math.random() * 11 + 379),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }]
                    },
                    options: getChartOptions('ÁîµÂéã (V)', 370, 400)
                });
            }
            
            // Ë∞êÊ≥¢ÂàÜÊûê
            const harmonicCtx = document.getElementById('meterHarmonicChart');
            if (harmonicCtx) {
                meterChartInstances.meterHarmonicChart = new Chart(harmonicCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Âü∫Ê≥¢', '2Ê¨°', '3Ê¨°', '4Ê¨°', '5Ê¨°', '6Ê¨°', '7Ê¨°', '8Ê¨°', '9Ê¨°', '10Ê¨°', '11Ê¨°', '12Ê¨°', '13Ê¨°', '14Ê¨°', '15Ê¨°', '16Ê¨°', '17Ê¨°', '18Ê¨°', '19Ê¨°', '20Ê¨°', '21Ê¨°'],
                        datasets: [{
                            label: 'Ë∞êÊ≥¢Âê´Èáè (%)',
                            data: [2.8, 2.3, 1.9, 1.4, 1.1, 0.8, 0.6, 0.5, 0.4, 0.3, 0.3, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.7)',
                                'rgba(239, 68, 68, 0.7)',
                                'rgba(245, 158, 11, 0.7)',
                                'rgba(16, 185, 129, 0.7)',
                                'rgba(139, 92, 246, 0.7)',
                                'rgba(236, 72, 153, 0.7)',
                                'rgba(14, 165, 233, 0.7)',
                                'rgba(248, 113, 113, 0.7)',
                                'rgba(34, 197, 94, 0.7)',
                                'rgba(251, 191, 36, 0.7)',
                                'rgba(168, 85, 247, 0.7)',
                                'rgba(244, 63, 94, 0.7)',
                                'rgba(6, 182, 212, 0.7)',
                                'rgba(129, 140, 248, 0.7)',
                                'rgba(45, 212, 191, 0.7)',
                                'rgba(251, 146, 60, 0.7)',
                                'rgba(196, 181, 253, 0.7)',
                                'rgba(110, 231, 183, 0.7)',
                                'rgba(254, 215, 170, 0.7)',
                                'rgba(217, 70, 239, 0.7)',
                                'rgba(125, 211, 252, 0.7)'
                            ],
                            borderColor: [
                                '#3b82f6',
                                '#ef4444',
                                '#f59e0b',
                                '#10b981',
                                '#8b5cf6',
                                '#ec4899',
                                '#0ea5e9',
                                '#f87171',
                                '#22c55e',
                                '#fbbf24',
                                '#a855f7',
                                '#f43f5e',
                                '#06b6d4',
                                '#818cf8',
                                '#2dd4bf',
                                '#fb923c',
                                '#c4b5fd',
                                '#6ee7b7',
                                '#fed7aa',
                                '#d946ef',
                                '#7dd3fc'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: getChartOptions('Ë∞êÊ≥¢Âê´Èáè (%)', 0, 3)
                });
            }
        }

        // Â≠òÂÇ®ÁîµË°®ÂõæË°®ÂÆû‰æã
        let meterChartInstances = {};

        // Êõ¥Êñ∞ÁîµË°®ÂäüÁéáË∂ãÂäøÂõæË°®
        function updateMeterPowerChart(selectedDate) {
            const ctx = document.getElementById('meterPowerChart');
            if (ctx && meterChartInstances.meterPowerChart) {
                // Ê†πÊçÆÈÄâÊã©ÁöÑÊó•ÊúüÁîüÊàêÂØπÂ∫îÁöÑÂ∞èÊó∂Êï∞ÊçÆ
                const dateObj = new Date(selectedDate);
                const dayOfYear = Math.floor((dateObj - new Date(dateObj.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                
                // ‰ΩøÁî®Êó•Êúü‰Ωú‰∏∫ÈöèÊú∫Êï∞ÁßçÂ≠êÔºåÁ°Æ‰øùÂêå‰∏ÄÂ§©ÁöÑÊï∞ÊçÆ‰øùÊåÅ‰∏ÄËá¥
                const seed = dayOfYear;
                const generateData = (base, variation) => {
                    return Array.from({length: 24}, (_, i) => {
                        const pseudoRandom = (seed + i * 37) % 100 / 100;
                        return base + pseudoRandom * variation;
                    });
                };

                meterChartInstances.meterPowerChart.data.datasets[0].data = generateData(184.4, 40);
                meterChartInstances.meterPowerChart.data.datasets[1].data = generateData(31.9, 15);
                meterChartInstances.meterPowerChart.data.datasets[2].data = generateData(255.4, 50);
                meterChartInstances.meterPowerChart.update();
            }
        }

        // Êõ¥Êñ∞ÁîµË°®ÁîµÈáèÊ∂àËÄóÂõæË°®
        function updateMeterEnergyChart(selectedDate) {
            const ctx = document.getElementById('meterEnergyChart');
            if (ctx && meterChartInstances.meterEnergyChart) {
                const dateObj = new Date(selectedDate);
                const dayOfYear = Math.floor((dateObj - new Date(dateObj.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                
                const seed = dayOfYear;
                const generateData = (base, variation) => {
                    return Array.from({length: 24}, (_, i) => {
                        const pseudoRandom = (seed + i * 43) % 100 / 100;
                        return base + pseudoRandom * variation;
                    });
                };

                meterChartInstances.meterEnergyChart.data.datasets[0].data = generateData(52.1, 25);
                meterChartInstances.meterEnergyChart.data.datasets[1].data = generateData(7.8, 8);
                meterChartInstances.meterEnergyChart.update();
            }
        }

        // Êõ¥Êñ∞ÁîµË°®ÁîµÂéãË¥®ÈáèÂõæË°®
        function updateMeterVoltageChart(selectedDate) {
            const ctx = document.getElementById('meterVoltageChart');
            if (ctx && meterChartInstances.meterVoltageChart) {
                const dateObj = new Date(selectedDate);
                const dayOfYear = Math.floor((dateObj - new Date(dateObj.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                
                const seed = dayOfYear;
                const generateData = (base, variation) => {
                    return Array.from({length: 24}, (_, i) => {
                        const pseudoRandom = (seed + i * 47) % 100 / 100;
                        return base + pseudoRandom * variation;
                    });
                };

                meterChartInstances.meterVoltageChart.data.datasets[0].data = generateData(382.5, 6);
                meterChartInstances.meterVoltageChart.data.datasets[1].data = generateData(383.1, 6);
                meterChartInstances.meterVoltageChart.data.datasets[2].data = generateData(381.8, 6);
                meterChartInstances.meterVoltageChart.update();
            }
        }

        // Êõ¥Êñ∞ÁîµË°®Ë∞êÊ≥¢ÂàÜÊûêÂõæË°®
        function updateMeterHarmonicChart(selectedDate) {
            const ctx = document.getElementById('meterHarmonicChart');
            if (ctx && meterChartInstances.meterHarmonicChart) {
                const dateObj = new Date(selectedDate);
                const dayOfYear = Math.floor((dateObj - new Date(dateObj.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                
                const seed = dayOfYear;
                const generateData = (baseValues) => {
                    return baseValues.map((base, i) => {
                        const pseudoRandom = (seed + i * 53) % 100 / 100;
                        return Math.max(0.1, base + (pseudoRandom - 0.5) * base * 0.3);
                    });
                };

                const harmonicData = generateData([2.8, 2.3, 1.9, 1.4, 1.1, 0.8, 0.6, 0.5, 0.4, 0.3, 0.3, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2]);
                meterChartInstances.meterHarmonicChart.data.datasets[0].data = harmonicData;
                meterChartInstances.meterHarmonicChart.update();
            }
        }
        
        // ÂàùÂßãÂåñBMSÂéÜÂè≤Êï∞ÊçÆÂõæË°®
        function initBMSHistoryCharts() {
            // ÁîµÊ±†ÁîµÂéãÂéÜÂè≤
            const voltageCtx = document.getElementById('bmsVoltageChart');
            if (voltageCtx) {
                new Chart(voltageCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}Êó∂`),
                        datasets: [{
                            label: 'ÊúÄÈ´òÁîµÂéã',
                            data: Array.from({length: 24}, () => Math.random() * 5 + 820),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }, {
                            label: 'Âπ≥ÂùáÁîµÂéã',
                            data: Array.from({length: 24}, () => Math.random() * 3 + 815),
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }, {
                            label: 'ÊúÄ‰ΩéÁîµÂéã',
                            data: Array.from({length: 24}, () => Math.random() * 3 + 810),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }]
                    },
                    options: getChartOptions('ÁîµÂéã (V)', 800, 830)
                });
            }
            
            // ÁîµÊ±†SOCË∂ãÂäø
            const balanceCtx = document.getElementById('bmsBalanceChart');
            if (balanceCtx) {
                new Chart(balanceCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}Êó∂`),
                        datasets: [{
                            label: 'SOCË∂ãÂäø',
                            data: Array.from({length: 24}, () => Math.random() * 10 + 80),
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderColor: '#10b981',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: getChartOptions('SOC (%)', 75, 95)
                });
            }
            
            // Ê∏©Â∫¶ÂàÜÂ∏ÉÂàÜÊûê
            const tempCtx = document.getElementById('bmsTempChart');
            if (tempCtx) {
                new Chart(tempCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'ÊúÄÈ´òÊ∏©Â∫¶',
                            data: Array.from({length: 24}, () => Math.random() * 5 + 30),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }, {
                            label: 'Âπ≥ÂùáÊ∏©Â∫¶',
                            data: Array.from({length: 24}, () => Math.random() * 3 + 28),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }, {
                            label: 'ÊúÄ‰ΩéÊ∏©Â∫¶',
                            data: Array.from({length: 24}, () => Math.random() * 3 + 25),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }]
                    },
                    options: getChartOptions('Ê∏©Â∫¶ (¬∞C)', 20, 40)
                });
            }
        }
        
        // ÂàùÂßãÂåñBatteryÂéÜÂè≤Êï∞ÊçÆÂõæË°®
        function initBatteryHistoryCharts() {
            // ÁîµÊ±†ÊÄßËÉΩË∂ãÂäø
            const performanceCtx = document.getElementById('batteryPerformanceChart');
            if (performanceCtx) {
                new Chart(performanceCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 12}, (_, i) => `${i + 1}Êúà`),
                        datasets: [{
                            label: 'SOH (%)',
                            data: Array.from({length: 12}, (_, i) => 98 - i * 0.2 + Math.random() * 0.5),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y'
                        }, {
                            label: 'ÂÜÖÈòª (mŒ©)',
                            data: Array.from({length: 12}, (_, i) => 45 + i * 0.5 + Math.random() * 2),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'SOH (%)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                min: 90,
                                max: 100
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'ÂÜÖÈòª (mŒ©)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    drawOnChartArea: false
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Âæ™ÁéØÂØøÂëΩÁªüËÆ°
            const cycleCtx = document.getElementById('batteryCycleChart');
            if (cycleCtx) {
                new Chart(cycleCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['ÊµÖÂÖÖÊµÖÊîæ', 'Ê†áÂáÜÂæ™ÁéØ', 'Ê∑±Â∫¶Âæ™ÁéØ', 'Âø´ÂÖÖÂæ™ÁéØ'],
                        datasets: [{
                            label: 'Âæ™ÁéØÊ¨°Êï∞',
                            data: [1200, 800, 300, 150],
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(37, 99, 235, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(239, 68, 68, 0.8)'
                            ],
                            borderColor: [
                                '#10b981',
                                '#2563eb',
                                '#f59e0b',
                                '#ef4444'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: getChartOptions('Âæ™ÁéØÊ¨°Êï∞')
                });
            }
            
            // ÂÆπÈáèË°∞ÂáèÂàÜÊûê
            const capacityCtx = document.getElementById('batteryCapacityChart');
            if (capacityCtx) {
                new Chart(capacityCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'],
                        datasets: [{
                            label: 'ÂÆûÈôÖÂÆπÈáè',
                            data: [500, 498, 496, 494, 492, 490, 488, 486, 484, 482, 480, 478],
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y'
                        }, {
                            label: 'ÂÆπÈáè‰øùÊåÅÁéá',
                            data: [100, 99.6, 99.2, 98.8, 98.4, 98.0, 97.6, 97.2, 96.8, 96.4, 96.0, 95.6],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'top',
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            if (context.datasetIndex === 0) {
                                                label += context.parsed.y + ' kWh';
                                            } else {
                                                label += context.parsed.y + ' %';
                                            }
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'ÂÆπÈáè (kWh)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                min: 470,
                                max: 510
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'ÂÆπÈáè‰øùÊåÅÁéá (%)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    drawOnChartArea: false,
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                min: 94,
                                max: 101
                            }
                        }
                    }
                });
            }
        }
        
        // ÂàùÂßãÂåñThermalÂéÜÂè≤Êï∞ÊçÆÂõæË°®
        function initThermalHistoryCharts() {
            // Ê∏©Â∫¶ÂàÜÂ∏ÉÂéÜÂè≤ - ÁîµÊ±†ÂåÖÊ∏©Â∫¶ÂàÜÂ∏ÉÂéÜÂè≤
            const tempCtx = document.getElementById('thermalTempChart');
            if (tempCtx) {
                new Chart(tempCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'ÁîµÊ±†ÂåÖÊúÄÈ´òÊ∏©Â∫¶',
                            data: Array.from({length: 24}, (_, i) => {
                                // Ê®°ÊãüÁîµÊ±†Ê∏©Â∫¶ÈöèÊó∂Èó¥ÂíåÂÖÖÊîæÁîµÁä∂ÊÄÅÂèòÂåñ
                                const baseTemp = 25;
                                const timeVariation = Math.sin(i * Math.PI / 12) * 3;
                                const randomVariation = (Math.random() - 0.5) * 2;
                                return (baseTemp + timeVariation + randomVariation + (i >= 10 && i <= 16 ? 4 : 0)).toFixed(1);
                            }),
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        }, {
                            label: 'ÁîµÊ±†ÂåÖÂπ≥ÂùáÊ∏©Â∫¶',
                            data: Array.from({length: 24}, (_, i) => {
                                const baseTemp = 23;
                                const timeVariation = Math.sin(i * Math.PI / 12) * 2;
                                const randomVariation = (Math.random() - 0.5) * 1.5;
                                return (baseTemp + timeVariation + randomVariation + (i >= 10 && i <= 16 ? 2 : 0)).toFixed(1);
                            }),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        }, {
                            label: 'ÁîµÊ±†ÂåÖÊúÄ‰ΩéÊ∏©Â∫¶',
                            data: Array.from({length: 24}, (_, i) => {
                                const baseTemp = 21;
                                const timeVariation = Math.sin(i * Math.PI / 12) * 1.5;
                                const randomVariation = (Math.random() - 0.5) * 1;
                                return (baseTemp + timeVariation + randomVariation + (i >= 10 && i <= 16 ? 1 : 0)).toFixed(1);
                            }),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'top',
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            title: { 
                                display: false
                            }
                        },
                        scales: { 
                            y: { 
                                title: { 
                                    display: true, 
                                    text: 'Ê∏©Â∫¶ (¬∞C)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                min: 15,
                                max: 35,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            x: { 
                                title: { 
                                    display: true, 
                                    text: 'Êó∂Èó¥',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }
            
            // ÂÜ∑Âç¥Á≥ªÁªüËøêË°å - ÁéØÂ¢ÉÊ∏©Â∫¶‰∏éÊπøÂ∫¶ÂèòÂåñ
            const coolingCtx = document.getElementById('thermalCoolingChart');
            if (coolingCtx) {
                new Chart(coolingCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'ËøõÈ£éÊ∏©Â∫¶',
                            data: Array.from({length: 24}, (_, i) => {
                                const baseTemp = 22;
                                const timeVariation = Math.sin((i - 6) * Math.PI / 12) * 4;
                                return (baseTemp + timeVariation + Math.random() * 2).toFixed(1);
                            }),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            yAxisID: 'y',
                            tension: 0.4
                        }, {
                            label: 'Âá∫È£éÊ∏©Â∫¶',
                            data: Array.from({length: 24}, (_, i) => {
                                const baseTemp = 28;
                                const timeVariation = Math.sin((i - 6) * Math.PI / 12) * 3;
                                return (baseTemp + timeVariation + Math.random() * 2).toFixed(1);
                            }),
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            yAxisID: 'y',
                            tension: 0.4
                        }, {
                            label: 'Áõ∏ÂØπÊπøÂ∫¶',
                            data: Array.from({length: 24}, () => (45 + Math.random() * 20).toFixed(1)),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            yAxisID: 'y1',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'top',
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: { 
                                    display: true, 
                                    text: 'Ê∏©Â∫¶ (¬∞C)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: { 
                                    display: true, 
                                    text: 'ÊπøÂ∫¶ (%RH)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                min: 0,
                                max: 100,
                                grid: { 
                                    drawOnChartArea: false,
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Ê∏©Â∫¶ÁÉ≠ÂäõÂõæ - Âà∂ÂÜ∑Á≥ªÁªüÊÄßËÉΩÂàÜÊûê
            const heatMapCtx = document.getElementById('thermalHeatMapChart');
            if (heatMapCtx) {
                new Chart(heatMapCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: '‰∏ªÈ£éÊú∫ËΩ¨ÈÄü',
                            data: Array.from({length: 24}, (_, i) => {
                                // Ê†πÊçÆÊ∏©Â∫¶ÈúÄÊ±ÇË∞ÉËäÇÈ£éÊú∫ËΩ¨ÈÄü
                                const baseSpeed = 1500;
                                const tempDemand = (i >= 10 && i <= 16) ? 300 : 0;
                                return baseSpeed + tempDemand + Math.random() * 200;
                            }),
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            yAxisID: 'y'
                        }, {
                            label: 'Âà∂ÂÜ∑ÂäüËÄó',
                            data: Array.from({length: 24}, (_, i) => {
                                const basePower = 3;
                                const tempDemand = (i >= 10 && i <= 16) ? 2 : 0;
                                return (basePower + tempDemand + Math.random() * 1).toFixed(1);
                            }),
                            backgroundColor: 'rgba(245, 158, 11, 0.7)',
                            yAxisID: 'y1',
                            type: 'line',
                            borderColor: '#f59e0b',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'top',
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: { 
                                    display: true, 
                                    text: 'ËΩ¨ÈÄü (RPM)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: { 
                                    display: true, 
                                    text: 'ÂäüËÄó (kW)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: { 
                                    drawOnChartArea: false,
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // ÂàùÂßãÂåñFireÂéÜÂè≤Êï∞ÊçÆÂõæË°®
        function initFireHistoryCharts() {
            // Á≥ªÁªüÁä∂ÊÄÅÂéÜÂè≤
            const systemCtx = document.getElementById('fireSystemChart');
            if (systemCtx) {
                new Chart(systemCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Ê≠£Â∏∏', 'È¢ÑË≠¶', 'ÂëäË≠¶'],
                        datasets: [{
                            data: [95, 4, 1],
                            backgroundColor: ['#10b981', '#f59e0b', '#dc2626'],
                            borderWidth: 2,
                            borderColor: ['#10b981', '#f59e0b', '#dc2626']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'bottom',
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }
            
            // Ê∞î‰ΩìÊµìÂ∫¶ÁõëÊµã
            const gasCtx = document.getElementById('fireGasChart');
            if (gasCtx) {
                new Chart(gasCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                        datasets: [{
                            label: 'COÊµìÂ∫¶',
                            data: Array.from({length: 24}, () => Math.random() * 10 + 5),
                            borderColor: '#dc2626',
                            backgroundColor: 'rgba(220, 38, 38, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }, {
                            label: 'ÁÉüÈõæÊµìÂ∫¶',
                            data: Array.from({length: 24}, () => Math.random() * 8 + 3),
                            borderColor: '#6b7280',
                            backgroundColor: 'rgba(107, 114, 128, 0.1)',
                            borderWidth: 2,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'top',
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        },
                        scales: { 
                            y: { 
                                beginAtZero: true, 
                                title: { 
                                    display: true, 
                                    text: 'ÊµìÂ∫¶ (ppm)',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            }
                        }
                    }
                });
            }
            
            // ÂëäË≠¶ËÆ∞ÂΩïÂàÜÊûê
            const alarmCtx = document.getElementById('fireAlarmChart');
            if (alarmCtx) {
                new Chart(alarmCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà'],
                        datasets: [{
                            label: 'ÁÉüÈõæÂëäË≠¶',
                            data: [2, 1, 0, 1, 0, 1],
                            backgroundColor: 'rgba(107, 114, 128, 0.8)',
                            borderColor: '#6b7280',
                            borderWidth: 1
                        }, {
                            label: 'Ê∏©Â∫¶ÂëäË≠¶',
                            data: [1, 0, 2, 0, 1, 0],
                            backgroundColor: 'rgba(245, 158, 11, 0.8)',
                            borderColor: '#f59e0b',
                            borderWidth: 1
                        }, {
                            label: 'Ê∞î‰ΩìÂëäË≠¶',
                            data: [0, 1, 1, 0, 0, 1],
                            backgroundColor: 'rgba(220, 38, 38, 0.8)',
                            borderColor: '#dc2626',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { 
                                position: 'top',
                                labels: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        label += context.parsed.y + ' Ê¨°';
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                stacked: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)'
                                }
                            },
                            y: {
                                stacked: true,
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'ÂëäË≠¶Ê¨°Êï∞',
                                    color: 'rgba(255, 255, 255, 0.7)'
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.7)',
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
        }

        // È°µÈù¢ÂàùÂßãÂåñ
        window.onload = function() {
            try {
                console.log('Data page initializing...');
                
                // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ - ÊöÇÊó∂Ê≥®ÈáäÊéâÁî®‰∫éË∞ÉËØï
                // const user = localStorage.getItem('touchscreen_user') || sessionStorage.getItem('touchscreen_user');
                // if (!user) {
                //     window.location.href = 'login.html';
                //     return;
                // }

                // Â∫îÁî®ËØ≠Ë®ÄËÆæÁΩÆ
                applyLanguage(currentLang);
                
                // ËÆæÁΩÆËØ≠Ë®ÄÈÄâÈ°πÁöÑÊøÄÊ¥ªÁä∂ÊÄÅ
                document.querySelectorAll('.lang-option').forEach(option => {
                    const isCurrentLang = option.getAttribute('onclick').includes(`'${currentLang}'`);
                    if (isCurrentLang) {
                        option.classList.add('active');
                    } else {
                        option.classList.remove('active');
                    }
                });

                // Êõ¥Êñ∞Êó∂Èó¥
                updateTime();
                setInterval(updateTime, 1000);
                
                // ÂàùÂßãÂåñÂíåÂÆöÊúüÊõ¥Êñ∞ÁªÑ‰ª∂Áä∂ÊÄÅ
                updateComponentStatuses();
                setInterval(updateComponentStatuses, 30000); // ÊØè30ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°
                
                // Á°Æ‰øùÊúâÈªòËÆ§ÊøÄÊ¥ªÁöÑÊ†áÁ≠æÈ°µ
                const firstComponent = document.querySelector('.component-item');
                const firstSection = document.querySelector('.content-section');
                if (firstComponent && !document.querySelector('.component-item.active')) {
                    firstComponent.classList.add('active');
                }
                if (firstSection && !document.querySelector('.content-section.active')) {
                    firstSection.classList.add('active');
                }

                // ÂàùÂßãÂåñÊâÄÊúâÁªÑ‰ª∂ÁöÑÂÆûÊó∂Êï∞ÊçÆ
                const components = ['overall', 'ems', 'pcs', 'bms', 'meter', 'thermal', 'fire'];
                
                // Á´ãÂç≥Ê∏≤ÊüìÊï¥Êú∫Ê¶ÇËßà
                console.log('Á´ãÂç≥Ê∏≤ÊüìÊï¥Êú∫Ê¶ÇËßà...');
                try {
                    renderComponentData('overall');
                } catch (err) {
                    console.error('Ê∏≤ÊüìÊï¥Êú∫Ê¶ÇËßàÂ§±Ë¥•:', err);
                }
                
                // È¶ñÂÖàÁ°Æ‰øùÊï¥Êú∫Ê¶ÇËßàÊòØÊòæÁ§∫Áä∂ÊÄÅÂπ∂Ê∏≤ÊüìÊï∞ÊçÆ
                setTimeout(() => {
                    console.log('Initializing component data...');
                    components.forEach(component => {
                        try {
                            console.log(`Ê≠£Âú®ÂàùÂßãÂåñÁªÑ‰ª∂: ${component}`);
                            renderComponentData(component);
                        } catch (err) {
                            console.error(`Error rendering ${component}:`, err);
                        }
                    });
                    
                    // Á°Æ‰øùÁ¨¨‰∏Ä‰∏™ÁªÑ‰ª∂ÁöÑÊï∞ÊçÆÂ∑≤Ê∏≤Êüì
                    const overallSection = document.getElementById('overallSection');
                    if (overallSection && overallSection.classList.contains('active')) {
                        console.log('Overall section is active and data should be visible');
                        // ÂÜçÊ¨°Âº∫Âà∂Ê∏≤Êüìoverall
                        renderComponentData('overall');
                    }
                }, 100);
                
                // ÂÆöÊó∂Êõ¥Êñ∞Êï∞ÊçÆÂÄºÔºàÊØè2ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°Ôºâ
                setInterval(() => {
                    try {
                        // Âè™Êõ¥Êñ∞ÂΩìÂâçÊòæÁ§∫ÁöÑÁªÑ‰ª∂
                        const activeSection = document.querySelector('.content-section.active');
                        if (activeSection) {
                            const componentId = activeSection.id.replace('Section', '');
                            updateDataValues(componentId);
                        }
                    } catch (err) {
                        console.error('Error updating data values:', err);
                    }
                }, 2000);
                
                // Ê£ÄÊü•URLÂèÇÊï∞ÔºåËá™Âä®ÈÄâ‰∏≠ÂØπÂ∫îÁöÑtab
                const urlParams = new URLSearchParams(window.location.search);
                const tabParam = urlParams.get('tab');
                if (tabParam) {
                    // Âª∂ËøüÊâßË°å‰ª•Á°Æ‰øùÈ°µÈù¢ÂÆåÂÖ®Âä†ËΩΩ
                    setTimeout(() => {
                        try {
                            switchDataTab(tabParam);
                        } catch (err) {
                            console.error('Error switching tab:', err);
                        }
                    }, 100);
                }
                
                // Âª∂ËøüËá™Âä®ÂàùÂßãÂåñÂéÜÂè≤Êï∞ÊçÆ
                setTimeout(() => {
                    try {
                        autoInitHistoryData();
                    } catch (err) {
                        console.error('Error initializing history data:', err);
                    }
                }, 500);
                
                console.log('Data page initialization complete');
            } catch (error) {
                console.error('Critical error during initialization:', error);
            }

            // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
            document.addEventListener('click', function(e) {
                const langSwitcher = document.querySelector('.lang-switcher');
                if (langSwitcher && !langSwitcher.contains(e.target)) {
                    document.getElementById('langDropdown').classList.remove('show');
                }
            });
            
            // Ê∑ªÂä†‰∫ã‰ª∂ÂßîÊâòÔºåÁ°Æ‰øùÂä®ÊÄÅÂÜÖÂÆπÁöÑ‰∫ã‰ª∂‰πüËÉΩÊ≠£Â∏∏Â∑•‰Ωú
            document.addEventListener('click', function(e) {
                // Â§ÑÁêÜÁªÑ‰ª∂ÂàáÊç¢
                if (e.target.classList.contains('component-item')) {
                    const onclick = e.target.getAttribute('onclick');
                    if (onclick && onclick.includes('switchDataTab')) {
                        const match = onclick.match(/switchDataTab\('(.+?)'\)/);
                        if (match) {
                            console.log('Switching to component:', match[1]);
                            switchDataTab(match[1]);
                        }
                    }
                }
                
                // Â§ÑÁêÜÂ≠êÊ†áÁ≠æÂàáÊç¢ÔºàÂÆûÊó∂Êï∞ÊçÆ/ÂéÜÂè≤Êï∞ÊçÆÔºâ
                if (e.target.classList.contains('sub-tab')) {
                    const onclick = e.target.getAttribute('onclick');
                    if (onclick && onclick.includes('switchSubTab')) {
                        const match = onclick.match(/switchSubTab\('(.+?)',\s*'(.+?)'\)/);
                        if (match) {
                            console.log('Switching sub tab:', match[1], match[2]);
                            switchSubTab(match[1], match[2]);
                        }
                    }
                }
                
                // Â§ÑÁêÜËá™ÂÆö‰πâÊåâÈíÆ
                if (e.target.classList.contains('data-settings-btn') || e.target.parentElement?.classList.contains('data-settings-btn')) {
                    const btn = e.target.classList.contains('data-settings-btn') ? e.target : e.target.parentElement;
                    const onclick = btn.getAttribute('onclick');
                    if (onclick && onclick.includes('openSettings')) {
                        const match = onclick.match(/openSettings\('(.+?)'\)/);
                        if (match) {
                            console.log('Opening settings for:', match[1]);
                            openSettings(match[1]);
                        }
                    }
                }
            });
        };
        
        // Â∞ÜÂáΩÊï∞Êö¥Èú≤Âà∞ÂÖ®Â±Ä‰ΩúÁî®ÂüüÔºåÁ°Æ‰øùÂÜÖËÅî‰∫ã‰ª∂Â§ÑÁêÜÂô®ÂèØ‰ª•ËÆøÈóÆ
        window.switchDataTab = switchDataTab;
        window.switchSubTab = switchSubTab;
        window.openSettings = openSettings;
        window.closeSettings = closeSettings;
        window.changeHistoryRange = changeHistoryRange;
        window.switchSettingsType = switchSettingsType;
        window.toggleLanguageDropdown = toggleLanguageDropdown;
        window.changeLanguage = changeLanguage;
        // ÂÖ≥Èó≠Á°ÆËÆ§ÂØπËØùÊ°Ü
        function closeConfirmDialog() {
            const modal = document.getElementById('confirmModal');
            if (modal) {
                modal.classList.remove('show');
            }
        }
        
        window.closeConfirmDialog = closeConfirmDialog;
        
        // Âº∫Âà∂ÂàùÂßãÂåñÂáΩÊï∞
        window.forceInitialize = function() {
            console.log('Force initializing data page...');
            
            // Á°Æ‰øùÊúâÊøÄÊ¥ªÁöÑÁªÑ‰ª∂
            const firstComponent = document.querySelector('.component-item');
            const firstSection = document.querySelector('.content-section');
            if (firstComponent) {
                firstComponent.classList.add('active');
            }
            if (firstSection) {
                firstSection.classList.add('active');
                firstSection.style.display = 'flex';
            }
            
            // Á°Æ‰øùÊúâÊøÄÊ¥ªÁöÑÂ≠êÂÜÖÂÆπ
            const firstSubContent = document.querySelector('.sub-content');
            if (firstSubContent) {
                firstSubContent.classList.add('active');
                firstSubContent.style.display = 'block';
            }
            
            // Ê∏≤ÊüìÊâÄÊúâÁªÑ‰ª∂Êï∞ÊçÆ
            const components = ['overall', 'ems', 'pcs', 'bms', 'meter', 'thermal', 'fire'];
            components.forEach(component => {
                try {
                    renderComponentData(component);
                } catch (err) {
                    console.error(`Error rendering ${component}:`, err);
                }
            });
            
            console.log('Force initialization complete');
        };
        
        // OTAÂçáÁ∫ßÂäüËÉΩ
        function showOTAUpgrade() {
            document.getElementById('otaModal').classList.add('show');
        }
        
        function closeOTAModal() {
            document.getElementById('otaModal').classList.remove('show');
            // ÈáçÁΩÆÁä∂ÊÄÅ
            document.getElementById('otaProgressSection').style.display = 'none';
            document.getElementById('otaActions').style.display = 'flex';
            document.getElementById('otaProgressFill').style.width = '0%';
            document.getElementById('otaProgressPercent').textContent = '0%';
        }
        
        function startOTAUpgrade() {
            // ÈöêËóèÊåâÈíÆÔºåÊòæÁ§∫ËøõÂ∫¶Êù°
            document.getElementById('otaActions').style.display = 'none';
            document.getElementById('otaProgressSection').style.display = 'block';
            
            // Ê®°ÊãüÂçáÁ∫ßËøõÂ∫¶
            let progress = 0;
            const statusTexts = [
                'ÂáÜÂ§áÂçáÁ∫ß...',
                '‰∏ãËΩΩÂõ∫‰ª∂...',
                'Ê†°È™åÂõ∫‰ª∂...',
                'ÂÆâË£ÖÊõ¥Êñ∞...',
                'ÈáçÂêØËÆæÂ§á...',
                'ÂçáÁ∫ßÂÆåÊàêÔºÅ'
            ];
            
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                document.getElementById('otaProgressFill').style.width = progress + '%';
                document.getElementById('otaProgressPercent').textContent = Math.floor(progress) + '%';
                
                // Êõ¥Êñ∞Áä∂ÊÄÅÊñáÊú¨
                const statusIndex = Math.floor((progress / 100) * (statusTexts.length - 1));
                document.getElementById('otaStatusText').textContent = statusTexts[statusIndex];
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        alert('Âõ∫‰ª∂ÂçáÁ∫ßÊàêÂäüÔºÅÁ≥ªÁªüÂ∞ÜÂú®3ÁßíÂêéÈáçÂêØ...');
                        setTimeout(() => {
                            closeOTAModal();
                        }, 3000);
                    }, 500);
                }
            }, 500);
        }
    </script>
    
    <!-- OTAÂçáÁ∫ßÂºπÁ™ó -->
    <div class="ota-modal" id="otaModal">
        <div class="ota-modal-content">
            <div class="ota-modal-header">
                <h3>OTA Âõ∫‰ª∂ÂçáÁ∫ß</h3>
                <button class="ota-close-btn" onclick="closeOTAModal()">√ó</button>
            </div>
            <div class="ota-modal-body">
                <div class="ota-info">
                    <div class="ota-info-row">
                        <span class="ota-label">ÂΩìÂâçÁâàÊú¨Ôºö</span>
                        <span class="ota-value">V2.0.1</span>
                    </div>
                    <div class="ota-info-row">
                        <span class="ota-label">ÊúÄÊñ∞ÁâàÊú¨Ôºö</span>
                        <span class="ota-value">V2.1.0</span>
                    </div>
                </div>
                
                <div class="ota-progress-section" id="otaProgressSection" style="display: none;">
                    <div class="ota-progress-text">
                        <span>ÂçáÁ∫ßËøõÂ∫¶</span>
                        <span id="otaProgressPercent">0%</span>
                    </div>
                    <div class="ota-progress-bar">
                        <div class="ota-progress-fill" id="otaProgressFill"></div>
                    </div>
                    <div class="ota-status-text" id="otaStatusText">ÂáÜÂ§áÂçáÁ∫ß...</div>
                </div>
                
                <div class="ota-actions" id="otaActions">
                    <button class="ota-btn ota-btn-primary" onclick="startOTAUpgrade()">ÂºÄÂßãÂçáÁ∫ß</button>
                    <button class="ota-btn ota-btn-secondary" onclick="closeOTAModal()">ÂèñÊ∂à</button>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        /* OTAÂçáÁ∫ßÂºπÁ™óÊ†∑Âºè */
        .ota-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .ota-modal.show {
            display: flex;
        }
        
        .ota-modal-content {
            background: linear-gradient(135deg, #1a2332 0%, #0f1823 100%);
            border: 2px solid rgba(0, 150, 255, 0.3);
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            overflow: hidden;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }
        
        .ota-modal-header {
            background: rgba(0, 150, 255, 0.1);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 150, 255, 0.2);
        }
        
        .ota-modal-header h3 {
            margin: 0;
            font-size: 20px;
            color: #00d4ff;
        }
        
        .ota-close-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 28px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .ota-close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        .ota-modal-body {
            padding: 30px 25px;
        }
        
        .ota-info {
            background: rgba(0, 150, 255, 0.05);
            border: 1px solid rgba(0, 150, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .ota-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }
        
        .ota-info-row:not(:last-child) {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .ota-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }
        
        .ota-value {
            color: #fff;
            font-size: 16px;
            font-weight: 600;
        }
        
        .ota-progress-section {
            margin-bottom: 25px;
        }
        
        .ota-progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .ota-progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .ota-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #0096ff);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        .ota-status-text {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
        }
        
        .ota-actions {
            display: flex;
            gap: 15px;
        }
        
        .ota-btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .ota-btn-primary {
            background: linear-gradient(135deg, #0096ff 0%, #00d4ff 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 150, 255, 0.3);
        }
        
        .ota-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 150, 255, 0.4);
        }
        
        .ota-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .ota-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .ota-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>

    <script>
        // ÊªöÂä®È°µÈù¢ÂäüËÉΩ
        function scrollPage(direction) {
            const scrollAmount = 300; // ÊØèÊ¨°ÊªöÂä®300ÂÉèÁ¥†
            
            // È¶ñÂÖàÊü•ÊâæÂΩìÂâçÊøÄÊ¥ªÁöÑ‰∏ªÂÜÖÂÆπÂå∫Âüü
            const activeSection = document.querySelector('.content-section.active');
            
            if (activeSection) {
                // Âú®ÊøÄÊ¥ªÁöÑ‰∏ªÂå∫ÂüüÂÜÖÊü•ÊâæÊøÄÊ¥ªÁöÑÂ≠êÂÜÖÂÆπ
                const activeContent = activeSection.querySelector('.sub-content.active');
                
                if (activeContent) {
                    // Â¶ÇÊûúÊúâÊøÄÊ¥ªÁöÑÂ≠êÂÜÖÂÆπÂå∫ÂüüÔºåÊªöÂä®ÂÆÉ
                    if (direction === 'up') {
                        activeContent.scrollBy({
                            top: -scrollAmount,
                            behavior: 'smooth'
                        });
                    } else if (direction === 'down') {
                        activeContent.scrollBy({
                            top: scrollAmount,
                            behavior: 'smooth'
                        });
                    }
                } else {
                    // Â¶ÇÊûúÊ≤°ÊúâÂ≠êÂÜÖÂÆπÔºåÂ∞ùËØïÊªöÂä®‰∏ªÂå∫Âüü
                    if (direction === 'up') {
                        activeSection.scrollBy({
                            top: -scrollAmount,
                            behavior: 'smooth'
                        });
                    } else if (direction === 'down') {
                        activeSection.scrollBy({
                            top: scrollAmount,
                            behavior: 'smooth'
                        });
                    }
                }
            } else {
                // Â¶ÇÊûúÊ≤°ÊúâÊøÄÊ¥ªÁöÑÂå∫ÂüüÔºåÊªöÂä®Êï¥‰∏™Á™óÂè£
                if (direction === 'up') {
                    window.scrollBy({
                        top: -scrollAmount,
                        behavior: 'smooth'
                    });
                } else if (direction === 'down') {
                    window.scrollBy({
                        top: scrollAmount,
                        behavior: 'smooth'
                    });
                }
            }
        }
    </script>

    <!-- Ëá™ÂÆö‰πâÊó•ÊúüÈÄâÊã©ÂºπÁ™ó -->
    <div id="customCalendarPopup" class="custom-calendar-popup">
        <div class="calendar-header">
            <button class="calendar-nav-btn" onclick="changeMonth(-1)">‚Äπ</button>
            <div class="calendar-month-year">
                <select id="calendarMonth" onchange="updateCalendar()">
                    <option value="0">‰∏ÄÊúà</option>
                    <option value="1">‰∫åÊúà</option>
                    <option value="2">‰∏âÊúà</option>
                    <option value="3">ÂõõÊúà</option>
                    <option value="4">‰∫îÊúà</option>
                    <option value="5">ÂÖ≠Êúà</option>
                    <option value="6">‰∏ÉÊúà</option>
                    <option value="7">ÂÖ´Êúà</option>
                    <option value="8">‰πùÊúà</option>
                    <option value="9">ÂçÅÊúà</option>
                    <option value="10">ÂçÅ‰∏ÄÊúà</option>
                    <option value="11">ÂçÅ‰∫åÊúà</option>
                </select>
                <select id="calendarYear" onchange="updateCalendar()">
                    <!-- Âπ¥‰ªΩÈÄâÈ°πÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
                </select>
            </div>
            <button class="calendar-nav-btn" onclick="changeMonth(1)">‚Ä∫</button>
        </div>
        <div class="calendar-weekdays">
            <div class="calendar-weekday">Êó•</div>
            <div class="calendar-weekday">‰∏Ä</div>
            <div class="calendar-weekday">‰∫å</div>
            <div class="calendar-weekday">‰∏â</div>
            <div class="calendar-weekday">Âõõ</div>
            <div class="calendar-weekday">‰∫î</div>
            <div class="calendar-weekday">ÂÖ≠</div>
        </div>
        <div class="calendar-days" id="calendarDays">
            <!-- Êó•ÊúüÂ∞ÜÁî±JSÂä®ÊÄÅÁîüÊàê -->
        </div>
        <div class="calendar-footer">
            <button class="calendar-btn secondary" onclick="setToday()" ontouchend="setToday()">‰ªäÂ§©</button>
            <button class="calendar-btn secondary" onclick="closeCustomCalendar()" ontouchend="closeCustomCalendar()">ÂèñÊ∂à</button>
        </div>
    </div>
    
    <script>
        // Ëá™ÂÆö‰πâÊó•ÂéÜÁõ∏ÂÖ≥ÂèòÈáè
        let currentCalendarInput = null;
        let selectedDate = new Date();
        let displayMonth = new Date();
        
        // ÂõæË°®ÂÆû‰æãË∑üË∏™
        let chartInstances = {};
        
        // ÊòæÁ§∫Ëá™ÂÆö‰πâÊó•ÂéÜ
        function showCustomCalendar(inputId) {
            console.log('showCustomCalendar called with inputId:', inputId);
            currentCalendarInput = document.getElementById(inputId);
            console.log('currentCalendarInput:', currentCalendarInput);
            const popup = document.getElementById('customCalendarPopup');
            console.log('popup:', popup);
            const inputRect = currentCalendarInput.getBoundingClientRect();
            
            // Ëé∑ÂèñÂΩìÂâçËæìÂÖ•Ê°ÜÁöÑÂÄºÔºåÂ¶ÇÊûúÊúâÁöÑËØù
            const currentValue = currentCalendarInput.value;
            if (currentValue) {
                selectedDate = new Date(currentValue);
                displayMonth = new Date(currentValue);
            } else {
                selectedDate = new Date();
                displayMonth = new Date();
            }
            
            // ÂàùÂßãÂåñÂπ¥‰ªΩÈÄâÈ°π
            const yearSelect = document.getElementById('calendarYear');
            yearSelect.innerHTML = '';
            const currentYear = new Date().getFullYear();
            for (let year = currentYear - 5; year <= currentYear + 5; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'Âπ¥';
                if (year === displayMonth.getFullYear()) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
            
            // ËÆæÁΩÆÊúà‰ªΩ
            document.getElementById('calendarMonth').value = displayMonth.getMonth();
            
            // ÊòæÁ§∫ÈÅÆÁΩ©Â±Ç
            let overlay = document.getElementById('calendarOverlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'calendarOverlay';
                overlay.className = 'calendar-overlay';
                document.body.appendChild(overlay);
                overlay.onclick = closeCustomCalendar;
            }
            // Á°Æ‰øùÊ∏ÖÈô§‰πãÂâçÂèØËÉΩËÆæÁΩÆÁöÑ display Ê†∑Âºè
            overlay.style.display = '';
            overlay.classList.add('show');
            
            // Â±Ö‰∏≠ÊòæÁ§∫ÂºπÁ™ó
            popup.classList.add('show');
            console.log('Popup should now be visible');
            
            updateCalendar();
        }
        
        // ÂÖ≥Èó≠Ëá™ÂÆö‰πâÊó•ÂéÜ
        function closeCustomCalendar() {
            console.log('closeCustomCalendar called');
            const popup = document.getElementById('customCalendarPopup');
            const overlay = document.getElementById('calendarOverlay');
            
            console.log('popup:', popup);
            console.log('overlay:', overlay);
            
            if (popup) {
                popup.classList.remove('show');
                // ‰∏çËÆæÁΩÆ style.display = 'none'ÔºåËÆ©CSSÊéßÂà∂ÊòæÁ§∫
                console.log('Popup hidden');
            }
            if (overlay) {
                overlay.classList.remove('show');
                console.log('Overlay hidden');
            }
            currentCalendarInput = null;
            console.log('Calendar closed successfully');
        }
        
        // Êõ¥Êñ∞Êó•ÂéÜÊòæÁ§∫
        function updateCalendar() {
            const month = parseInt(document.getElementById('calendarMonth').value);
            const year = parseInt(document.getElementById('calendarYear').value);
            displayMonth = new Date(year, month, 1);
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            
            const daysContainer = document.getElementById('calendarDays');
            daysContainer.innerHTML = '';
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Ê∑ªÂä†‰∏äÊúàÁöÑÊó•Êúü
            const firstDayOfWeek = firstDay.getDay();
            for (let i = firstDayOfWeek - 1; i >= 0; i--) {
                const day = prevLastDay.getDate() - i;
                const dayDiv = createDayElement(day, true, new Date(year, month - 1, day));
                daysContainer.appendChild(dayDiv);
            }
            
            // Ê∑ªÂä†Êú¨ÊúàÁöÑÊó•Êúü
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const currentDate = new Date(year, month, day);
                const dayDiv = createDayElement(day, false, currentDate);
                
                // Ê†áËÆ∞‰ªäÂ§©
                if (currentDate.getTime() === today.getTime()) {
                    dayDiv.classList.add('today');
                }
                
                // Ê†áËÆ∞ÈÄâ‰∏≠ÁöÑÊó•Êúü
                if (selectedDate && 
                    currentDate.getDate() === selectedDate.getDate() &&
                    currentDate.getMonth() === selectedDate.getMonth() &&
                    currentDate.getFullYear() === selectedDate.getFullYear()) {
                    dayDiv.classList.add('selected');
                }
                
                daysContainer.appendChild(dayDiv);
            }
            
            // Ê∑ªÂä†‰∏ãÊúàÁöÑÊó•Êúü
            const remainingDays = 42 - daysContainer.children.length;
            for (let day = 1; day <= remainingDays; day++) {
                const dayDiv = createDayElement(day, true, new Date(year, month + 1, day));
                daysContainer.appendChild(dayDiv);
            }
        }
        
        // ÂàõÂª∫Êó•ÊúüÂÖÉÁ¥†
        function createDayElement(day, isOtherMonth, date) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day';
            dayDiv.textContent = day;
            dayDiv.setAttribute('data-date', date.toISOString());
            
            if (isOtherMonth) {
                dayDiv.classList.add('other-month');
            }
            
            // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂Â§ÑÁêÜ
            dayDiv.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Day clicked:', day, date);
                console.log('currentCalendarInput:', currentCalendarInput);
                selectedDate = new Date(date);
                console.log('selectedDate set to:', selectedDate);
                
                try {
                    confirmDate();
                    console.log('confirmDate called successfully');
                } catch (error) {
                    console.error('Error in confirmDate:', error);
                }
            });
            
            // Ëß¶Êë∏Â±èÊîØÊåÅ
            dayDiv.addEventListener('touchend', function(e) {
                e.preventDefault();
                e.stopPropagation();
                selectedDate = new Date(date);
                setTimeout(() => {
                    confirmDate();
                }, 100); // Âª∂Ëøü‰∏ÄÁÇπÈò≤Ê≠¢Ëß¶Êë∏‰∫ã‰ª∂ÂÜ≤Á™Å
            });
            
            return dayDiv;
        }
        
        // ÂàáÊç¢Êúà‰ªΩ
        function changeMonth(direction) {
            const month = parseInt(document.getElementById('calendarMonth').value);
            const year = parseInt(document.getElementById('calendarYear').value);
            
            let newMonth = month + direction;
            let newYear = year;
            
            if (newMonth < 0) {
                newMonth = 11;
                newYear--;
            } else if (newMonth > 11) {
                newMonth = 0;
                newYear++;
            }
            
            document.getElementById('calendarMonth').value = newMonth;
            document.getElementById('calendarYear').value = newYear;
            
            updateCalendar();
        }
        
        // ËÆæÁΩÆ‰∏∫‰ªäÂ§©
        function setToday() {
            selectedDate = new Date();
            displayMonth = new Date();
            document.getElementById('calendarMonth').value = displayMonth.getMonth();
            document.getElementById('calendarYear').value = displayMonth.getFullYear();
            confirmDate(); // Áõ¥Êé•Á°ÆÂÆöÂπ∂ÂÖ≥Èó≠ÂºπÁ™ó
        }
        
        // Á°ÆËÆ§ÈÄâÊã©
        function confirmDate() {
            console.log('confirmDate called');
            
            if (currentCalendarInput && selectedDate) {
                const year = selectedDate.getFullYear();
                const month = (selectedDate.getMonth() + 1).toString().padStart(2, '0');
                const day = selectedDate.getDate().toString().padStart(2, '0');
                const dateString = `${year}-${month}-${day}`;
                console.log('Setting date to:', dateString);
                currentCalendarInput.value = dateString;
                
                // ‰øùÂ≠òËæìÂÖ•Ê°ÜIDÔºåÂõ†‰∏∫closeCustomCalendar‰ºöÊ∏ÖÁ©∫currentCalendarInput
                const inputId = currentCalendarInput.id;
                
                // ÂÖàÂÖ≥Èó≠ÂºπÁ™ó
                closeCustomCalendar();
                
                // Âª∂ËøüÊõ¥Êñ∞ÂõæË°®ÔºåÁ°Æ‰øùÂºπÁ™óÂ∑≤ÂÖ≥Èó≠
                setTimeout(() => {
                    try {
                        if (inputId === 'historyEndDatePicker') {
                            console.log('Triggering updateHistoryChart');
                            updateHistoryChart();
                        } else if (inputId === 'revenueDatePicker') {
                            console.log('Triggering updateRevenueAnalysisChart');
                            updateRevenueAnalysisChart();
                        } else if (inputId.startsWith('pcs') && inputId.endsWith('DatePicker')) {
                            console.log('Triggering PCS chart update for:', inputId);
                            if (inputId === 'pcsEfficiencyDatePicker') {
                                updatePcsEfficiencyChart();
                            } else {
                                initPCSHistoryCharts();
                            }
                        } else if (inputId.startsWith('bms') && inputId.endsWith('DatePicker')) {
                            console.log('Triggering BMS chart update for:', inputId);
                            initBMSHistoryCharts();
                        } else if (inputId.startsWith('thermal') && inputId.endsWith('DatePicker')) {
                            console.log('Triggering Thermal chart update for:', inputId);
                            initThermalHistoryCharts();
                        } else if (inputId.startsWith('fire') && inputId.endsWith('DatePicker')) {
                            console.log('Triggering Fire chart update for:', inputId);
                            initFireHistoryCharts();
                        } else if (inputId.startsWith('meter') && inputId.endsWith('DatePicker')) {
                            console.log('Triggering Meter chart update for:', inputId, 'with date:', dateString);
                            if (inputId === 'meterPowerDatePicker') {
                                updateMeterPowerChart(dateString);
                            } else if (inputId === 'meterEnergyDatePicker') {
                                updateMeterEnergyChart(dateString);
                            } else if (inputId === 'meterVoltageDatePicker') {
                                updateMeterVoltageChart(dateString);
                            } else if (inputId === 'meterHarmonicDatePicker') {
                                updateMeterHarmonicChart(dateString);
                            }
                        }
                    } catch (error) {
                        console.error('Error updating chart:', error);
                    }
                }, 100);
            } else {
                console.log('Missing currentCalendarInput or selectedDate');
                closeCustomCalendar();
            }
        }
        
        // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠Êó•ÂéÜ
        document.addEventListener('click', function(e) {
            const popup = document.getElementById('customCalendarPopup');
            if (!popup || !popup.classList.contains('show')) {
                return; // ÂºπÁ™óÊ≤°ÊúâÊòæÁ§∫ÔºåÁõ¥Êé•ËøîÂõû
            }
            
            const isClickInside = popup.contains(e.target) || 
                                  e.target.classList.contains('calendar-icon') ||
                                  e.target.id === 'historyEndDatePicker' ||
                                  e.target.id === 'revenueDatePicker' ||
                                  e.target.id.startsWith('pcs') && e.target.id.endsWith('DatePicker') ||
                                  e.target.id.startsWith('bms') && e.target.id.endsWith('DatePicker') ||
                                  e.target.id.startsWith('thermal') && e.target.id.endsWith('DatePicker') ||
                                  e.target.id.startsWith('fire') && e.target.id.endsWith('DatePicker') ||
                                  e.target.closest('.custom-date-input');
            
            if (!isClickInside) {
                closeCustomCalendar();
            }
        });
        
        // ESCÈîÆÂÖ≥Èó≠Êó•ÂéÜ
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const popup = document.getElementById('customCalendarPopup');
                if (popup && popup.classList.contains('show')) {
                    closeCustomCalendar();
                }
            }
        });
        
        // Ëß¶Êë∏Â±èÊîØÊåÅ
        document.addEventListener('touchend', function(e) {
            const popup = document.getElementById('customCalendarPopup');
            if (popup && popup.classList.contains('show')) {
                const isClickInside = popup.contains(e.target) || 
                                      e.target.classList.contains('calendar-icon') ||
                                      (currentCalendarInput && currentCalendarInput.contains(e.target));
                
                if (!isClickInside) {
                    closeCustomCalendar();
                }
            }
        });
    </script>

    <!-- ÈÄÄÂá∫Á°ÆËÆ§ÂºπÁ™ó -->
    <div id="logoutModal" class="logout-modal">
        <div class="logout-content">
            <div class="logout-icon">
                <i class="fas fa-sign-out-alt"></i>
            </div>
            <div class="logout-title" id="logoutTitle">ÈÄÄÂá∫ÁôªÂΩï</div>
            <div class="logout-message" id="logoutMessage">ÊÇ®Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÂΩìÂâçË¥¶Êà∑ÂêóÔºüÈÄÄÂá∫ÂêéÈúÄË¶ÅÈáçÊñ∞ÁôªÂΩï„ÄÇ</div>
            <div class="logout-buttons">
                <button class="logout-btn-action cancel" id="logoutCancelBtn" onclick="closeLogoutModal()">
                    <i class="fas fa-times"></i> ÂèñÊ∂à
                </button>
                <button class="logout-btn-action confirm" id="logoutConfirmBtn" onclick="confirmLogout()">
                    <i class="fas fa-sign-out-alt"></i> ÈÄÄÂá∫
                </button>
            </div>
        </div>
    </div>
    <script src="common-header-scripts.js"></script>
    <script>
        // ÈÄÄÂá∫ÂäüËÉΩ - Áõ¥Êé•ÂÆö‰πâÂú®È°µÈù¢‰∏≠Á°Æ‰øùÂèØÁî®
        if (typeof logout === 'undefined') {
            window.logout = function() {
                console.log('logout function called from inline script');
                const modal = document.getElementById('logoutModal');
                if (modal) {
                    modal.classList.add('show');
                    // Êõ¥Êñ∞ÊñáÊú¨
                    const titleEl = document.getElementById('logoutTitle');
                    const messageEl = document.getElementById('logoutMessage');
                    if (titleEl) titleEl.textContent = 'ÈÄÄÂá∫ÁôªÂΩï';
                    if (messageEl) messageEl.textContent = 'ÊÇ®Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÂΩìÂâçË¥¶Êà∑ÂêóÔºüÈÄÄÂá∫ÂêéÈúÄË¶ÅÈáçÊñ∞ÁôªÂΩï„ÄÇ';
                } else {
                    console.error('logoutModal not found');
                }
            };
        }
        
        if (typeof closeLogoutModal === 'undefined') {
            window.closeLogoutModal = function() {
                const modal = document.getElementById('logoutModal');
                if (modal) {
                    modal.classList.remove('show');
                }
            };
        }
        
        if (typeof confirmLogout === 'undefined') {
            window.confirmLogout = function() {
                // Ê∏ÖÈô§ÁôªÂΩï‰ø°ÊÅØ
                localStorage.removeItem('touchscreen_user');
                sessionStorage.removeItem('touchscreen_user');
                localStorage.removeItem('login_time');
                // Ë∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ
                window.location.href = 'login.html';
            };
        }
        
        // Á°Æ‰øùÈ°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂáΩÊï∞ÂèØÁî®
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, checking functions:');
            console.log('logout:', typeof window.logout);
            console.log('closeLogoutModal:', typeof window.closeLogoutModal);
            console.log('confirmLogout:', typeof window.confirmLogout);
        });
    </script>
</body>
</html>