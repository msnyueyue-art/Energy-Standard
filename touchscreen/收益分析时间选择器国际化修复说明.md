# 收益分析时间选择器国际化修复说明

## 问题描述

在英文环境下,数据页面(Data)的收益分析图表的时间类型下拉菜单显示**中文选项**:
- 日 ❌
- 月 ❌
- 年 ❌
- 合计 ❌

**应该显示:**
- Day ✓
- Month ✓
- Year ✓
- Total ✓

## 问题原因

`data.html` 文件中的 `<option>` 元素虽然有 `data-i18n` 属性,但文本内容是**中文硬编码**:

```html
<!-- 修复前 -->
<option value="day" selected data-i18n="day">日</option>
<option value="month" data-i18n="month">月</option>
<option value="year" data-i18n="year">年</option>
<option value="total" data-i18n="total">合计</option>
```

HTML默认语言应该是英文,所以文本内容应该是英文,通过国际化脚本在需要时切换到中文。

## 修复内容

### 修复位置
**文件:** `touchscreen/data.html`

**第一处:** 行 2800-2803 (收益分析图表)
**第二处:** 行 2949-2952 (功率趋势分析图表)

### 修复前后对比

**修复前:**
```html
<select id="revenueTimeType" class="form-input" ...>
    <option value="day" selected data-i18n="day">日</option>
    <option value="month" data-i18n="month">月</option>
    <option value="year" data-i18n="year">年</option>
    <option value="total" data-i18n="total">合计</option>
</select>
```

**修复后:**
```html
<select id="revenueTimeType" class="form-input" ...>
    <option value="day" selected data-i18n="day">Day</option>
    <option value="month" data-i18n="month">Month</option>
    <option value="year" data-i18n="year">Year</option>
    <option value="total" data-i18n="total">Total</option>
</select>
```

## 国际化映射

翻译配置已存在于 `touchscreen-i18n.js`:

```javascript
touchscreenTranslations = {
    zh: {
        day: '日',
        month: '月',
        year: '年',
        total: '合计'
    },
    en: {
        day: 'Day',
        month: 'Month',
        year: 'Year',
        total: 'Total'
    }
}
```

## 修复验证

### 测试步骤

1. **清除缓存,默认英文环境测试**
   ```javascript
   localStorage.clear();
   location.reload();
   ```

2. **打开数据页面 (Data)**
   - 点击 "Historical Data" 标签
   - 查看 "Revenue Analysis" 图表的时间类型下拉菜单

3. **预期结果 (英文环境)**
   - ✅ 下拉菜单选项显示: "Day", "Month", "Year", "Total"
   - ✅ 默认选中 "Day"

4. **切换到中文**
   - 点击语言切换按钮,选择 "中文简体"
   - 刷新页面

5. **预期结果 (中文环境)**
   - ✅ 下拉菜单选项显示: "日", "月", "年", "合计"
   - ✅ 默认选中 "日"

### 验证命令

在浏览器控制台执行:

```javascript
// 检查当前语言
console.log('当前语言:', localStorage.getItem('touchscreen_language') || '默认(en)');

// 检查select元素的选项
const select = document.getElementById('revenueTimeType');
Array.from(select.options).forEach(opt => {
    console.log(`value="${opt.value}", text="${opt.textContent}", i18n="${opt.getAttribute('data-i18n')}"`);
});

// 预期输出 (英文环境):
// value="day", text="Day", i18n="day"
// value="month", text="Month", i18n="month"
// value="year", text="Year", i18n="year"
// value="total", text="Total", i18n="total"
```

## 相关问题检查

### 已检查的文件
- ✅ `history.html` - 无类似问题
- ✅ `home.html` - 无类似问题
- ✅ `control.html` - 无类似问题
- ✅ `alarm.html` - 无类似问题
- ✅ `logs.html` - 无类似问题
- ✅ `settings.html` - 无类似问题

### 修复的文件
- ✅ `data.html` - 2处修复完成

## 修复命令记录

```bash
cd touchscreen

# 修复第一处 (行 2800-2803)
sed -i '2800s/data-i18n="day">日</data-i18n="day">Day</' data.html
sed -i '2801s/data-i18n="month">月</data-i18n="month">Month</' data.html
sed -i '2802s/data-i18n="year">年</data-i18n="year">Year</' data.html
sed -i '2803s/data-i18n="total">合计</data-i18n="total">Total</' data.html

# 修复第二处 (行 2949-2952)
sed -i '2949s/data-i18n="day">日</data-i18n="day">Day</' data.html
sed -i '2950s/data-i18n="month">月</data-i18n="month">Month</' data.html
sed -i '2951s/data-i18n="year">年</data-i18n="year">Year</' data.html
sed -i '2952s/data-i18n="total">合计</data-i18n="total">Total</' data.html
```

## 技术说明

### 为什么HTML内容要用英文?

1. **国际化标准**: HTML默认内容应该是主要语言(通常是英文)
2. **避免闪烁**: 默认英文环境下无需翻译,减少页面加载闪烁
3. **语义清晰**: `<html lang="en">` 配合英文内容,语义一致

### data-i18n属性的作用

`data-i18n` 属性标记需要国际化的元素,国际化脚本会:
1. 读取属性值作为翻译键(如 "day")
2. 根据当前语言从翻译表获取对应文本
3. 替换元素的 `textContent`

### 国际化处理流程

```javascript
// touchscreen-i18n.js 中的处理逻辑
document.querySelectorAll('[data-i18n]').forEach(elem => {
    const key = elem.getAttribute('data-i18n'); // "day"
    const translation = touchscreenTranslations[lang][key]; // "日" 或 "Day"
    if (translation) {
        elem.textContent = translation; // 替换文本
    }
});
```

## 修复影响范围

- **影响页面:** 仅 `data.html` (数据监控页面)
- **影响图表:**
  - Revenue Analysis (收益分析)
  - Power Trend Analysis (功率趋势分析)
- **影响元素:** 时间类型选择器的4个选项

## 修复状态

✅ **修复完成**
- 第一处时间选择器: ✅ 已修复
- 第二处时间选择器: ✅ 已修复
- 其他页面检查: ✅ 无类似问题

## 修复时间
2026-01-15

## 相关文档
- [触摸屏系统默认英文语言修复说明.md](./触摸屏系统默认英文语言修复说明.md)
- [快速验证-默认英文语言.md](./快速验证-默认英文语言.md)

## 补充修复: 年份选择器

### 问题
年份选择器中的选项显示 "2023年", "2024年", "2025年",包含中文"年"字。

### 修复
**位置:** 行 2811-2813, 2960-2962

**修复前:**
```html
<option value="2023">2023年</option>
<option value="2024">2024年</option>
<option value="2025" selected>2025年</option>
```

**修复后:**
```html
<option value="2023">2023</option>
<option value="2024">2024</option>
<option value="2025" selected>2025</option>
```

年份使用纯数字,无需国际化,全球通用。

### 修复命令
```bash
sed -i 's/>2023年</>2023</g; s/>2024年</>2024</g; s/>2025年</>2025</g; s/>2026年</>2026</g' data.html
```

