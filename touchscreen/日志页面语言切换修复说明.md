# 日志页面语言切换修复说明

## 问题描述
在英文环境下点击"日志"(Log)菜单后,页面会意外显示中文内容,包括:
- 顶部菜单栏显示中文
- Logo旁边的系统名称显示中文"储能柜管理系统"
- 登录日志和操作日志Tab标签显示中文

## 问题原因
1. **HTML默认内容是中文**: 页面HTML中的所有文本默认都是中文
2. **语言初始化逻辑错误**: 页面加载时的判断逻辑反了,只在英文环境下执行翻译,导致默认中文内容没有被翻译成英文

## 修复方案

### 1. 修改HTML默认语言为英文
将所有HTML中的默认文本改为英文:

```html
<!-- 修改前 -->
<html lang="zh-CN">
<title>日志管理 - 储能柜管理系统</title>
<div class="logo-text" data-i18n="systemName">储能柜管理系统</div>

<!-- 修改后 -->
<html lang="en">
<title>Log Management - Energy Storage Cabinet System</title>
<div class="logo-text" data-i18n="systemName">Energy Storage Cabinet System</div>
```

### 2. 修改所有菜单项为英文
```html
<!-- 修改前 -->
<div class="nav-item" data-i18n="navHome">首页</div>
<div class="nav-item" data-i18n="navLog">日志</div>

<!-- 修改后 -->
<div class="nav-item" data-i18n="navHome">Home</div>
<div class="nav-item" data-i18n="navLog">Log</div>
```

### 3. 修改Tab标签为英文
```html
<!-- 修改前 -->
<div class="sub-tab active" data-i18n="loginLog">登录日志</div>
<div class="sub-tab" data-i18n="operationLogTab">操作日志</div>

<!-- 修改后 -->
<div class="sub-tab active" data-i18n="loginLog">Login Log</div>
<div class="sub-tab" data-i18n="operationLogTab">Operation Log</div>
```

### 4. 修改分页控件为英文
```html
<!-- 修改前 -->
<div class="pagination-info" id="paginationInfo">第 1-10 条,共 0 条记录</div>
<span data-i18n="previousPage">上一页</span>

<!-- 修改后 -->
<div class="pagination-info" id="paginationInfo">Showing 1-10 of 0 records</div>
<span data-i18n="previousPage">Previous</span>
```

### 5. 修改语言初始化逻辑
关键修复:将判断条件从 `currentLang === 'en'` 改为 `currentLang === 'zh'`

```javascript
// 修改前 - 错误逻辑
// HTML默认是中文,只有当前语言是英文时才需要翻译
if (currentLang === 'en' && typeof applyTouchscreenTranslations === 'function') {
    applyTouchscreenTranslations();
}

// 修改后 - 正确逻辑
// HTML默认是英文,只有当前语言是中文时才需要翻译
if (currentLang === 'zh' && typeof applyTouchscreenTranslations === 'function') {
    applyTouchscreenTranslations();
}
```

## 修复效果

### 英文环境下
✅ 页面加载时显示英文内容
✅ 顶部菜单栏显示英文
✅ Logo旁边显示 "Energy Storage Cabinet System"
✅ Tab标签显示 "Login Log" 和 "Operation Log"
✅ 点击语言切换按钮切换到中文后,所有内容正确显示中文

### 中文环境下
✅ 页面加载时自动翻译成中文
✅ 顶部菜单栏显示中文
✅ Logo旁边显示 "储能柜管理系统"
✅ Tab标签显示 "登录日志" 和 "操作日志"
✅ 点击语言切换按钮切换到英文后,所有内容正确显示英文

## 测试步骤

### 测试1:英文环境
1. 清除浏览器localStorage或将语言设置为英文
2. 打开页面,检查顶部菜单、Logo、Tab标签是否都显示英文
3. 点击日志菜单,检查页面是否保持英文显示
4. 点击语言切换按钮切换到中文
5. 确认所有内容正确显示中文

### 测试2:中文环境
1. 将语言设置为中文
2. 打开页面,检查所有内容是否显示中文
3. 点击日志菜单,检查页面是否保持中文显示
4. 点击语言切换按钮切换到英文
5. 确认所有内容正确显示英文

### 测试3:语言切换稳定性
1. 在英文环境下,在不同页面(首页、数据、历史、控制、告警、日志、设置)之间切换
2. 确认所有页面都保持英文显示
3. 切换到中文
4. 再次在不同页面之间切换
5. 确认所有页面都保持中文显示

## 技术要点

### 1. HTML默认语言原则
- **所有页面的HTML默认内容应该是英文**
- 这样可以避免在英文环境下出现闪烁
- 中文用户通过国际化翻译函数动态转换

### 2. 国际化翻译逻辑
```javascript
// 页面加载时的处理
const currentLang = getTouchscreenLang(); // 从localStorage获取当前语言

// 如果是中文,则翻译页面(因为HTML默认是英文)
if (currentLang === 'zh') {
    applyTouchscreenTranslations(); // 应用中文翻译
}
// 如果是英文,则不需要翻译(HTML已经是英文)
```

### 3. 语言切换事件
```javascript
// 监听语言切换事件
window.addEventListener('languageChanged', function(e) {
    // 重新应用翻译
    applyTouchscreenTranslations();
    // 重新渲染动态内容
    renderLogTable();
});
```

## 相关文件
- `touchscreen/logs.html` - 日志页面(已修复)
- `touchscreen/touchscreen-i18n.js` - 国际化翻译文件
- `touchscreen/common-header-scripts.js` - 通用头部脚本

## 注意事项
1. 此修复方案适用于所有触摸屏页面
2. 确保所有新增页面都遵循"HTML默认英文"的原则
3. 动态生成的内容(如表格数据)也需要根据当前语言进行翻译

## 修复日期
2026-01-13
