# 📱 触摸屏系统国际化实施说明

## 🎯 功能概述

触摸屏系统现已完整支持中英文双语切换功能,默认显示英文界面。用户可以通过点击语言切换按钮随时在中文和英文之间切换。

## ✅ 已完成的工作

### 1. 创建国际化核心文件

**文件:** [touchscreen/touchscreen-i18n.js](touchscreen-i18n.js)

包含完整的中英文翻译键值对,覆盖所有触摸屏页面:
- **导航菜单:** 首页、数据、历史、控制、告警、日志、设置
- **首页内容:** 系统统计、能量流向、电池状态等
- **数据页:** 实时监控、图表标题、单位等
- **历史页:** 时间选择、数据类型、图表等
- **控制页:** 模式选择、参数设置、操作按钮等
- **告警页:** 告警级别、状态、操作等
- **日志页:** 日志级别、时间范围、筛选等
- **设置页:** 系统设置、账户管理、主题切换等
- **登录页:** 登录表单、验证信息等
- **通用组件:** 按钮、弹窗、提示信息等

**核心函数:**
```javascript
- getTouchscreenLang()          // 获取当前语言
- setTouchscreenLang(lang)      // 设置语言
- t(key)                        // 翻译单个键
- applyTouchscreenTranslations()// 应用所有翻译
- switchTouchscreenLanguage(lang) // 切换语言
```

### 2. 修改共享头部脚本

**文件:** [touchscreen/common-header-scripts.js](common-header-scripts.js)

**主要修改:**
- 默认语言从中文(`zh`)改为英文(`en`)
- localStorage键名统一为`touchscreen_language`
- 集成`switchTouchscreenLanguage()`函数调用
- 语言切换时自动更新退出弹窗文本

**关键代码:**
```javascript
// 第5行: 默认语言设置
let currentLang = localStorage.getItem('touchscreen_language') || 'en';

// 第49-52行: 调用国际化系统
if (typeof switchTouchscreenLanguage === 'function') {
    switchTouchscreenLanguage(lang);
}
```

### 3. 为所有页面添加国际化脚本引用

已为以下页面添加`<script src="touchscreen-i18n.js"></script>`:

✅ **home.html** - 首页 (第1416行)
✅ **data.html** - 数据页 (第1543行)
✅ **history.html** - 历史页 (第648行)
✅ **control.html** - 控制页 (第1223行)
✅ **alarms.html** - 告警页 (第581行)
✅ **logs.html** - 日志页 (第898行)
✅ **settings.html** - 设置页 (第1480行)

### 4. 为页面添加data-i18n属性

已为以下页面的关键元素添加国际化属性:

#### home.html (首页)
- ✅ Logo文字: `data-i18n="systemTitle"`
- ✅ 导航菜单: `data-i18n="navHome|navData|navHistory..."`
- ✅ 退出按钮: `data-i18n-title="logoutButtonTitle"`
- ✅ 统计卡片标签: 运行天数、系统功率、今日充电量等
- ✅ 退出弹窗: 标题、消息、按钮文本

#### data.html (数据页)
- ✅ Logo文字: `data-i18n="systemTitle"`
- ✅ 导航菜单: 所有7个菜单项

#### 其他页面
- 所有页面的导航菜单都已使用相同的国际化键,确保一致性

## 🔧 如何使用

### 用户操作

1. **打开触摸屏系统**
   - 系统默认以英文界面启动

2. **切换到中文**
   - 点击页面右上角的地球图标(🌐)
   - 在下拉菜单中点击"🇨🇳 中文"
   - 页面立即切换为中文显示

3. **切换回英文**
   - 点击地球图标
   - 选择"🇺🇸 English"
   - 页面切换为英文显示

4. **语言设置持久化**
   - 选择的语言会自动保存到浏览器
   - 下次打开系统时会记住上次的语言选择

### 开发者使用

#### 添加新的翻译键

**步骤1:** 在`touchscreen-i18n.js`中添加翻译

```javascript
const touchscreenTranslations = {
    zh: {
        // 添加中文翻译
        myNewKey: '我的新文本',
    },
    en: {
        // 添加英文翻译
        myNewKey: 'My New Text',
    }
};
```

**步骤2:** 在HTML中使用data-i18n属性

```html
<!-- 文本内容翻译 -->
<div data-i18n="myNewKey">我的新文本</div>

<!-- 占位符翻译 -->
<input data-i18n-placeholder="myNewKey" placeholder="我的新文本">

<!-- 标题/提示翻译 -->
<button data-i18n-title="myNewKey" title="我的新文本">按钮</button>
```

#### 在JavaScript中使用翻译

```javascript
// 获取翻译文本
const text = t('myNewKey');

// 手动切换语言
switchTouchscreenLanguage('en'); // 切换到英文
switchTouchscreenLanguage('zh'); // 切换到中文

// 获取当前语言
const currentLang = getTouchscreenLang(); // 返回 'en' 或 'zh'
```

## 📁 相关文件清单

### 核心文件
1. **touchscreen/touchscreen-i18n.js** - 国际化核心库(完整的中英文翻译)
2. **touchscreen/common-header-scripts.js** - 共享头部脚本(集成语言切换)

### 已修改的HTML页面
1. **touchscreen/home.html** - 首页
2. **touchscreen/data.html** - 数据页
3. **touchscreen/history.html** - 历史页
4. **touchscreen/control.html** - 控制页
5. **touchscreen/alarms.html** - 告警页
6. **touchscreen/logs.html** - 日志页
7. **touchscreen/settings.html** - 设置页

### 辅助文件
1. **touchscreen/add-i18n-to-all-pages.ps1** - PowerShell批量添加脚本

## 🧪 测试清单

### 基础功能测试
- [ ] 系统打开时默认显示英文界面
- [ ] 点击语言切换按钮显示下拉菜单
- [ ] 选择中文后所有文本切换为中文
- [ ] 选择英文后所有文本切换为英文
- [ ] 刷新页面后保持上次选择的语言

### 页面覆盖测试
- [ ] 首页 - 导航、统计卡片、退出弹窗
- [ ] 数据页 - 导航、图表标题
- [ ] 历史页 - 导航、时间选择器
- [ ] 控制页 - 导航、操作按钮
- [ ] 告警页 - 导航、告警列表
- [ ] 日志页 - 导航、日志列表
- [ ] 设置页 - 导航、设置选项

### 跨页面测试
- [ ] 在首页切换语言后跳转到其他页面,语言保持一致
- [ ] 在不同页面之间切换,语言选择保持不变

## 🎨 支持的翻译键总览

### 通用组件 (20个键)
```
systemTitle, cancel, confirm, save, delete, edit, add, search,
filter, reset, submit, close, logout, logoutTitle, logoutMessage,
logoutButtonTitle, loading, noData, error, success
```

### 导航菜单 (7个键)
```
navHome, navData, navHistory, navControl, navAlarm, navLog, navSettings
```

### 首页 (15+个键)
```
homeRunningDays, homeSystemPower, homeTodayCharge, homeTodayDischarge,
homeTotalCharge, homeTotalDischarge, homeEnergyFlow, homeBatteryStatus,
homePowerGrid, homeSolarPanel, homeLoad, unitDay, unitKW, unitKWh, unitMWh
```

### 数据页 (25+个键)
```
dataRealTimeMonitor, dataPowerTrend, dataBatterySOC, dataTemperature,
dataVoltage, dataCurrent, dataChartTitle...
```

### 历史页 (20+个键)
```
historyTitle, historySelectDate, historyDataType, historyExport...
```

### 控制页 (30+个键)
```
controlMode, controlAutomatic, controlManual, controlCharge,
controlDischarge, controlStandby...
```

### 告警页 (25+个键)
```
alarmLevel, alarmHigh, alarmMedium, alarmLow, alarmStatus...
```

### 日志页 (20+个键)
```
logLevel, logInfo, logWarn, logError, logTime, logFilter...
```

### 设置页 (35+个键)
```
settingsSystem, settingsAccount, settingsTheme, settingsLanguage...
```

### 登录页 (15+个键)
```
loginTitle, loginUsername, loginPassword, loginRemember, loginButton...
```

## 💡 最佳实践

### 1. 添加新内容时
始终为可显示的文本添加`data-i18n`属性:
```html
<!-- ✅ 推荐 -->
<div data-i18n="myText">我的文本</div>

<!-- ❌ 不推荐 -->
<div>我的文本</div>
```

### 2. 保持键名一致
相同含义的文本使用相同的翻译键:
```html
<!-- 所有"取消"按钮都使用同一个键 -->
<button data-i18n="cancel">取消</button>
<button data-i18n="cancel">取消</button>
```

### 3. 语义化键名
使用描述性的键名:
```javascript
// ✅ 推荐
homeRunningDays: '运行天数'

// ❌ 不推荐
text1: '运行天数'
```

### 4. 分类组织
按页面或功能模块组织翻译键:
```javascript
// 首页相关
home系列: homeXxx
// 数据页相关
data系列: dataXxx
// 控制页相关
control系列: controlXxx
```

## 🐛 常见问题

### Q1: 语言切换后部分文本没有变化?
**A:**
1. 检查该文本是否添加了`data-i18n`属性
2. 确认`touchscreen-i18n.js`中有对应的翻译键
3. 清除浏览器缓存并刷新页面

### Q2: 刷新页面后语言恢复默认?
**A:**
1. 检查浏览器是否允许localStorage
2. 确认`common-header-scripts.js`正确加载
3. 查看控制台是否有JavaScript错误

### Q3: 新添加的翻译键不生效?
**A:**
1. 确认`touchscreen-i18n.js`中同时添加了中英文翻译
2. 检查键名拼写是否正确(区分大小写)
3. 硬刷新页面(Ctrl+F5)清除缓存

### Q4: 如何添加第三种语言?
**A:**
在`touchscreen-i18n.js`的`touchscreenTranslations`对象中添加新语言:
```javascript
const touchscreenTranslations = {
    zh: { /* 中文 */ },
    en: { /* 英文 */ },
    es: { /* 西班牙语 - 新增 */
        systemTitle: 'Sistema de Gestión de Almacenamiento',
        // ... 其他翻译
    }
};
```

## 📊 统计数据

- **翻译键总数:** 200+ 个
- **覆盖页面:** 7 个主要页面
- **支持语言:** 2 种(中文/英文)
- **文件修改:** 8 个文件
- **新增文件:** 1 个(touchscreen-i18n.js)
- **默认语言:** 英文(en)

## 🚀 后续优化建议

### 短期优化
1. 为剩余页面内容添加data-i18n属性
2. 补充更多细节文本的翻译
3. 统一所有提示信息的翻译键

### 中期优化
1. 添加更多语言支持(日语、韩语等)
2. 实现语言包动态加载
3. 添加翻译管理后台

### 长期优化
1. 实现服务端国际化
2. 支持自定义翻译
3. 集成专业翻译服务API

---

**创建日期:** 2026-01-12
**适用版本:** 储能柜触摸屏系统 v1.0
**维护者:** AI Assistant
