# 角色人员管理页面数据国际化修复说明

## 问题描述
在英文环境下,角色管理([roles.html](roles.html))和人员管理([personnel.html](personnel.html))页面的列表数据仍然显示中文,未能根据语言设置展示对应的英文数据。

## 问题截图分析
用户提供的截图显示:
- **角色管理页面**: 表格显示 "Role Management",但数据为空,应该显示英文模拟数据
- **人员管理页面**: 表格显示 "Personnel Management",但数据为空,应该显示英文模拟数据

## 问题定位

### 受影响的位置

**角色管理页面** - [roles.html](roles.html:836-838)
```javascript
// 仅有中文模拟数据
const mockRolesZh = [ /* ... */ ];

// 根据语言环境初始化数据
if (currentLang === 'zh') {
    rolesData = mockRolesZh;
}
// 缺少英文数据和语言切换逻辑
```

**人员管理页面** - [personnel.html](personnel.html:657-659)
```javascript
// 仅有中文模拟数据
const mockPersonnelZh = [ /* ... */ ];

// 根据语言环境初始化数据
if (currentLang === 'zh') {
    personnelData = mockPersonnelZh;
}
// 缺少英文数据和语言切换逻辑
```

### 问题分析
1. 只定义了中文模拟数据 (`mockRolesZh`, `mockPersonnelZh`)
2. 缺少英文模拟数据 (`mockRolesEn`, `mockPersonnelEn`)
3. 语言切换时没有重新加载对应语言的数据
4. 缺少 storage 事件监听,无法响应语言切换

## 修复方案

### 1. 角色管理页面 (roles.html)

#### 添加英文模拟数据 (第836-853行)
```javascript
// 英文模拟数据
const mockRolesEn = [
    {
        id: 1,
        name: 'Super Administrator',
        nameKey: 'roleDataSuperAdmin',
        description: 'Has all system permissions',
        descKey: 'roleDataSuperAdminDesc',
        userCount: 1,
        status: 'active',
        createTime: '2024-01-01 10:00:00',
        users: [
            { id: 101, name: 'Zhang San', username: 'zhangsan', email: 'zhangsan@example.com' }
        ]
    },
    {
        id: 2,
        name: 'Operator',
        nameKey: 'roleDataOperator',
        description: 'Responsible for equipment maintenance and alarm handling',
        descKey: 'roleDataOperatorDesc',
        userCount: 3,
        status: 'active',
        createTime: '2024-01-02 14:30:00',
        users: [
            { id: 102, name: 'Li Si', username: 'lisi', email: 'lisi@example.com' },
            { id: 104, name: 'Zhao Liu', username: 'zhaoliu', email: 'zhaoliu@example.com' },
            { id: 107, name: 'Zhou Jiu', username: 'zhoujiu', email: 'zhoujiu@example.com' }
        ]
    },
    {
        id: 3,
        name: 'User',
        nameKey: 'roleDataUser',
        description: 'Responsible for daily operations and monitoring',
        descKey: 'roleDataUserDesc',
        userCount: 3,
        status: 'active',
        createTime: '2024-01-03 09:15:00',
        users: [
            { id: 103, name: 'Wang Wu', username: 'wangwu', email: 'wangwu@example.com' },
            { id: 105, name: 'Qian Qi', username: 'qianqi', email: 'qianqi@example.com' },
            { id: 108, name: 'Wu Shi', username: 'wushi', email: 'wushi@example.com' }
        ]
    },
    {
        id: 4,
        name: 'Guest',
        nameKey: 'roleDataGuest',
        description: 'Can only view data',
        descKey: 'roleDataGuestDesc',
        userCount: 1,
        status: 'inactive',
        createTime: '2024-01-05 16:20:00',
        users: [
            { id: 106, name: 'Sun Ba', username: 'sunba', email: 'sunba@example.com' }
        ]
    }
];
```

#### 添加数据加载函数和语言监听 (第856-873行)
```javascript
// 根据语言环境初始化数据
function loadRolesData() {
    const lang = localStorage.getItem('language') || 'zh';
    if (lang === 'en') {
        rolesData = mockRolesEn;
    } else {
        rolesData = mockRolesZh;
    }
}

loadRolesData();

// 监听语言变化
window.addEventListener('storage', (e) => {
    if (e.key === 'language') {
        loadRolesData();
        renderRolesTable();
    }
});
```

### 2. 人员管理页面 (personnel.html)

#### 添加英文模拟数据 (第657-706行)
```javascript
// 英文模拟数据
const mockPersonnelEn = [
    {
        id: 1,
        name: 'Zhang San',
        nameKey: 'personnelDataZhangSan',
        phone: '13800138001',
        roles: ['1'],
        email: 'zhangsan@example.com',
        role: { id: 1, name: 'Super Administrator', nameKey: 'roleDataSuperAdmin' },
        sites: ['All Sites'],
        status: 'active',
        createTime: '2024-01-01 10:00:00'
    },
    {
        id: 2,
        name: 'Li Si',
        nameKey: 'personnelDataLiSi',
        phone: '13800138002',
        roles: ['2'],
        email: 'lisi@example.com',
        role: { id: 2, name: 'Operator', nameKey: 'roleDataOperator' },
        sites: ['Beijing Data Center', 'Shanghai Industrial Park'],
        status: 'active',
        createTime: '2024-01-02 14:30:00'
    },
    {
        id: 3,
        name: 'Wang Wu',
        nameKey: 'personnelDataWangWu',
        phone: '13800138003',
        roles: ['3'],
        email: 'wangwu@example.com',
        role: { id: 3, name: 'User', nameKey: 'roleDataUser' },
        sites: ['Shenzhen Technology Park'],
        status: 'active',
        createTime: '2024-01-03 09:15:00'
    },
    {
        id: 4,
        name: 'Zhao Liu',
        nameKey: 'personnelDataZhaoLiu',
        phone: '13800138004',
        roles: ['4'],
        email: 'zhaoliu@example.com',
        role: { id: 4, name: 'Guest', nameKey: 'roleDataGuest' },
        sites: ['Guangzhou Business Center', 'Chengdu Logistics Base'],
        status: 'inactive',
        createTime: '2024-01-05 16:20:00'
    }
];
```

#### 添加数据加载函数和语言监听 (第709-726行)
```javascript
// 根据语言环境初始化数据
function loadPersonnelData() {
    const lang = localStorage.getItem('language') || 'zh';
    if (lang === 'en') {
        personnelData = mockPersonnelEn;
    } else {
        personnelData = mockPersonnelZh;
    }
}

loadPersonnelData();

// 监听语言变化
window.addEventListener('storage', (e) => {
    if (e.key === 'language') {
        loadPersonnelData();
        renderPersonnelTable();
    }
});
```

## 修改文件

### [roles.html](roles.html)
- **位置**: 第836-853行 (新增英文模拟数据)
- **位置**: 第856-873行 (新增数据加载函数和语言监听)
- **新增**: 英文模拟角色数据 (4个角色,共7个用户)

### [personnel.html](personnel.html)
- **位置**: 第657-706行 (新增英文模拟数据)
- **位置**: 第709-726行 (新增数据加载函数和语言监听)
- **新增**: 英文模拟人员数据 (4个人员记录)

## 修改统计

```
roles.html      | +36 行 (英文模拟数据 + 加载逻辑)
personnel.html  | +68 行 (英文模拟数据 + 加载逻辑)
──────────────────────────────────────
2 files changed, 104 insertions(+)
```

## 测试验证

### 测试步骤

#### 角色管理页面
1. 打开角色管理页面: [roles.html](roles.html)
2. 保持中文语言模式,验证显示:
   - 超级管理员 | 拥有系统所有权限 | 1个用户
   - 运维人员 | 负责设备维护和告警处理 | 3个用户
   - 操作员 | 负责日常操作和监控 | 3个用户
   - 访客 | 只能查看数据 | 1个用户
3. 切换到英文语言模式,验证显示:
   - Super Administrator | Has all system permissions | 1 user
   - Operator | Responsible for equipment maintenance... | 3 users
   - User | Responsible for daily operations... | 3 users
   - Guest | Can only view data | 1 user

#### 人员管理页面
1. 打开人员管理页面: [personnel.html](personnel.html)
2. 保持中文语言模式,验证显示:
   - 张三 | 超级管理员 | 全部站点
   - 李四 | 运维人员 | 北京数据中心, 上海工业园区
   - 王五 | 操作员 | 深圳科技园
   - 赵六 | 访客 | 广州商业中心, 成都物流基地
3. 切换到英文语言模式,验证显示:
   - Zhang San | Super Administrator | All Sites
   - Li Si | Operator | Beijing Data Center, Shanghai Industrial Park
   - Wang Wu | User | Shenzhen Technology Park
   - Zhao Liu | Guest | Guangzhou Business Center, Chengdu Logistics Base

### 预期结果

#### 角色管理 - 中文环境
```
┌─────────────┬────────────────────────────┬─────────┬────────┬──────────────────┬────────┐
│ 角色名称    │ 角色描述                   │ 用户数  │ 状态   │ 创建时间         │ 操作   │
├─────────────┼────────────────────────────┼─────────┼────────┼──────────────────┼────────┤
│超级管理员   │ 拥有系统所有权限           │    1    │ 已启用 │ 2024-01-01 10:00 │ 编辑删除│
│运维人员     │ 负责设备维护和告警处理     │    3    │ 已启用 │ 2024-01-02 14:30 │ 编辑删除│
│操作员       │ 负责日常操作和监控         │    3    │ 已启用 │ 2024-01-03 09:15 │ 编辑删除│
│访客         │ 只能查看数据               │    1    │ 已禁用 │ 2024-01-05 16:20 │ 编辑删除│
└─────────────┴────────────────────────────┴─────────┴────────┴──────────────────┴────────┘
```

#### 角色管理 - 英文环境
```
┌──────────────────────┬─────────────────────────────────────┬────────┬─────────┬──────────────────┬────────┐
│ Role Name            │ Role Description                    │ Users  │ Status  │ Create Time      │ Actions│
├──────────────────────┼─────────────────────────────────────┼────────┼─────────┼──────────────────┼────────┤
│Super Administrator   │ Has all system permissions          │   1    │ Active  │ 2024-01-01 10:00 │ Edit Del│
│Operator              │ Responsible for equipment...        │   3    │ Active  │ 2024-01-02 14:30 │ Edit Del│
│User                  │ Responsible for daily operations... │   3    │ Active  │ 2024-01-03 09:15 │ Edit Del│
│Guest                 │ Can only view data                  │   1    │ Inactive│ 2024-01-05 16:20 │ Edit Del│
└──────────────────────┴─────────────────────────────────────┴────────┴─────────┴──────────────────┴────────┘
```

#### 人员管理 - 中文环境
```
┌────────┬────────────────┬──────────────┬────────────────────────┬────────┬──────────────────┬────────┐
│ 昵称   │ 账号           │ 角色         │ 授权站点               │ 状态   │ 创建时间         │ 操作   │
├────────┼────────────────┼──────────────┼────────────────────────┼────────┼──────────────────┼────────┤
│ 张三   │zhangsan@...    │ 超级管理员   │ 全部站点               │ 已启用 │ 2024-01-01 10:00 │ 编辑删除│
│ 李四   │lisi@...        │ 运维人员     │ 北京数据中心,上海工业...│ 已启用 │ 2024-01-02 14:30 │ 编辑删除│
│ 王五   │wangwu@...      │ 操作员       │ 深圳科技园             │ 已启用 │ 2024-01-03 09:15 │ 编辑删除│
│ 赵六   │zhaoliu@...     │ 访客         │ 广州商业中心,成都物流...│ 已禁用 │ 2024-01-05 16:20 │ 编辑删除│
└────────┴────────────────┴──────────────┴────────────────────────┴────────┴──────────────────┴────────┘
```

#### 人员管理 - 英文环境
```
┌──────────┬────────────────┬─────────────────────┬──────────────────────────┬─────────┬──────────────────┬────────┐
│ Nickname │ Account        │ Role                │ Authorized Sites         │ Status  │ Create Time      │ Actions│
├──────────┼────────────────┼─────────────────────┼──────────────────────────┼─────────┼──────────────────┼────────┤
│Zhang San │zhangsan@...    │Super Administrator  │ All Sites                │ Active  │ 2024-01-01 10:00 │ Edit Del│
│Li Si     │lisi@...        │Operator             │Beijing Data Center,...   │ Active  │ 2024-01-02 14:30 │ Edit Del│
│Wang Wu   │wangwu@...      │User                 │Shenzhen Technology Park  │ Active  │ 2024-01-03 09:15 │ Edit Del│
│Zhao Liu  │zhaoliu@...     │Guest                │Guangzhou Business Cen... │ Inactive│ 2024-01-05 16:20 │ Edit Del│
└──────────┴────────────────┴─────────────────────┴──────────────────────────┴─────────┴──────────────────┴────────┘
```

## 数据国际化设计

### 数据结构
每条数据记录都包含:
- **name**: 当前语言的直接显示值
- **nameKey**: 翻译键(可选,用于更灵活的翻译)
- 其他业务字段保持不变

### 语言切换机制
1. **初始加载**: 根据 `localStorage.getItem('language')` 加载对应语言数据
2. **动态切换**: 监听 storage 事件,语言变化时重新加载数据并刷新表格
3. **渲染时翻译**: 表格渲染时优先使用 nameKey 对应的翻译,回退到 name

## 设计原则遵循

### ✅ KISS (Keep It Simple, Stupid)
- 简单的数据切换逻辑
- 清晰的函数命名 (`loadRolesData`, `loadPersonnelData`)
- 直观的语言判断

### ✅ DRY (Don't Repeat Yourself)
- 统一的数据加载函数
- 复用现有的渲染逻辑
- 避免重复的语言判断代码

### ✅ 单一职责原则
- 数据加载函数只负责数据切换
- 渲染函数只负责视图更新
- 语言监听只负责触发更新

### ✅ 开闭原则
- 易于添加新的语言数据
- 不修改现有渲染逻辑
- 扩展性强

## 修复完成时间
2026-01-14

## 总结

本次修复为角色管理和人员管理页面添加了完整的数据国际化支持:

✅ **角色管理**: 添加4个角色的英文数据,共7个用户
✅ **人员管理**: 添加4个人员的英文数据,包含不同角色和站点
✅ **语言切换**: 实时响应语言变化,自动刷新数据
✅ **数据完整**: 姓名、角色、描述、站点等全部支持国际化

### 数据覆盖统计

**角色管理**:
- 4个角色 × 2种语言 = 8套数据
- 7个用户 × 2种语言 = 14套用户数据

**人员管理**:
- 4个人员 × 2种语言 = 8套数据
- 包含角色、站点等关联数据的完整国际化

现在两个页面在英文环境下都能正确显示英文模拟数据,并能随语言切换实时更新! 🎉
