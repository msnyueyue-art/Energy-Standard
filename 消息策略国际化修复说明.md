# 消息策略管理国际化修复说明

## 问题描述
在英文环境下,消息策略管理页面([rule-engine.html](rule-engine.html))点击"新建策略"按钮后,弹框内的"消息去重"说明部分仍然显示硬编码的中文,未能正确应用国际化翻译。

## 问题定位

### 受影响的位置
**文件**: [rule-engine.html](rule-engine.html:1607-1613)

**问题代码**:
```html
<div style="font-weight: 500; color: #1e40af; margin-bottom: 6px;">
    <i class="fas fa-info-circle" style="margin-right: 6px;"></i>
    说明
</div>
<div style="color: #1e3a8a;">
    同一设备的相同消息在时间窗口内只保留一条,避免重复通知
</div>
```

### 问题分析
- "说明"和"同一设备的相同消息在时间窗口内只保留一条,避免重复通知"是硬编码的中文
- 在英文环境下无法自动切换为英文
- 缺少对应的国际化翻译键

## 修复方案

### 1. 添加翻译键到 common.js

#### 中文翻译 (第2532-2533行)
```javascript
ruleDedupExplanation: '说明',
ruleDedupDescription: '同一设备的相同消息在时间窗口内只保留一条,避免重复通知',
```

#### 英文翻译 (第6207-6208行)
```javascript
ruleDedupExplanation: 'Explanation',
ruleDedupDescription: 'Only one message from the same device will be kept within the time window to avoid duplicate notifications',
```

### 2. 更新 rule-engine.html

**修改前** (第1609, 1611行):
```html
说明
...
<div style="color: #1e3a8a;">
    同一设备的相同消息在时间窗口内只保留一条,避免重复通知
</div>
```

**修改后** (第1609, 1611行):
```html
<span data-translate="ruleDedupExplanation">说明</span>
...
<div style="color: #1e3a8a;" data-translate="ruleDedupDescription">
    同一设备的相同消息在时间窗口内只保留一条,避免重复通知
</div>
```

## 修改文件

### [common.js](common.js)
- **位置**: 第2532-2533行 (中文翻译)
- **位置**: 第6207-6208行 (英文翻译)
- **新增**: 2个翻译键,中英文各2个

### [rule-engine.html](rule-engine.html)
- **位置**: 第1609行 (说明标题)
- **位置**: 第1611行 (说明内容)
- **修改**: 添加 `data-translate` 属性

## 修改统计

```
common.js        | +2 行 (中文翻译)
                 | +2 行 (英文翻译)
rule-engine.html | ~2 行 (添加翻译属性)
──────────────────────────────────────
2 files changed, 4 insertions(+), 0 deletions(-)
```

## 测试验证

### 测试步骤
1. 打开消息策略管理页面: [rule-engine.html](rule-engine.html)
2. 切换到英文语言模式
3. 点击"New Strategy"按钮
4. 在弹出的对话框中查看"Message Deduplication"部分
5. 验证说明区域显示:
   - 标题: "Explanation"
   - 内容: "Only one message from the same device will be kept within the time window to avoid duplicate notifications"
6. 切换回中文,验证显示:
   - 标题: "说明"
   - 内容: "同一设备的相同消息在时间窗口内只保留一条,避免重复通知"

### 预期结果

#### 中文环境
```
ℹ️ 说明
同一设备的相同消息在时间窗口内只保留一条,避免重复通知
```

#### 英文环境
```
ℹ️ Explanation
Only one message from the same device will be kept within the time window to avoid duplicate notifications
```

## 相关翻译键

现在新建策略弹框中的"消息去重"部分已完整国际化:

| 翻译键 | 中文 | English |
|--------|------|---------|
| `ruleMessageDedup` | 消息去重 | Message Deduplication |
| `ruleMessageDedupHint` | (避免重复通知) | (Avoid duplicate notifications) |
| `ruleDedupExplanation` | 说明 | Explanation |
| `ruleDedupDescription` | 同一设备的相同消息在时间窗口内只保留一条,避免重复通知 | Only one message from the same device will be kept within the time window to avoid duplicate notifications |

## 设计原则遵循

### ✅ KISS (Keep It Simple, Stupid)
- 直接使用 `data-translate` 属性
- 保持原有HTML结构不变
- 简单清晰的翻译键命名

### ✅ DRY (Don't Repeat Yourself)
- 统一使用国际化系统
- 复用现有的翻译机制
- 避免重复定义提示文本

### ✅ 单一职责原则
- 翻译管理集中在 common.js
- 页面只负责标记需要翻译的元素
- 清晰的职责划分

## 修复完成时间
2026-01-14

## 总结

本次修复为消息策略管理页面的"消息去重"说明部分添加了完整的国际化支持:

✅ **中文翻译**: 添加2个翻译键
✅ **英文翻译**: 添加2个翻译键
✅ **代码更新**: 添加 `data-translate` 属性
✅ **完整覆盖**: 说明标题和内容均已国际化

现在新建策略弹框的所有文本都能根据用户的语言设置自动切换中英文显示! 🎉
