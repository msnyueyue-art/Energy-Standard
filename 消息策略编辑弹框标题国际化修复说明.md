# 消息策略编辑弹框标题国际化修复说明

## 修复概述

修复消息策略管理页面 (`rule-engine.html`) 编辑弹框标题在英文环境下仍显示中文"编辑规则"的问题。

## 问题描述

在英文环境下,点击编辑按钮打开编辑弹框时:
- **弹框标题:** `编辑规则` ❌ (硬编码中文)
- **期望显示:** `Edit Rule` ✅

## 问题原因

在 `openRuleModal` 函数中,编辑模式下的标题使用了硬编码的中文文本:

```javascript
if (ruleId) {
    modalTitle.textContent = '编辑规则';  // ❌ 硬编码中文
}
```

## 修复方案

使用国际化翻译函数 `getTranslation()` 替换硬编码文本。

## 修复内容

### 修改 openRuleModal 函数

**文件:** `rule-engine.html` (第 2799 行)

**修改前:**
```javascript
function openRuleModal(ruleId = null) {
    const modal = document.getElementById('ruleModal');
    const modalTitle = document.getElementById('modalTitle');

    if (ruleId) {
        modalTitle.textContent = '编辑规则';  // ❌ 硬编码
        // ...
    }
}
```

**修改后:**
```javascript
function openRuleModal(ruleId = null) {
    const modal = document.getElementById('ruleModal');
    const modalTitle = document.getElementById('modalTitle');

    if (ruleId) {
        modalTitle.textContent = getTranslation('ruleEditRule') || '编辑规则';  // ✅ 使用翻译
        // ...
    }
}
```

## 翻译键

使用现有的翻译键 `ruleEditRule`:

**中文翻译** (`common.js` 第 1874 行):
```javascript
ruleEditRule: '编辑规则',
```

**英文翻译** (`common.js` 第 5602 行):
```javascript
ruleEditRule: 'Edit Rule',
```

## 效果对比

### 修改前
- **中文环境:** `编辑规则` ✅
- **英文环境:** `编辑规则` ❌ (应该是英文)

### 修改后
- **中文环境:** `编辑规则` ✅
- **英文环境:** `Edit Rule` ✅

## 相关弹框标题

同一页面中其他弹框标题已正确使用国际化:

| 弹框 | HTML 标识 | 翻译键 | 中文 | 英文 |
|------|-----------|--------|------|------|
| 新建规则 | `modalTitle` | `ruleNewRule` | 新建策略 | New Strategy |
| 编辑规则 | `modalTitle` | `ruleEditRule` | 编辑规则 | Edit Rule |
| 选择模版 | - | `ruleTemplateModalTitle` | 选择规则模版 | Select Rule Template |

## 测试建议

1. **中文环境测试:**
   - 点击任一规则的编辑按钮
   - 验证弹框标题显示"编辑规则"

2. **英文环境测试:**
   - 切换到英文
   - 点击任一规则的编辑按钮
   - 验证弹框标题显示"Edit Rule"

3. **新建规则测试:**
   - 点击"New Strategy"按钮
   - 验证弹框标题显示"New Strategy"(而非"Edit Rule")

4. **语言切换测试:**
   - 打开编辑弹框
   - 切换语言
   - 关闭并重新打开弹框
   - 验证标题使用新语言

## 技术说明

### 为什么使用 `||` 回退

```javascript
getTranslation('ruleEditRule') || '编辑规则'
```

这种写法提供了回退机制:
- 如果 `getTranslation()` 返回有效值,使用翻译文本
- 如果 `getTranslation()` 返回 `undefined` 或 `null`,使用默认中文文本
- 确保在翻译系统故障时也能正常显示

### 最佳实践

1. **避免硬编码文本:** 所有用户可见的文本都应使用翻译键
2. **提供回退值:** 使用 `||` 提供默认文本作为回退
3. **使用现有翻译键:** 优先使用已定义的翻译键,避免重复定义
4. **保持一致性:** 相似功能使用相似的翻译键命名

## 相关文件

- **主文件:** `rule-engine.html`
- **修改位置:** 第 2799 行
- **翻译文件:** `common.js`
- **翻译键位置:**
  - 中文: 第 1874 行
  - 英文: 第 5602 行

## 相关修复

此修复是消息策略管理页面国际化完善的一部分,相关修复包括:
1. [消息策略删除确认对话框国际化修复](消息策略删除确认对话框国际化修复说明.md)
2. [删除按钮无响应问题修复](删除按钮无响应问题修复说明.md)
3. 编辑弹框标题国际化修复 (本文档)

## 日期

修复日期: 2026-01-14
