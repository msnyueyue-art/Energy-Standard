<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Dashboardå›¾è¡¨è¯Šæ–­</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            display: inline-block;
            margin-left: 10px;
        }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .warning { background: #fef3c7; color: #92400e; }
    </style>
</head>
<body>
    <h1>ğŸ” Dashboardå›¾è¡¨è¯Šæ–­å·¥å…·</h1>

    <div class="test-section">
        <h2>æ­¥éª¤1ï¼šæ£€æŸ¥è„šæœ¬åŠ è½½</h2>
        <div id="scriptTest"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤2ï¼šæ£€æŸ¥Chart.js</h2>
        <div id="chartJsTest"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤3ï¼šæ£€æŸ¥i18n</h2>
        <div id="i18nTest"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤4ï¼šæ£€æŸ¥DOMå…ƒç´ </h2>
        <div id="domTest"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤5ï¼šå°è¯•åˆ›å»ºæµ‹è¯•å›¾è¡¨</h2>
        <canvas id="testChart" width="400" height="200"></canvas>
        <div id="chartTest"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤6ï¼šæ£€æŸ¥localStorage</h2>
        <div id="storageTest"></div>
    </div>

    <div class="test-section">
        <h2>æ§åˆ¶å°æ—¥å¿—</h2>
        <div id="console" style="background: #1e293b; color: #e2e8f0; padding: 12px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;"></div>
    </div>

    <!-- åŠ è½½å¿…è¦çš„è„šæœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../ueh/components/i18n.js"></script>

    <script>
        // é‡å®šå‘console.logåˆ°é¡µé¢
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addToConsole(type, ...args) {
            const message = args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
            const color = type === 'error' ? '#ef4444' : type === 'warn' ? '#f59e0b' : '#e2e8f0';
            consoleDiv.innerHTML += `<div style="color: ${color};">[${type}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole('log', ...args);
        };
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole('error', ...args);
        };
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole('warn', ...args);
        };

        // å¼€å§‹æµ‹è¯•
        console.log('=== è¯Šæ–­å¼€å§‹ ===');

        // æµ‹è¯•1ï¼šæ£€æŸ¥è„šæœ¬åŠ è½½
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… DOMContentLoadedäº‹ä»¶è§¦å‘');

            let html = '';
            html += `<p>âœ… DOMContentLoadedäº‹ä»¶: <span class="status success">æ­£å¸¸è§¦å‘</span></p>`;
            html += `<p>è„šæœ¬æ ‡ç­¾æ•°é‡: ${document.scripts.length}</p>`;
            document.getElementById('scriptTest').innerHTML = html;
        });

        // æµ‹è¯•2ï¼šæ£€æŸ¥Chart.js
        setTimeout(function() {
            const chartJsTestDiv = document.getElementById('chartJsTest');
            let html = '';

            if (typeof Chart !== 'undefined') {
                html += `<p>âœ… Chart.jsåŠ è½½: <span class="status success">æˆåŠŸ</span></p>`;
                html += `<p>Chartç‰ˆæœ¬: ${Chart.version || 'æœªçŸ¥'}</p>`;
                console.log('âœ… Chart.jsåŠ è½½æˆåŠŸï¼Œç‰ˆæœ¬:', Chart.version);
            } else {
                html += `<p>âŒ Chart.jsåŠ è½½: <span class="status error">å¤±è´¥</span></p>`;
                console.error('âŒ Chart.jsæœªåŠ è½½');
            }

            chartJsTestDiv.innerHTML = html;
        }, 500);

        // æµ‹è¯•3ï¼šæ£€æŸ¥i18n
        setTimeout(function() {
            const i18nTestDiv = document.getElementById('i18nTest');
            let html = '';

            if (typeof window.i18n !== 'undefined') {
                html += `<p>âœ… i18nåŠ è½½: <span class="status success">æˆåŠŸ</span></p>`;
                html += `<p>å½“å‰è¯­è¨€: ${window.i18n.currentLanguage || 'æœªè®¾ç½®'}</p>`;
                console.log('âœ… i18nåŠ è½½æˆåŠŸï¼Œå½“å‰è¯­è¨€:', window.i18n.currentLanguage);
            } else {
                html += `<p>âŒ i18nåŠ è½½: <span class="status error">å¤±è´¥</span></p>`;
                console.error('âŒ i18næœªåŠ è½½');
            }

            i18nTestDiv.innerHTML = html;
        }, 1000);

        // æµ‹è¯•4ï¼šæ£€æŸ¥DOMå…ƒç´ 
        window.addEventListener('load', function() {
            console.log('âœ… window.loadäº‹ä»¶è§¦å‘');

            const domTestDiv = document.getElementById('domTest');
            let html = '';

            html += `<p>âœ… window.loadäº‹ä»¶: <span class="status success">æ­£å¸¸è§¦å‘</span></p>`;
            html += `<p>é¡µé¢æ€»å…ƒç´ æ•°: ${document.querySelectorAll('*').length}</p>`;
            html += `<p>Canvaså…ƒç´ : testChartå­˜åœ¨? ${document.getElementById('testChart') ? 'âœ… æ˜¯' : 'âŒ å¦'}</p>`;

            domTestDiv.innerHTML = html;
        });

        // æµ‹è¯•5ï¼šå°è¯•åˆ›å»ºå›¾è¡¨
        window.addEventListener('load', function() {
            const chartTestDiv = document.getElementById('chartTest');
            const canvas = document.getElementById('testChart');

            if (!canvas) {
                chartTestDiv.innerHTML = '<p>âŒ Canvaså…ƒç´ ä¸å­˜åœ¨</p>';
                console.error('âŒ Canvaså…ƒç´ ä¸å­˜åœ¨');
                return;
            }

            if (typeof Chart === 'undefined') {
                chartTestDiv.innerHTML = '<p>âŒ Chart.jsæœªåŠ è½½ï¼Œæ— æ³•åˆ›å»ºå›¾è¡¨</p>';
                console.error('âŒ Chart.jsæœªåŠ è½½');
                return;
            }

            try {
                const ctx = canvas.getContext('2d');
                const testChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['æµ‹è¯•1', 'æµ‹è¯•2', 'æµ‹è¯•3'],
                        datasets: [{
                            label: 'æµ‹è¯•æ•°æ®',
                            data: [12, 19, 3],
                            backgroundColor: '#3b82f6'
                        }]
                    },
                    options: {
                        responsive: false,
                        plugins: {
                            legend: { display: true }
                        }
                    }
                });

                chartTestDiv.innerHTML = '<p>âœ… æµ‹è¯•å›¾è¡¨åˆ›å»º: <span class="status success">æˆåŠŸ</span></p>';
                console.log('âœ… æµ‹è¯•å›¾è¡¨åˆ›å»ºæˆåŠŸ');
            } catch (error) {
                chartTestDiv.innerHTML = `<p>âŒ æµ‹è¯•å›¾è¡¨åˆ›å»ºå¤±è´¥: <span class="status error">${error.message}</span></p>`;
                console.error('âŒ åˆ›å»ºå›¾è¡¨å¤±è´¥:', error);
            }
        });

        // æµ‹è¯•6ï¼šæ£€æŸ¥localStorage
        setTimeout(function() {
            const storageTestDiv = document.getElementById('storageTest');
            let html = '<ul>';

            try {
                const appLanguage = localStorage.getItem('app_language');
                const language = localStorage.getItem('language');

                html += `<li>app_language: ${appLanguage || 'æœªè®¾ç½®'}</li>`;
                html += `<li>language: ${language || 'æœªè®¾ç½®'}</li>`;

                if (appLanguage || language) {
                    html += `<li><span class="status success">è¯­è¨€è®¾ç½®å­˜åœ¨</span></li>`;
                    console.log('âœ… localStorageè¯­è¨€è®¾ç½®:', { appLanguage, language });
                } else {
                    html += `<li><span class="status warning">è¯­è¨€è®¾ç½®æœªåˆå§‹åŒ–</span></li>`;
                    console.warn('âš ï¸ localStorageä¸­æ²¡æœ‰è¯­è¨€è®¾ç½®');
                }
            } catch (error) {
                html += `<li><span class="status error">localStorageè®¿é—®å¤±è´¥: ${error.message}</span></li>`;
                console.error('âŒ localStorageè®¿é—®å¤±è´¥:', error);
            }

            html += '</ul>';
            storageTestDiv.innerHTML = html;
        }, 1500);
    </script>
</body>
</html>
