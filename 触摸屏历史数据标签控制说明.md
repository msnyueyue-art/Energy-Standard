# 触摸屏历史数据标签控制说明

## 功能概述

在英文环境下，选择性地隐藏数据页面各个组件的"Historical Data"（历史数据）标签，同时保留未来恢复显示的灵活性。

## 实现位置

**文件**: `touchscreen/data.html` (第8429-8460行)

## 受控组件列表

当前在英文环境下隐藏历史数据标签的组件：

| 序号 | 组件名称 | 英文名称 | 标识符 | 状态 |
|-----|---------|---------|--------|------|
| 1 | 整机 | Overall | `overall` | ❌ 隐藏 |
| 2 | EMS | EMS | `ems` | ❌ 隐藏 |
| 3 | PCS | PCS | `pcs` | ❌ 隐藏 |
| 4 | BMS | BMS | `bms` | ❌ 隐藏 |
| 5 | 电表 | Meter | `meter` | ❌ 隐藏 |
| 6 | 温度 | Thermal | `thermal` | ❌ 隐藏 |
| 7 | 消防 | Fire | `fire` | ❌ 隐藏 |

## 核心实现代码

```javascript
// 控制历史数据标签的显示/隐藏
function toggleHistoricalDataTabs() {
    const currentLang = getTouchscreenLang();

    // 定义在英文环境下需要隐藏历史数据标签的组件列表
    // 如果将来需要恢复显示，只需从此数组中移除对应的组件名称
    const hiddenComponents = [
        'overall',  // 整机
        'ems',      // EMS
        'pcs',      // PCS
        'bms',      // BMS
        'meter',    // 电表
        'thermal',  // 温度
        'fire'      // 消防
    ];

    // 遍历需要隐藏的组件
    hiddenComponents.forEach(component => {
        // 使用 onclick 属性来精确定位特定组件的历史数据按钮
        const button = document.querySelector(`button[onclick="switchSubTab('${component}', 'history')"]`);

        if (button) {
            if (currentLang === 'en') {
                // 英文环境下隐藏
                button.style.display = 'none';
            } else {
                // 中文环境下显示
                button.style.display = '';
            }
        }
    });
}
```

## 技术特点

### 1. 精确选择器

使用 `onclick` 属性作为选择器，可以精确定位特定组件的历史数据按钮：

```javascript
const button = document.querySelector(`button[onclick="switchSubTab('ems', 'history')"]`);
```

这个选择器会精确匹配：
```html
<button class="sub-tab"
        onclick="switchSubTab('ems', 'history')"
        data-i18n="historicalData">
    Historical Data
</button>
```

### 2. 配置化控制

通过 `hiddenComponents` 数组集中管理需要隐藏的组件，便于维护和调整：

```javascript
const hiddenComponents = [
    'overall',  // 整机
    'ems',      // EMS
    'pcs',      // PCS
    // ...
];
```

### 3. 不影响其他页面

- ✅ 只影响数据页面的历史数据标签
- ✅ 不影响其他页面的布局和内容
- ✅ 不影响实时数据标签的显示
- ✅ 不影响设置按钮的显示

## 如何恢复显示

### 恢复单个组件

如果将来需要恢复某个组件的历史数据标签（例如 EMS），只需从 `hiddenComponents` 数组中删除该组件：

**修改前**:
```javascript
const hiddenComponents = [
    'overall',
    'ems',      // ← 删除这一行即可恢复 EMS 的历史数据标签
    'pcs',
    'bms',
    'meter',
    'thermal',
    'fire'
];
```

**修改后**:
```javascript
const hiddenComponents = [
    'overall',
    // 'ems',   // ← 已删除，EMS 的历史数据标签将在英文环境下显示
    'pcs',
    'bms',
    'meter',
    'thermal',
    'fire'
];
```

### 恢复多个组件

恢复 EMS、PCS、BMS 的历史数据标签：

```javascript
const hiddenComponents = [
    'overall',
    // 'ems',      // ← 恢复显示
    // 'pcs',      // ← 恢复显示
    // 'bms',      // ← 恢复显示
    'meter',
    'thermal',
    'fire'
];
```

### 恢复所有组件

如果所有组件的历史数据功能都已完成，可以清空数组：

```javascript
const hiddenComponents = [
    // 所有组件都已恢复显示
];
```

或者直接注释掉整个隐藏逻辑：

```javascript
function toggleHistoricalDataTabs() {
    // 历史数据功能已全部完成，不再需要隐藏
    return;

    const currentLang = getTouchscreenLang();
    // ...
}
```

## 调用时机

### 1. 页面初始化

```javascript
document.addEventListener('DOMContentLoaded', function() {
    // ... 其他初始化代码 ...

    // 控制历史数据标签的显示/隐藏
    toggleHistoricalDataTabs();
});
```

### 2. 语言切换

```javascript
window.addEventListener('languageChanged', function(e) {
    // ... 其他代码 ...

    // 控制历史数据标签的显示/隐藏
    toggleHistoricalDataTabs();
});
```

## 显示效果

### 中文环境 ✅

所有组件都显示"实时数据"和"历史数据"两个标签：

```
整机: [实时数据] [历史数据] ⚙️ 自定义
EMS:  [实时数据] [历史数据] ⚙️ 自定义
PCS:  [实时数据] [历史数据] ⚙️ 自定义
BMS:  [实时数据] [历史数据] ⚙️ 自定义
电表: [实时数据] [历史数据] ⚙️ 自定义
温度: [实时数据] [历史数据] ⚙️ 自定义
消防: [实时数据] [历史数据] ⚙️ 自定义
```

### 英文环境 ❌

所有组件只显示"Real-time Data"标签，"Historical Data"标签被隐藏：

```
Overall: [Real-time Data] ⚙️ Custom
EMS:     [Real-time Data] ⚙️ Custom
PCS:     [Real-time Data] ⚙️ Custom
BMS:     [Real-time Data] ⚙️ Custom
Meter:   [Real-time Data] ⚙️ Custom
Thermal: [Real-time Data] ⚙️ Custom
Fire:    [Real-time Data] ⚙️ Custom
```

## 测试验证

### 测试步骤

1. **打开触摸屏系统**
   - 访问 `touchscreen/touchscreen-display.html`
   - 登录系统

2. **验证中文环境**
   - 确保当前语言是中文
   - 点击顶部导航 "数据" 进入数据页面
   - 逐个检查所有组件标签页
   - ✅ 验证: 每个组件都显示"实时数据"和"历史数据"两个标签

3. **切换到英文环境**
   - 点击右上角语言切换按钮
   - 选择 "English"

4. **验证英文环境**
   - ✅ 验证: 所有7个组件只显示"Real-time Data"标签
   - ✅ 验证: "Historical Data"标签完全不可见
   - ✅ 验证: "Custom"按钮正常显示
   - ✅ 验证: 页面布局没有错乱

5. **验证动态切换**
   - 在数据页面来回切换语言
   - ✅ 验证: 历史数据标签根据语言动态显示/隐藏
   - ✅ 验证: 切换流畅,无延迟

### 组件检查清单

**中文环境**:
- [ ] 整机 - 显示"历史数据"标签
- [ ] EMS - 显示"历史数据"标签
- [ ] PCS - 显示"历史数据"标签
- [ ] BMS - 显示"历史数据"标签
- [ ] 电表 - 显示"历史数据"标签
- [ ] 温度 - 显示"历史数据"标签
- [ ] 消防 - 显示"历史数据"标签

**英文环境**:
- [ ] Overall - 隐藏"Historical Data"标签
- [ ] EMS - 隐藏"Historical Data"标签
- [ ] PCS - 隐藏"Historical Data"标签
- [ ] BMS - 隐藏"Historical Data"标签
- [ ] Meter - 隐藏"Historical Data"标签
- [ ] Thermal - 隐藏"Historical Data"标签
- [ ] Fire - 隐藏"Historical Data"标签

## 代码维护指南

### 添加新组件

如果系统中新增了组件，需要在英文环境下隐藏其历史数据标签：

1. 找到组件的标识符（例如新组件叫 `newComponent`）
2. 将标识符添加到 `hiddenComponents` 数组：

```javascript
const hiddenComponents = [
    'overall',
    'ems',
    'pcs',
    'bms',
    'meter',
    'thermal',
    'fire',
    'newComponent'  // ← 新增组件
];
```

### 调整隐藏策略

如果需要更复杂的控制逻辑（例如根据用户权限），可以扩展函数：

```javascript
function toggleHistoricalDataTabs() {
    const currentLang = getTouchscreenLang();
    const userRole = getUserRole(); // 假设有获取用户角色的函数

    // 根据不同角色定义不同的隐藏规则
    let hiddenComponents = [];

    if (currentLang === 'en') {
        if (userRole === 'admin') {
            // 管理员：只隐藏部分组件
            hiddenComponents = ['overall', 'meter'];
        } else {
            // 普通用户：隐藏所有组件
            hiddenComponents = ['overall', 'ems', 'pcs', 'bms', 'meter', 'thermal', 'fire'];
        }
    }

    // ... 后续隐藏逻辑 ...
}
```

### 配置文件化

对于更灵活的配置，可以将隐藏规则提取到配置对象：

```javascript
// 历史数据标签显示配置
const historicalDataConfig = {
    zh: {
        // 中文环境：所有组件都显示
        visible: ['overall', 'ems', 'pcs', 'bms', 'meter', 'thermal', 'fire']
    },
    en: {
        // 英文环境：所有组件都隐藏
        hidden: ['overall', 'ems', 'pcs', 'bms', 'meter', 'thermal', 'fire']
    }
};

function toggleHistoricalDataTabs() {
    const currentLang = getTouchscreenLang();
    const config = historicalDataConfig[currentLang];

    if (config && config.hidden) {
        config.hidden.forEach(component => {
            const button = document.querySelector(`button[onclick="switchSubTab('${component}', 'history')"]`);
            if (button) {
                button.style.display = 'none';
            }
        });
    }
}
```

## 常见问题

### Q1: 修改 `hiddenComponents` 数组后没有生效

**原因**: 浏览器缓存了旧版本的文件

**解决方案**:
1. 按 Ctrl+F5 强制刷新页面
2. 清除浏览器缓存后重新加载

### Q2: 某个组件的历史数据标签无法隐藏

**原因**: 组件标识符可能不正确

**解决方案**:
1. 打开浏览器开发者工具 (F12)
2. 在 Elements 标签中找到该组件的历史数据按钮
3. 检查 `onclick` 属性中的组件标识符
4. 确保 `hiddenComponents` 数组中的标识符与 `onclick` 中的一致

例如，如果按钮是：
```html
<button onclick="switchSubTab('new-component', 'history')">Historical Data</button>
```

则数组中应该使用 `'new-component'` 而不是 `'newComponent'`

### Q3: 切换语言后标签没有更新

**原因**: `languageChanged` 事件可能没有正确触发

**解决方案**:
1. 检查控制台是否有错误信息
2. 确认 `window.addEventListener('languageChanged', ...)` 已正确添加
3. 确认在事件处理函数中调用了 `toggleHistoricalDataTabs()`

## 相关文件

- **主文件**: [touchscreen/data.html](touchscreen/data.html)
  - toggleHistoricalDataTabs 函数: 第8429-8460行
  - 页面初始化调用: 第8456行
  - 语言切换调用: 第8420行

## 版本记录

| 版本 | 日期 | 修改内容 |
|-----|------|---------|
| 1.0 | 2026-01-13 | 初始版本：隐藏所有组件的历史数据标签 |
| 2.0 | 2026-01-13 | 改进版本：使用配置数组，便于恢复显示 |

## 总结

通过使用配置化的 `hiddenComponents` 数组，我们实现了：

✅ **精确控制** - 可以精确控制每个组件的历史数据标签显示
✅ **易于维护** - 通过修改数组即可调整隐藏规则
✅ **易于恢复** - 删除数组元素即可恢复显示
✅ **不影响布局** - 只隐藏标签，不影响其他页面内容
✅ **动态响应** - 语言切换时自动更新显示状态

这个设计为未来的功能开发提供了最大的灵活性！🎉
