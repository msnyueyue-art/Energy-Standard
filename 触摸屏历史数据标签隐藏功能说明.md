# è§¦æ‘¸å±å†å²æ•°æ®æ ‡ç­¾éšè—åŠŸèƒ½è¯´æ˜

## éœ€æ±‚æè¿°

åœ¨è‹±æ–‡ç¯å¢ƒä¸‹ï¼Œè§¦æ‘¸å±æ•°æ®é¡µé¢çš„"Historical Data"ï¼ˆå†å²æ•°æ®ï¼‰æ ‡ç­¾éœ€è¦éšè—ï¼Œåªä¿ç•™"Real-time Data"ï¼ˆå®æ—¶æ•°æ®ï¼‰æ ‡ç­¾ã€‚

è¿™æ˜¯å› ä¸ºå†å²æ•°æ®åŠŸèƒ½å°šæœªå®Œå…¨å¼€å‘ï¼Œä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œåœ¨è‹±æ–‡ç‰ˆæœ¬ä¸­æš‚æ—¶éšè—è¯¥åŠŸèƒ½ã€‚

## å®ç°ä½ç½®

**æ–‡ä»¶**: `touchscreen/data.html`

## å—å½±å“çš„æ ‡ç­¾

æ‰€æœ‰å¸¦æœ‰ `data-i18n="historicalData"` å±æ€§çš„æŒ‰é’®å…ƒç´ ï¼š

1. **æ•´æœº(Overall)** - å†å²æ•°æ®æ ‡ç­¾
2. **EMS** - å†å²æ•°æ®æ ‡ç­¾
3. **PCS** - å†å²æ•°æ®æ ‡ç­¾
4. **Meter** - å†å²æ•°æ®æ ‡ç­¾
5. **BMS** - å†å²æ•°æ®æ ‡ç­¾
6. **Thermal** - å†å²æ•°æ®æ ‡ç­¾
7. **Fire** - å†å²æ•°æ®æ ‡ç­¾
8. **è®¾ç½®é¢æ¿** - å†å²æ•°æ®ç±»å‹æŒ‰é’®

å…± 8 ä¸ª"Historical Data"æŒ‰é’®ã€‚

## å®ç°æ–¹æ¡ˆ

### æ ¸å¿ƒå‡½æ•°

æ–°å¢ `toggleHistoricalDataTabs()` å‡½æ•° (ç¬¬8429-8443è¡Œ):

```javascript
// æ§åˆ¶å†å²æ•°æ®æ ‡ç­¾çš„æ˜¾ç¤º/éšè—
function toggleHistoricalDataTabs() {
    const currentLang = getTouchscreenLang();
    const historicalDataButtons = document.querySelectorAll('[data-i18n="historicalData"]');

    historicalDataButtons.forEach(button => {
        if (currentLang === 'en') {
            // è‹±æ–‡ç¯å¢ƒä¸‹éšè—å†å²æ•°æ®æ ‡ç­¾
            button.style.display = 'none';
        } else {
            // ä¸­æ–‡ç¯å¢ƒä¸‹æ˜¾ç¤ºå†å²æ•°æ®æ ‡ç­¾
            button.style.display = '';
        }
    });
}
```

### è°ƒç”¨æ—¶æœº

#### 1. é¡µé¢åˆå§‹åŒ–æ—¶ (ç¬¬8456è¡Œ)

```javascript
document.addEventListener('DOMContentLoaded', function() {
    const currentLang = getTouchscreenLang();

    // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...

    // æ§åˆ¶å†å²æ•°æ®æ ‡ç­¾çš„æ˜¾ç¤º/éšè—
    toggleHistoricalDataTabs();

    // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...
});
```

#### 2. è¯­è¨€åˆ‡æ¢æ—¶ (ç¬¬8420è¡Œ)

```javascript
window.addEventListener('languageChanged', function(e) {
    console.log('æ•°æ®é¡µé¢æ¥æ”¶åˆ°è¯­è¨€åˆ‡æ¢äº‹ä»¶:', e.detail.lang);

    // æ›´æ–°HTML langå±æ€§
    document.documentElement.lang = e.detail.lang === 'zh' ? 'zh-CN' : 'en';

    // é‡æ–°åº”ç”¨ç¿»è¯‘åˆ°æ‰€æœ‰å…ƒç´ 
    applyTouchscreenTranslations();

    // æ§åˆ¶å†å²æ•°æ®æ ‡ç­¾çš„æ˜¾ç¤º/éšè—
    toggleHistoricalDataTabs();

    // ... å…¶ä»–ä»£ç  ...
});
```

## æŠ€æœ¯ç»†èŠ‚

### é€‰æ‹©å™¨è¯´æ˜

```javascript
document.querySelectorAll('[data-i18n="historicalData"]')
```

è¿™ä¸ªé€‰æ‹©å™¨ä¼šæ‰¾åˆ°æ‰€æœ‰å¸¦æœ‰ `data-i18n="historicalData"` å±æ€§çš„å…ƒç´ ï¼ŒåŒ…æ‹¬ï¼š

```html
<!-- å­æ ‡ç­¾é¡µä¸­çš„å†å²æ•°æ®æŒ‰é’® -->
<button class="sub-tab"
        onclick="switchSubTab('overall', 'history')"
        data-i18n="historicalData">
    Historical Data
</button>

<!-- è®¾ç½®é¢æ¿ä¸­çš„ç±»å‹åˆ‡æ¢æŒ‰é’® -->
<button class="type-btn"
        id="history-type-btn"
        onclick="switchSettingsType('history')"
        data-i18n="historicalData">
    Historical Data
</button>
```

### æ˜¾ç¤º/éšè—é€»è¾‘

```javascript
if (currentLang === 'en') {
    // è‹±æ–‡: éšè—
    button.style.display = 'none';
} else {
    // ä¸­æ–‡: æ˜¾ç¤º (æ¢å¤é»˜è®¤)
    button.style.display = '';
}
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ç©ºå­—ç¬¦ä¸² `''` è€Œä¸æ˜¯ `'block'`?**

å› ä¸ºä¸åŒçš„æŒ‰é’®å¯èƒ½æœ‰ä¸åŒçš„é»˜è®¤ display å€¼ï¼š
- å­æ ‡ç­¾æŒ‰é’®å¯èƒ½æ˜¯ `inline-block`
- å…¶ä»–æŒ‰é’®å¯èƒ½æ˜¯ `flex`

ä½¿ç”¨ç©ºå­—ç¬¦ä¸² `''` ä¼šè®©æµè§ˆå™¨ä½¿ç”¨å…ƒç´ çš„é»˜è®¤æˆ– CSS å®šä¹‰çš„ display å€¼ã€‚

## åŠŸèƒ½æ•ˆæœ

### ä¸­æ–‡ç¯å¢ƒ âœ…

**æ•°æ®é¡µé¢ - æ•´æœºæ ‡ç­¾**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å®æ—¶æ•°æ®] [å†å²æ•°æ®] âš™ï¸ è‡ªå®šä¹‰        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æ‰€æœ‰ç»„ä»¶(æ•´æœºã€EMSã€PCSã€Meterã€BMSã€Thermalã€Fire)éƒ½æ˜¾ç¤ºä¸¤ä¸ªæ ‡ç­¾ã€‚

### è‹±æ–‡ç¯å¢ƒ âœ…

**Data Page - Overall Tab**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Real-time Data] âš™ï¸ Custom            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

"Historical Data" æŒ‰é’®è¢«éšè—ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°"Real-time Data"æ ‡ç­¾ã€‚

## åŠ¨æ€åˆ‡æ¢æ•ˆæœ

### åœºæ™¯1: ä»ä¸­æ–‡åˆ‡æ¢åˆ°è‹±æ–‡

```
ä¸­æ–‡çŠ¶æ€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å®æ—¶æ•°æ®] [å†å²æ•°æ®] âš™ï¸ è‡ªå®šä¹‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“ åˆ‡æ¢åˆ°è‹±æ–‡

è‹±æ–‡çŠ¶æ€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Real-time Data] âš™ï¸ Custom       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯2: ä»è‹±æ–‡åˆ‡æ¢åˆ°ä¸­æ–‡

```
è‹±æ–‡çŠ¶æ€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Real-time Data] âš™ï¸ Custom       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“ åˆ‡æ¢åˆ°ä¸­æ–‡

ä¸­æ–‡çŠ¶æ€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [å®æ—¶æ•°æ®] [å†å²æ•°æ®] âš™ï¸ è‡ªå®šä¹‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. **æ‰“å¼€è§¦æ‘¸å±å±•ç¤ºé¡µé¢**:
   - è®¿é—® `touchscreen/touchscreen-display.html`
   - ç™»å½•ç³»ç»Ÿ

2. **åˆ‡æ¢åˆ°æ•°æ®é¡µé¢**:
   - ç‚¹å‡»é¡¶éƒ¨å¯¼èˆªçš„ "Data" æŒ‰é’®
   - ç¡®è®¤è¿›å…¥æ•°æ®é¡µé¢

3. **éªŒè¯ä¸­æ–‡ç¯å¢ƒ**:
   - ç¡®ä¿å½“å‰è¯­è¨€æ˜¯ä¸­æ–‡
   - æ£€æŸ¥æ‰€æœ‰ç»„ä»¶æ ‡ç­¾é¡µ
   - âœ… éªŒè¯: æ‰€æœ‰ç»„ä»¶éƒ½æ˜¾ç¤º"å®æ—¶æ•°æ®"å’Œ"å†å²æ•°æ®"ä¸¤ä¸ªæ ‡ç­¾

4. **åˆ‡æ¢åˆ°è‹±æ–‡ç¯å¢ƒ**:
   - ç‚¹å‡»å³ä¸Šè§’è¯­è¨€åˆ‡æ¢æŒ‰é’®
   - é€‰æ‹© "English"

5. **éªŒè¯è‹±æ–‡ç¯å¢ƒ**:
   - âœ… éªŒè¯: æ‰€æœ‰ç»„ä»¶åªæ˜¾ç¤º"Real-time Data"æ ‡ç­¾
   - âœ… éªŒè¯: "Historical Data"æ ‡ç­¾å®Œå…¨ä¸å¯è§
   - âœ… éªŒè¯: "Custom"æŒ‰é’®æ­£å¸¸æ˜¾ç¤º

6. **éªŒè¯åŠ¨æ€åˆ‡æ¢**:
   - åœ¨æ•°æ®é¡µé¢æ¥å›åˆ‡æ¢è¯­è¨€
   - âœ… éªŒè¯: å†å²æ•°æ®æ ‡ç­¾æ ¹æ®è¯­è¨€åŠ¨æ€æ˜¾ç¤º/éšè—
   - âœ… éªŒè¯: åˆ‡æ¢æµç•…,æ— å»¶è¿Ÿ

### é¢„æœŸç»“æœ

| è¯­è¨€ç¯å¢ƒ | å®æ—¶æ•°æ®æ ‡ç­¾ | å†å²æ•°æ®æ ‡ç­¾ | è‡ªå®šä¹‰æŒ‰é’® |
|---------|------------|------------|-----------|
| ä¸­æ–‡ | âœ… æ˜¾ç¤º | âœ… æ˜¾ç¤º | âœ… æ˜¾ç¤º |
| è‹±æ–‡ | âœ… æ˜¾ç¤º | âŒ éšè— | âœ… æ˜¾ç¤º |

### æ£€æŸ¥ç‚¹æ¸…å•

- [ ] æ•´æœº(Overall)æ ‡ç­¾é¡µ - å†å²æ•°æ®æŒ‰é’®éšè—
- [ ] EMSæ ‡ç­¾é¡µ - å†å²æ•°æ®æŒ‰é’®éšè—
- [ ] PCSæ ‡ç­¾é¡µ - å†å²æ•°æ®æŒ‰é’®éšè—
- [ ] Meteræ ‡ç­¾é¡µ - å†å²æ•°æ®æŒ‰é’®éšè—
- [ ] BMSæ ‡ç­¾é¡µ - å†å²æ•°æ®æŒ‰é’®éšè—
- [ ] Thermalæ ‡ç­¾é¡µ - å†å²æ•°æ®æŒ‰é’®éšè—
- [ ] Fireæ ‡ç­¾é¡µ - å†å²æ•°æ®æŒ‰é’®éšè—
- [ ] è®¾ç½®é¢æ¿ä¸­çš„å†å²æ•°æ®ç±»å‹æŒ‰é’®éšè—
- [ ] ä¸­è‹±æ–‡åˆ‡æ¢æ—¶æ ‡ç­¾æ­£ç¡®æ˜¾ç¤º/éšè—
- [ ] é¡µé¢åˆ·æ–°åä¿æŒæ­£ç¡®çš„æ˜¾ç¤ºçŠ¶æ€

## å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: åˆ·æ–°é¡µé¢åå†å²æ•°æ®æ ‡ç­¾ä»ç„¶æ˜¾ç¤º

**åŸå› **: æµè§ˆå™¨ç¼“å­˜äº†æ—§ç‰ˆæœ¬çš„ data.html

**è§£å†³æ–¹æ¡ˆ**:
1. æŒ‰ Ctrl+F5 å¼ºåˆ¶åˆ·æ–°é¡µé¢
2. æˆ–æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡æ–°åŠ è½½

### Q2: åˆ‡æ¢è¯­è¨€åæ ‡ç­¾æ²¡æœ‰ç«‹å³æ›´æ–°

**åŸå› **: `languageChanged` äº‹ä»¶å¯èƒ½æ²¡æœ‰æ­£ç¡®è§¦å‘

**è§£å†³æ–¹æ¡ˆ**:
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤ `toggleHistoricalDataTabs()` å‡½æ•°è¢«è°ƒç”¨
4. æ£€æŸ¥ `getTouchscreenLang()` å‡½æ•°è¿”å›å€¼æ˜¯å¦æ­£ç¡®

### Q3: æŸäº›ç»„ä»¶çš„å†å²æ•°æ®æ ‡ç­¾æ²¡æœ‰éšè—

**åŸå› **: è¯¥æŒ‰é’®å¯èƒ½æ²¡æœ‰ `data-i18n="historicalData"` å±æ€§

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥è¯¥æŒ‰é’®çš„ HTML ä»£ç 
2. ç¡®è®¤æ˜¯å¦æœ‰æ­£ç¡®çš„ `data-i18n` å±æ€§
3. å¦‚æœç¼ºå¤±,æ·»åŠ è¯¥å±æ€§

## ç›¸å…³æ–‡ä»¶

- **ä¸»æ–‡ä»¶**: [touchscreen/data.html](touchscreen/data.html)
  - toggleHistoricalDataTabs å‡½æ•°: ç¬¬8429-8443è¡Œ
  - é¡µé¢åˆå§‹åŒ–è°ƒç”¨: ç¬¬8456è¡Œ
  - è¯­è¨€åˆ‡æ¢è°ƒç”¨: ç¬¬8420è¡Œ
- **å…¬å…±è„šæœ¬**: [touchscreen/common-header-scripts.js](touchscreen/common-header-scripts.js)
  - åŒ…å« `getTouchscreenLang()` å‡½æ•°
  - åŒ…å« `applyTouchscreenTranslations()` å‡½æ•°

## æœªæ¥æ‰©å±•

### æ·»åŠ å…¶ä»–æ¡ä»¶éšè—

å¦‚æœå°†æ¥éœ€è¦æ ¹æ®ç”¨æˆ·æƒé™æˆ–å…¶ä»–æ¡ä»¶éšè—æ ‡ç­¾,å¯ä»¥æ‰©å±• `toggleHistoricalDataTabs()` å‡½æ•°:

```javascript
function toggleHistoricalDataTabs() {
    const currentLang = getTouchscreenLang();
    const historicalDataButtons = document.querySelectorAll('[data-i18n="historicalData"]');

    // è·å–ç”¨æˆ·æƒé™
    const hasHistoryPermission = checkUserPermission('history');

    historicalDataButtons.forEach(button => {
        // è‹±æ–‡ç¯å¢ƒ æˆ– æ— æƒé™æ—¶éšè—
        if (currentLang === 'en' || !hasHistoryPermission) {
            button.style.display = 'none';
        } else {
            button.style.display = '';
        }
    });
}
```

### é…ç½®åŒ–æ§åˆ¶

ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶:

```javascript
// é…ç½®å¯¹è±¡
const featureConfig = {
    historicalData: {
        enabledLanguages: ['zh'],  // åªåœ¨ä¸­æ–‡ç¯å¢ƒå¯ç”¨
        enabledRoles: ['admin', 'engineer']  // åªå¯¹ç‰¹å®šè§’è‰²å¯ç”¨
    }
};

function toggleHistoricalDataTabs() {
    const currentLang = getTouchscreenLang();
    const config = featureConfig.historicalData;

    // æ£€æŸ¥å½“å‰è¯­è¨€æ˜¯å¦åœ¨å¯ç”¨åˆ—è¡¨ä¸­
    const isEnabled = config.enabledLanguages.includes(currentLang);

    const historicalDataButtons = document.querySelectorAll('[data-i18n="historicalData"]');
    historicalDataButtons.forEach(button => {
        button.style.display = isEnabled ? '' : 'none';
    });
}
```

## æ€»ç»“

é€šè¿‡æ·»åŠ  `toggleHistoricalDataTabs()` å‡½æ•°å¹¶åœ¨é€‚å½“çš„æ—¶æœºè°ƒç”¨ï¼ŒæˆåŠŸå®ç°äº†ï¼š

âœ… **è‹±æ–‡ç¯å¢ƒéšè—** - è‹±æ–‡ç”¨æˆ·çœ‹ä¸åˆ°å†å²æ•°æ®æ ‡ç­¾
âœ… **ä¸­æ–‡ç¯å¢ƒæ˜¾ç¤º** - ä¸­æ–‡ç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨å†å²æ•°æ®åŠŸèƒ½
âœ… **åŠ¨æ€åˆ‡æ¢** - è¯­è¨€åˆ‡æ¢æ—¶æ ‡ç­¾è‡ªåŠ¨æ˜¾ç¤º/éšè—
âœ… **å…¨é¢è¦†ç›–** - æ‰€æœ‰8ä¸ªå†å²æ•°æ®æŒ‰é’®éƒ½è¢«æ­£ç¡®å¤„ç†
âœ… **æ— ä¾µå…¥æ€§** - ä¸å½±å“å…¶ä»–åŠŸèƒ½,æ˜“äºç»´æŠ¤

è¿™ä¸ªå®ç°ä¸ºæœªæ¥çš„åŠŸèƒ½å¼€å‘é¢„ç•™äº†çµæ´»æ€§ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è½»æ¾è°ƒæ•´æ˜¾ç¤ºé€»è¾‘ï¼ğŸ‰
