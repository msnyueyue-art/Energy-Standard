# 触摸屏历史页面图表标题翻译修复说明

## 修复日期
2026-01-15

## 问题描述

在触摸屏系统的**中文环境**下,历史页面存在以下国际化问题:

### 问题1: Logo文本不完整
- **显示**: "储能系统"
- **期望**: "储能柜管理系统"

### 问题2: 图表标题显示英文
- **功率趋势分析**: 显示 "Power Trend Analysis" (应显示"功率趋势分析")
- **收益分析**: 显示 "Revenue Analysis" (应显示"收益分析")

## 根本原因

在 [touchscreen/touchscreen-i18n.js](touchscreen/touchscreen-i18n.js) 翻译配置文件中:

### 原因1: Logo文本翻译不完整
第10行的 `systemName` 设置为"储能系统",而不是"储能柜管理系统"

### 原因2: 缺少图表标题翻译键
历史页面部分缺少以下翻译键:
- `powerTrendAnalysis` (功率趋势分析)
- `revenueAnalysis` (收益分析)

虽然 HTML 中已经添加了 `data-i18n` 属性,但翻译配置文件中没有对应的翻译文本。

## 完整修复方案

### 修改文件
- **文件**: [touchscreen/touchscreen-i18n.js](touchscreen/touchscreen-i18n.js)

### 修复内容

#### 修复1: 修正Logo文本翻译 (第10行)

```javascript
// 修复前
zh: {
    systemName: '储能系统',
}

// 修复后
zh: {
    systemName: '储能柜管理系统',
}
```

#### 修复2: 添加图表标题翻译 (第242-243行)

在中文翻译部分的"历史页"区块添加:

```javascript
// ========== 历史页 ==========
historyTitle: '历史记录',
historyData: '历史数据',
powerTrendAnalysis: '功率趋势分析',      // 新增
revenueAnalysis: '收益分析',             // 新增
selectDate: '选择日期',
```

#### 修复3: 添加英文翻译 (第858-859行)

在英文翻译部分的"History"区块添加:

```javascript
// ========== History ==========
historyTitle: 'History',
historyData: 'Historical Data',
powerTrendAnalysis: 'Power Trend Analysis',  // 新增
revenueAnalysis: 'Revenue Analysis',         // 新增
selectDate: 'Select Date',
```

## 验证修复

### 修复后的翻译配置

**中文翻译** (第10行, 242-243行):
```javascript
zh: {
    systemName: '储能柜管理系统',          // 第10行
    // ...
    powerTrendAnalysis: '功率趋势分析',    // 第242行
    revenueAnalysis: '收益分析',           // 第243行
}
```

**英文翻译** (第624行, 858-859行):
```javascript
en: {
    systemName: 'Energy Storage System',      // 第624行
    // ...
    powerTrendAnalysis: 'Power Trend Analysis',  // 第858行
    revenueAnalysis: 'Revenue Analysis',         // 第859行
}
```

## 测试验证

### 中文环境测试
1. 设置语言为中文
2. 导航至历史页面
3. 验证显示:
   - ✅ Logo: "储能柜管理系统"
   - ✅ 图表1标题: "功率趋势分析"
   - ✅ 图表2标题: "收益分析"
   - ✅ 图表图例: "功率 (kW)", "SOC (%)"
   - ✅ 收益图例: "充电量 (kWh)", "放电量 (kWh)", "净收益 (¥)"

### 英文环境测试
1. 切换语言为英文
2. 导航至历史页面
3. 验证显示:
   - ✅ Logo: "Energy Storage System"
   - ✅ 图表1标题: "Power Trend Analysis"
   - ✅ 图表2标题: "Revenue Analysis"
   - ✅ 图表图例: "Power (kW)", "SOC (%)"
   - ✅ 收益图例: "Charging (kWh)", "Discharging (kWh)", "Net Revenue ($)"

### 语言切换测试
1. 在中文环境下查看历史页面 → 应显示中文标题
2. 点击语言切换按钮切换到英文 → 应立即显示英文标题
3. 切换回中文 → 应立即显示中文标题
4. ✅ 语言切换实时生效,无需刷新页面

## 国际化工作流程

### 翻译键查找过程
```javascript
// HTML 中的标记
<span data-i18n="powerTrendAnalysis">Power Trend Analysis</span>

// JavaScript 翻译函数查找
function applyTouchscreenTranslations() {
    const lang = getTouchscreenLang();  // 'zh' 或 'en'

    document.querySelectorAll('[data-i18n]').forEach(elem => {
        const key = elem.getAttribute('data-i18n');  // 'powerTrendAnalysis'
        const translation = touchscreenTranslations[lang][key];  // '功率趋势分析'

        if (translation) {
            elem.textContent = translation;  // 替换为中文
        }
    });
}
```

### 翻译配置结构
```javascript
const touchscreenTranslations = {
    zh: {
        // 翻译键: 中文文本
        powerTrendAnalysis: '功率趋势分析',
    },
    en: {
        // 翻译键: 英文文本
        powerTrendAnalysis: 'Power Trend Analysis',
    }
};
```

## 相关文件

- [touchscreen/touchscreen-i18n.js](touchscreen/touchscreen-i18n.js:10) - Logo文本修复
- [touchscreen/touchscreen-i18n.js](touchscreen/touchscreen-i18n.js:242-243) - 中文图表标题添加
- [touchscreen/touchscreen-i18n.js](touchscreen/touchscreen-i18n.js:858-859) - 英文图表标题添加
- [touchscreen/history.html](touchscreen/history.html:727) - 功率趋势分析图表
- [touchscreen/history.html](touchscreen/history.html:747) - 收益分析图表

## 影响范围

- **影响页面**: 触摸屏历史页面
- **影响组件**:
  - Logo文本显示
  - 功率趋势分析图表标题
  - 收益分析图表标题
- **用户影响**:
  - ✅ 中文用户看到完整的中文界面
  - ✅ 英文用户看到正确的英文界面
  - ✅ Logo显示完整的系统名称
  - ✅ 图表标题正确翻译
- **向后兼容**: ✅ 完全兼容,不影响其他页面

## 注意事项

1. ✅ 仅修改翻译配置文件,未修改HTML代码
2. ✅ 中英文翻译保持对应关系
3. ✅ 翻译键命名符合项目规范
4. ✅ 不影响其他页面和组件
5. ⚠️ 图表图例的翻译由 `translateChartLabel()` 函数处理(已存在)
6. ⚠️ 确保所有使用 `data-i18n` 属性的元素都有对应的翻译键

## 完整的翻译键列表

### Logo相关
```javascript
zh: { systemName: '储能柜管理系统' }
en: { systemName: 'Energy Storage System' }
```

### 图表标题
```javascript
zh: {
    powerTrendAnalysis: '功率趋势分析',
    revenueAnalysis: '收益分析'
}
en: {
    powerTrendAnalysis: 'Power Trend Analysis',
    revenueAnalysis: 'Revenue Analysis'
}
```

### 图表图例 (已存在,由 translateChartLabel 函数处理)
```javascript
zh: {
    'power': '功率 (kW)',
    'soc': 'SOC (%)',
    'charging': '充电量 (kWh)',
    'discharging': '放电量 (kWh)',
    'revenue': '净收益 (¥)'
}
en: {
    'power': 'Power (kW)',
    'soc': 'SOC (%)',
    'charging': 'Charging (kWh)',
    'discharging': 'Discharging (kWh)',
    'revenue': 'Net Revenue ($)'
}
```

## 经验总结

### 这次问题的教训

1. **翻译完整性**: 添加 `data-i18n` 属性后,必须同时添加对应的翻译文本
2. **中英文对应**: 每个翻译键必须在中英文配置中都存在
3. **文本准确性**: Logo文本应该显示完整的系统名称
4. **测试覆盖**: 添加翻译后必须在两种语言环境下测试

### 如何避免类似问题

1. **翻译检查清单**:
   - [ ] HTML中有 `data-i18n` 属性
   - [ ] 中文翻译配置中有对应的键值对
   - [ ] 英文翻译配置中有对应的键值对
   - [ ] 中英文翻译文本准确无误

2. **开发规范**:
   ```javascript
   // 1. HTML中添加属性
   <span data-i18n="newKey">English Text</span>

   // 2. 添加中文翻译
   zh: { newKey: '中文文本' }

   // 3. 添加英文翻译
   en: { newKey: 'English Text' }

   // 4. 测试两种语言
   ```

3. **测试流程**:
   - 英文环境下查看是否显示英文
   - 中文环境下查看是否显示中文
   - 语言切换测试

## 总结

本次修复解决了触摸屏历史页面的Logo和图表标题翻译问题:

1. **修正Logo文本**: "储能系统" → "储能柜管理系统"
2. **添加图表标题翻译**: 为 `powerTrendAnalysis` 和 `revenueAnalysis` 添加中英文翻译

**核心要点**:
- HTML的 `data-i18n` 属性必须在翻译配置文件中有对应的翻译文本
- 中英文翻译必须完整对应
- Logo应显示完整的系统名称

**修复效果**:
- ✅ 中文环境显示"储能柜管理系统"和中文图表标题
- ✅ 英文环境显示"Energy Storage System"和英文图表标题
- ✅ 语言切换实时生效
- ✅ 符合项目国际化架构规范
