# 模板详情策略类型国际化修复说明

## 问题描述

在英文环境下,当打开购电模板的【模板详情页】和【编辑模板页面】时,以下内容仍然显示中文:
- 策略类型显示"峰谷平尖"(应显示"Peak-Valley-Flat-Sharp")
- 模板名称显示中文(如"浙江峰谷电价")
- 模板描述显示中文(如"适用于浙江地区工商业用电")

## 根本原因

1. **策略类型"峰谷平尖"缺少翻译映射**:在 `templateI18n` 对象中没有为"峰谷平尖"添加英文翻译
2. **viewTemplate 函数使用了硬编码的 typeNameMap**:没有复用已有的 `getTemplateI18nText()` 函数
3. **模板名称和描述已有翻译**:实际上 `templateI18n` 中已经包含了预设模板的名称和描述翻译,只是在某些地方没有被正确应用

## 修复方案

### 1. 在 `templateI18n` 中添加"峰谷平尖"翻译 (第1906-1909行)

```javascript
'峰谷平尖': {
    en: 'Peak-Valley-Flat-Sharp',
    zh: '峰谷平尖'
},
```

### 2. 简化 viewTemplate 函数中的类型翻译逻辑 (第5808-5809行)

**修改前:**
```javascript
// 翻译策略类型名称
const typeNameMap = {
    '分时电价': lang === 'zh' ? '分时电价' : 'Time-of-Use (Peak-Valley-Flat-Sharp)',
    '阶梯电价': lang === 'zh' ? '阶梯电价' : 'Tiered Pricing',
    '固定电价': lang === 'zh' ? '固定电价' : 'Fixed Price'
};
const translatedTypeName = typeNameMap[template.typeName] || template.typeName;
```

**修改后:**
```javascript
// 翻译策略类型名称 - 使用 getTemplateI18nText 统一处理
const translatedTypeName = getTemplateI18nText(template.typeName);
```

## 技术原理

### getTemplateI18nText() 函数工作原理

位置:`electricity-price-new.html` 第1926-1936行

```javascript
function getTemplateI18nText(text) {
    if (!text) return text;

    // 如果没有翻译映射或当前语言是中文,返回原文
    if (!templateI18n[text] || !currentLang || currentLang === 'zh') {
        return text;
    }

    // 返回对应语言的翻译,如果没有则返回原文
    return templateI18n[text][currentLang] || text;
}
```

**功能:**
- 接收一个文本字符串作为键
- 在 `templateI18n` 对象中查找对应的翻译
- 根据当前语言(currentLang)返回相应的翻译文本
- 如果找不到翻译,则返回原文

### 支持的翻译内容

`templateI18n` 对象包含以下类型的翻译:

1. **模板名称**: 阶梯电价-固定、分时电价-逐月、浙江峰谷电价等
2. **模板描述**: 全年使用同一套阶梯标准、适用于浙江地区工商业用电等
3. **策略类型**: 阶梯电价、分时电价、峰谷平尖、固定电价
4. **时段标签**: 尖峰、高峰、平段、低谷等
5. **季节名称**: 夏季、冬季、春秋季

## 修复效果

修复后,在英文环境下:

| 位置 | 中文显示 | 英文显示 |
|------|---------|---------|
| 策略类型 | 峰谷平尖 | Peak-Valley-Flat-Sharp |
| 策略类型 | 分时电价 | Time-of-Use |
| 策略类型 | 阶梯电价 | Tiered Pricing |
| 策略类型 | 固定电价 | Fixed Price |
| 模板名称 | 浙江峰谷电价 | Zhejiang Peak-Valley Pricing |
| 模板描述 | 适用于浙江地区工商业用电 | For commercial and industrial use in Zhejiang |
| 时段标签 | 尖峰 | Sharp Peak |
| 时段标签 | 高峰 | Peak |
| 时段标签 | 平段 | Flat |
| 时段标签 | 低谷 | Valley |

## 测试验证

### 测试步骤:
1. 切换系统语言到英文环境
2. 进入购电模板页面
3. 选择一个预设模板(如"浙江峰谷电价")创建模板
4. 点击"View"按钮打开模板详情弹窗
5. 点击"Edit Template"按钮打开编辑页面

### 预期结果:
- ✅ 模板详情弹窗中的所有文本均显示英文
- ✅ 策略类型正确显示为"Peak-Valley-Flat-Sharp"
- ✅ 模板名称正确显示为"Zhejiang Peak-Valley Pricing"
- ✅ 模板描述正确显示为"For commercial and industrial use in Zhejiang"
- ✅ 时段标签正确显示英文(Sharp Peak, Peak, Flat, Valley)

## 相关文件

- `electricity-price-new.html`: 主要修复文件
  - 第1906-1909行: 添加"峰谷平尖"翻译映射
  - 第5808-5809行: 简化类型翻译逻辑

## 注意事项

1. **用户自定义模板**: 如果用户在英文环境下创建了自定义模板,输入的英文名称会直接保存,不会被翻译
2. **预设模板**: 所有预设模板的名称、描述和类型都会根据当前语言自动翻译
3. **翻译扩展**: 如需添加新的预设模板,需要在 `templateI18n` 对象中添加相应的中英文翻译映射

## 总结

此次修复通过以下方式解决了国际化问题:
1. ✅ 补充了缺失的"峰谷平尖"翻译映射
2. ✅ 统一使用 `getTemplateI18nText()` 函数处理所有文本翻译
3. ✅ 确保了模板详情页和编辑页的国际化一致性
4. ✅ 保持了代码的可维护性和扩展性
