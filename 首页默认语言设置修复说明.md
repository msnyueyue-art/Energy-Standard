# 首页默认语言设置修复说明

## 修复概述

将 `index.html` 首页的默认显示语言从中文改为英文，确保用户首次访问时看到英文界面。

## 问题描述

在用户首次访问 `index.html` 页面时，或者本地存储 (`localStorage`) 中没有保存语言偏好时：
- **当前行为：** 页面默认显示中文 ❌
- **期望行为：** 页面默认显示英文 ✅

## 修复方案

修改默认语言设置，将回退语言从 `'zh'` (中文) 改为 `'en'` (英文)。

## 修复内容

### 1. 修改默认语言变量

**文件：** `index.html` (第 484 行)

**修改前：**
```javascript
let currentLang = localStorage.getItem('language') || 'zh';
```

**修改后：**
```javascript
let currentLang = localStorage.getItem('language') || 'en';
```

**说明：**
- 当 `localStorage` 中没有保存语言偏好时，使用 `'en'` 作为默认值
- 如果用户之前已经选择过语言，仍会使用用户保存的语言偏好

### 2. 更新 HTML lang 属性

**文件：** `index.html` (第 2 行)

**修改前：**
```html
<html lang="zh">
```

**修改后：**
```html
<html lang="en">
```

**说明：**
- 初始 HTML 语言属性设置为英文
- JavaScript 加载后会根据当前语言动态更新此属性

### 3. 更新页面标题

**文件：** `index.html` (第 6 行)

**修改前：**
```html
<title>储能柜管理系统</title>
```

**修改后：**
```html
<title>Energy Storage Management System</title>
```

**说明：**
- 初始页面标题设置为英文
- JavaScript 加载后会根据当前语言动态更新标题

## 工作原理

### 语言初始化流程

```
页面加载
    ↓
读取 localStorage.getItem('language')
    ↓
有值? → 使用保存的语言
    ↓
无值? → 使用默认值 'en'
    ↓
调用 setLanguage(currentLang)
    ↓
更新页面所有文本、标题和 lang 属性
```

### 动态更新机制

`setLanguage` 函数会自动更新：
1. **页面所有文本元素** - 包括标题、副标题、描述等
2. **HTML lang 属性** - 设置为 `'zh-CN'` 或 `'en-US'`
3. **页面标题** - 浏览器标签页显示的标题

相关代码（第 579-582 行）：
```javascript
// 更新HTML语言属性
document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en-US';

// 更新页面标题
document.title = t.pageTitle;
```

## 效果对比

### 修改前

**首次访问（无 localStorage）：**
- 页面显示：中文 ❌
- HTML lang 属性：`zh-CN` ❌
- 页面标题：`储能柜管理系统` ❌

**用户已选择英文（有 localStorage）：**
- 页面显示：英文 ✅
- HTML lang 属性：`en-US` ✅
- 页面标题：`Energy Storage Management System` ✅

### 修改后

**首次访问（无 localStorage）：**
- 页面显示：英文 ✅
- HTML lang 属性：`en-US` ✅
- 页面标题：`Energy Storage Management System` ✅

**用户已选择中文（有 localStorage）：**
- 页面显示：中文 ✅
- HTML lang 属性：`zh-CN` ✅
- 页面标题：`储能柜管理系统` ✅

## 翻译内容对照

页面支持的所有翻译内容（第 486-507 行）：

| 翻译键 | 中文 | 英文 |
|--------|------|------|
| `pageTitle` | 储能柜管理系统 | Energy Storage Management System |
| `mainTitle` | 储能柜管理系统 | Energy Storage Management System |
| `mainSubtitle` | Energy Storage Management System | COMMERCIAL ENERGY STORAGE MANAGEMENT SYSTEM |
| `introText` | 智能化储能管理解决方案，提供全方位的能源监控、管理和优化服务。支持Web云平台远程管理和HMI触摸屏本地控制两种操作方式。 | Intelligent energy storage management solution, providing comprehensive energy monitoring, management and optimization services. Supports both Web cloud platform remote management and HMI touch screen local control. |
| `webTitle` | Web云平台 | Web Cloud Platform |
| `webDesc` | 通过浏览器远程访问<br>随时随地监控管理<br>支持多设备同时访问 | Remote access via browser<br>Monitor and manage anytime, anywhere<br>Support multiple devices simultaneously |
| `hmiTitle` | HMI触摸屏 | HMI Touch Screen |
| `hmiDesc` | 本地触摸屏操作<br>直观便捷的控制界面<br>实时响应快速操作 | Local touch screen operation<br>Intuitive and convenient control interface<br>Real-time response and fast operation |

## 语言持久化机制

### 保存用户偏好

当用户通过语言切换器选择语言时：
```javascript
function selectLang(lang) {
    currentLang = lang;
    localStorage.setItem('language', lang);  // 保存到本地存储
    setLanguage(lang);
    updateLangDropdown();
}
```

### 语言传递

用户从首页进入其他页面时：
- 所有页面都会读取 `localStorage.getItem('language')`
- 确保整个应用的语言设置保持一致
- 用户的语言偏好会在整个会话中保持

## 测试建议

### 1. 首次访问测试
1. 清除浏览器 localStorage（开发者工具 → Application → Local Storage → 删除 `language` 键）
2. 刷新页面
3. ✅ 验证页面显示英文
4. ✅ 验证页面标题为 "Energy Storage Management System"
5. ✅ 验证 HTML lang 属性为 "en-US"

### 2. 语言切换测试
1. 点击页面右上角的语言切换器
2. 选择"中文"
3. ✅ 验证页面立即切换为中文
4. ✅ 验证 localStorage 中保存了 `language: 'zh'`
5. 刷新页面
6. ✅ 验证页面仍然显示中文（读取 localStorage）

### 3. 语言持久化测试
1. 在首页选择"中文"
2. 点击"Web云平台"或"HMI触摸屏"进入其他页面
3. ✅ 验证其他页面也显示中文
4. 返回首页
5. ✅ 验证首页仍然显示中文

### 4. 跨浏览器测试
1. 在首页选择"English"
2. 关闭浏览器
3. 重新打开浏览器，访问首页
4. ✅ 验证页面显示英文（localStorage 跨会话保存）

## 涉及文件

| 文件 | 修改内容 | 行号 |
|------|---------|------|
| `index.html` | 修改默认语言为 `'en'` | 484 |
| `index.html` | 修改 HTML lang 属性为 `'en'` | 2 |
| `index.html` | 修改初始页面标题为英文 | 6 |

## 最佳实践

1. **统一默认语言：** 如果需要修改整个应用的默认语言，应该同时修改：
   - `index.html` 的默认语言
   - `common.js` 的默认语言（如果有全局设置）
   - 所有页面的 HTML lang 属性

2. **尊重用户选择：** 使用 localStorage 保存用户的语言偏好，确保用户不需要每次都重新选择

3. **SEO 优化：** HTML lang 属性帮助搜索引擎识别页面语言，应该与页面内容保持一致

4. **无障碍访问：** 正确的 lang 属性有助于屏幕阅读器选择正确的语音和发音

## 注意事项

⚠️ **重要提醒：**

1. **已有用户不受影响：** 如果用户之前已经选择过语言，修改默认值不会影响他们（因为使用 localStorage 中保存的值）

2. **新用户体验：** 只有首次访问的新用户才会看到英文作为默认语言

3. **清除缓存测试：** 测试时需要清除 localStorage 才能看到默认语言的效果

4. **其他页面：** 其他页面（如 `dashboard.html`）也有类似的语言初始化代码，如果需要统一默认语言，应该一并修改

## 日期

修复日期: 2026-01-14
