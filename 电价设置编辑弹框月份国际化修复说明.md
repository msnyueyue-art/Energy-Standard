# 电价设置编辑弹框月份国际化修复说明

## 修复概述

为电价设置页面 (`electricity-price-new.html`) 的编辑模板弹框中的季节配置部分添加了国际化支持,解决了英文环境下月份显示仍为中文的问题。

## 问题描述

在英文环境下,点击编辑上网模板(或购电模板)时,弹框底部的季节配置汇总信息中,月份仍然显示为中文格式:
- **中文:** `Summer (6月、7月、8月)`、`Winter (1月、2月、12月)`
- **期望英文:** `Summer (6, 7, 8)`、`Winter (1, 2, 12)`

## 修复内容

### 1. 新增月份格式化辅助函数

在 `electricity-price-new.html` 文件的第 5448-5493 行,新增了三个月份格式化函数:

#### a) `formatMonth(month)` - 格式化单个月份
```javascript
function formatMonth(month) {
    const lang = localStorage.getItem('language') || 'zh';
    return lang === 'zh' ? `${month}月` : `${month}`;
}
```
- **中文:** `6` → `6月`
- **英文:** `6` → `6`

#### b) `formatMonthsList(months)` - 格式化月份列表
```javascript
function formatMonthsList(months) {
    if (!months || months.length === 0) return '';
    const lang = localStorage.getItem('language') || 'zh';
    const separator = lang === 'zh' ? '、' : ', ';
    return months.map(m => formatMonth(m)).join(separator);
}
```
- **中文:** `[6, 7, 8]` → `6月、7月、8月`
- **英文:** `[6, 7, 8]` → `6, 7, 8`

#### c) `formatMonthsRange(months)` - 格式化月份范围(已优化)
```javascript
function formatMonthsRange(months) {
    // ... (智能识别连续月份并格式化)
}
```
- **中文:** `[6, 7, 8]` → `6-8月`
- **英文:** `[6, 7, 8]` → `6-8`
- **中文:** `[1, 2, 12]` → `1-2月, 12月`
- **英文:** `[1, 2, 12]` → `1-2, 12`

### 2. 替换所有硬编码的月份格式化代码

**修改位置:** 第 7462、7566、7685、7789 行

**修改前:**
```javascript
(${season.months.map(m => m + '月').join('、')})
```

**修改后:**
```javascript
(${formatMonthsList(season.months)})
```

### 3. 修改影响的功能区域

修改影响了以下4个显示区域:

1. **第 7462 行** - 购电模板 > 阶梯电价 > 分季节模式 > 电站配置查看页面
2. **第 7566 行** - 购电模板 > 分时电价 > 分季节模式 > 电站配置查看页面
3. **第 7685 行** - 上网模板 > 阶梯电价 > 分季节模式 > 电站配置查看页面
4. **第 7789 行** - 上网模板 > 分时电价 > 分季节模式 > 电站配置查看页面

## 效果对比

### 中文环境
- **季节显示:** `Summer (6月、7月、8月)`
- **季节显示:** `Winter (1月、2月、12月)`
- **季节显示:** `Spring and Autumn (3月、4月、5月、9月、10月、11月)`

### 英文环境
- **季节显示:** `Summer (6, 7, 8)`
- **季节显示:** `Winter (1, 2, 12)`
- **季节显示:** `Spring and Autumn (3, 4, 5, 9, 10, 11)`

## 技术特点

1. **智能分隔符:**
   - 中文使用顿号 `、`
   - 英文使用逗号加空格 `, `

2. **可扩展性:** 三个函数可用于所有需要显示月份的场景

3. **向后兼容:** 修改不影响现有功能逻辑

4. **语言响应:** 根据 localStorage 中的 language 设置自动切换

## 测试建议

1. **中文环境测试:**
   - 点击编辑任一分季节模式的模板
   - 验证底部季节汇总显示格式为 "X月、Y月、Z月"

2. **英文环境测试:**
   - 切换到英文
   - 点击编辑任一 Seasonal 模式的模板
   - 验证底部季节汇总显示格式为 "X, Y, Z"

3. **语言切换测试:**
   - 在编辑弹框打开状态下切换语言
   - 关闭弹框重新打开,验证显示正确

## 相关文件

- 主文件: `electricity-price-new.html`
- 相关函数: `formatMonth()`, `formatMonthsList()`, `formatMonthsRange()`

## 日期

修复日期: 2026-01-14
