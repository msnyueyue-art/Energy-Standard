# 🌐 货币符号语言切换完整测试指南

## 📋 测试前准备

1. 确保所有文件已保存
2. 清除浏览器缓存 (Ctrl + Shift + Delete)
3. 使用 Chrome/Edge 浏览器打开测试

## 🧪 快速测试流程

### 测试 1: dashboard.html

#### 步骤:
1. 打开 [dashboard.html](dashboard.html)
2. 默认显示中文界面,检查收益显示为 `¥` 符号
3. 点击右上角语言切换按钮,切换到 English
4. **验证点:**
   - ✅ 运行概览卡片中的 4 个收益指标 (Yesterday/Today/Month/Total) 显示 `$`
   - ✅ 能量图下方的收益指标显示 `$`
   - ✅ 鼠标悬停在收益趋势图上,tooltip 显示 `$`
   - ✅ 切换到 Map View,点击站点标记,弹窗中 Revenue 显示 `$`
5. 切换回中文,验证所有货币符号变为 `¥`

#### 预期结果:
```
中文环境:
昨日收益: ¥1,467
今日收益: ¥1,580

英文环境:
Yesterday Revenue: $1,467
Today Revenue: $1,580
```

---

### 测试 2: devices.html

#### 步骤:
1. 打开 [devices.html](devices.html)
2. 查看右侧 **Profit Statistics** 卡片
3. 默认中文环境,检查显示 `¥` 符号
4. 切换到 English
5. **验证点:**
   - ✅ Yesterday 收益显示 `$12,350`
   - ✅ Today 收益显示 `$8,450`
   - ✅ This Month 收益显示 `$326.5K`
   - ✅ Total 收益显示 `$1.85M`
6. 切换回中文,验证所有货币符号变为 `¥`

#### 预期结果:
```
中文环境:
昨日: ¥12,350
今日: ¥8,450

英文环境:
Yesterday: $12,350
Today: $8,450
```

---

### 测试 3: data-analysis.html (重点测试)

#### 步骤 1: 收益统计卡片
1. 打开 [data-analysis.html](data-analysis.html)
2. 查看左侧 **Revenue Statistics** 卡片
3. 默认中文环境,检查显示 `¥` 符号
4. 切换到 English
5. **验证点:**
   - ✅ Total Profit 显示 `$` (非 NaN)
   - ✅ Selling Profit 显示 `$` (非 NaN)
   - ✅ Self-use Saving 显示 `$` (非 NaN)
6. 切换回中文,验证显示 `¥`

#### 步骤 2: 数据表格
1. 点击 **Table** 标签页
2. 查看表格数据
3. **验证点 (中文环境):**
   - ✅ 表头: Charge Cost(¥) | Selling Profit(¥) | Net Profit(¥) | Self-use Saving(¥) | Total Revenue(¥)
   - ✅ 数据行: 所有收益列显示 `¥` 符号
   - ✅ 汇总行 (Total): 所有值显示 `¥` 符号
4. 切换到 English
5. **验证点 (英文环境):**
   - ✅ 表头: Charge Cost($) | Selling Profit($) | Net Profit($) | Self-use Saving($) | Total Revenue($)
   - ✅ 数据行: 所有收益列显示 `$` 符号
   - ✅ 汇总行: 所有值显示 `$` 符号

#### 步骤 3: 图表视图
1. 点击 **Chart** 标签页
2. 查看 **Revenue Trend** (收益趋势图)
3. **验证点 (英文环境):**
   - ✅ Y 轴标签显示 `$` (如 $2000, $4000)
   - ✅ 鼠标悬停数据点,tooltip 显示 `$` 符号
4. 查看 **Revenue Structure** (收益结构饼图)
5. **验证点:**
   - ✅ 图例显示正确的数值 (非 NaN)
   - ✅ 鼠标悬停扇区,tooltip 显示 `$` 符号
   - ✅ 饼图标签显示 `$` 符号
6. 切换回中文,验证所有图表显示 `¥`

#### 步骤 4: 时间维度切换
1. 在 Table 视图中
2. 切换时间维度: Monthly → Daily → Yearly
3. **验证点:**
   - ✅ 切换维度后,表格数据正确显示
   - ✅ 货币符号与当前语言一致
4. 在 Chart 视图中
5. 切换时间维度,验证图表正确更新

---

## 🎯 关键验证点总结

### ✅ 静态显示
- [ ] 页面加载后,所有收益数值正常显示 (非 NaN)
- [ ] 中文环境所有收益显示 `¥` 符号
- [ ] 英文环境所有收益显示 `$` 符号

### ✅ 动态切换
- [ ] 中文 → 英文: 所有 `¥` 立即变为 `$`
- [ ] 英文 → 中文: 所有 `$` 立即变为 `¥`
- [ ] 切换后数值保持正确 (不变为 NaN)
- [ ] 切换后图表正常显示

### ✅ 图表功能
- [ ] Tooltip 显示正确的货币符号
- [ ] Y 轴标签显示正确的货币符号
- [ ] 饼图标签显示正确的货币符号
- [ ] 图表数据数值正确 (非 NaN)

### ✅ 表格功能
- [ ] 表头货币符号正确
- [ ] 数据行货币符号正确
- [ ] 汇总行货币符号正确
- [ ] 切换时间维度后货币符号仍正确

---

## 🐛 常见问题排查

### 问题 1: 切换语言后显示 NaN
**原因:** 浏览器缓存了旧版本代码
**解决:** 清除缓存并强制刷新 (Ctrl + Shift + R)

### 问题 2: 部分区域货币符号未更新
**原因:** 可能该元素未添加 `data-revenue` 属性
**检查:** 打开开发者工具 (F12),查看元素是否有 `data-revenue` 属性

### 问题 3: 图表显示异常
**原因:** 图表未重新渲染
**检查:**
1. 控制台是否有 JavaScript 错误
2. 检查 `updateRevenueTrendChart` 和 `updateRevenueStructureChart` 函数是否正常调用

### 问题 4: 刷新页面后语言设置丢失
**原因:** localStorage 未正确保存
**检查:**
1. 打开开发者工具 → Application → Local Storage
2. 查看是否有 `language` 键

---

## 📊 测试结果记录表

| 页面 | 测试项 | 中文→英文 | 英文→中文 | 备注 |
|------|--------|-----------|-----------|------|
| dashboard.html | 运行概览卡片 | ⬜ | ⬜ | |
| dashboard.html | 能量图指标 | ⬜ | ⬜ | |
| dashboard.html | 趋势图 Tooltip | ⬜ | ⬜ | |
| dashboard.html | 地图弹窗 | ⬜ | ⬜ | |
| devices.html | Profit Statistics | ⬜ | ⬜ | |
| data-analysis.html | Revenue Statistics | ⬜ | ⬜ | |
| data-analysis.html | 数据表格 | ⬜ | ⬜ | |
| data-analysis.html | 趋势图 | ⬜ | ⬜ | |
| data-analysis.html | 饼图 | ⬜ | ⬜ | |

**测试通过标准:** 所有项目都打 ✅

---

## 🚀 自动化测试 (可选)

可以在浏览器控制台运行以下脚本快速验证:

```javascript
// 测试语言切换
function testCurrencySwitch() {
    console.log('=== 开始测试货币符号切换 ===');

    // 切换到英文
    selectLanguage('en');
    setTimeout(() => {
        const elements = document.querySelectorAll('[data-revenue]');
        const hasError = Array.from(elements).some(el =>
            el.textContent.includes('NaN') || !el.textContent.includes('$')
        );
        console.log('英文环境检查:', hasError ? '❌ 失败' : '✅ 通过');

        // 切换回中文
        selectLanguage('zh');
        setTimeout(() => {
            const hasError2 = Array.from(elements).some(el =>
                el.textContent.includes('NaN') || !el.textContent.includes('¥')
            );
            console.log('中文环境检查:', hasError2 ? '❌ 失败' : '✅ 通过');
        }, 500);
    }, 500);
}

// 运行测试
testCurrencySwitch();
```

---

## ✅ 测试完成确认

- [ ] 所有 3 个页面测试完成
- [ ] 所有验证点通过
- [ ] 未发现 NaN 错误
- [ ] 语言切换响应迅速
- [ ] 无控制台错误

**测试人员:** ___________
**测试日期:** ___________
**测试浏览器:** ___________
**测试结果:** ⬜ 通过 / ⬜ 失败

---

**相关文档:**
- [收益货币符号国际化说明.md](./收益货币符号国际化说明.md)
- [NaN错误修复说明.md](./NaN错误修复说明.md)
