<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Energy Storage Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            min-height: 100vh;
            display: flex;
            background: #f8f9fa;
            position: relative;
            overflow: hidden;
        }

        /* å·¦ä¾§å±•ç¤ºåŒº */
        .showcase-section {
            flex: 1;
            /* ä½¿ç”¨æœ¬åœ°æ‘„å›¾ç½‘çš„é£åŠ›å‘ç”µæœºå’Œå‚¨èƒ½æŸœå›¾ç‰‡ */
            background: url('æ‘„å›¾ç½‘_601826889_é£åŠ›å‘ç”µæœºå’Œå‚¨èƒ½æŸœ(éä¼ä¸šå•†ç”¨).jpg') center/cover no-repeat;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 60px;
            position: relative;
            background-size: cover;
            background-position: center;
        }
        
        /* èƒŒæ™¯é®ç½©å±‚ - å·²ç§»é™¤
        .showcase-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: none;
            z-index: 0;
        } */

        /* ç½‘æ ¼èƒŒæ™¯ - å¯é€‰ï¼Œå¦‚æœè¦ä¿ç•™ç½‘æ ¼æ•ˆæœ */
        .grid-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: grid-move 20s linear infinite;
            z-index: 1;
        }

        @keyframes grid-move {
            0% {
                transform: translate(0, 0);
            }
            100% {
                transform: translate(50px, 50px);
            }
        }

        /* å±•ç¤ºå†…å®¹ */
        .showcase-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            max-width: 500px;
        }

        .showcase-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .showcase-icon i {
            font-size: 60px;
            color: white;
        }

        .showcase-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 16px;
            letter-spacing: -0.5px;
        }

        .showcase-subtitle {
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 40px;
            font-weight: 300;
        }

        /* ç‰¹æ€§åˆ—è¡¨ */
        .features-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            text-align: left;
            max-width: 400px;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feature-icon i {
            font-size: 20px;
            color: white;
        }

        .feature-text {
            flex: 1;
        }

        .feature-text h4 {
            font-size: 16px;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .feature-text p {
            font-size: 14px;
            opacity: 0.8;
            font-weight: 300;
        }

        /* å³ä¾§ç™»å½•åŒº */
        .login-section {
            width: 480px;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 60px;
            box-shadow: -10px 0 40px rgba(0, 0, 0, 0.05);
        }

        /* Logoåœ¨å·¦ä¸Šè§’ */
        .logo-area-top {
            position: absolute;
            top: 30px;
            left: 30px;
            z-index: 10;
        }

        .logo {
            height: 50px;
            margin-bottom: 8px;
        }

        .logo img {
            height: 100%;
            width: auto;
            filter: brightness(0) invert(1); /* è®©logoå˜æˆç™½è‰² */
        }

        .system-name {
            font-size: 24px;
            color: white;
            font-weight: 600;
            margin-top: 8px;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            letter-spacing: 1px;
        }

        /* ç™»å½•æ ‡é¢˜ */
        .login-header {
            margin-bottom: 40px;
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            color: #212529;
            margin-bottom: 8px;
        }

        .login-desc {
            font-size: 15px;
            color: #6c757d;
        }

        /* è¡¨å• */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #495057;
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            font-size: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            transition: all 0.2s;
            background: white;
        }

        .form-input:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .form-input::placeholder {
            color: #adb5bd;
        }

        /* è®°ä½æˆ‘å’Œå¿˜è®°å¯†ç  */
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #0066cc;
        }

        .checkbox-group label {
            font-size: 14px;
            color: #495057;
            cursor: pointer;
            user-select: none;
        }

        .forgot-link {
            font-size: 14px;
            color: #0066cc;
            text-decoration: none;
            font-weight: 500;
        }

        .forgot-link:hover {
            text-decoration: underline;
        }

        /* ç™»å½•æŒ‰é’® */
        .btn-login {
            width: 100%;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 600;
            color: white;
            background: #0066cc;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 24px;
        }

        .btn-login:hover:not(:disabled) {
            background: #0052a3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
        }

        .btn-login:active {
            transform: translateY(0);
        }

        .btn-login:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* åˆ†éš”çº¿ */
        .divider {
            text-align: center;
            margin: 32px 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e9ecef;
        }

        .divider span {
            position: relative;
            padding: 0 16px;
            background: white;
            font-size: 13px;
            color: #adb5bd;
        }

        /* å…¶ä»–ç™»å½•æ–¹å¼ */
        .other-login {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
        }

        .other-btn {
            flex: 1;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
            color: #495057;
        }

        .other-btn:hover {
            border-color: #adb5bd;
            background: #f8f9fa;
        }

        .other-btn i {
            font-size: 18px;
        }

        /* æ³¨å†Œæç¤º */
        .register-tip {
            text-align: center;
            font-size: 14px;
            color: #6c757d;
        }

        .register-link {
            color: #0066cc;
            text-decoration: none;
            font-weight: 500;
        }

        .register-link:hover {
            text-decoration: underline;
        }

        /* ç‰ˆæƒä¿¡æ¯ */
        .copyright {
            position: absolute;
            bottom: 20px;
            left: 60px;
            right: 60px;
            text-align: center;
            font-size: 12px;
            color: #adb5bd;
        }

        /* è¯­è¨€åˆ‡æ¢å›¾æ ‡ */
        .lang-switcher {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 10000;
        }

        .lang-icon {
            font-size: 24px;  /* å›¾æ ‡å¤§å° */
            color: #000000;  /* çº¯é»‘è‰²å›¾æ ‡ */
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-block;
        }

        .lang-icon:hover {
            color: #333333;  /* hoveræ—¶ç¨å¾®å˜ç° */
            transform: scale(1.1);  /* è½»å¾®æ”¾å¤§æ•ˆæœ */
        }

        .lang-icon:active {
            transform: scale(0.95);
        }

        /* è¯­è¨€ä¸‹æ‹‰èœå• - ä¿æŒç™½è‰²é£æ ¼ */
        .lang-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: white;  /* ç™½è‰²èƒŒæ™¯ */
            border-radius: 12px;
            padding: 8px;
            min-width: 140px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.2s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .lang-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .lang-option {
            padding: 10px 12px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: #1f2937;  /* æ·±è‰²æ–‡å­— */
            font-weight: 500;
        }

        .lang-option:hover {
            background: #f3f4f6;  /* æµ…ç°è‰²èƒŒæ™¯ */
        }

        .lang-option.active {
            background: #e5f3ff;  /* æµ…è“è‰²èƒŒæ™¯ */
            color: #2563eb;  /* è“è‰²æ–‡å­— */
        }

        .lang-option .flag {
            font-size: 18px;
            line-height: 1;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .showcase-section {
                display: none;
            }

            .login-section {
                width: 100%;
                min-height: 100vh;
            }
        }

        @media (max-width: 480px) {
            .login-section {
                padding: 40px 30px;
            }
        }

        /* éªŒè¯ç æŒ‰é’® */
        .btn-verify {
            padding: 12px 20px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            color: #0066cc;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn-verify:hover:not(:disabled) {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .btn-verify:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            color: #6c757d;
        }

        /* åŠ è½½åŠ¨ç”» */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- è¯­è¨€åˆ‡æ¢å™¨ -->
    <div class="lang-switcher">
        <i class="fas fa-globe lang-icon" onclick="toggleLangDropdown()" title="åˆ‡æ¢è¯­è¨€"></i>
        <div class="lang-dropdown" id="langDropdown">
            <div class="lang-option active" onclick="selectLang('zh')">
                <span class="flag">ğŸ‡¨ğŸ‡³</span>
                <span>ä¸­æ–‡</span>
            </div>
            <div class="lang-option" onclick="selectLang('en')">
                <span class="flag">ğŸ‡ºğŸ‡¸</span>
                <span>English</span>
            </div>
        </div>
    </div>

    <!-- å·¦ä¾§å±•ç¤ºåŒº -->
    <div class="showcase-section">
        <div class="grid-background"></div>
        <!-- Logoæ”¾åœ¨å·¦ä¸Šè§’ -->
        <div class="logo-area-top">
            <div class="logo">
                <img src="logo.png" alt="Logo">
            </div>
            <div class="system-name" id="systemName">å·¥å•†å‚¨èƒ½æºç®¡ç†ç³»ç»Ÿ</div>
        </div>
    </div>

    <!-- å³ä¾§ç™»å½•åŒº -->
    <div class="login-section">
        <div class="login-header">
            <h2 class="login-title" id="loginTitle">æ¬¢è¿å›æ¥</h2>
            <p class="login-desc" id="loginDesc">è¯·ç™»å½•æ‚¨çš„è´¦æˆ·ä»¥ç»§ç»­</p>
        </div>

        <form id="loginForm" onsubmit="handleLogin(event)">
            <div class="form-group">
                <label class="form-label" id="usernameLabel">ç”¨æˆ·å</label>
                <input type="text" class="form-input" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autocomplete="username">
            </div>

            <div class="form-group">
                <label class="form-label" id="passwordLabel">å¯†ç </label>
                <input type="password" class="form-input" id="password" placeholder="è¯·è¾“å…¥å¯†ç " autocomplete="current-password">
            </div>

            <div class="form-group">
                <label class="form-label" id="captchaLabel">å›¾å½¢éªŒè¯ç </label>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <input type="text" class="form-input" id="captchaInput" placeholder="è¯·è¾“å…¥éªŒè¯ç " autocomplete="off" style="flex: 1;" maxlength="4">
                    <canvas id="captchaCanvas" width="120" height="40" style="border: 1px solid #dee2e6; border-radius: 8px; cursor: pointer;" onclick="generateCaptcha()" title="ç‚¹å‡»åˆ·æ–°éªŒè¯ç "></canvas>
                </div>
            </div>

            <div class="form-options">
                <div class="checkbox-group">
                    <input type="checkbox" id="remember">
                    <label for="remember" id="rememberLabel">è®°ä½æˆ‘</label>
                </div>
                <a href="#" class="forgot-link" id="forgotLink" onclick="showForgotPassword(event)">å¿˜è®°å¯†ç ï¼Ÿ</a>
            </div>

            <button type="submit" class="btn-login" id="loginBtn">
                <span id="loginBtnText">ç™»å½•</span>
            </button>
        </form>

        <!-- å¿˜è®°å¯†ç è¡¨å•ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <form id="forgotForm" style="display: none;" onsubmit="handleForgotPassword(event)">
            <div class="form-group">
                <label class="form-label" id="forgot_emailLabel">é‚®ç®±åœ°å€</label>
                <input type="email" class="form-input" id="resetEmail" placeholder="è¯·è¾“å…¥æ³¨å†Œæ—¶çš„é‚®ç®±" required>
            </div>

            <div class="form-group">
                <label class="form-label" id="forgot_verifyCodeLabel">éªŒè¯ç </label>
                <div style="display: flex; gap: 12px;">
                    <input type="text" class="form-input" id="verifyCode" placeholder="è¯·è¾“å…¥éªŒè¯ç " required style="flex: 1;">
                    <button type="button" class="btn-verify" id="sendCodeBtn" onclick="sendVerifyCode()">
                        <span id="forgot_sendCodeBtnText">è·å–éªŒè¯ç </span>
                    </button>
                </div>
            </div>

            <button type="submit" class="btn-login" id="resetBtn">
                <span id="resetBtnText">é‡ç½®å¯†ç </span>
            </button>

            <div style="text-align: center; margin-top: 20px;">
                <a href="#" class="forgot-link" id="forgot_backToLogin" onclick="showLoginForm(event)">è¿”å›ç™»å½•</a>
            </div>
        </form>

        <!-- é‡ç½®å¯†ç è¡¨å•ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <form id="resetPasswordForm" style="display: none;" onsubmit="handleResetPassword(event)">
            <div class="form-group">
                <label class="form-label">æ–°å¯†ç </label>
                <input type="password" class="form-input" id="newPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç " required>
            </div>

            <div class="form-group">
                <label class="form-label">ç¡®è®¤å¯†ç </label>
                <input type="password" class="form-input" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " required>
            </div>

            <button type="submit" class="btn-login" id="confirmResetBtn">
                <span id="confirmResetBtnText">ç¡®è®¤é‡ç½®</span>
            </button>

            <div style="text-align: center; margin-top: 20px;">
                <a href="#" class="forgot-link" onclick="showLoginForm(event)">è¿”å›ç™»å½•</a>
            </div>
        </form>

        <!-- æ³¨å†Œè¡¨å•ç¬¬ä¸€æ­¥ï¼šéªŒè¯é‚®ç®±ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <form id="registerForm" style="display: none;" onsubmit="verifyEmailFirst(event)">
            <div class="form-group">
                <label class="form-label" id="reg_nicknameLabel">æ˜µç§°</label>
                <input type="text" class="form-input" id="nickname" placeholder="è¯·è¾“å…¥æ‚¨çš„æ˜µç§°" required minlength="2">
            </div>

            <div class="form-group">
                <label class="form-label" id="reg_emailLabel">é‚®ç®±</label>
                <input type="email" class="form-input" id="registerEmail" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" required>
            </div>

            <div class="form-group">
                <label class="form-label" id="reg_verifyCodeLabel">é‚®ç®±éªŒè¯ç </label>
                <div style="display: flex; gap: 12px;">
                    <input type="text" class="form-input" id="registerVerifyCode" placeholder="è¯·è¾“å…¥éªŒè¯ç " required style="flex: 1;">
                    <button type="button" class="btn-verify" id="registerSendCodeBtn" onclick="sendRegisterVerifyCode()">
                        <span id="reg_sendCodeBtnText">è·å–éªŒè¯ç </span>
                    </button>
                </div>
            </div>

            <button type="submit" class="btn-login" id="verifyBtn">
                <span id="verifyBtnText">ä¸‹ä¸€æ­¥</span>
            </button>

            <div style="text-align: center; margin-top: 20px;">
                <span style="color: #6c757d; font-size: 14px;" id="reg_alreadyHaveAccount">å·²æœ‰è´¦æˆ·ï¼Ÿ</span>
                <a href="#" class="forgot-link" id="reg_loginNow" onclick="showLoginForm(event)">ç«‹å³ç™»å½•</a>
            </div>
        </form>

        <!-- æ³¨å†Œè¡¨å•ç¬¬äºŒæ­¥ï¼šè®¾ç½®å¯†ç ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div id="setPasswordForm" style="display: none;">
            <div class="login-header">
                <h2 class="login-title">è®¾ç½®å¯†ç </h2>
                <p class="login-desc">æ­¥éª¤ 2/2ï¼šè¯·è®¾ç½®æ‚¨çš„ç™»å½•å¯†ç </p>
            </div>

            <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                <div style="color: #0066cc; font-size: 14px; margin-bottom: 8px;">
                    <i class="fas fa-check-circle" style="margin-right: 8px;"></i>é‚®ç®±éªŒè¯æˆåŠŸ
                </div>
                <div style="color: #495057; font-size: 13px;">
                    <strong>æ˜µç§°ï¼š</strong><span id="verifiedNickname"></span>
                </div>
                <div style="color: #495057; font-size: 13px;">
                    <strong>é‚®ç®±ï¼š</strong><span id="verifiedEmail"></span>
                </div>
            </div>

            <form onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label class="form-label">è®¾ç½®å¯†ç </label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="è¯·è®¾ç½®å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required minlength="6">
                    <small style="color: #6c757d; font-size: 12px; margin-top: 4px; display: block;">
                        å¯†ç éœ€åŒ…å«å­—æ¯å’Œæ•°å­—ï¼Œé•¿åº¦6-20ä½
                    </small>
                </div>

                <div class="form-group">
                    <label class="form-label">ç¡®è®¤å¯†ç </label>
                    <input type="password" class="form-input" id="registerConfirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: flex-start; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="agreeTerms" required style="margin-top: 3px;">
                        <span style="font-size: 13px; color: #6c757d; line-height: 1.5;">
                            æˆ‘å·²é˜…è¯»å¹¶åŒæ„ã€Šç”¨æˆ·æœåŠ¡åè®®ã€‹å’Œã€Šéšç§æ”¿ç­–ã€‹
                        </span>
                    </label>
                </div>

                <button type="submit" class="btn-login" id="registerBtn">
                    <span id="registerBtnText">å®Œæˆæ³¨å†Œ</span>
                </button>

                <div style="text-align: center; margin-top: 20px;">
                    <a href="#" class="forgot-link" onclick="backToVerifyEmail(event)">è¿”å›ä¸Šä¸€æ­¥</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        // è¯­è¨€åˆ‡æ¢ç›¸å…³å˜é‡å’Œç¿»è¯‘æ–‡æœ¬
        let currentLang = localStorage.getItem('language') || 'en';

        const translations = {
            zh: {
                systemName: 'å·¥å•†å‚¨èƒ½æºç®¡ç†ç³»ç»Ÿ',
                loginTitle: 'æ¬¢è¿å›æ¥',
                loginDesc: 'è¯·ç™»å½•æ‚¨çš„è´¦æˆ·ä»¥ç»§ç»­',
                usernameLabel: 'ç”¨æˆ·å',
                usernamePlaceholder: 'è¯·è¾“å…¥ç”¨æˆ·å',
                passwordLabel: 'å¯†ç ',
                passwordPlaceholder: 'è¯·è¾“å…¥å¯†ç ',
                captchaLabel: 'å›¾å½¢éªŒè¯ç ',
                captchaPlaceholder: 'è¯·è¾“å…¥éªŒè¯ç ',
                rememberLabel: 'è®°ä½æˆ‘',
                forgotLink: 'å¿˜è®°å¯†ç ï¼Ÿ',
                loginBtnText: 'ç™»å½•',
                noAccountText: 'è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ',
                registerLink: 'ç«‹å³æ³¨å†Œ',
                resetPasswordTitle: 'é‡ç½®å¯†ç ',
                resetPasswordDesc: 'è¯·è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€ä»¥é‡ç½®å¯†ç ',
                emailLabel: 'é‚®ç®±åœ°å€',
                emailPlaceholder: 'è¯·è¾“å…¥æ³¨å†Œæ—¶çš„é‚®ç®±',
                verifyCodeLabel: 'éªŒè¯ç ',
                verifyCodePlaceholder: 'è¯·è¾“å…¥éªŒè¯ç ',
                sendCodeBtn: 'è·å–éªŒè¯ç ',
                resetBtn: 'é‡ç½®å¯†ç ',
                backToLogin: 'è¿”å›ç™»å½•',
                newPasswordLabel: 'æ–°å¯†ç ',
                newPasswordPlaceholder: 'è¯·è¾“å…¥æ–°å¯†ç ',
                confirmPasswordLabel: 'ç¡®è®¤å¯†ç ',
                confirmPasswordPlaceholder: 'è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ',
                confirmResetBtn: 'ç¡®è®¤é‡ç½®',
                createAccountTitle: 'åˆ›å»ºè´¦æˆ·',
                createAccountStep1: 'æ­¥éª¤ 1/2ï¼šéªŒè¯é‚®ç®±',
                createAccountStep2: 'æ­¥éª¤ 2/2ï¼šè®¾ç½®å¯†ç ',
                nicknameLabel: 'æ˜µç§°',
                nicknamePlaceholder: 'è¯·è¾“å…¥æ‚¨çš„æ˜µç§°',
                setPasswordTitle: 'è®¾ç½®å¯†ç ',
                setPasswordDesc: 'æ­¥éª¤ 2/2ï¼šè¯·è®¾ç½®æ‚¨çš„ç™»å½•å¯†ç ',
                emailVerifiedSuccess: 'é‚®ç®±éªŒè¯æˆåŠŸ',
                nicknameText: 'æ˜µç§°ï¼š',
                emailText: 'é‚®ç®±ï¼š',
                setPasswordLabel: 'è®¾ç½®å¯†ç ',
                setPasswordPlaceholder: 'è¯·è®¾ç½®å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰',
                passwordHint: 'å¯†ç éœ€åŒ…å«å­—æ¯å’Œæ•°å­—ï¼Œé•¿åº¦6-20ä½',
                agreeTerms: 'æˆ‘å·²é˜…è¯»å¹¶åŒæ„ã€Šç”¨æˆ·æœåŠ¡åè®®ã€‹å’Œã€Šéšç§æ”¿ç­–ã€‹',
                completeRegister: 'å®Œæˆæ³¨å†Œ',
                backToPrevious: 'è¿”å›ä¸Šä¸€æ­¥',
                nextStep: 'ä¸‹ä¸€æ­¥',
                alreadyHaveAccount: 'å·²æœ‰è´¦æˆ·ï¼Ÿ',
                loginNow: 'ç«‹å³ç™»å½•',
                loginSuccess: 'ç™»å½•æˆåŠŸ',
                loggingIn: 'ç™»å½•ä¸­...',
                verifying: 'éªŒè¯ä¸­...',
                resetting: 'é‡ç½®ä¸­...',
                resetSuccess: 'é‡ç½®æˆåŠŸ',
                registering: 'æ³¨å†Œä¸­...',
                registerSuccess: 'æ³¨å†ŒæˆåŠŸ'
            },
            en: {
                systemName: 'Commercial Energy Storage Management System',
                loginTitle: 'Welcome Back',
                loginDesc: 'Please sign in to your account to continue',
                usernameLabel: 'Username',
                usernamePlaceholder: 'Enter your username',
                passwordLabel: 'Password',
                passwordPlaceholder: 'Enter your password',
                captchaLabel: 'Captcha',
                captchaPlaceholder: 'Enter captcha',
                rememberLabel: 'Remember me',
                forgotLink: 'Forgot password?',
                loginBtnText: 'Sign In',
                noAccountText: "Don't have an account?",
                registerLink: 'Create Account',
                resetPasswordTitle: 'Reset Password',
                resetPasswordDesc: 'Please enter your email address to reset password',
                emailLabel: 'Email Address',
                emailPlaceholder: 'Enter your registered email',
                verifyCodeLabel: 'Verification Code',
                verifyCodePlaceholder: 'Enter verification code',
                sendCodeBtn: 'Get Code',
                resetBtn: 'Reset Password',
                backToLogin: 'Back to Login',
                newPasswordLabel: 'New Password',
                newPasswordPlaceholder: 'Enter new password',
                confirmPasswordLabel: 'Confirm Password',
                confirmPasswordPlaceholder: 'Enter new password again',
                confirmResetBtn: 'Confirm Reset',
                createAccountTitle: 'Create Account',
                createAccountStep1: 'Step 1/2: Verify Email',
                createAccountStep2: 'Step 2/2: Set Password',
                nicknameLabel: 'Nickname',
                nicknamePlaceholder: 'Enter your nickname',
                setPasswordTitle: 'Set Password',
                setPasswordDesc: 'Step 2/2: Please set your login password',
                emailVerifiedSuccess: 'Email verified successfully',
                nicknameText: 'Nickname: ',
                emailText: 'Email: ',
                setPasswordLabel: 'Set Password',
                setPasswordPlaceholder: 'Set password (at least 6 characters)',
                passwordHint: 'Password must contain letters and numbers, 6-20 characters',
                agreeTerms: 'I have read and agree to the Terms of Service and Privacy Policy',
                completeRegister: 'Complete Registration',
                backToPrevious: 'Back',
                nextStep: 'Next',
                alreadyHaveAccount: 'Already have an account?',
                loginNow: 'Sign in',
                loginSuccess: 'Login Successful',
                loggingIn: 'Signing in...',
                verifying: 'Verifying...',
                resetting: 'Resetting...',
                resetSuccess: 'Reset Successful',
                registering: 'Registering...',
                registerSuccess: 'Registration Successful'
            }
        };

        // åˆå§‹åŒ–è¯­è¨€
        function initLanguage() {
            setLanguage(currentLang);
            updateLangDropdown();
        }

        // åˆ‡æ¢è¯­è¨€ä¸‹æ‹‰èœå•
        function toggleLangDropdown() {
            const dropdown = document.getElementById('langDropdown');
            dropdown.classList.toggle('show');
        }

        // é€‰æ‹©è¯­è¨€
        function selectLang(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            setLanguage(lang);
            updateLangDropdown();

            // å…³é—­ä¸‹æ‹‰èœå•
            setTimeout(() => {
                document.getElementById('langDropdown').classList.remove('show');
            }, 200);
        }

        // æ›´æ–°ä¸‹æ‹‰èœå•æ¿€æ´»çŠ¶æ€
        function updateLangDropdown() {
            document.querySelectorAll('.lang-option').forEach(option => {
                option.classList.remove('active');
                if (option.onclick.toString().includes(currentLang)) {
                    option.classList.add('active');
                }
            });
        }

        // è®¾ç½®è¯­è¨€
        function setLanguage(lang) {
            const t = translations[lang];
            if (!t) return;

            // æ›´æ–°æ‰€æœ‰æ–‡æœ¬å…ƒç´ 
            const elements = {
                'systemName': t.systemName,
                'loginTitle': t.loginTitle,
                'loginDesc': t.loginDesc,
                'usernameLabel': t.usernameLabel,
                'passwordLabel': t.passwordLabel,
                'captchaLabel': t.captchaLabel,
                'rememberLabel': t.rememberLabel,
                'forgotLink': t.forgotLink,
                'loginBtnText': t.loginBtnText,
                'noAccountText': t.noAccountText,
                'registerLink': t.registerLink,
                // å¿˜è®°å¯†ç è¡¨å•
                'forgot_emailLabel': t.emailLabel,
                'forgot_verifyCodeLabel': t.verifyCodeLabel,
                'forgot_sendCodeBtnText': t.sendCodeBtn,
                'resetBtnText': t.resetBtn,
                'forgot_backToLogin': t.backToLogin,
                // æ³¨å†Œè¡¨å•ç¬¬ä¸€æ­¥
                'reg_nicknameLabel': t.nicknameLabel,
                'reg_emailLabel': t.emailLabel,
                'reg_verifyCodeLabel': t.verifyCodeLabel,
                'reg_sendCodeBtnText': t.sendCodeBtn,
                'verifyBtnText': t.nextStep,
                'reg_alreadyHaveAccount': t.alreadyHaveAccount,
                'reg_loginNow': t.loginNow
            };

            Object.keys(elements).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = elements[id];
                }
            });

            // æ›´æ–°è¾“å…¥æ¡†placeholder
            const placeholders = {
                'username': t.usernamePlaceholder,
                'password': t.passwordPlaceholder,
                'captchaInput': t.captchaPlaceholder,
                // å¿˜è®°å¯†ç è¡¨å•
                'resetEmail': t.emailPlaceholder,
                'verifyCode': t.verifyCodePlaceholder,
                // æ³¨å†Œè¡¨å•
                'nickname': t.nicknamePlaceholder,
                'registerEmail': t.emailPlaceholder,
                'registerVerifyCode': t.verifyCodePlaceholder
            };

            Object.keys(placeholders).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.placeholder = placeholders[id];
                }
            });

            // æ›´æ–°HTMLè¯­è¨€å±æ€§
            document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en-US';

            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = lang === 'zh' ? 'ç™»å½• - å‚¨èƒ½æŸœç®¡ç†ç³»ç»Ÿ' : 'Login - Energy Storage Management System';
        }

        // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.lang-switcher')) {
                document.getElementById('langDropdown').classList.remove('show');
            }
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–è¯­è¨€
        window.addEventListener('DOMContentLoaded', function() {
            initLanguage();
            generateCaptcha(); // ç”ŸæˆéªŒè¯ç 
        });

        // éªŒè¯ç ç›¸å…³å˜é‡å’Œå‡½æ•°
        let captchaCode = '';

        // ç”ŸæˆéšæœºéªŒè¯ç 
        function generateCaptcha() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // å»é™¤å®¹æ˜“æ··æ·†çš„å­—ç¬¦
            captchaCode = '';
            for (let i = 0; i < 4; i++) {
                captchaCode += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            drawCaptcha(captchaCode);
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('captchaInput').value = '';
        }

        // åœ¨canvasä¸Šç»˜åˆ¶éªŒè¯ç 
        function drawCaptcha(code) {
            const canvas = document.getElementById('captchaCanvas');
            const ctx = canvas.getContext('2d');

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // è®¾ç½®èƒŒæ™¯è‰²
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶å¹²æ‰°çº¿
            for (let i = 0; i < 3; i++) {
                ctx.strokeStyle = getRandomColor(180, 230);
                ctx.beginPath();
                ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.stroke();
            }

            // ç»˜åˆ¶å¹²æ‰°ç‚¹
            for (let i = 0; i < 30; i++) {
                ctx.fillStyle = getRandomColor(150, 200);
                ctx.beginPath();
                ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, 1, 0, 2 * Math.PI);
                ctx.fill();
            }

            // ç»˜åˆ¶éªŒè¯ç æ–‡å­—
            for (let i = 0; i < code.length; i++) {
                ctx.font = `bold ${20 + Math.random() * 5}px Arial`;
                ctx.fillStyle = getRandomColor(50, 100);
                ctx.textBaseline = 'middle';

                // éšæœºæ—‹è½¬è§’åº¦
                const angle = (Math.random() - 0.5) * 0.4;
                const x = 15 + i * 25;
                const y = 20;

                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(angle);
                ctx.fillText(code[i], 0, 0);
                ctx.restore();
            }
        }

        // ç”Ÿæˆéšæœºé¢œè‰²
        function getRandomColor(min, max) {
            const r = min + Math.floor(Math.random() * (max - min));
            const g = min + Math.floor(Math.random() * (max - min));
            const b = min + Math.floor(Math.random() * (max - min));
            return `rgb(${r},${g},${b})`;
        }

        // éªŒè¯éªŒè¯ç 
        function validateCaptcha(input) {
            return input.toUpperCase() === captchaCode;
        }

        // ç™»å½•å¤„ç†
        function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const loginBtn = document.getElementById('loginBtn');
            const btnText = document.getElementById('loginBtnText');

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            loginBtn.disabled = true;
            const t = translations[currentLang] || translations['zh'];
            btnText.innerHTML = `<span class="spinner"></span>${t.loggingIn}`;

            // æ¨¡æ‹Ÿç™»å½•è¿‡ç¨‹
            setTimeout(() => {
                // ä¿å­˜ç™»å½•çŠ¶æ€
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('username', username || 'guest');

                // ç™»å½•æˆåŠŸ
                btnText.textContent = t.loginSuccess;

                // è·³è½¬åˆ°ä»ªè¡¨ç›˜
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 500);
            }, 1500);
        }

        // æ˜¾ç¤ºå¿˜è®°å¯†ç è¡¨å•
        function showForgotPassword(event) {
            event.preventDefault();
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('forgotForm').style.display = 'block';
            document.getElementById('resetPasswordForm').style.display = 'none';

            // æ›´æ–°æ ‡é¢˜
            const t = translations[currentLang] || translations['zh'];
            document.querySelector('.login-title').textContent = t.resetPasswordTitle;
            document.querySelector('.login-desc').textContent = t.resetPasswordDesc;

            // ç¡®ä¿å¿˜è®°å¯†ç è¡¨å•çš„æ–‡æœ¬ä¹Ÿæ˜¯æ­£ç¡®çš„è¯­è¨€
            setLanguage(currentLang);
        }

        // æ˜¾ç¤ºç™»å½•è¡¨å•
        function showLoginForm(event) {
            if (event) event.preventDefault();
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('forgotForm').style.display = 'none';
            document.getElementById('resetPasswordForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('setPasswordForm').style.display = 'none';

            // æ¢å¤æ ‡é¢˜ - åªæ›´æ–°ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„æ ‡é¢˜
            const t = translations[currentLang] || translations['zh'];
            const titles = document.querySelectorAll('.login-title');
            const descs = document.querySelectorAll('.login-desc');
            if (titles.length > 0) titles[0].textContent = t.loginTitle;
            if (descs.length > 0) descs[0].textContent = t.loginDesc;
        }
        
        // æ˜¾ç¤ºæ³¨å†Œè¡¨å•
        function showRegisterForm(event) {
            if (event) event.preventDefault();
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('forgotForm').style.display = 'none';
            document.getElementById('resetPasswordForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('setPasswordForm').style.display = 'none';

            // æ›´æ–°æ ‡é¢˜
            const t = translations[currentLang] || translations['zh'];
            document.querySelector('.login-title').textContent = t.createAccountTitle;
            document.querySelector('.login-desc').textContent = t.createAccountStep1;

            // ç¡®ä¿æ³¨å†Œè¡¨å•çš„æ–‡æœ¬ä¹Ÿæ˜¯æ­£ç¡®çš„è¯­è¨€
            setLanguage(currentLang);
        }
        
        // è¿”å›é‚®ç®±éªŒè¯æ­¥éª¤
        function backToVerifyEmail(event) {
            if (event) event.preventDefault();
            document.getElementById('registerForm').style.display = 'block';
            document.getElementById('setPasswordForm').style.display = 'none';
            
            // æ›´æ–°æ ‡é¢˜
            document.querySelector('.login-title').textContent = 'åˆ›å»ºè´¦æˆ·';
            document.querySelector('.login-desc').textContent = 'æ­¥éª¤ 1/2ï¼šéªŒè¯é‚®ç®±';
        }

        // å‘é€éªŒè¯ç 
        let countdownTimer = null;
        function sendVerifyCode() {
            const email = document.getElementById('resetEmail').value;
            if (!email) {
                alert('è¯·å…ˆè¾“å…¥é‚®ç®±åœ°å€');
                return;
            }

            const sendBtn = document.getElementById('sendCodeBtn');
            sendBtn.disabled = true;
            
            // æ¨¡æ‹Ÿå‘é€éªŒè¯ç 
            let countdown = 60;
            sendBtn.textContent = `${countdown}ç§’åé‡å‘`;
            
            countdownTimer = setInterval(() => {
                countdown--;
                if (countdown <= 0) {
                    clearInterval(countdownTimer);
                    sendBtn.disabled = false;
                    sendBtn.textContent = 'è·å–éªŒè¯ç ';
                } else {
                    sendBtn.textContent = `${countdown}ç§’åé‡å‘`;
                }
            }, 1000);
            
            // æ¨¡æ‹Ÿå‘é€æˆåŠŸæç¤º
            setTimeout(() => {
                alert(`éªŒè¯ç å·²å‘é€è‡³ ${email}`);
            }, 500);
        }

        // å¤„ç†å¿˜è®°å¯†ç è¡¨å•æäº¤
        function handleForgotPassword(event) {
            event.preventDefault();
            
            const email = document.getElementById('resetEmail').value;
            const code = document.getElementById('verifyCode').value;
            
            const resetBtn = document.getElementById('resetBtn');
            const btnText = document.getElementById('resetBtnText');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            resetBtn.disabled = true;
            btnText.innerHTML = '<span class="spinner"></span>éªŒè¯ä¸­...';
            
            // æ¨¡æ‹ŸéªŒè¯è¿‡ç¨‹
            setTimeout(() => {
                // éªŒè¯æˆåŠŸï¼Œæ˜¾ç¤ºé‡ç½®å¯†ç è¡¨å•
                document.getElementById('forgotForm').style.display = 'none';
                document.getElementById('resetPasswordForm').style.display = 'block';
                
                // æ›´æ–°æ ‡é¢˜
                document.querySelector('.login-title').textContent = 'è®¾ç½®æ–°å¯†ç ';
                document.querySelector('.login-desc').textContent = 'è¯·è¾“å…¥æ‚¨çš„æ–°å¯†ç ';
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                resetBtn.disabled = false;
                btnText.textContent = 'é‡ç½®å¯†ç ';
            }, 1500);
        }

        // å¤„ç†é‡ç½®å¯†ç 
        function handleResetPassword(event) {
            event.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }
            
            if (newPassword.length < 6) {
                alert('å¯†ç é•¿åº¦è‡³å°‘6ä½');
                return;
            }
            
            const confirmBtn = document.getElementById('confirmResetBtn');
            const btnText = document.getElementById('confirmResetBtnText');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            confirmBtn.disabled = true;
            btnText.innerHTML = '<span class="spinner"></span>é‡ç½®ä¸­...';
            
            // æ¨¡æ‹Ÿé‡ç½®è¿‡ç¨‹
            setTimeout(() => {
                btnText.textContent = 'é‡ç½®æˆåŠŸ';
                
                // 2ç§’åè¿”å›ç™»å½•
                setTimeout(() => {
                    showLoginForm(event);
                    alert('å¯†ç é‡ç½®æˆåŠŸï¼Œè¯·ä½¿ç”¨æ–°å¯†ç ç™»å½•');
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    confirmBtn.disabled = false;
                    btnText.textContent = 'ç¡®è®¤é‡ç½®';
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('forgotForm').reset();
                    document.getElementById('resetPasswordForm').reset();
                }, 1000);
            }, 1500);
        }

        // å‘é€æ³¨å†ŒéªŒè¯ç 
        let registerCountdownTimer = null;
        function sendRegisterVerifyCode() {
            const email = document.getElementById('registerEmail').value;
            if (!email) {
                alert('è¯·å…ˆè¾“å…¥é‚®ç®±åœ°å€');
                return;
            }

            const sendBtn = document.getElementById('registerSendCodeBtn');
            sendBtn.disabled = true;
            
            // æ¨¡æ‹Ÿå‘é€éªŒè¯ç 
            let countdown = 60;
            sendBtn.textContent = `${countdown}ç§’åé‡å‘`;
            
            registerCountdownTimer = setInterval(() => {
                countdown--;
                if (countdown <= 0) {
                    clearInterval(registerCountdownTimer);
                    sendBtn.disabled = false;
                    sendBtn.textContent = 'è·å–éªŒè¯ç ';
                } else {
                    sendBtn.textContent = `${countdown}ç§’åé‡å‘`;
                }
            }, 1000);
            
            // æ¨¡æ‹Ÿå‘é€æˆåŠŸæç¤º
            setTimeout(() => {
                alert(`éªŒè¯ç å·²å‘é€è‡³ ${email}`);
            }, 500);
        }

        // ç¬¬ä¸€æ­¥ï¼šéªŒè¯é‚®ç®±
        function verifyEmailFirst(event) {
            event.preventDefault();
            
            const nickname = document.getElementById('nickname').value;
            const email = document.getElementById('registerEmail').value;
            const verifyCode = document.getElementById('registerVerifyCode').value;
            
            // éªŒè¯æ˜µç§°
            if (nickname.length < 2) {
                alert('æ˜µç§°è‡³å°‘2ä¸ªå­—ç¬¦');
                return;
            }
            
            // éªŒè¯é‚®ç®±æ ¼å¼
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€');
                return;
            }
            
            // éªŒè¯éªŒè¯ç 
            if (!verifyCode || verifyCode.length < 4) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„éªŒè¯ç ');
                return;
            }
            
            const verifyBtn = document.getElementById('verifyBtn');
            const btnText = document.getElementById('verifyBtnText');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            verifyBtn.disabled = true;
            btnText.innerHTML = '<span class="spinner"></span>éªŒè¯ä¸­...';
            
            // æ¨¡æ‹ŸéªŒè¯è¿‡ç¨‹
            setTimeout(() => {
                // éªŒè¯æˆåŠŸï¼Œæ˜¾ç¤ºè®¾ç½®å¯†ç è¡¨å•
                document.getElementById('registerForm').style.display = 'none';
                document.getElementById('setPasswordForm').style.display = 'block';
                
                // æ˜¾ç¤ºå·²éªŒè¯çš„ä¿¡æ¯
                document.getElementById('verifiedNickname').textContent = nickname;
                document.getElementById('verifiedEmail').textContent = email;
                
                // ä¸´æ—¶å­˜å‚¨éªŒè¯ä¿¡æ¯
                window.tempRegisterInfo = {
                    nickname: nickname,
                    email: email
                };
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                verifyBtn.disabled = false;
                btnText.textContent = 'ä¸‹ä¸€æ­¥';
                
                // èšç„¦åˆ°å¯†ç è¾“å…¥æ¡†
                setTimeout(() => {
                    document.getElementById('registerPassword').focus();
                }, 100);
            }, 1500);
        }

        // ç¬¬äºŒæ­¥ï¼šè®¾ç½®å¯†ç å¹¶å®Œæˆæ³¨å†Œ
        function handleRegister(event) {
            event.preventDefault();
            
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;
            
            // éªŒè¯å¯†ç 
            if (password !== confirmPassword) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return;
            }
            
            if (password.length < 6) {
                alert('å¯†ç é•¿åº¦è‡³å°‘6ä½');
                return;
            }
            
            // éªŒè¯å¯†ç å¤æ‚åº¦ï¼ˆè‡³å°‘åŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰
            const hasLetter = /[a-zA-Z]/.test(password);
            const hasNumber = /\d/.test(password);
            if (!hasLetter || !hasNumber) {
                alert('å¯†ç éœ€åŒ…å«å­—æ¯å’Œæ•°å­—');
                return;
            }
            
            // éªŒè¯åè®®
            if (!agreeTerms) {
                alert('è¯·åŒæ„ç”¨æˆ·æœåŠ¡åè®®å’Œéšç§æ”¿ç­–');
                return;
            }
            
            // è·å–ä¹‹å‰éªŒè¯çš„ä¿¡æ¯
            const nickname = window.tempRegisterInfo.nickname;
            const email = window.tempRegisterInfo.email;
            
            const registerBtn = document.getElementById('registerBtn');
            const btnText = document.getElementById('registerBtnText');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            registerBtn.disabled = true;
            btnText.innerHTML = '<span class="spinner"></span>æ³¨å†Œä¸­...';
            
            // æ¨¡æ‹Ÿæ³¨å†Œè¿‡ç¨‹
            setTimeout(() => {
                btnText.textContent = 'æ³¨å†ŒæˆåŠŸ';
                
                // æ¨¡æ‹Ÿä¿å­˜ç”¨æˆ·ä¿¡æ¯
                const userInfo = {
                    nickname: nickname,
                    email: email,
                    password: password, // å®é™…åº”ç”¨ä¸­åº”åŠ å¯†
                    registerTime: new Date().toISOString()
                };
                
                // ä¿å­˜åˆ°localStorageï¼ˆå®é™…åº”ç”¨ä¸­åº”å‘é€åˆ°æœåŠ¡å™¨ï¼‰
                localStorage.setItem('userInfo', JSON.stringify(userInfo));
                
                // æ¸…é™¤ä¸´æ—¶æ•°æ®
                delete window.tempRegisterInfo;
                
                // 2ç§’åè‡ªåŠ¨ç™»å½•
                setTimeout(() => {
                    alert(`æ³¨å†ŒæˆåŠŸï¼æ¬¢è¿æ‚¨ï¼Œ${nickname}`);
                    
                    // è‡ªåŠ¨å¡«å……ç™»å½•ä¿¡æ¯
                    showLoginForm(event);
                    document.getElementById('username').value = email;
                    document.getElementById('password').value = password;
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    registerBtn.disabled = false;
                    btnText.textContent = 'å®Œæˆæ³¨å†Œ';
                    
                    // æ¸…ç©ºæ³¨å†Œè¡¨å•
                    document.getElementById('registerForm').reset();
                    document.getElementById('setPasswordForm').querySelector('form').reset();
                    
                    // è‡ªåŠ¨ç™»å½•
                    setTimeout(() => {
                        document.getElementById('loginForm').dispatchEvent(new Event('submit'));
                    }, 500);
                }, 1000);
            }, 2000);
        }

        // è‡ªåŠ¨èšç„¦
        window.addEventListener('load', () => {
            document.getElementById('username').focus();
        });
    </script>
</body>
</html>